# Root URL: https://osc.github.io/ood-documentation/latest

## https://osc.github.io/ood-documentation/latest/#
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/requirements.html
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
RedHat/CentOS 7
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
Ubuntu 20.04
✅
✅
Ubuntu 22.04
✅
✅
Debian 12
✅
✅
Amazon Linux 2023
✅
✅
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation.html
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation
Edit on GitHub
Installation
The OnDemand host machine needs to be setup similarly to a login node. This means that it will need:
RedHat/CentOS 7+ or Ubuntu 20.04-22.04 or Debian 12 or Amazon Linux 2023
the resource manager (e.g., Torque, Slurm, or LSF) client binaries and libraries used by the batch servers installed
configuration on both OnDemand node and batch servers to be able to submit, status, and delete jobs from command line
signed SSL certificate with corresponding intermediate certificate for your advertised OnDemand host name (e.g., ondemand.my_center.edu)
Adding Open OnDemand SELinux policies is optional for RHEL systems. Open OnDemand, by default, expects Apache to have SSL enabled by securing your Apache. Sites may reconfigure their deployment to allow for plain text traffic see FIXME-LINK-NEEDED.
1. Install Software
1. Enable Dependencies
2. Add repository and install
3. Start services
4. Verify installation
Building From Source
2. Authentication
Overview
OpenID Connect
OpenID Connect with Dex
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
NSF ACCESS
Other Insecure Options
3. Secure Apache httpd
1. Edit the Open OnDemand Portal ood-portal-generator-configuration file
2. Update CA (Dex Users only)
3. Restart the Apache service for the changes take effect.
4. Add SELinux
SELinux
SELinux after Updates
Firewall
Building From Source
Building from source is left as an exercise to the reader.
It’s not particularly difficult to build the code, but installing it with all the various files is. Should you be interested, review the Dockerfile and packaging specs for what would be involved.
https://github.com/OSC/ondemand/blob/master/Dockerfile
https://github.com/OSC/ondemand/tree/master/packaging
If you’d like a package built for a system that we don’t currently support, feel free to open a ticket!
https://github.com/OSC/ondemand/issues/new
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/add-cluster-config.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration
Edit on GitHub
Cluster Configuration
Cluster configuration files describe each cluster a user may submit jobs to and login hosts the user can ssh to. These files detail how the system can interact with your scheduler. Without them, many of the features in Open OnDemand won’t work - including interactive apps.
Indeed, one of the main reasons to use Open OnDemand is use your clusters interactively.
Apps that require proper cluster configuration include:
shell (connect to a cluster login node from the Dashboard App)
active-jobs (view a list of active jobs for the various clusters)
job-composer (submit jobs to various clusters)
All interactive apps such as Jupyter and RStudio
Tip
We provide a puppet module and an ansible role for automating all of this configuration.
Create the default directory that the cluster configuration files reside under:
sudo mkdir -p /etc/ood/config/clusters.d
Create a cluster YAML configuration file for each HPC cluster you want to provide access to. They must have the .yml or .yaml extensions.
Note
It is best to name the file after the HPC cluster it is defining. For example, we added the cluster configuration file /etc/ood/config/clusters.d/oakley.yml for the Oakley cluster here at OSC.
The simplest cluster configuration file for an HPC cluster with only a login node and no resource manager looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
Where host is the SSH server host for the given cluster.
In production you will also want to add a resource manager. That is because the active-jobs and job-composer pages won’t be able to list or submit jobs without a defined resource manager.
The Test Configuration page provides directions on using a Rake task to verify the resource manager configuration.
The A Working Example of a bin_overrides Script provides directions on how to provide a replacement or wrapper script for one or more of the resource manager client binaries.
Cluster Config
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/interactive/setup.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Setup Interactive Apps
Edit on GitHub
Setup Interactive Apps
This guide will walk you through setting up your Open OnDemand installation to support interactive apps that run on compute nodes.
Warning
This guide does not walk you through installing the software requirements a specific Interactive App may need on the compute node it runs on.
Quick Start Guide
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
3.1. Requirements
3.2. Steps to Enable in Apache
3.3. Verify it Works
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Feature
Property
Title
dashboard_title
Logo
dashboard_logo
Logo height
dashboard_logo_height
Favicon
public_url
Brand background color
brand_bg_color
Brand foreground color
brand_link_active_bg_color
Replace header title with logo
dashboard_header_img_logo
Use white text on black background for navbar.
navbar_type
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/debug.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring
Edit on GitHub
Debugging and Monitoring
OnDemand has a lot of moving parts and you may have to troubleshoot all sorts of things.
These pages should help you monitor & debug components or failure modes. As well as how to monitor your Open OnDemand deployment.
Apache httpd tips
Log locations
Restart services
Show VirtualHosts
Performance Tuning
Debugging Interactive Apps
Log location
App completes without being able to connect to it.
Logging
System Logs
Session Data
Prometheus Monitoring
Install via RPM
Install from Source
Test Prometheus Exporter
Prometheus Configuration
Grafana Dashboard
Process Exporter
Adding Google Analytics
Configure Open OnDemand
Querying Google Analytics
More Info
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/enable-desktops.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Enable Interactive Desktop
Edit on GitHub
Enable Interactive Desktop
This installation guide will walk you through setting up an Interactive Desktop app that your users will be able to use to launch a Gnome 2, Mate, or Xfce desktop on a compute node within your HPC cluster. The user should then be able to connect to a running session through their browser using the noVNC client.
Danger
Confirm that you have walked through the Setup Interactive Apps instructions for interactive apps before continuing on.
Quick Start Guide
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
Change to Xfce Desktop
Remove Form Field
Hard-code a Form Field
Change a Label
Add Help Message to Field
Change Field Default Value
Minimal LinuxHost Form
4. Custom Job Submission
Slurm
Torque
PBS Professional
LinuxHost Adapter
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
Enabling App Development
Interactive Apps
App Sharing
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » App Development
Edit on GitHub
App Development
OnDemand is made up of the platform (Apache and NGINX), Passenger apps and plugins. Passenger apps are rack based Ruby apps, wsgi based Python web apps, or Node.js apps that follow a convention for the app’s startup file.
The Dashboard app, Shell app, and all other core apps in OnDemand are Passenger apps that can be replaced by custom Passenger apps. Or you can create your own.
OnDemand’s Interactive Apps are plugins that contain configuration files and a job template for running a VNC Server or Web Server application (such as Jupyter or MATLAB) on a compute node.
App Development Guide
Enabling App Development
Enable in OnDemand v1.6+:
Enable in OnDemand v1.4 & v1.5:
Enable in OnDemand v1.3:
Specify dedicated host for development (optional)
Make everyone a developer by default (optional)
Interactive Apps
Manifest yml files
User Form (form.yml.erb)
Form Widgets
Dynamic Form Widgets
Render Template
Job Submission (submit.yml.erb)
Connection View
Sub-Apps and Reconfiguring exsting apps
Connection Parameters conn_params
Adding Additional Information to the session cards
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/install-ihpc-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Install Other Interactive Apps
Edit on GitHub
Install Other Interactive Apps
For Jupyter, we provide a tutorial for copying a generic Jupyter batch connect template and modifying it to work at your center. See Add a Jupyter App to install Jupyter.
If you have developed an app and would like to contribute it to the community, please post a description and link to the app to https://discourse.osc.edu/c/open-ondemand. In order to submit the code of an interactive app that you developed to the GitHub repository, it should be available on the developer’s GitHub and well commented. The comments need to include, but not limited to, mentioning if there are parts of the app that are site-specific. Also, the following files must be included:
LICENSE file - the license should be open source. If you are not sure what to choose, OnDemand uses MIT License.
README.md file - which specifies all the dependencies as well as cluster specific instructions
Table 6 Generic Interactive App Templates
Name
GitHub URL
Jupyter
https://github.com/OSC/bc_example_jupyter
While we don’t yet provide this for other interactive apps, here is a list of interactive apps that are currently deployed at OSC and other contributing institutions.
Table 7 Interactive App
Name
Institution
GitHub URL
Abaqus/CAE
OSC
https://github.com/OSC/bc_osc_abaqus
University of Utah
https://github.com/CHPC-UofU/bc_osc_abaqus
ANSYS Workbench
OSC
https://github.com/OSC/bc_osc_ansys_workbench
COMSOL Multiphysics
OSC
https://github.com/OSC/bc_osc_comsol
University of Utah
https://github.com/CHPC-UofU/bc_osc_comsol
MATLAB
OSC
https://github.com/OSC/bc_osc_matlab
University of Utah
https://github.com/CHPC-UofU/bc_osc_matlab
Jupyter
OSC
https://github.com/OSC/bc_osc_jupyter
University of Utah
https://github.com/CHPC-UofU/bc_osc_jupyter
University of Utah
https://github.com/CHPC-UofU/bc_jupyter_dynpart
Stanford
https://github.com/stanford-rc/sh_ood-apps#sh_jupyter
TechSquareInc
https://gitlab.com/mjbludwig/jupyter_experimental
Jupyter + Spark
OSC
https://github.com/OSC/bc_osc_jupyter_spark
Paraview
OSC
https://github.com/OSC/bc_osc_paraview
RStudio Server
OSC
https://github.com/OSC/bc_osc_rstudio_server
University of Utah
https://github.com/CHPC-UofU/bc_osc_rstudio_server
Stanford
https://github.com/stanford-rc/sh_ood-apps#sh_rstudio
VMD
OSC
https://github.com/OSC/bc_osc_vmd
QGIS
OSC
https://github.com/OSC/bc_osc_qgis
RELION (for REgularised LIkelihood OptimisatioN)
Shanghai Jiao Tong University (SJTU)
https://github.com/SJTU-HPC/bc_relion
Stata
OSC
https://github.com/OSC/bc_osc_stata
Shiny App
University of Utah
https://github.com/CHPC-UofU/bc_osc_example_shiny
Tensorboard
Stanford
https://github.com/stanford-rc/sh_ood-apps#sh_tensorboard
Visual Studio Code
OSC
https://github.com/OSC/bc_osc_codeserver
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps
Edit on GitHub
Tutorials: Interactive Apps
Below is a list of tutorials for developing interactive apps.
Tutorials
Add a Jupyter App
1. Software Requirements
2. Copy Jupyter App
3. Customize Attributes
4. Modify Submit Parameters
5. Deploy Jupyter App
Add an RStudio App
1. Copy RStudio App
2. Software Requirements
3. Setup Singularity
4. Customize Attributes
5. Deploy RStudio App
Add a MATLAB App
1. Software Requirements
2. Copy MATLAB App
3. Customize Attributes
4. Edit Launch Script
5. Modify Submit Parameters
6. Edit Form.js
7. Deploy MATLAB App
8. Known Issues
Add a Jupyter App on a Kubernetes Cluster
container spec
resource requests
configmap
mounts
init containers
submit yml in full
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
The container
Switch between SLURM and Kubernetes
container spec
mounts
submit yml in full
Add Custom Queues/Partitions
Use a Local Static List
Use a Global Static List
Troubleshooting Interactive Apps
The window cannot be resized/moved/maximized
MATLAB throws Java errors when the window is resized
Job finishes instantly because, desktop app backgrounds itself
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-passenger-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Passenger Apps
Edit on GitHub
Tutorials: Passenger Apps
A Passenger App is any Rack-based Ruby app, WSGI-based Python app, or Node.js app that has a “startup file” following the convention that Phusion Passenger Web Application Server instances use to start the process. OnDemand uses the NGINX Integration mode for Passenger, where NGINX and Passenger and individual web app processes all communicate using UNIX domain sockets.
At the bottom of the page is a list of tutorials for developing Passenger apps for OnDemand.
Tutorials
Creating a Status App
Overview of App
Clone and Setup
Edit to Run and Parse Quota
Brand App
Publish App
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-dashboard-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Developing The OOD Dashboard
Edit on GitHub
Developing The OOD Dashboard
Warning
Enabling App Development must be completed first for this tutorial to work.
Open OnDemand is composed of several apps, one of which is the dashboard app. You can see some of the other apps that make up OOD here.
This tutorial aims to equip admins with the knowledge and tools for developing the Open OnDemand dashboard and shell apps directly from within OnDemand itself.
Tutorials
Developing the Dashboard App
Things To Know
Create a Dev Dashboard
Add .env.local File
Set Dev Configuration Directory
Add Dev Configurations
Develop OOD in OOD
Developing the Shell App
Create a Dev Shell
Develop the Shell
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference
Edit on GitHub
Configuration Reference
This is reference documentation for all the configuration files and commands that make up the Open OnDemand infrastructure.
Files
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
Commands
ood-portal-generator
nginx-stage
Overviews
PUN environment
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes
Edit on GitHub
Release Notes
v3.1 Release Notes
Administrative changes
New Features
Details of administrative changes
Details of new features
v3.0 Release Notes
Administrative changes
New Features
Thanks!
Security Fixes
Details of administrative changes
Details of new features
v2.0 Release Notes
Upgrading to v2.0.29
Upgrading from v1.8
Details
v1.8 Release Notes
Special thanks
Upgrading from v1.7
Upgrading from v1.6
Details
v1.7 Release Notes
Special thanks
Upgrading from v1.6
Upgrading from v1.5
Details
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/glossary.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Glossary
Edit on GitHub
Glossary
Cluster
Physical machines with a resource scheduler that users can submit jobs to.
Compute-node
The machine where a submitted job runs. Part of a cluster.
Login-node
A server on the compute cluster that can be anything from the OOD dashboard itself, to a shell, to the file-browser app, etc. Runs on the cluster but is not a compute-node.
Web-node
A term used for when a site or institution has enough funds/personel to run the OOD login on a dedicated server and not on a login-node.
PUN
The Per User Nginx. An Nginx instance running as the user.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/#
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/#
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://github.com/OSC/ood-documentation/blob/latest/source/index.rst
Skip to content
Navigation Menu
Sign in
Dismiss alert
OSC
/
ood-documentation
Public
Notifications
Fork 47
Star 8
Code
Issues
153
Pull requests
Actions
Projects
Wiki
Additional navigation options
 latest
Breadcrumbs
ood-documentation/source
/index.rst
Latest commit
Oglopf
add docs to develop dashboard and shell apps within ood itself (#912)
4 months ago
87f1fe9
 · 4 months ago
Jan 19, 2024
History
99 lines (79 loc) · 3.58 KB
File metadata and controls
Preview
Code
Blame
Raw
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC's Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
requirements installation installation/add-cluster-config how-tos/app-development/interactive/setup
customizations how-tos/debug enable-desktops how-tos/app-development
install-ihpc-apps tutorials/tutorials-interactive-apps tutorials/tutorials-passenger-apps tutorials/tutorials-dashboard-apps
architecture reference release-notes version-policy glossary issues/overview

## https://osc.github.io/ood-documentation/latest/#open-ondemand
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://openondemand.org/
Open OnDemand
Connecting Computing Power With Powerful Minds
Open OnDemand empowers students, researchers, and industry professionals 
with remote web access to supercomputers. 
Compute from anywhere
Run Open OnDemand
Perform high-power calculations, simulations, modeling, and more on the web.
See how
on Run Open OnDemand
Administer remote access
Install Open OnDemand
Make supercomputing accessible with our easy-to-use web portal. 
Learn more
on Install Open OnDemand
Branding
Careers
Licensing
Maintained by OSC
Please cite us Hudak et al., (2018). Open OnDemand: A web-based client portal for HPC centers. Journal of Open Source Software, 3(25), 622, https://doi.org/10.21105/joss.00622 or via our permanent code repos Jeff Ohrstrom, Travis Ravert, Gerald Byrket, Trey Dockendorf, & Alan Chalker. Open OnDemand Source Code. Zenodo. https://doi.org/10.5281/zenodo.6323791
This material is based upon work supported by the National Science Foundation under grant numbers 1534949, 1835725, 2138286, and 2303692 and supported by a team from the Massachusetts Green High Performance Computing Center, Ohio Supercomputer Center, U. of Buffalo CCR, U. of Colorado Boulder, and Virginia Tech.
If you have a disability and experience difficulty accessing this content, please contact the OH-TECH Digital Accessibility Team at accessibility@oh-tech.org.  For information regarding the accessibility and alignment with WCAG standards of the Open OnDemand software itself, please visit openondemand.org/accessibility
© 2024 Open OnDemand. All right reserved.
Privacy Policy

## https://osc.github.io/ood-documentation/latest/#community-contributions
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://github.com/PSC-PublicHealth/pha-nbextensions
Skip to content
Navigation Menu
Sign in
Dismiss alert
PSC-PublicHealth
/
pha-nbextensions
Public
Notifications
Fork 0
Star 5
Code
Issues
Pull requests
Actions
Projects
Security
Additional navigation options
PSC-PublicHealth/pha-nbextensions
 master
Go to file
Code
Folders and files
Name Last commit message Last commit date
Latest commit
 History
doc
    update_environment
    README.md
    setup.py
    Repository files navigation
README
pha-nbextensions
PHA Developed Notebook Extensions
About
PHA Developed Notebook Extensions
Resources
Readme
Activity
Custom properties
Stars
5 stars
Watchers
4 watching
Forks
0 forks
Report repository
Releases
No releases published
Packages
No packages published
Contributors
2
jswelling Joel Welling
jvd10
Languages
Python
100.0%
Footer
© 2024 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Docs
Contact
Manage cookies
Do not share my personal information

## https://discourse.osc.edu/c/open-ondemand
Sign Up
Log In
Oops! That page doesn’t exist or is private.
Log In
Popular
Issues with Bundler and Passenger when Updating Open OnDemand 3.0
Get Help
Error when connecting to interactive desktop
Get Help
Vulnerability in R language < 4.4.0
Announcements
Mod_authnz_external and pam authentication
Get Help
Upgraded to 3.1.4 - Garbled website now
Get Help
Import javascript used by the filepicker
Get Help
Using ondemand – can’t enter the portal or ssh
Get Help
Proxy error when downloading folders and files under “Home Directory” of “File” menu in open ondemand
Get Help
Setup Open OnDemand Desktop with GPU
Get Help
Run OOD in WSL on a Win10 VDI?
Get Help
More…
Recent
Launch of jupyterlab (rstudio server as well) gets Not Found
Get Help
Cluster shell access cannot resolve hostname
Get Help
Rstudio relative links don't work in help pane
Get Help
Inactivity timeout for both web page and SSH Shell session in OpenOnDemand
Get Help
Problems with integration with xdmod in LDAP authentication
Get Help
Installing Open OnDemand with LDAP for Authentication
Get Help
Jupyter Notebook Fails
Get Help
Sqlite3 database is locked issue
Get Help
Ondemand install - can't get to the login screen
Get Help
Websockify novnc - failed to connect to server - 400 error
Get Help
More…
Search this site
Search

## https://osc.github.io/ood-documentation/latest/#special-thanks
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://www.bowdoin.edu/it/resources/high-performance-computing.html
Menu
Info for
Information Technology
(207) 725-3030
Staff Directory
In this section
Main Content
High Performance Computing
Linux High Performance Computing (HPC)
HPC at Bowdoin
Originally supporting a single faculty member in a single department, the Bowdoin HPC environment now supports faculty and students across a variety of disciplines, including biology, chemistry, computer science, digital and computational studies, environmental studies, economics, geology, history, sociology, math, and physics, as well as many individual student and faculty research projects.
A wide variety of software packages and programming languages are available within the Linux HPC environment, both commercial and Open Source, including but not limited to ADF, Beast, C, C++, CUDA, Fortran, Gamess, Gaussian, Grass, IDL, Java, Mathematica, Matlab, Mopac, NBO, NWChem, Perl, Python, R (along with RStudio), Ruby, Sage, SPSS, Stata-MP, SuperMongo, and hundreds more.
There are two different methods for using the Linux HPC resources; interactively, and via a batch scheduler that manages the HPC Cluster.
Interactive Computing
Interactive Computing is the way that most people use a computer. This is essentially sitting at a single computer, running programs, and interacting with those programs either through a GUI (Graphical User Interface) or command line interface. Checking e-mail, browsing the web, and composing a document are examples of interactive computing. You would use interactive computing if you were running any software that displayed graphics, or required manual interaction with the program while it is running, such as inputting more data, typing additional information, or clicking on an icon. Interactive computing is best used when you are able to accomplish your goals during the time that you will be sitting at the computer, and can quit the program when you leave (ie, you are not leaving the computer running your job when you walk away from it).
Bowdoin Computing Cluster
The Bowdoin Computing Cluster is a group of Linux servers which appear as one big, multiprocessor, compute server that can run many computationally intensive jobs concurrently. The Cluster supports a wide range of jobs from simple shell scripts to heavy computational jobs and parallel processes. Jobs taking several days on a typical desktop machine might finish within hours using the Cluster environment, thus freeing up the desktop computer for other tasks while the Cluster resources process the job on dedicated computational nodes. People interact with the Bowdoin Computing Cluster via Slurm, which is a software environment that coordinates the resources of multiple computers. Slurm accepts jobs, puts them in a waiting queue until they can be run, sends them to a computational node, manages them during the run, and notifies the person when they are finished.
Typically if a job takes more than a few hours to run on a desktop machine, or the desktop machine needs to be available for other tasks, you should consider running the job on the Cluster.
Bowdoin maintains a High Performance Compute cluster with over 1,400 processing cores across 50+ nodes with a variety of memory configurations (from 384 Gb up to 2 Tb), and 20 NVIDIA GPUs. The cluster is accessible by all current faculty, students and staff with no additional fees or chargebacks. A dedicated Director of High Performance Computing maintains the cluster and works closely with faculty, students and staff to install and maintain general and specialized software. The cluster uses the Slurm workload manager hosted on the Linux operating system in addition to JupyterHub and our HPC Web Portal (Open OnDemand).
HPC Community @Bowdoin
"My collaborator, Tim Divoll from Indiana State University, and I use the HPC to conduct bioinformatic analyses of high throughput DNA sequencing data. The DNA sequences are a metabarcoding study to understand the diet of a Neotropical bat species, the frog-eating bat Trachops cirrhosus. T. cirrhosus has been well studied in captivity for its behavior of hunting frogs by eavesdropping on their calls, but their diet in the wild is largely unknown. We collected fecal samples from more than 100 T. cirrhosus individuals over multiple years and across dry and wet seasons in Panama. We then sequenced two gene regions, 16S and CO1 (using 454 sequencing and illumina sequencing respectively), from prey remains in the fecal samples. We are using the HPC to sort and assign taxonomy to the millions of sequences that result from these next-generation sequencing approaches. Our goal is to be able to comprehensively describe the diet of this bat for the first time, as well as assess how diet varies between adults and juveniles, across capture sites, and across seasons. Understanding a species' diet is a first step in better understanding its ecology, and potential approaches to conservation." -- Patricia Jones, Biology
"Several of my recent projects address how public assistance like welfare affect the long run outcomes of children. For example, one project focuses on the role of public assistance in delaying the onset of certain diseases or conditions like diabetes, asthma, and high blood pressure. This requires longitudinal data where we can follow people from childhood to adulthood. The project uses the Panel Study of Income Dynamics (PSID), an annual sample that follows households to today beginning in 1968. Several thousand families generate a lot of data when followed for 40 years with extensive information on demographics, income, labor, health, etc. The study estimates transition models of age at adverse health onset using computationally intensive latent variable methods that allow joint modeling of family income and public assistance. The HPC environment allows me to estimate models that use up to days of CPU time, and run more than one at a time . This would simply not be feasible on a desktop computer."  --John Fitzgerald, Economics
 "I am using a deep neural network to study a problem in theoretical mathematics: what is the minimum number of scalar multiplications necessary to multiply two matrices.  This is a long-standing problem that has never been analyzed using machine learning.  Based on some initial experiments using Bowdoin's GPUs, it looks the current known bound on the number of multiplications can be improved, perhaps substantially."  --Thomas Pietraho, Mathematics
"I am a biologist studying Gulf of Maine marine organisms’ response to changing waters and the underlying genetic mechanisms of adaptation. In order to do my work, I use the Bowdoin HPC Grid to align and analyze large datasets of DNA and RNA sequences. In addition, I harness the computing power of the HPC Grid to link underlying genetic variation with traits that matter to the organisms in the wild, e.g. how well a mussel can continue to build its shell in acidic water.

During the Fall, my Bowdoin Marine Science Semester students learn to use the bioinformatic pipelines on the HPC Grid to investigate population genomic patterns in a native Gulf of Maine intertidal snail species. These snails exhibit physical differences between populations in sheltered shorelines versus wave-exposed shorelines; the BMSS students utilized next generation sequencing techniques and the HPC to discern the genetic architecture underlying these physical differences.

This Spring 2017 semester, I am teaching The Omics Revolution: Computational Genomics and Big Data in the Field of Biology, where students learn to use the HPC Grid to analyze a variety of large-scale datasets common in the ‘Omics’ fields. The Omics Revolution students will choose a question and existing omic-scale dataset of interest, analyze that data to test their hypothesis, and write a scientific paper summarizing their findings."  --Sarah Kingston, Biology

"I have incorporated Amsterdam Density Functional (ADF) calculations into my research efforts with students since 2001. ADF calculations allow them to better understand the bonding and photochemical properties of molecules containing metals such as platinum, gold, iridium, ruthenium, and osmium. Beginning about 2005, I added a computational chemistry project as part of Chemistry 3400, an Advanced Inorganic Chemistry course. The project requires students to perform ADF calculations on a molecule of their choosing, and to write a report describing and interpreting the results of the calculations. This project complements the other parts of the course and, among other things, provides students interested in graduate work in chemistry with valuable computational chemistry experience.  Since 2008, the Bowdoin HPC Grid has allowed us to run much larger jobs, and multiple jobs at the same time, which is a great improvement over running on desktop computers, and also frees up the desktop computer for other tasks." --Jeff Nagle, Chemistry

"The HPC Grid has been a great resource for teaching and doing research with computational text analysis. I was able to be up and running quickly; the process is not intimidating. Students in my First Year Seminar “How to Read 1,000,000 Books” use programs written in R to isolate language usage patterns in over 1.2 billion data points collected from Google Books. My different research projects use smaller data sets: 1 million tweets, nearly 46,000 journal articles, and nearly 1,000 books. Having the HPC allows me to run my analyses without tying up the computer that I use for teaching and day-to-day activities and my student research assistants can do the same, which helps with collaboration. Sometimes this means reconfiguring a matrix with billions of elements, other times it means creating thousands of smaller documents for comparison. Completing these jobs, and completing them in a reasonable time frame, simply wouldn’t be possible without the HPC."  --Crystal Hall, Digital and Computational Studies

"My students and I use the Bowdoin Computing Grid to perform numerical relativity simulations of black holes. Einstein’s theory of gravity, general relativity, is encoded in Einstein’s equations, a complicated set of partial differential equations. The equations can be solved exactly only for special cases. In general, we have to rely on some approximation technique in order to study the behavior and interactions of black holes, as well as the gravitational radiation that they emit. A particular powerful technique are numerical simulations. In recent years we have used such ’numerical relativity’ simulations to study, for example, binaries of two orbiting black holes, as well as so-called ‘critical phenomena’ in the formation of black holes. These simulations require significant computational resources and can be performed only in high-performance computing environments. It is extremely useful to have such resources here at Bowdoin."  --Thomas Baumgarte, Physics

"I am utilizing the HPC for my research on cricket's neuronal plasticity in response to injury. In Dr. Horch's wet lab, we extracted RNA from the terminal ganglion of adult male crickets and are now building a transcriptome from the sequences. Thus far, we have used the HPC Grid to run programs such as bowtie, Fastqc, trim galore! to build our transcriptome. To identify target candidates involved in neuronal plasticity such as guidance molecules slit and semaphorin, we will use the Trinity program suite on the HPC grid and conduct differential analysis. The HPC's high computing capacity make it easy for me to submit jobs that do not use local resources on my computer, nor take years to finish given the high volume files I am working with. It would be impossible for me to complete my project in a thorough or efficient manner without the HPC Grid." --Meera Prasad, Biology and Religious Studies double major

"I am an economics and mathematics major and the HPC has been a great resource for my research with Prof. Nelson in the economics department and for my independent study with Prof. Pietraho in the mathematics department. For my economics research I use the HPC to apply a machine learning package to estimate the likelihood and to describe the factors that affect fishing spots in the Gulf of Maine. The dataset contains 21 bio-psychical and socio-economic variables for around 2.6 million coordinates in the Gulf of Maine. The processing power of the HPC allows for easy partitioning of this dataset to learn how these variables interact together, which can then be used to classify the corresponding occurrence of fishing spots. On the other hand, for my independent study in mathematics I am using a deep neural network to classify images. The objective is to use a pre-trained neural network that has been trained on a large dataset and multiple categories and then to retrain it on my smaller dataset. Such re-training allows us to explore how explore how accuracy of classification is affected. Both my projects could not have been implemented on my PC. The HPC has been a great facilitator for exploring the research questions I have and for demystifying the world of computing."  --Parikshit Sharma, Economics and Mathematics Major

"I am a Neuroscience major and Mathematics minor using the HPC for the bioinformatics aspects of my research on the compensatory growth responses to injury in crickets. In lab, I collected the prothoracic ganglion from 21 male adult crickets for RNA extraction and sequencing. During the summer of 2016, using the Trinity program suite on the HPC Grid, I assembled a de novo transcriptome of RNAseq read data and began differential expression analysis using EdgeR. I have also used bowtie, FastQC, the BLAST suite, and Tophat on the HPC for further analysis of my dataset. After an initial characterization of the guidance cue peptidome in my transcriptome, I will aim to identify novel candidate genes for involvement in the compensatory plasticity in response to injury using differential expression analysis. The high computing power of the Grid and ability to submit jobs that don’t require local resources on my computer have been hugely beneficial to my project." --Harris Fisher, Neuroscience Major
History of HPC at Bowdoin College
Spring 2003 - Creation of specialized Physics cluster (16 CPU cores total) supporting one computational application for Thomas Baumgarte

Spring 2008 - Hiring of Dj Merrill to support HPC / Research Computing

Fall 2008 - Creation of general purpose HPC SGE Grid to support campus-wide research.  Dan O'Leary, Chemistry, was the first faculty to use the new resource

Fall 2009 - HPC usage expands to the classroom teaching environment, supporting both research and academic use.  Chemistry, Computer Science, Math, Physics, Geology, Economics, and Biology are actively using the HPC environment

Spring 2010 - Code ported from the old Physics cluster to the new HPC Grid

Summer 2010 - Specialized Physics cluster retired

Summer 2010 - Dhiraj Murthy, Sociology, starts using the HPC environment for analyzing Twitter content

Summer 2011 - GPU compute capabilities added to HPC Grid

Fall 2012 - Digital and Computational Studies Major created

Summer 2013 - Gluster high speed data storage solution added to HPC environment

Summer 2014 - Campus core server environment upgraded.  "Best of" these systems re-purposed as HPC compute nodes, breaking the 500 CPU core barrier

Summer 2014 - Sarah Kingston, Biology, starts doing bioinformatics research using the HPC environment

Summer 2015 - Upgraded HPC core networking using Cisco's 10 Gb ultra-low latency Nexus 3548 switches, offering speeds comparable to Infiniband networking

Summer 2016 - Sarah Kingston teaches seminar on using the Bowdoin Computing Grid to run bioinformatics analysis
Fall 2016 - Institutional Research, Analytics & Consulting Division starts using the HPC environment for data set analysis, representing the first business (non-Academic) usage
Winter 2017 - In addition to the normal research efforts, multiple classes, an Honors Thesis, and several independent studies are using the HPC environment.

Winter 2021 - SGE Grid software replaced by Slurm Cluster software.
Current status: ~1400 CPU cores, 20 GPU cards, 15+ Commercial applications, hundreds of Open Source applications
255 Maine Street
Brunswick, Maine 04011
(207) 725-3000
Contact Us
Make a Gift
Request Info
Campaign
Offices & Services A-Z
Employment
Directory
Title IX
Accessibility
Policies
Facebook
Youtube
Twitter
Instagram

## http://www.ou.edu/oscer/people
This website uses cookies, which are necessary to its functioning and required to achieve the purposes illustrated in the Privacy Policy. By using this website you agree to the use of the Privacy Policy, which includes the use of cookies. Learn more
Close
People
The University of Oklahoma
Home
About
Getting Started
Accounts
Hardware & Software
Support
Education
Publications
Participants
Acknowledging
Events
People
Contact
  Quick Links
       Getting Started
       Request an OSCER Account
       Support Articles
       support@oscer.ou.edu
  
OU SUPERCOMPUTING CENTER FOR EDUCATION & RESEARCH (OSCER)
/
PEOPLE
OSCER Best Director Of All Time
And the best-director-of-all-time trophy belongs to... (drum rolling...)
Henry, our best boss of all time, of course!

OSCER Team
Name Email Phone
David Akin
Senior Systems Analyst david.akin@ou.edu (405) 325-7081
John Mueller
Systems Analyst
jmueller@ou.edu  
Henry Neeman
Executive Director, Research Computing hneeman@ou.edu
(405) 325-5386
Horst Severini
Associate Director for Remote & Heterogeneous Computing,
Research Computing Facilitator
severini@ou.edu (405) 325-7152
Soumya Bhattacharya
Systems Analyst
bhattacharya@ou.edu  
Patrick Calhoun
Petascale Storage Administrator
phineas@ou.edu (405) 325-7081
Thang Ha
Research Computing Facilitator ha7675@ou.edu (405) 357-8426
OU Supercomputing Center
for Education & Research
3200 Marshall Avenue, Suite 130
Norman, OK 73072
Accessibility
Sustainability
HIPAA
OU Job Search
Accreditation
Policies
Legal Notices
Copyright
Resources & Offices
OU Report It!

OSCER SOCIAL MEDIA
facebook
twitter
Updated 4/22/2024 by OU Supercomputing Center: support@oscer.ou.edu

## https://oregonstate.edu/
Skip to main content
Oregon State University



In OSU’s College of Forestry — ranked No. 1 in the U.S. — students gain hands-on experience in Oregon’s living laboratory.
Your path starts here
Oregon State University was founded more than 150 years ago as a land grant institution, building on the idea that everybody deserves an extraordinary education that’s attainable and accessible. Here you can determine your purpose, shape your identity and values and become who you want to be.
Apply Now
Request Info
Visit
#1
College town on the West Coast
Best Colleges
Top 10
for 10 years in a row in online education
U.S. News & World Report
#1
Most innovative university in the Pacific Northwest
U.S. News & World Report
Our Locations
Corvallis
OSU-Cascades
Online
Statewide
Hatfield Marine Science Center
OSU Portland Center
Oregon State’s beautiful, historic and state-of-the-art campus is located in one of America’s best college towns. Nestled in the heart of the Willamette Valley, Corvallis offers miles of mountain biking and hiking trails, a river perfect for boating or kayaking and an eclectic downtown featuring local cuisine, popular events and performances.
Corvallis Virtual Tour
Oregon's best public research university
With nearly 200 degree programs Oregon State has a path to the career and future you always wanted. 
As Oregon’s largest university, we draw people from all 50 states and more than 100 countries to a welcoming community that supports success, well-being and belonging for all. We are constantly learning, innovating and applying new skills to make the world better. You can too.
Find your major
Discover the people and stories of Oregon State
Video file
Celebrating OSU's distinguished professors
Video file
Earning two OSU degrees online has changed his life, his business and his community.
Video file
¡Sí, Se Puede! Make your dreams of college a reality.
Video file
Never stop pursuing your path. Lauren Steenson found hers over 12 years, five stations and countless adventures.
Read More Stories
OSU's Instagram
OSU's TikTok
OSU's Twitter
OSU's Facebook
OSU's Youtube
Spotify
1500 SW Jefferson Way
Corvallis, OR 97331
541-737-1000
Accessibility Information
Campus Map
Campus Safety
Contact OSU
Directory
Faculty and Staff Resources
Jobs
News
OSU Beaver Store
Reporting and Advocacy Resources
Copyright © 2024 Oregon State University
Privacy Information and Disclaimer
Apply Now
Request Info
Visit

## https://www.psc.edu/
ADAPT PA
ADAPT PA partners PSC with community colleges and PASSHE schools in PA for new programs, learning resources and curriculum enhancement.
We welcome new partners!
LEARN MORE
123456


Recent News from PSC
PSC’s Bridges-2 Joins Neocortex Among Elite Artificial Intelligence Computers Allocated through National NAIRR Pilot Project
by Ken Chiacchia | May 6, 2024 | Bridges-2, Neocortex, News, Press release, User News, What's new on Bridges-2
The Pittsburgh Supercomputing Center’s Bridges-2 supercomputer is now available to scientists through the National AI Research Resource (NAIRR) Pilot Project.
Bridges-2 Simulations Target Role of Red Blood Cells in Clot Formation
by Ken Chiacchia | May 2, 2024 | Bridges-2, Science Highlights
Addition Is Latest Step in Building First-Principle Model of How Clots Form and Function in Health and Disease
National AI Research Resource Announcement
by Ken Chiacchia | May 6, 2024 | Bridges-2, Neocortex, News, Press release
Click the title above to get the link for the announcement.
View more news
Accelerate your research on
Bridges-2, our newest supercomputer
LEARN MORE
Our Featured Projects
PSC maintains advanced infrastructure to support computation-heavy research in areas in: data analytics, machine learning, bimolecular simulation, AI and deep learning, and provides access to the national cyberinfrastructure community of resources.
HuBMAP
The Human BioMolecular Atlas Program is developing the tools to create an open, global atlas of the human body at the cellular level.
Learn More
12345
Want to help further our research?
Support the next big discovery or inspire the next class
of great thinkers with a gift to our center.
GIVE ONLINE
Pittsburgh Supercomputing Center
300 S. Craig St.
Pittsburgh, PA 15213
Phone: 412.268.4960
About Us
Calendar
PSC Staff
Careers
Giving
Contact Us
Bridges-2
Anton 2
Neocortex
© 2024 Pittsburgh Supercomputing Center, a joint computational research center with Carnegie Mellon University and the University of Pittsburgh.

## https://hprc.tamu.edu/
TEXAS A&M HIGH PERFORMANCE RESEARCH COMPUTING
MENU
   Search
Quick Links
New User Information
Accounts
Apply for Accounts
Manage Accounts
User Consulting
Training
Knowledge Base
Software
FAQ
User Guides
Launch
ACES
FASTER
Grace
Terra
Portal
Galaxy
Cluster Status
ACES
Nodes
Cores
Jobs
22/74 (30%)
1088/7056 (15%)
13R-52Q
FASTER
Nodes
Cores
Jobs
93/140 (66%)
4701/8888 (53%)
91R-13Q
Grace
Nodes
Cores
Jobs
351/861 (41%)
12618/41552 (30%)
606R-27Q
Terra
Nodes
Cores
Jobs
130/284 (46%)
2593/8332 (31%)
116R-75Q

Historical Status
Previous Slide
◀︎
Next Slide
▶︎
News
April 8
HPRC staff presenting at "Hear from Peers: Navigating AI in the Classroom" workshop
Mar 15
HPCwire article: Houston We Have a Solution: Addressing the HPC and Tech Talent Gap
Mar 06
HPRC team awarded ADM innovation grant
Feb 29
HPCwire article: South African Cluster Competition Team Enjoys Big Texas HPC Adventure
Feb 15
HPCwire article: It Doesn’t Get Much SWEETER
Jan 21
STEM-Trek NRG@SC23 Workshop: Inspiring and Enlightening!

News Archive
Events
July 21-25
PEARC24 Conference, Providence, RI
July 18-20
ACES Workshop
June 24-28
Summer Computing Academy Week 2
June 10-14
Summer Computing Academy Week 1
May 20-23
Seventh Annual Texas A&M Research Computing Symposium
System Notices
Terra Cluster Retirement, May 31
Posted at 04/05/2024 3:22pm
The Terra cluster will be retired in phases according to the following schedule:
On May 31, we will close job scheduling and power down the compute nodes on Terra. The login and data transfer nodes will remain available for retrieving and migrating data.
On June 30, the Terra cluster will be completely shutdown. Retrieval and/or migration of data MUST be completed by this date.
Users MUST only migrate data from Terra that will be used for future work to the other HPRC clusters. Any other data not intended for use on HPRC cluster that you want to retain MUST be copied to non-HPRC storage. All large quota increase requests over 10TB MUST be submitted by PIs, and will be reviewed and approved by the HPRC director.
Texas A&M University
Division of Research
Site Policies
Contact Us
Webmaster

## https://it.tufts.edu/it-computing/technology-research/high-performance-computing-tufts-research-cluster
Tufts Username
Tufts Password
Login
Forgot your Tufts Username or Password?
For security reasons, please quit your browser when you are done.
Do not bookmark this page.
Powered by
More about Shibboleth
Information Stewardship Policy
NEED HELP?
Please contact the TTS Service Desk
Call: 617-627-3376
Email: it@tufts.edu

## https://idre.ucla.edu/resources/hpc
Skip to main content
Toggle Mobile Navigation
Oops! Page not found...
404 Error
 Go to Homepage
Contact Us
Research Consulting
Our Organization
Contact Us
[Youtube Icon]
© 2023 The Regents of the University of California
Accessibility
Emergency
Privacy & Terms of Use

## https://docs.hpc.arizona.edu/


## http://www.buffalo.edu/ccr.html
Support
UB HomeMapsUB Directory
Center for Computational Research
High Performance Computing & High End Visualization
Who We Are
What We Do
User Support
Outreach
INFO FOR
High Performance Computing
Leading, High-Performance Computing and AI Cluster Powers Innovative Solutions
High Performance Computing
CCR remains a leader in university HPC
Supporting UB Researchers
Advancing our users' research & knowledge
Propelling Research
Cutting edge research done at CCR every day!
Engaging the Community
CCR's outreach extends to schools, businesses and the community
Get Started Today!
Take the next step by clicking on one of these icons to learn more about how CCR can help you
Researchers
Students
Business Partners

Research & Innovation
NSF ACCESS Metrics: ACCESS Monitoring and Measurement Service (MMS) is responsible for monitoring and measurement of the ACCESS Cyberinfrastructure (CI) facilities.

CCR Support
Welcome to CCR!  Our support staff is comprised of HPC specialists, computational scientists, system administrators, programmers, software developers, and database experts.  Staff are available to help users of all levels.  The CCR support pages offer a wide range of documentation, presentations, and examples to aid in the utilization of CCR resources to facilitate your research.  Our searchable knowledgebase provides users with answers to frequently asked questions, how-to articles on using the clusters & research cloud, and detailed step-by-step instructions for many of the tasks most users desire.  Contact us any time you need assistance!
Getting Started
Account Portals
Support Portal & Searchable Knowledgebase
Research Computing Infrastructure
Machine Status
Training Resources
Center for Computational Research
NYS Center of Excellence in Bioinformatics & Life Sciences
701 Ellicott St
Buffalo, NY 14203

Support Portal & Searchable Knowledgebase
© 2024 University at Buffalo. All rights reserved.  |  Privacy  |  Accessibility

## https://www.chpc.utah.edu/
CHPC - Research Computing and Data Support for the University
UNIVERSITY INFORMATION TECHNOLOGY




  CHPC - Research Computing and Data Support for the University
In addition to deploying and operating high performance computational resources and providing advanced user support and training, CHPC serves as an expert team to broadly support the increasingly diverse research computing and data needs on campus. These needs include support for big data, big data movement, data analytics, security, virtual machines, Windows science application servers, protected environments for data mining and analysis of protected health information, and advanced networking.
If you are new to CHPC, the best place to start to get more information on CHPC resources and policies is our Getting Started page.
Upcoming Events:
Please update your browser to view the iframe content.
Allocation Requests for Summer 2024 are Due June 1st, 2024
Posted May 1st, 2024
CHPC Downtime: Tuesday March 5 starting at 7:30am
Posted February 8th, 2024
Two upcoming security related changes
Posted February 6th, 2024
Allocation Requests for Spring 2024 are Due March 1st, 2024
Posted February 1st, 2024
CHPC ANNOUNCEMENT: Change in top level home directory permission settings
Posted December 14th, 2023
CHPC Spring 2024 Presentation Schedule Now Available
CHPC PE DOWNTIME: Partial Protected Environment Downtime  -- Oct 24-25, 2023
Posted October 18th, 2023
CHPC INFORMATION: MATLAB and Ansys updates
Posted September 22, 2023
CHPC SECURITY REMINDER
Posted September 8th, 2023
CHPC is reaching out to remind our users of their responsibility to understand what the software being used is doing, especially software that you download, install, or compile yourself. Read More...
News History...
CHPC Metrics: Wait Time in Hours (Protected ENV.): Per Job 
By CHPC Staff
The above graph shows the job wait time in hours for all of the general partition jobs on Redwood run between January 2018 and October 2022. 








 

 

 




  System Status
General Environment
last update: 2024-05-24 09:13:03
General Nodes
system cores % util.
kingspeak 670/972 68.93%
notchpeak 3094/3212 96.33%
lonepeak 2630/3128 84.08%
Owner/Restricted Nodes
system cores % util.
ash 0/1152 0%
notchpeak 14015/19128 73.27%
kingspeak 1754/5340 32.85%
lonepeak 336/416 80.77%

Protected Environment
last update: 2024-05-24 09:10:02
General Nodes
system cores % util.
redwood 87/616 14.12%
Owner/Restricted Nodes
system cores % util.
redwood 232/6408 3.62%

Cluster Utilization
THE CENTER FOR HIGH PERFORMANCE COMPUTING
155 S 1452 E, RM. 405
SLC, UT 84112-0190
801.585.3791 
STAY IN TOUCH
FIND US
CONTACT US
WEBMASTER
QUICK LINKS
A-Z INDEX
CAMPUS DIRECTORY
CAMPUS MAP
SHUTTLE TRACKER
CIS
UMAIL
@ THE U
© 2024 THE UNIVERSITY OF UTAH
INDIGENOUS LAND ACKNOWLEDGMENT NONDISCRIMINATION & ACCESSIBILITY DISCLAIMER PRIVACY CREDITS & ATTRIBUTIONS MEDIA CONTACTS LAST UPDATED: 5/1/24
X
Facebook
Instagram
Youtube

## https://osc.github.io/ood-documentation/latest/requirements.html
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
RedHat/CentOS 7
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
Ubuntu 20.04
✅
✅
Ubuntu 22.04
✅
✅
Debian 12
✅
✅
Amazon Linux 2023
✅
✅
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/requirements.html#supported-operating-systems
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
RedHat/CentOS 7
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
Ubuntu 20.04
✅
✅
Ubuntu 22.04
✅
✅
Debian 12
✅
✅
Amazon Linux 2023
✅
✅
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/requirements.html#software-requirements
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
ppc64le
RedHat/CentOS 7
✅
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
✅
Ubuntu 20.04
✅
✅
❌
Ubuntu 22.04
✅
✅
❌
Debian 12
✅
✅
✅
Amazon Linux 2023
✅
✅
❌
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/requirements.html#hardware-requirements
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
ppc64le
RedHat/CentOS 7
✅
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
✅
Ubuntu 20.04
✅
✅
❌
Ubuntu 22.04
✅
✅
❌
Debian 12
✅
✅
✅
Amazon Linux 2023
✅
✅
❌
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/requirements.html#browser-requirements
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
ppc64le
RedHat/CentOS 7
✅
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
✅
Ubuntu 20.04
✅
✅
❌
Ubuntu 22.04
✅
✅
❌
Debian 12
✅
✅
✅
Amazon Linux 2023
✅
✅
❌
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation.html
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation
Edit on GitHub
Installation
The OnDemand host machine needs to be setup similarly to a login node. This means that it will need:
RedHat/CentOS 7+ or Ubuntu 20.04-22.04 or Debian 12 or Amazon Linux 2023
the resource manager (e.g., Torque, Slurm, or LSF) client binaries and libraries used by the batch servers installed
configuration on both OnDemand node and batch servers to be able to submit, status, and delete jobs from command line
signed SSL certificate with corresponding intermediate certificate for your advertised OnDemand host name (e.g., ondemand.my_center.edu)
Adding Open OnDemand SELinux policies is optional for RHEL systems. Open OnDemand, by default, expects Apache to have SSL enabled by securing your Apache. Sites may reconfigure their deployment to allow for plain text traffic see FIXME-LINK-NEEDED.
1. Install Software
1. Enable Dependencies
2. Add repository and install
3. Start services
4. Verify installation
Building From Source
2. Authentication
Overview
OpenID Connect
OpenID Connect with Dex
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
NSF ACCESS
Other Insecure Options
3. Secure Apache httpd
1. Edit the Open OnDemand Portal ood-portal-generator-configuration file
2. Update CA (Dex Users only)
3. Restart the Apache service for the changes take effect.
4. Add SELinux
SELinux
SELinux after Updates
Firewall
Building From Source
Building from source is left as an exercise to the reader.
It’s not particularly difficult to build the code, but installing it with all the various files is. Should you be interested, review the Dockerfile and packaging specs for what would be involved.
https://github.com/OSC/ondemand/blob/master/Dockerfile
https://github.com/OSC/ondemand/tree/master/packaging
If you’d like a package built for a system that we don’t currently support, feel free to open a ticket!
https://github.com/OSC/ondemand/issues/new
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/install-software.html
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
1. Enable Dependencies
2. Add repository and install
3. Start services
4. Verify installation
Building From Source
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation » 1. Install Software
Edit on GitHub
1. Install Software
Open OnDemand uses these packages, among many others.
Apache HTTP Server 2.4
Ruby 3.0 with rake, bundler, and development libraries
Node.js 18
Some operating systems use Software Collections to satisfy these.
Note
This tutorial is run from the perspective of an account that has sudo access but is not root.
Warning
Be sure to check Supported Operating Systems and Architectures before proceeding with install to verify you are on a supported operating system and architecture.
Warning
If you are an administrator responsible for Open OnDemand, you are now an administrator of Apache Httpd as well. As such, you should get comfortable with it as from time to time you will have to troubleshoot it.
1. Enable Dependencies
CentOS 7RockyLinux/Alma Linux 8RockyLinux/Alma Linux 9RHEL 8RHEL 9
sudo yum install centos-release-scl epel-release
2. Add repository and install
RedHat/CentOS 7RedHat/Rocky Linux/AlmaLinux 8RedHat/Rocky Linux/AlmaLinux 9Ubuntu 20.04Ubuntu 22.04Debian 12Amazon Linux 2023
sudo yum install https://yum.osc.edu/ondemand/3.1/ondemand-release-web-3.1-1.el7.noarch.rpm

sudo yum install ondemand
3. Start services
RHEL/CentOS 7RHEL/Rocky 8 & 9Ubuntu & DebianAmazon Linux 2023
sudo systemctl start httpd24-httpd
sudo systemctl enable httpd24-httpd
4. Verify installation
Now that Open OnDemand is installed and Apache is running, it should be serving a public page telling you to come back here and setup authentication.
If this is the case - then you need to add authentication. The installation will not move forward without adding authentication.
After adding authentication, but before actually testing that it works, you should secure your Apache. This way you never send credentials over plain HTTP.
You may also want to enable SELinux.
If you’re seeing the default Apache page (Ubuntu & Debian users will) you will have to debug virtualhosts and likely configure a servername.
Building From Source
Building from source is left as an exercise to the reader.
It’s not particularly difficult to build the code, but installing it with all the various files is. Should you be interested, review the Dockerfile and packaging specs for what would be involved.
https://github.com/OSC/ondemand/blob/master/Dockerfile
https://github.com/OSC/ondemand/tree/master/packaging
If you’d like a package built for a system that we don’t currently support, feel free to open a ticket!
https://github.com/OSC/ondemand/issues/new
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/authentication.html
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
2. Authentication
Overview
OpenID Connect
OpenID Connect with Dex
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
NSF ACCESS
Other Insecure Options
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation » 2. Authentication
Edit on GitHub
2. Authentication
Open OnDemand supports most authentication modules that work with Apache HTTP Server version 2.4. The following Overview section provides an introduction to setting up these generic authentication modules with an Open OnDemand installation. Tutorials will also be provided with the focus on setting up some of the more common authentication modules (e.g., OpenID Connect with KeyCloak).
After installing Open OnDemand you must add authentication of some kind to generate the correct Apache configuration. When no authentication is supplied Apache will only serve a static page that directs you here.
No Open OnDemand functionality is available without authentication.
Note
If you managed to install an Apache authentication module at your center that currently does not have a tutorial listed below we would greatly appreciate it if you could take the time to contribute a detailed walkthrough.
Tip
Dex is a very good starting option if you can connect to LDAP or Active Directory and not an institutional Single Sign-On service.
Overview
1. Configure Apache Authentication
2. Setup User Mapping
3. Configure Logout
OpenID Connect
OpenID Connect with Dex
Installing OnDemand Dex package
Installing OnDemand Dex from source
Configuring OnDemand Dex
Managing the OnDemand Dex service
OnDemand Dex behind Apache reverse proxy
Dex Firewall
Configuring OnDemand Dex for LDAP
Customizing OnDemand Dex
OnDemand Dex configuration reference
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
1. Install Keycloak
2. Configure Keycloak
3. Configure OnDemand to authenticate with Keycloak
4. Add Custom Theme
5. Configure Keycloak with CILogon
Two Factor Auth using Duo with Keycloak
Install Keycloak Duo SPI
Configure Duo SPI
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
Prepare the Host
Install mod_auth_mellon
Configure mod_auth_mellon
Configure OOD
NSF ACCESS
OIDC Client Registration
Shibboleth and InCommon
Mapping Users
Other Insecure Options
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/add-ssl.html
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
1. Edit the Open OnDemand Portal ood-portal-generator-configuration file
2. Update CA (Dex Users only)
3. Restart the Apache service for the changes take effect.
4. Add SELinux
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation » 3. Secure Apache httpd
Edit on GitHub
3. Secure Apache httpd
The SSL protocol provides for a secure channel of communication between the user’s browser and the Open OnDemand portal. It is recommended that you secure your Apache server by adding these configurations.
Requirements:
A server name that points to the Open OnDemand server (ondemand.my_center.edu). I.e., nslookup ondemand.my_center.edu resolves to your instance.
signed SSL certificates with possible intermediate certificates
Note
Let’s Encrypt is a great option to obtain a free SSL certificate. You can read more about it in their Getting Started documentation.
In this example we assume the following certificates are provided:
Public certificate
/etc/pki/tls/certs/ondemand.my_center.edu.crt
Private key
/etc/pki/tls/private/ondemand.my_center.edu.key
Intermediate certificate
/etc/pki/tls/certs/ondemand.my_center.edu-interm.crt
1. Edit the Open OnDemand Portal ood_portal.yml file
/etc/ood/config/ood_portal.yml as such:
# /etc/ood/config/ood_portal.yml
---

# ...
servername: ondemand.my_center.edu
ssl:
  - 'SSLCertificateFile "/etc/pki/tls/certs/ondemand.my_center.edu.crt"'
  - 'SSLCertificateKeyFile "/etc/pki/tls/private/ondemand.my_center.edu.key"'
  - 'SSLCertificateChainFile "/etc/pki/tls/certs/ondemand.my_center.edu-interm.crt"'
Note
For documentation on SSL directives please see: https://httpd.apache.org/docs/2.4/mod/mod_ssl.html
2. Update CA (Dex Users only)
Dex users may encounter issues with SSL certificates like:
remote error: tls: unknown certificate authority
If this is the case, you need to ensure that their certificate authority (CA) is in the system trust store and that your CA certificates are up to date.
First, try updating your CA certificates. This could especially happen when you have a Let’s Encrypt and your machine does not know about that certificate authority.
RHELUbuntu & Debian
sudo yum update ca-certificates
If you’re still having issues, copy your certificate authority (examples could be fullchain.pem) to your trust store. replace CA CERT location with the actual certificate authority you’re using and run these commands to copy it to the appropriate place.
RHELUbuntu & Debian
sudo cp <CA CERT location> /etc/pki/ca-trust/source/anchors/
sudo update-ca-trust
3. Restart the Apache service for the changes take effect.
Restart the Apache service for the changes take effect.
Now when you browse to your OnDemand portal at:
http://ondemand.my_center.edu
it should redirect you to the HTTP over SSL protocol deployment:
https://ondemand.my_center.edu
where depending on your browser, should display a green lock of some kind to indicate that the site is secure.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/modify-system-security.html
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
SELinux
SELinux after Updates
Firewall
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation » 4. Add SELinux
Edit on GitHub
4. Add SELinux
SELinux
If you plan to use SELinux on the Open OnDemand host you must install the ondemand-selinux package.
sudo yum install ondemand-selinux
Note
OnDemand runs under the ood_pun_t context.
The OnDemand SELinux package makes several changes to allow OnDemand to run with SELinux enabled.
Set contexts of several filesystem paths specific to OnDemand.
Enable SELinux booleans.
Apply a custom policy to allow actions to performed by ood_pun_t context.
The custom SELinux booleans provided by the OnDemand SELinux policy:
ondemand_manage_user_home_dir (default=off): Necessary if user home directories are local disk and not NFS. This is useful when OnDemand is hosted on the system also acting as the NFS server for home directories.
ondemand_manage_vmblock (default=off): So far this has only proven necessary when running OnDemand inside of Vagrant when the home directory is a Virtualbox mount.
ondemand_use_nfs (default=on): Allow OnDemand to manage NFS home directories, which is necessary if home directories are accessible via NFS on the OnDemand web node.
ondemand_use_ssh (default=on): Allow OnDemand to use SSH for Shell app and Linux Host Adapter.
ondemand_use_sssd (default=on): Allows OnDemand to access SSSD
ondemand_use_slurm (default=off): Allows OnDemand to interact with SLURM and MUNGE.
ondemand_use_torque (default=off): Allows OnDemand to interact with Torque.
ondemand_use_kubernetes (default=off): Allow OnDemand to interact with Kubernetes.
ondemand_use_ldap (default=off): Allows OnDemand to interact with remote LDAP servers. This does not affect Apache LDAP authentication. This is only necessary if the PUN is interacting with LDAP ports.
ondemand_use_kerberos (default=off): Allow OnDemand to interact with Kerberos.
ondemand_use_smtp (default=off): Allow OnDemand to interact with SMTP for sending emails.
The following SELinux booleans are enabled by the ondemand-selinux package:
httpd_setrlimit
httpd_mod_auth_pam
httpd_run_stickshift
httpd_can_network_connect
daemons_use_tty
use_nfs_home_dirs (can be disabled if the OnDemand web node is not using NFS for home directories)
The following example disabled the OnDemand SSH SELinux boolean.
sudo setsebool -P ondemand_use_ssh=off
If you experience denials when running SELinux with Open OnDemand please provide denial details by generating a ood.te file and posting that to Discourse. It would also help to post the audit.log lines that correspond to the OnDemand specific denials.
cat /var/log/audit/audit.log | audit2allow -M ood
SELinux after Updates
After OnDemand updates that include the ondemand-selinux package, some SELinux booleans may be turned back off if their default value is to be disabled. It is required that after these updates, all SELinux booleans that are enabled should be checked that they are still enabled.
Firewall
Open ports 80 (http) and 443 (https) in the firewall, typically done with firewalld or iptables.
Firewalld example:
$ sudo firewall-cmd --zone=public --add-port=80/tcp --permanent
$ sudo firewall-cmd --zone=public --add-port=443/tcp --permanent
$ sudo firewall-cmd --reload
Iptables example:
$ sudo iptables -I INPUT -p tcp -m tcp --dport 80 -j ACCEPT
$ sudo iptables -I INPUT -p tcp -m tcp --dport 443 -j ACCEPT
$ sudo iptables-save > /etc/sysconfig/iptables
Note
If using Dex authentication the port used by Dex must also be opened. See Dex Firewall for details.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation.html#building-from-source
3.1
GETTING STARTED
Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Installation
Edit on GitHub
Installation
The OnDemand host machine needs to be setup similarly to a login node. This means that it will need:
RedHat/CentOS 7+ or Ubuntu 20.04-22.04 or Debian 12 or Amazon Linux 2023
the resource manager (e.g., Torque, Slurm, or LSF) client binaries and libraries used by the batch servers installed
configuration on both OnDemand node and batch servers to be able to submit, status, and delete jobs from command line
signed SSL certificate with corresponding intermediate certificate for your advertised OnDemand host name (e.g., ondemand.my_center.edu)
Adding Open OnDemand SELinux policies is optional for RHEL systems. Open OnDemand, by default, expects Apache to have SSL enabled by securing your Apache. Sites may reconfigure their deployment to allow for plain text traffic see FIXME-LINK-NEEDED.
1. Install Software
1. Enable Dependencies
2. Add repository and install
3. Start services
4. Verify installation
Building From Source
2. Authentication
Overview
OpenID Connect
OpenID Connect with Dex
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
NSF ACCESS
Other Insecure Options
3. Secure Apache httpd
1. Edit the Open OnDemand Portal ood-portal-generator-configuration file
2. Update CA (Dex Users only)
3. Restart the Apache service for the changes take effect.
4. Add SELinux
SELinux
SELinux after Updates
Firewall
Building From Source
Building from source is left as an exercise to the reader.
It’s not particularly difficult to build the code, but installing it with all the various files is. Should you be interested, review the Dockerfile and packaging specs for what would be involved.
https://github.com/OSC/ondemand/blob/master/Dockerfile
https://github.com/OSC/ondemand/tree/master/packaging
If you’d like a package built for a system that we don’t currently support, feel free to open a ticket!
https://github.com/OSC/ondemand/issues/new
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/add-cluster-config.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration
Edit on GitHub
Cluster Configuration
Cluster configuration files describe each cluster a user may submit jobs to and login hosts the user can ssh to. These files detail how the system can interact with your scheduler. Without them, many of the features in Open OnDemand won’t work - including interactive apps.
Indeed, one of the main reasons to use Open OnDemand is use your clusters interactively.
Apps that require proper cluster configuration include:
shell (connect to a cluster login node from the Dashboard App)
active-jobs (view a list of active jobs for the various clusters)
job-composer (submit jobs to various clusters)
All interactive apps such as Jupyter and RStudio
Tip
We provide a puppet module and an ansible role for automating all of this configuration.
Create the default directory that the cluster configuration files reside under:
sudo mkdir -p /etc/ood/config/clusters.d
Create a cluster YAML configuration file for each HPC cluster you want to provide access to. They must have the .yml or .yaml extensions.
Note
It is best to name the file after the HPC cluster it is defining. For example, we added the cluster configuration file /etc/ood/config/clusters.d/oakley.yml for the Oakley cluster here at OSC.
The simplest cluster configuration file for an HPC cluster with only a login node and no resource manager looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
Where host is the SSH server host for the given cluster.
In production you will also want to add a resource manager. That is because the active-jobs and job-composer pages won’t be able to list or submit jobs without a defined resource manager.
The Test Configuration page provides directions on using a Rake task to verify the resource manager configuration.
The A Working Example of a bin_overrides Script provides directions on how to provide a replacement or wrapper script for one or more of the resource manager client binaries.
Cluster Config
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/cluster-config-schema.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
First an example:
A Break Down
Login Cluster Only
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Cluster Config Schema v2
Edit on GitHub
Cluster Config Schema v2
The cluster config controls many OnDemand features including job submission, shell access, names in menus.
First an example:
Below is the production configuration for OSC’s Owens cluster.
---
v2:
  metadata:
    title: "Owens"
    url: "https://www.osc.edu/supercomputing/computing/owens"
    hidden: false
  login:
    host: "owens.osc.edu"
  job:
    adapter: "torque"
    host: "owens-batch.ten.osc.edu"
    lib: "/opt/torque/lib64"
    bin: "/opt/torque/bin"
    version: "6.0.1"
  acls:
  - adapter: "group"
    groups:
      - "cluster_users"
      - "other_users_of_the_cluster"
    type: "allowlist"
  custom:
    grafana:
          host: "https://grafana.osc.edu"
          orgId: 3
          dashboard:
            name: "ondemand-clusters"
            uid: "aaba6Ahbauquag"
            panels:
              cpu: 20
              memory: 24
          labels:
            cluster: "cluster"
            host: "host"
            jobid: "jobid"
  batch_connect:
      basic:
        script_wrapper: "module restore\n%s"
      vnc:
        script_wrapper: "module restore\nmodule load ondemand-vnc\n%s"
Warning
Quick warning: be aware that YAML requires the use of spaces as indentation characters, tabs are not permitted by the YAML spec.
A Break Down
v2:
Version 2 is the current schema, and is the top level mapping for the cluster configuration.
---
v2:
meta:
Meta describes how the cluster will be displayed to the user
metadata:
    # title: is the display label that will be used anywhere the cluster is referenced
    title: "Owens"
    # url: provides the ability to show a link to information about the cluster
    url: "https://www.osc.edu/supercomputing/computing/owens"
    # hidden: setting this to true causes OnDemand to not show this cluster to the user, the cluster is still available for use by other applications
    hidden: false
login:
Login controls what hosts should be used when trying to SSH via the Shell app. Used by the Dashboard and the Job Composer (MyJobs).
login:
  host: "owens.osc.edu"
job:
The job mapping is specific to a cluster’s resource manager.
job:
  adapter: "torque"
  host: "owens-batch.ten.osc.edu"
  lib: "/opt/torque/lib64"
  bin: "/opt/torque/bin"
  version: "6.0.1"
bin_overrides:
bin_overrides adds the ability for a site to specify full paths to alternatives to the configured resource manager’s client executables. This advanced feature allows a site considerable flexibilty to write wrappers to handle logging, environment or default setting, or use 3rd party API compatible alternative clients without having to alter the resource manager installation.
Warning
bin_overrides is an advanced feature. OOD relies both on return codes from clients, and on parsing the standard output in order to get information about submitted jobs. Care and testing is recommended.
# An example in Slurm
job:
  adapter: "slurm"
  bin: "/opt/slurm/bin"
  conf: "/opt/slurm/etc/slurm.conf"
  bin_overrides:
      squeue: "/usr/local/slurm/bin/squeue_wrapper"
      # Override just want you want/need to
      # scontrol: "/usr/local/slurm/bin/scontrol_wrapper"
      sbatch: "/usr/local/slurm/bin/sbatch_wrapper"
      # Will be ignored because bsub is not a command used in the Slurm adapter
      bsub: "/opt/lsf/bin/bsub"
Adapter support for this feature is mixed. For example for Slurm sbatch, scontrol, scancel and squeue are all supported. For Torque only qsub is supported. Unsupported options are ignored.
acls:
Warning
Sites should not use this OnDemand feature and instead just use Linux’s base support for File Access Control lists. This provides the same basic functionality but since permissions are being handled in the Linux kernel, is much faster, simpler and frankly, safer.
Access control lists provide a method to limit cluster access by group membership. ACLs are implicitly allowlists but may be set explicitly to either allowlist or blocklist.
acls:
- adapter: "group"
  groups:
    - "cluster_users"
    - "other_users_of_the_cluster"
  type: "allowlist"  # optional, one of "allowlist" or "blocklist"
Note that to look up group membership ood_core uses the ood_support library which uses id -G USERNAME to get the list groups the user is in, and getgrgid to look up the name of the group.
custom:
The custom mapping is a space that is available for extension, and does not have a schema. In OSC’s usage the custom namespace has been used to provide more cluster-specific information for in-house custom applications.
For details on configuring Grafana see the Grafana Support documentation.
batch_connect:
Batch connect controls the defaults for interactive applications such as Jupyter or interactive desktops.
batch_connect:
    basic:
      script_wrapper: "module restore\n%s"
    vnc:
      script_wrapper: "module restore\nmodule load ondemand-vnc\n%s"
    ssh_allow: true
Script wrappers may contain Bash statements, and are useful for setting up a default environment, and or cleaning up after a script. The keys basic and vnc refer to the two types of batch connect application templates. script_wrapper’s have the content of a batch connect script interpolated into them. String interpolation is performed using sprintf, with the script’s content replacing the %s.
Since 2.0, ssh_allow can be used to override the global value for OOD_BC_SSH_TO_COMPUTE_NODE which is used to determine whether batch connect apps will render a link to SSH into the worker node. See Disable Host Link in Batch Connect Session Card for more details.
Note
The user is responsible for providing the %s that is used to place the script content. If a script_wrapper is provided without %s then batch connect applications are unlikely to work properly.
Login Cluster Only
Suppose you need want to create a login cluster that does not schedule or run jobs. It is used purely as a login/shell cluster only.
To accomplish this, you need to simply leave out the v2.job stanza that associates a scheduler with the cluster.
An example config file in ondemand.d/pitzer_01_login.yml:
---
v2:
metadata:
    title: "Pitzer Login"
    url: "https://www.osc.edu/supercomputing/computing/pitzer"
    hidden: false
login:
    host: "pitzer-login01.hpc.osu.edu"
Again, the thing to note here is we’ve left off the v2.job which renders the cluster useable only for logins, i.e. no jobs will be scheduleable on this cluster.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/torque.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Torque
Edit on GitHub
Torque
A YAML cluster configuration file for a Torque/PBS resource manager on an HPC cluster looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
  job:
    adapter: "torque"
    host: "my_cluster-batch.my_center.edu"
    lib: "/path/to/torque/lib"
    bin: "/path/to/torque/bin"
  # bin_overrides:
      # qsub: "/usr/local/bin/qsub"
with the following configuration options:
adapter
This is set to torque.
host
The host of the Torque batch server.
lib
The path to the Torque client libraries.
bin
The path to the Torque client binaries.
submit_host
A different, optional host to ssh to and then issue commands. Optional
bin_overrides
Replacements/wrappers for Torque’s job submission and control clients. Optional
The Torque adapter uses the foreign function interface interact with libtorque.so and so it is only possible to override qsub.
Warning
The corresponding cluster’s batch server will need to be configured with the Open OnDemand server as a valid submit_host to allow the jobs to be submitted.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/slurm.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Slurm
Edit on GitHub
Slurm
A YAML cluster configuration file for a Slurm resource manager on an HPC cluster looks like:
Warning
Open OnDemand’s Slurm support defaults to issuing CLI commands with the --export flag set to NONE, when Slurms default is ALL. This can cause issues with jobs that require srun.
Work arounds are currently to export SLURM_EXPORT_ENV=ALL in a script_wrapper before any job scripts run.
Alternatively, you can use copy_environment below with the caveat that the PUNs environment is very different from regular shell sessions.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
   metadata:
     title: "My Cluster"
   login:
     host: "my_cluster.my_center.edu"
   job:
     adapter: "slurm"
     cluster: "my_cluster"
     bin: "/path/to/slurm/bin"
     conf: "/path/to/slurm.conf"
     # bin_overrides:
       # sbatch: "/usr/local/bin/sbatch"
       # squeue: ""
       # scontrol: ""
       # scancel: ""
     copy_environment: false
with the following configuration options:
adapter
This is set to slurm.
cluster
The Slurm cluster name. Optional, passed to SLURM as -M <cluster>
Warning
Using the cluster option is discouraged. This is because maintenance outages on the Slurm database will propogate to Open OnDemand. Instead sites should use different conf files for each cluster to limit maintenance outages.
bin
The path to the Slurm client installation binaries.
conf
The path to the Slurm configuration file for this cluster. Optional
submit_host
A different, optional host to ssh to and then issue commands. Optional
bin_overrides
Replacements/wrappers for Slurm’s job submission and control clients. Optional
Supports the following clients:
sbatch
squeue
scontrol
scancel
copy_environment
Copies the enviornment of the PUN when issuing CLI commands. Default behaviour for Open OnDemand is to use --export=NONE flag. Setting this to true will cause Open OnDemand to issue CLI commands with --export=ALL. Though this may cause issues as the PUN’s environment is very different than a regular shell session.
Note
If you do not have a multi-cluster Slurm setup you can remove the cluster: "my_cluster" line from the above configuration file.
Tip
When installing Slurm ensure that all nodes on your cluster including the node running the Open OnDemand server have the same MUNGE key installed. Read the Slurm Quick Start Administrator Guide for more information on installing and configuring Slurm itself.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/lsf.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
Advanced LSF settings
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » LSF
Edit on GitHub
LSF
A YAML cluster configuration file for an LSF resource manager on an HPC cluster looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
  job:
    adapter: "lsf"
    bindir: "/path/to/lsf/bin"
    libdir: "/path/to/lsf/lib"
    envdir: "/path/to/lsf/conf"
    serverdir: "/path/to/lsf/etc"
    cluster: "mycluster"
    # bin_overrides:
      # bsub: "/usr/local/bin/bsub"
      # bjobs: ""
      # bstop: ""
      # bresume: ""
      # bkill: ""
with the following configuration options:
adapter
This is set to lsf.
bindir
The path to the LSF client bin/ directory.
libdir
The path to the LSF client lib/ directory.
envdir
The path to the LSF client conf/ directory.
serverdir
The path to the LSF client etc/ directory.
bin_overrides
Replacements/wrappers for LSF’s job submission and control clients. Optional
submit_host
A different, optional host to ssh to and then issue commands. Optional
cluster
The cluster to interact with when running LSF’s multi-cluster mode. Required to enable multi-cluster mode
Supports the following clients:
bsub
bjobs
bstop
bresume
bkill
Advanced LSF settings
Performance Settings
Given these settings in lsf.conf:
LSB_QUERY_PORT=688X
LSB_QUERY_ENH=y
It’s recommented that you set LSB_MBD_PORT to the same value as LSB_QUERY_PORT
It has also been observed that setting these values in lsb.params helps with the performance of the cluster and in turn Open OnDemand’s usage.
JOB_INFO_MEMORY_CACHE_SIZE=2048
MBD_REFRESH_TIME=5
NEWJOB_REFRESH=Y
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/pbspro.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » PBS Professional
Edit on GitHub
PBS Professional
A YAML cluster configuration file for a PBS Professional resource manager on an HPC cluster looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
  job:
    adapter: "pbspro"
    host: "my_cluster-batch.my_center.edu"
    exec: "/opt/pbs"
   # bin_overrides:
      # qsub: "/usr/local/bin/qsub"
      # qselect: ""
      # qstat: ""
      # qhold: ""
      # qrls: ""
      # qdel: ""
with the following configuration options:
adapter
This is set to pbspro.
host
The host of the PBS Pro batch server.
exec
The installation path for the PBS Pro executables and libraries on the OnDemand host. For default installs from Github RPM releases this value should be /opt/pbs.
submit_host
A different, optional host to ssh to and then issue commands. Optional
bin_overrides
Replacements/wrappers for PBSPro’s job submission and control clients. Optional
Supports the following clients:
qsub
qselect
qstat
qhold
qrls
qdel
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/sge.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
Common Issues
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Grid Engine
Edit on GitHub
Grid Engine
A YAML cluster configuration file for a Grid Engine (Sun Grid Engine, Son of Grid Engine, Univa Grid Engine) resource manager on an HPC cluster looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
  job:
    adapter: "sge"
    cluster: "my_cluster"
    bin: "/usr/lib/gridengine"
    conf: "/etc/default/gridengine"
    sge_root: "/var/lib/gridengine"
    libdrmaa_path: "/var/lib/gridengine/drmaa/libdrmaa.so"
    # bin_overrides:
      # qsub: "/usr/local/bin/qsub_wrapper"
      # qstat: ""
      # qhold: ""
      # qrls: ""
      # qdel: ""
with the following configuration options:
adapter
This is set to sge.
cluster
The Grid Engine cluster name. Optional
bin
The path to the Grid Engine client installation binaries.
sge_root
The path to the root directory of the Grid Engine installation. Default: /var/lib/gridengine
conf
The path to the Grid Engine configuration file for this cluster. Optional
libdrmaa_path
The full path to libdrmaa.so. Provide this to enable use of libdrmaa for more precise job status reporting. Optional
submit_host
A different, optional host to ssh to and then issue commands. Optional
bin_overrides
Replacements/wrappers for Grid Engine’s job submission and control clients. Optional
Supports the following clients:
qsub
qstat
qhold
qrls
qdel
Tip
DRMAA improves OnDemand’s ability to report on the precise status of jobs. To use this feature ensure that libdrmaa.so for Grid Engine is installed or built and set the config value for libdrmaa_path and sge_root. If DRMAA is not installed then OnDemand is unable to get a precise job status for single jobs and will only return either queued or complete.
Common Issues
Shell environments
You may run into an error similar to this where the script running is using a BASH process substitution and there’s a syntax error.
/export/uge/some/file: line 156: syntax error near unexpected token <' /export/uge/some/file:
line 156: done < <(tail -f --pid=${SCRIPT_PID} “vnc.log”) &’
What you’ll need to do is add a script_wrapper element to your clusters’ configuration like below. This sets the sh shell to behave like bash and ensures you’ve sourced your users’ bashrc file.
# /etc/ood/config/clusters.d/my_cluster.yml
# (other elements removed for brevity)
---
v2:
  batch_connect:
    basic:
      script_wrapper: |
        set +o posix
        . ~/.bashrc
        %s
    vnc:
      script_wrapper: |
        set +o posix
        . ~/.bashrc
        %s
Invalid Job name
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
You’ll need to configure illegal job name characters as described here.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/linuxhost.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Launch any software on target host
Launch specific application containers
Cluster Configuration
Enforce resource limits on the target host
Troubleshooting
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » LinuxHost
Edit on GitHub
LinuxHost
The LinuxHost adapter facilitates launching jobs immediately without using a batch scheduler or resource manager. Use cases for this non-traditional job adapter include:
Interactive work on login nodes, such as remote desktop or IDE
Providing an option to start an interactive session immediately, without any queue time imposed
Using OnDemand on systems that do not have a supported scheduler installed
The adapter pieces together several tools to achieve behavior similar to what a scheduler offers:
ssh
connects from the web node to a configured host such as a login node.
tmux
Specially named tmux sessions offer the ability to rediscover running jobs
timeout
is used to set a ‘walltime’ after which the job is killed
pstree
is used to detect the job’s parent sinit process so that it can be killed
singularity
containerization provides a PID namespace without requiring elevated privileges that ensures that all child processes are cleaned up when the job either times out or is killed
Note
There are many recipes for managing processes on arbitrary Linux hosts, and we will be exploring others in future development of this adapter.
The adapter and target host can be configured to either:
Enable launching any software installed on the target host
Enable launching a specific application container
The cluster configuration can be shared between both strategies and each interactive app plugin individually configured to use the appropriate strategy.
Launch any software on target host
Install on the target host a Singularity base OS image matching the OS of the target host. In the cluster configuration example below we use /opt/ood/linuxhost_adapter/centos_7.6.sif as the target host is running CentOS7.
See Cluster Configuration below to add the cluster configuration file for the target host
This base image is used to provide an unprivileged PID namespace when launching the app. To make the rest of the software installed on the host available to launch within the image, most/all of the host file system is bind-mounted into the running container. For this reason many existing interactive apps will just work when launched by the LinuxHost adapter.
Launch specific application containers
Install the specific application containers on the target host.
See Cluster Configuration below to add the cluster configuration file for the target host. Specify a default application container for singularity_image: and singularity_bindpath: even if you will override it.
In each interactive app plugin, specify the image to launch and host directories to mount by setting the native attribute singularity_container and singularity_bindpath. In interactive app plugins these attributes may be set in the file submit.yml. For example:
---
batch_connect:
  template: vnc
script:
  native:
     singularity_bindpath: /fs,/home
     singularity_container: /usr/local/modules/netbeans/netbeans_2019.sif
Cluster Configuration
A YAML cluster configuration file for a Linux host looks like:
# /etc/ood/config/clusters.d/owens_login.yml
---
v2:
  metadata:
    title: "Owens"
    url: "https://www.osc.edu/supercomputing/computing/owens"
    hidden: true
  login:
    host: "owens.osc.edu"
  job:
    adapter: "linux_host"
    submit_host: "owens.osc.edu"  # This is the head for a login round robin
    ssh_hosts: # These are the actual login nodes
      - owens-login01.hpc.osc.edu
      - owens-login02.hpc.osc.edu
      - owens-login03.hpc.osc.edu
    site_timeout: 7200
    debug: true
    singularity_bin: /usr/bin/singularity
    singularity_bindpath: /etc,/media,/mnt,/opt,/run,/srv,/usr,/var,/users
    singularity_image: /opt/ood/linuxhost_adapter/centos_7.6.sif
    # Enabling strict host checking may cause the adapter to fail if the user's known_hosts does not have all the roundrobin hosts
    strict_host_checking: false
    tmux_bin: /usr/bin/tmux
with the following configuration options:
adapter
This is set to linux_host.
submit_host
The target execution host for jobs. May be the head for a login round robin. May also be “localhost”.
ssh_hosts
All nodes the submit_host can DNS resolve to.
site_timeout
The number of seconds that a user’s job is allowed to run. Distinct from the length of time that a user selects.
debug
When set to true job scripts are written to $HOME/tmp.UUID_tmux and $HOME/tmp.UUID_sing for debugging purposes. When false those files are written to /tmp and deleted as soon as they have been read.
singularity_bin
The absolute path to the singularity executable on the execution host(s).
singularity_bindpath
The comma delimited list of paths to bind mount into the host; cannot simply be / because Singularity expects certain dot files in its containers’ root; defaults to: /etc,/media,/mnt,/opt,/run,/srv,/usr,/var,/users.
singularity_image
The absolute path to the Singularity image used when simply PID namespacing jobs; expected to be a base distribution image with no customizations.
strict_host_checking
When false the SSH options include StrictHostKeyChecking=no and UserKnownHostsFile=/dev/null this prevents jobs from failing to launch.
tmux_bin
The absolute path to the tmux executable on the execution host(s).
Warning
This adapter was designed with the primary goal of launching installed software on the target host, not launching specific application containers. As a result, even if your use of this adapter is reserved to launching specific application containers, you currently must specify a value in the cluster config for singularity_bindpath and singularity_image, even if these will be specified in each interactive app plugin.
Note
In order to communicate with the execution hosts the adapter uses SSH in BatchMode. The adapter does not take a position on whether authentication is performed by user owned passwordless keys, or host-based authentication; however OSC has chosen to provide host based authentication to its users.
Enforce resource limits on the target host
By default the adapter does not limit the user’s CPU or memory utilization, only their “walltime”. The following are two examples of ways to implement resource limits for the LinuxHost Adapter using cgroups.
Approach #1: Systemd user slices
With systemd it is possible to manage the resource limits of user logins through each user’s slice. The limits applied to a user slice are shared by all processes belonging to that user, this is not a per-job or per-node resource limit but a per-user limit. When setting the limits keep in mind the sum of all user limits is the max potential resource consumption on a single host.
First update the PAM stack to include the following line:
session     required      pam_exec.so type=open_session /etc/security/limits.sh
This goes into a file used by the sshd PAM configs which on CentOS/RHEL default to /etc/pam.d/password-auth-ac and needs to be included in the proper position, after pam_systemd.so. Also set pam_systemd.so to required:
1
2
3
4
5
6
7
session     optional      pam_keyinit.so revoke
session     required      pam_limits.so
session     required      pam_systemd.so
session     required      pam_exec.so type=open_session /etc/security/limits.sh
session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid
session     required      pam_unix.so
session     optional      pam_sss.so
The following example of /etc/security/limits.sh is used by OSC on interactive login nodes. Adjust MemoryLimit and CPUQuota to meet the needs of your site. See man systemd.resource-control
#!/bin/bash
set -e

PAM_UID=$(id -u "${PAM_USER}")

if [ "${PAM_SERVICE}" = "sshd" -a "${PAM_UID}" -ge 1000 ]; then
        /usr/bin/systemctl set-property "user-${PAM_UID}.slice" \
                MemoryAccounting=true MemoryLimit=64G \
                CPUAccounting=true \
                CPUQuota=700%
fi
Approach #2: libcgroup cgroups
The libcgroup cgroups rules and configurations are a per-group resource limit where the group is defined in the examples at /etc/cgconfig.d/limits.conf. The following examples limit resources of all tmux processes launched for the LinuxHost Adapter so they all share 700 CPU shares and 64GB of RAM. This requires setting tmux_bin to a wrapper script that in this example will be /usr/local/bin/ondemand_tmux.
Example of /usr/local/bin/ondemand_tmux:
#!/bin/bash
exec tmux "$@"
Setup the cgroup limits at /etc/cgconfig.d/limits.conf:
group linuxhostadapter {
        memory {
                memory.limit_in_bytes="64G";
                memory.memsw.limit_in_bytes="64G";
        }
        cpu {
                cpu.shares="700";
        }
}
Setup the cgroup rules at /etc/cgrules.conf:
*:/usr/local/bin/ondemand_tmux memory linuxhostadapter/
*:/usr/local/bin/ondemand_tmux cpu linuxhostadapter/
Start the necessary services:
sudo systemctl start cgconfig
sudo systemctl start cgred
sudo systemctl enable cgconfig
sudo systemctl enable cgred
Troubleshooting
Undetermined state
Your job can be in an ‘undetermined state’ because you haven’t listed all the ssh_hosts. ssh_hosts should be anything the submit_host can DNS resolve to. You submit your job the submit_host, but OnDemand is going to poll the ssh_hosts for your job and in this case, your running a job on a node that OnDemand is not polling.
# /etc/ood/config/clusters.d/no_good_config.yml
---
v2:
  job:
    submit_host: "owens.osc.edu"  # This is the head for a login round robin
    ssh_hosts: # These are the actual login nodes
      - owens-login01.hpc.osc.edu
      - owens-login02.hpc.osc.edu
      - # I need 03 and 04 here!
In this example I’ve only configured hosts 01 and 02 (above), but I got scheduled on 03 (you can tell by the ‘job name’) so the adapter now cannot find my job.
error while loading shared libraries
The default mounts for singularity are '/etc,/media,/mnt,/opt,/srv,/usr,/var,/users'. It’s likely either you’ve overwritten this with too few mounts (like /lib, /opt or /usr) or your container lacks the library in question.
If the library exists on the host, consider mounting it into the container. Otherwise install it in the container definition and rebuild the container.
The job just exists with no errors.
This is where turning debug on with debug: true is really going to come in handy.
Enable this, and you’ll see the two shell scripts that ran during this job. Open the file ending in _tmux and you’ll see something like below.
export SINGULARITY_BINDPATH=/usr,/lib,/lib64,/opt
# ... removed for brevity
ERROR_PATH=/dev/null
({
timeout 28800s /usr/bin/singularity exec  --pid /users/PZS0714/johrstrom/src/images/shelf/centos.sif /bin/bash --login /users/PZS0714/johrstrom/tmp.73S0QFxC5e_sing
} | tee "$OUTPUT_PATH") 3>&1 1>&2 2>&3 | tee "$ERROR_PATH"
Export the SINGULARITY_BINDPATH so you’re sure to have the same mounts, and run this /usr/bin/singularity exec ... tmp.73S0QFxC5e_sing command manually on one of the ssh hosts. This will emulate what the linuxhost adapter is doing and you should be able to modify and rerun until you fix the issue.
D-Bus errors
Maybe you’ve seen something like below. Mounting /var into the container will likely fix the issue.
Launching desktop 'xfce'...
process 195: D-Bus library appears to be incorrectly set up; failed to read machine uuid: UUID file '/etc/machine-id' should contain a hex string of length 32, not length 0, with no other text
See the manual page for dbus-uuidgen to correct this issue.
  D-Bus not built with -rdynamic so unable to print a backtrace
Again, mounting var fixed this error too.
Starting system message bus: Could not get password database information for UID of current process: User "???" unknown or no memory to allocate password entry
Note
Subsequent versions of the adapter are expected to use unshare for PID namespacing as the default method instead of Singularity. Singularity will continue to be supported.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/ccq.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Common Issues
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Cloudy Cluster
Edit on GitHub
Cloudy Cluster
A YAML cluster configuration file for a Cloudy Cluster resource manager on an HPC cluster looks like:
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
  job:
    adapter: "ccq"
    image: "my-default-image"
    cloud: "gcp"
    scheduler: "my_scheduler"
    bin: "/path/to/other/CCQ"
    jobid_regex: "different job_id regex: (?<job_id>\\d+) "
    # bin_overrides:
      # ccqstat: "/usr/local/bin/ccqstat"
      # ccqdel: ""
      # ccqsub: ""
with the following configuration options:
adapter
This is set to ccq.
image
The default cloud image to use when launching jobs. There is no default.
cloud
The cloud provider being used. Valid options are gcp or aws. Defaults to gcp.
scheduler
The name of the scheduler being used. There is no default.
bin
The path to the CCQ client installation binaries. Defaults to /opt/CloudyCluster/srv/CCQ.
jobid_regex
The regular expression to extract the job id from the ccqstat output. Defaults to job id is: (?<job_id>\\d+) you. You should only need this if the ccqstat output changes format. If you are required to reconfigure, you’ll need to extract the named group job_id as the default does.
bin_overrides
Replacements/wrappers for CCQ’s job submission and control clients. Optional
Supports the following clients:
ccqstat
ccqdel
ccqsub
Common Issues
Prompted for input
You may see this error when you initially try to start a job.
The /opt/CloudyCluster/srv/CCQ/ccqsub command was prompted. You need
to generate the certificate manually in a shell by running 'ccqstat'
and entering your username/password
This is because CCQ libraries require a certificate to be generated to communicate with the backend servers. To remediate you’ll simply have to login through a shell terminal and generate a certificate. Do this by running the ccqstat command and entering your username and password when prompted. If you’re successful, the command will generate a ccqCert.cert in your home directory that subsequent invocations will use.
Note these certificates expire, so you may have to generate them every so often or specify a very distant expiry date when you do generate them.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/kubernetes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Per User Kubernetes
Bootstrapping the Kuberenetes cluster
Bootstrapping OnDemand web node to communicate with Kubernetes
Deploy Hooks to bootstrap users Kubernetes configuration
Authentication
Open OnDemand apps in a Kuberenetes cluster
Kyverno Policies
Enforcing Walltimes
Using a private image registry
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Kubernetes
Edit on GitHub
Kubernetes
TODO table of contents
A YAML cluster configuration file for a Kubernetes resource manager on an HPC cluster looks like:
# /etc/ood/config/clusters.d/my_k8s_cluster.yml
---
v2:
  metadata:
    title: "My K8s Cluster"
  # you may not want a login section. There may not be a login node
  # for your kuberenetes cluster
  login:
    host: "my_k8s_cluster.my_center.edu"
  job:
    adapter: "kubernetes"
    config_file: "~/.kube/config"
    cluster: "ood-prod"
    context: "ood-prod"
    bin: "/usr/bin/kubectl"
    username_prefix: "prod-"
    namespace_prefix: "user-"
    all_namespaces: false
    auto_supplemental_groups: false
    server:
      endpoint: "https://my_k8s_cluster.my_center.edu"
      cert_authority_file: "/etc/pki/tls/certs/kubernetes-ca.crt"
    auth:
      type: "oidc"
    mounts: []
  batch_connect:
    ssh_allow: false
adapter
This is set to kubernetes.
config_file
The KUBECONFIG file. Optional. Defaults to ~/.kube/config. Sites can also set the KUBECONFIG environment varaible, but this configuration has precedence.
cluster
The cluster name. Saved to and referenced from your KUBECONFIG.
context
The context to use when issuing kubectl commands. Optional. Defaults to cluster when using OIDC authentication. Saved to and referenced from your KUBECONFIG.
username_prefix
The prefix to your users in your KUBECONFIG. Use this prefix to differentiate between different clusters (like test and production).
namespace_prefix
The prefix to your namespace. Use this prefix if you have assertions on what namespaces are available. I.e., a Kyverno policy that ensures all namespaces are user-\w+.
all_namespaces
A boolean to determine if the user will query for pods in other namespaces. When false users will only query in their namespace. If true they will query and display pods from all namespaces.
auto_supplemental_groups:
Automatically populate a container’s securityContext.supplementalGroups with the users supplemental groups.
server
The kubernetes server to communicate with. This field is a map with endpoint and cert_authority_file keys.
auth:
See the notes on Authentication below.
mounts:
Site wide mount points for all kubernetes jobs. See the documentation on kubernetes mounts for more details.
Note
The batch_connect.ssh_allow is important to disable OnDemand from rendering links to SSH into your Kubernetes worker nodes when Batch Connect apps are running.
Per User Kubernetes
To get kubernetes to act like a Per User resource there are some conventions we put in place. Users only schedule pods in their own namespaces and they always run those pods as themselves.
At most users could be allow to read pods from other namespaces (have sufficient privileges to run kubectl get pods --all-namespaces), but this is not required. Being able to view pods in other namespaces is only applicable to a feature like viewing active jobs and seeing pods from other namespaces in that view.
Second is that we specify the Kubernetes security context such that pods have the same UID and GID as the actual user.
Open OnDemand will always use the users UID and GID as the runAsUser and runAsGroup. fsGroup is always the same as runAsGroup. runAsNonRoot is always set to true. supplementalGroups are empty by default. One can automatically populate them with a cluster configuration above or specify them for each app individually.
You should have policies in place to enforce these.
Bootstrapping the Kuberenetes cluster
Before anyone can use your Kubernetes cluster from Open OnDemand, you’ll need to create the open ondemand kubernetes resources on your cluster.
Below is an example of adding the necessary resources:
kubectl apply -f https://raw.githubusercontent.com/OSC/ondemand/master/hooks/k8s-bootstrap/ondemand.yaml
Bootstrapping OnDemand web node to communicate with Kubernetes
The OnDemand web node root user must be configured to use the ondemand service account deployed by the open ondemand kubernetes resources and be able to execute kubectl commands.
First deploy kubectl to the OnDemand web node. Replace $VERSION with the version of the Kubernetes controller, eg. 1.21.5.
wget -O /usr/local/bin/kubectl https://storage.googleapis.com/kubernetes-release/release/v$VERSION/bin/linux/amd64/kubectl
chmod +x /usr/local/bin/kubectl
Tokens for Bootstrapping
The root user on the OnDemand web node needs a Kubernetes token to bootstrap users. Specifically to create user namespaces and give the users sufficient privileges in their namespace.
Service account tokens are not generated automatically since Kubernetes 1.24. You have two options here: You can either create a non-expiring token for the service account and save it as a secret or you can create a crontab entry to refresh the root users token. Both are described here.
Tip
Kubernetes recommends that you use rotating tokens, so we recommend the same.
To do use rotating tokens, you can use the kubectl create token API to create a token and save it in a crontab entry. Here’s an example of what you could use to create new tokens for the root user. The tokens last 9 hours, so you can set a crontab entry for every 8 hours to refresh your tokens before they expire.
#!/bin/bash

set -e

if command -v kubectl >/dev/null 2>&1;
then
  CMD_USER=$(whoami)
  if [ "$CMD_USER" == "root" ]; then
    TOKEN=$(kubectl create token ondemand --namespace=ondemand --duration 9h)
    kubectl config set-credentials ondemand@kubernetes --token="$TOKEN"
  else
    >&2 echo "this program needs to run as 'root' and you are $CMD_USER."
    exit 1
  fi
fi
If you wish to create a non-expiring token, you will need to create the secret through a kubectl apply command on the yaml below.
Next extract the ondemand ServiceAccount token. Here is an example command to extract the token using an account that has ClusterAdmin privileges:
# token.yml
apiVersion: v1
kind: Secret
type: kubernetes.io/service-account-token
metadata:
  name: token
  namespace: ondemand
  annotations:
    kubernetes.io/service-account.name: ondemand
kubectl apply -f token.yml
TOKEN=$(kubectl describe serviceaccount ondemand -n ondemand | grep Tokens | awk '{ print $2 }')
kubectl describe secret $TOKEN -n ondemand | grep "token:"
Below are example commands to bootstrap the kubeconfig for root user on the OnDemand web node using the token from above. Run these commands as root on the OnDemand web node.
kubectl config set-cluster kubernetes --server=https://$CONTROLLER:6443 --certificate-authority=$CACERT
kubectl config set-credentials ondemand@kubernetes --token=$TOKEN
kubectl config set-context ondemand@kubernetes --cluster=kubernetes --user=ondemand@kubernetes
kubectl config use-context ondemand@kubernetes
Replace the following values:
$CONTROLLER with the Kubernetes Controller FQDN or IP address
$CACERT the path to Kubernetes cluster CA cert
$TOKEN the token for ondemand ServiceAccount
Below is an example of verifying the kubeconfig is valid:
kubectl cluster-info
Deploy Hooks to bootstrap users Kubernetes configuration
We ship with open ondemand provided hooks to bootstrap users when the login to Open OnDemand. These scripts will create their namespace, a networking policy, and rolebindings for user and the service accounts in their namespace.
A user oakley would create the oakley namespace. If you’ve configured to use prefix user-, then the namespace would be user-oakley.
The networking policy ensures that pods cannot communicate inbetween namespaces.
The RoleBindings give user, oakley in this case, sufficient privileges to the oakley namespace. Refer to the open ondemand kubernetes resources for details on the roles and privileges created.
You’ll need to employ PUN pre hooks to bootstrap your users to this cluster.
You’ll also have to modify /etc/ood/config/hooks.env because open ondemand provided hooks require a HOOKENV environment variable.
Here’s what you’ll have to edit in the hook.env.example file we ship.
# /etc/ood/config/hook.env

# required if you changed the items in the cluster.d file
K8S_USERNAME_PREFIX=""
NAMESPACE_PREFIX=""

# required
NETWORK_POLICY_ALLOW_CIDR="127.0.0.1/32"

# required if you're using OIDC
IDP_ISSUER_URL="https://idp.example.com/auth/realms/main/protocol/openid-connect/token"
CLIENT_ID="changeme"
CLIENT_SECRET="changeme"

# required if you're using a secret registry
IMAGE_PULL_SECRET=""
REGISTRY_DOCKER_CONFIG_JSON="/some/path/to/docker/config.json"

# enable if are enforcing walltimes through the job pod reaper
# see 'Enforcing walltimes' below.
USE_JOB_POD_REAPER=false
You can refer to osc’s prehook but we’ll also provide this example. As you can see in this pre hook, the username is passed in to the script which then defines the HOOKENV and calls two open ondemand provided hooks.
k8s-bootstrap-ondemand.sh boostraps the user in the kubernetes cluster as described above.
Since we use OIDC at OSC we use set-k8s-creds.sh to add or update the user in their ~/.kube/config with the relevant OIDC credentials.
#!/bin/bash

for arg in "$@"
do
  case $arg in
    --user)
    ONDEMAND_USERNAME=$2
    shift
    shift
    ;;
esac
done

if [ "x${ONDEMAND_USERNAME}" = "x" ]; then
  echo "Must specify username"
  exit 1
fi

HOOKSDIR="/opt/ood/hooks"
HOOKENV="/etc/ood/config/hook.env"

/bin/bash "$HOOKSDIR/k8s-bootstrap/k8s-bootstrap-ondemand.sh" "$ONDEMAND_USERNAME" "$HOOKENV"
/bin/bash "$HOOKSDIR/k8s-bootstrap/set-k8s-creds.sh" "$ONDEMAND_USERNAME" "$HOOKENV"
Authentication
Here are the current configurations you can list for different types of authentication.
Managed Authentication
# /etc/ood/config/clusters.d/my_k8s_cluster.yml
---
v2:
  job:
    # ...
    auth:
      type: 'managed'
This is the simplest case and is the default. The authentication is managed outside of Open OnDemand. We will not set-context or set-cluster.
We will pass --context to kubectl commands if you have it configured in the cluster config (above). Otherwise, it’s assumed that the current context is set out of bounds.
OIDC Authentication
For OIDC authentication the tokens provided to OnDemand users must be seen as valid for Kubernetes in order for that token to be used to authenticate with Kubernetes. First both OnDemand and Kubernetes must be using the same OIDC provider. In order for the OnDemand token to work with Kubernetes, it’s simplest to configure an audience on the OnDemand OIDC client. An alternative approach would be to update the pre-PUN hooks to perform a token exchange. Another approach would be to use the same OIDC client configuration for OnDemand and Kubernetes.
# /etc/ood/config/clusters.d/my_k8s_cluster.yml
---
v2:
  job:
    # ...
    auth:
      type: 'odic'
This uses the OIDC credentails that you’ve logged in with. When the dashboard starts up it will set-context and set-cluster to what you’ve configured.
We will pass --context to kubectl commands. This defaults to the cluster but can be something different if you configure it so.
GKE Authentication
# /etc/ood/config/clusters.d/my_k8s_cluster.yml
---
v2:
  job:
    # ...
    auth:
      type: 'gke'
      svc_acct_file: '~/.gke/my-service-account-file'
It’s expected that you have a service account that can then manipulate the cluster you’re interacting with. Every user should have a cooresponding service account to interact with GKE.
When the dasbhoard starts up, we use gcloud to configure your KUBECONFIG.
Google Cloud’s Goolge Kubernetes Engine (GKE) needs some more documentation on what privileges this serivce account is setup with and how one may bootstrap it.
OIDC Audience
The simplest way to have the OnDemand OIDC tokens be valid for Kubernetes is to update the OnDemand client configuration to include the audience of the Kubernetes client.
Keycloak
In the Keycloak web UI, logged in as the admin user:
Navigate to Clients then choose the OnDemand client.
Choose the Mappers tab and click Create
Fill in a Name and select Audience for Mapper Type
For Included Client Audience choose the Kubernetes client entry
Turn on both Add to ID token and Add to access token
OIDC Token Exchange
Keycloak
Refer to the Keycloak token exchange documentation
Open OnDemand apps in a Kuberenetes cluster
Kuberenetes is so different from other HPC clusters that the interface we have for other schedulers didn’t quite fit. So Open OnDemand apps developed for kubernetes clusters look quite different from other schedulers. Essentially most things we’ll need are packed into the native key of the submit.yml.erb files.
See the tutorial for a kubernetes app that behaves like HPC compute as well as the tutorial for a kubernetes app for more details.
Kyverno Policies
Once Kubernetes is available to OnDemand, it’s possible for users to use kubectl to submit arbirary pods to Kubernetes. To ensure proper security with Kubernetes a policy engine such as Kyverno can be used to ensure certain security standards.
For OnDemand, many of the Kyverno baseline and restricted sescurity policies will work. There are also policies that can be deployed to ensure the UID/GID of user pods match that user’s UID/GID on the HPC clusters. Some example policies do things such as enforce UID/GID and other security standards for OnDemand. These policies rely heavily on the fact that OnDemand usage in Kubernetes using a namespace prefix.
The policies enforcing UID/GID and supplemental groups are using data supplied by the k8-ldap-configmap tool that generates ConfigMap resources based on LDAP data. This tool runs as a deployment inside the Kubernetes cluster.
Enforcing Walltimes
In order to enforce that OnDemand pods are shut down after so much time, it’s necessary to deploy a service that can cleanup pods that have run past their walltime. Also because OnDemand is bootstrapping a namespace per user it’s useful to cleanup unused namespaces.
The OnDemand pods will have the pod.kubernetes.io/lifetime annotation set that is read by job-pod-reaper that will kill pods that have reached their walltime. The job-pod-reaper service runs as a Deployment inside Kubernetes and will kill any pods based on the lifetime annotation. Below is an example of Helm values that can be used to configure job-pod-reaper for OnDemand:
reapNamespaces: false
namespaceLabels: app.kubernetes.io/name=open-ondemand
objectLabels: app.kubernetes.io/managed-by=open-ondemand
You will need to tell OnDemand you are using job-pod-reaper and to bootstrap the necessary RoleBinding so that job-pod-reaper can delete OnDemand pods. Update /etc/ood/config/hooks.env to include the following configuration:
USE_JOB_POD_REAPER="true"
In order to cleanup unused namespaces the k8-namespace-reaper tool can be used. This tool will delete a namespace based on several factors:
The creation timestamp of the namespace
openondemand.org/last-hook-execution annotation set by the OnDemand pre-PUN hook
The last pod to run in that namespace based on Prometheus metrics
Below is an example of Helm values to deploy this tool for OnDemand where the OnDemand namespaces have user- prefix:
config:
  namespaceLabels: app.kubernetes.io/name=open-ondemand
  namespaceRegexp: user-.+
  namespaceLastUsedAnnotation: openondemand.org/last-hook-execution
  prometheusAddress: http://prometheus.prometheus:9090
  reapAfter: 8h
  lastUsedThreshold: 4h
  interval: 2h
Using a private image registry
OnDemand’s Kubernetes integration can be setup to pull images from a private registry like Harbor.
In order to pull images from a private registry that requires authentication, OnDemand can be configured to setup Image Pull Secrets. The OnDemand web node will need a JSON file setup that includes the username and password of a registry user authorized to pull images used by OnDemand apps.
Warning
Once the OnDemand user’s namespace is given the registry auth secret, it will be readable by the user. It’s recommended to use a read-only auth token that has limited to access just images used by OnDemand.
In the following example you can set the following values:
$REGISTRY the registry address.
$REGISTRY_USER the username of the user authorized to pull the images
$REGISTRY_PASSWORD the password of the user authorized to pull the images
AUTH=$(echo -n "${REGISTRY_USER}:${REGISTRY_PASSWORD}" | base64)
cat > /etc/ood/config/image-registry.json <<EOF
{
  "auths": {
    "${REGISTRY}": {
      "auth": "${AUTH}"
    }
  }
}
EOF
chmod 0600 /etc/ood/config/image-registry.json
Once the registry JSON is created you must configure /etc/ood/config/hooks.env so OnDemand knows how to bootstrap a user’s namespaces with the ability to pull from this registry:
IMAGE_PULL_SECRET="private-docker-registry"
REGISTRY_DOCKER_CONFIG_JSON="/etc/ood/config/image-registry.json"
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/systemd.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Systemd
Edit on GitHub
Systemd
Coming in 2.1!
Open OnDemand can use SystemD timers to schedule a ‘job’. Sites can use this adapter for short lived jobs or to use resources outside of your compute pool (like login nodes).
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/bin-override-example.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » A Working Example of a bin_overrides Script
Edit on GitHub
A Working Example of a bin_overrides Script
sbatch is the Slurm scheduler’s submission client. In this example we will show how cluster configuration’s bin_overrides may be used to change default behavior.
This example demonstrates a few uses of wrapping the default scheduler clients:
Using SSH from the web host to launch sbatch on the submit host
Altering arguments passed to the scheduler
Altering the script passed to sbatch (which is almost certainly a terrible idea)
Logging values passed to the scheduler in a custom location (note that the values passed to sbatch are also logged to the PUN log file at /var/log/ondemand-nginx/$USER/error.log by the Dashboard and Job Composer when submitting jobs)
Warning
This wrapper when used with the OOD Job Composer will place any stdout or stderr files in $HOME instead of the usual location of $HOME/ondemand/data/sys/myjobs/projects/default/$JOBID.
#!/usr/bin/env python36
from getpass import getuser
from select import select
from sh import ssh, ErrorReturnCode  # pip3 install sh
import logging
import os
import re
import sys

'''
An example of a `bin_overrides` replacing Slurm `sbatch` for use with Open OnDemand.

Requirements:

- $USER must be able to SSH from web node to submit node without using a password

Examples:

- SSH's from a web node to a submit node
- Logging values passed to sbatch
- Altering arguments passed to sbatch
- Altering the script passed to sbatch (which is almost certainly a bad idea)

Thoughts for further development:

- Add out of script configuration (SUBMISSION_NODE, logging preferences)
- Improve logging permission handling (right now it needs to be done manually)
- Solve problem of CWD being set to the $HOME

Note that as of v1.4.9 OOD's job adapters parse stdout but may not validate;
changing the format of sbatch's stdout can break applications. For exit codes
OOD's job adapters require that the wrapper exit 0 on success and non 0 on
failure.
'''

logging.basicConfig(filename='/tmp/sbatch.log', level=logging.INFO)

SUBMISSION_NODE = 'head'
USER = os.environ['USER']


def run_remote_sbatch(script, *argv):
  """
  @brief      SSH and submit the job from the submission node

  @param      script (str)  The script
  @param      argv (list<str>)    The argument vector for sbatch

  @return     output (str) The merged stdout/stderr of the remote sbatch call
  """

  output = None

  try:
    result = ssh(
      '@'.join([USER, SUBMISSION_NODE]),
      '-oBatchMode=yes',  # ensure that SSH does not hang waiting for a password that will never be sent
      '/opt/slurm/bin/sbatch',  # the real sbatch on the remote
      *argv,  # any arguments that sbatch should get
      _in=script,  # redirect the script's contents into stdin
      _err_to_out=True  # merge stdout and stderr
    )

    output = result.stdout.decode('utf-8')
    logging.info(output)
  except ErrorReturnCode as e:
    output = e.stdout.decode('utf-8')
    logging.info(output)
    print(output)
    sys.exit(e.exit_code)

  return output


def filter_argv(argv):
  """
  @brief      Filter the argument vector to add or remove arguments

  @param      argv (list<str>) The original argument vector passed to sbatch

  @return     argv (list<str>) The altered argument vector to pass to the real sbatch
  """

  logging.info('ARGV:')
  for arg in argv:
    logging.info(argv)

  argv += ['--export=THE_ANSWER=42']

  return argv


def filter_script(script):
  """
  @brief      Alter the script that the user is sending to sbatch

  This is a terrible fragile idea, but it is possible, so let's try it! We will set
  an environment variable and cleanup /tmp after the user.

  @param      script (str)  The script

  @return     script (str) The altered script
  """

  shebang = '#!/bin/bash\n'
  match = re.match('^(#!.+)\n', script)
  if match:
    shebang = match.group()
    script  = script.replace(shebang, '')

  return shebang + '''
  export THE_QUESTION='6*9=?'
  ''' + script + '''
  rm -rf /tmp 2>/dev/null
  '''


def load_script():
  """
  @brief      Loads a script from stdin.

  With OOD and Slurm the user's script is read from disk and passed to sbatch via stdin
  https://github.com/OSC/ood_core/blob/5b4d93636e0968be920cf409252292d674cc951d/lib/ood_core/job/adapters/slurm.rb#L138-L148

  @return     script (str) The script content
  """
  # Do not hang waiting for stdin that is not coming
  if not select([sys.stdin], [], [], 0.0)[0]:
    print('No script available on stdin!')
    sys.exit(1)

  return sys.stdin.read()


def main():
  """
  @brief      SSHs from web node to submit node and executes the remote sbatch.
  """
  output = run_remote_sbatch(
    filter_script(load_script()),
    filter_argv(sys.argv[1:])
  )

  print(output)

if __name__ == '__main__':
  main()
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/test.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Test Configuration
Edit on GitHub
Test Configuration
Warning
This is an experimental feature right now that may change drastically in the future. So always revisit this documentation after upgrading OnDemand and attempting to test your cluster configuration.
We currently provide an experimental rake task in the dashboard for testing your resource manager configuration in the cluster configuration files.
For all rake tasks we will need to be in the dashboard’s root directory (this will change in the future):
cd /var/www/ood/apps/sys/dashboard
We will now list all available tasks that we can run:
If your operating system is CentOS 7 or RHEL 7, run this command:
scl enable ondemand -- bin/rake -T test:jobs
# rake test:jobs           # Test all clusters
# rake test:jobs:cluster1  # Test the cluster: cluster1
# rake test:jobs:cluster2  # Test the cluster: cluster2
Otherwise, run this command:
source /opt/ood/ondemand/enable
bin/rake -T test:jobs
# rake test:jobs           # Test all clusters
# rake test:jobs:cluster1  # Test the cluster: cluster1
# rake test:jobs:cluster2  # Test the cluster: cluster2
This list is dynamically generated from all the available cluster configuration files that reside under /etc/ood/config/clusters.d/*.yml.
For now let us test just a single cluster (in our example we use cluster1, so you will need to replace it with the name of the cluster you configured):
If your operating system is CentOS 7 or RHEL 7, run this command:
sudo su $USER -c 'scl enable ondemand -- bin/rake test:jobs:cluster1 RAILS_ENV=production'
Otherwise, run this command:
sudo su $USER -c 'source /opt/ood/ondemand/enable; bin/rake test:jobs:cluster1 RAILS_ENV=production'
Results
# [sudo] password for user:
# Rails Error: Unable to access log file. Please ensure that /var/www/ood/apps/sys/dashboard/log/production.log exists and is writable (ie, make it writable for user and group: chmod 0664 /var/www/ood/apps/sys/dashboard/log/production.log). The log level has been raised to WARN and the output directed to STDERR until the problem is fixed.
# mkdir -p /home/user/test_jobs
# Testing cluster 'cluster1'...
# Submitting job...
# [2018-04-24 10:15:32 -0400 ]  INFO "execve = [{\"PBS_DEFAULT\"=>\"oak-batch.osc.edu\", \"LD_LIBRARY_PATH\"=>\"/opt/torque/lib64:/opt/rh/rh-nodejs6/root/usr/lib64:/opt/rh/rh-ruby24/root/usr/lib64\"}, \"/opt/torque/bin/qsub\", \"-N\", \"test_jobs_cluster1\", \"-S\", \"/bin/bash\", \"-o\", \"/users/appl/jnicklas/test_jobs/output_cluster1_2018-04-24T10:15:32-04:00.log\", \"-l\", \"walltime=00:01:00\", \"-j\", \"oe\"]"
# Got job id '10820525.oak-batch.osc.edu'
# Job has status of queued
# Job has status of queued
# Job has status of queued
# Job has status of queued
# Job has status of completed
# Test for 'cluster1' PASSED!
# Finished testing cluster 'cluster1'
Please ignore the Rails Error: message as this is just a warning that doesn’t affect your OnDemand installation in any way. We are currently tracking this issue in GitHub at OSC/dashboard#364.
Tip
We actually launch the rake task with sudo to best mimic the environment that the OnDemand applications are run under.
You can run the rake task as the current user, but it may lead to a false positive as your user environment may have the correct libraries and paths loaded in it that may not necessarily exist in the cleaner OnDemand application environment.
This creates and submits a batch job that echo’s a defined string. It then pings the batch server every 5 seconds until the job is completed. Finally, it parses the output file looking for the defined string. The test passes if it can find the string in the output file.
If something fails at any point in the chain, then the test fails. This may require you to make edits to the corresponding cluster configuration file under /etc/ood/config/clusters.d/ and run the test again.
Note
If your job fails to submit because you need to supply more submission arguments, e.g., a queue, memory requirements, an account, etc. You can provide these command line arguments as a string with the environment variable SUBMIT_ARGS as:
If your operating system is CentOS 7 or RHEL 7, run this command:
sudo su $USER -c 'scl enable ondemand-- bin/rake test:jobs:cluster1 RAILS_ENV=production SUBMIT_ARGS="-A myaccount"'
Otherwise, run this command:
sudo su $USER -c 'source /opt/ood/ondemand/enable; bin/rake test:jobs:cluster1 RAILS_ENV=production SUBMIT_ARGS="-A myaccount"'
Note that the SUBMIT_ARGS="..." is defined at the end of the command.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/installation/resource-manager/advanced-configs.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Visualization Nodes
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Cluster Configuration » Advanced Resource Manager Configrations
Edit on GitHub
Advanced Resource Manager Configrations
This page details advanced settings for any resource manager that could be helpful in using Open OnDemand.
Visualization Nodes
At OSC we offer visualization nodes that attach the X11 session to a GPU so that any rendering can occur on the GPU itself.
We’ve defined vis as a Slurm GRES that jobs can request (i.e., some batch connect applications request this Slurm GRES).
We use a Slurm prolog to do the actual work of attaching the X11 session to the GPU.
Other resource managers may have a similar facility for doing work just before the job starts running.
This is an example of that Slurm prolog.
if [[ "$SLURM_LOCALID" == "0" && "$SLURM_JOB_GRES" == *"vis"* ]]; then
  if [ -n "$CUDA_VISIBLE_DEVICES" ]; then
    FIRSTGPU=$(echo $CUDA_VISIBLE_DEVICES | tr ',' "\n" | head -1)
    setsid /usr/bin/X :${FIRSTGPU} -noreset >& /dev/null &
    sleep 2
    if [ -n "$DISPLAY" ]; then
      echo "export OLDDISPLAY=$DISPLAY"
    fi
    echo "export DISPLAY=:$FIRSTGPU"
  fi
fi
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/interactive/setup.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Setup Interactive Apps
Edit on GitHub
Setup Interactive Apps
This guide will walk you through setting up your Open OnDemand installation to support interactive apps that run on compute nodes.
Warning
This guide does not walk you through installing the software requirements a specific Interactive App may need on the compute node it runs on.
Quick Start Guide
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
3.1. Requirements
3.2. Steps to Enable in Apache
3.3. Verify it Works
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/interactive/setup/software-requirements.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Setup Interactive Apps » 1. Software Requirements
Edit on GitHub
1. Software Requirements
Some interactive apps will need a VNC server on the compute node (e.g., the Desktop app). This requires the following software to be installed on the nodes that the batch job submitted by the Interactive App is meant to run on, NOT the OnDemand node.
For VNC server support:
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Warning
Do NOT install the above software on the OnDemand node. The above software requirements are ONLY for the compute nodes you intend on launching Desktops on within batch jobs.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/interactive/setup/modify-cluster-configuration.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Setup Interactive Apps » 2. Modify Cluster Configuration
Edit on GitHub
2. Modify Cluster Configuration
If you haven’t already done so, you will need to first have a corresponding cluster configuration file for the cluster you intend to submit interactive batch jobs to. It is recommended you follow the directions on Cluster Configuration.
This is a simple example that ensures modules are always being purged and vnc applications have the right environment variables for TurboVNC and websockify.
# /etc/ood/config/clusters.d/example_cluster.yml
---
v2:
  metadata:
    title: "Example Cluster"
  login:
    host: "example.my_center.edu"
  job:
    adapter: "..."
    ...
  batch_connect:
    basic:
      script_wrapper: |
        module purge
        %s
    vnc:
      script_wrapper: |
        module purge
        export PATH="/usr/local/turbovnc/bin:$PATH"
        export WEBSOCKIFY_CMD="/usr/local/websockify/run"
        %s
In this example we’re setting batch connect options globally that wrap the basic and vnc scripts. That’s important, because it means any batch connect app used on this cluster will use these settings.
This example uses bash code that wraps around the body Open OnDemand provided scripts (the variable %s). First, we purge the module environment to remove any conflicting modules that may have been loaded by the user’s .bashrc or .bash_profile files. Then we set environment variables needed by the vnc script to launch TurboVNC and websockify.
Note
This is an example of how to set batch connect options globally. You will likely need use different values.
Warning
Do not forget to include the %s in the script_wrapper configuration option. Otherwise the actual bash code that launches the corresponding web servers will never be interpolated into the main batch script and run.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/interactive/setup/enable-reverse-proxy.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
3.1. Requirements
3.2. Steps to Enable in Apache
3.3. Verify it Works
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Setup Interactive Apps » 3. Enable Reverse Proxy
Edit on GitHub
3. Enable Reverse Proxy
The reverse proxy will proxy a request to any specified host and port through IP sockets. This can be used to connect to Jupyter notebook servers, RStudio servers, VNC servers, and more! This is disabled by default as it can be a security risk if not properly setup using a good host_regex.
You can read more about how this works in Open OnDemand under Configure Reverse Proxy.
3.1. Requirements
a regular expression that best describes all the hosts that you would want a user to connect to through the proxy (e.g., [\w.-]+\.osc\.edu)
confirm that if you run the command hostname from a compute node it will return a string that matches the above regular expression
hostname
# n0001.ten.osc.edu
Note
If the hostname command gives you a value that cannot be used to connect to the compute node from the OnDemand host, then you can override it in the cluster config with a bash command that will work, e.g.:
# /etc/ood/config/clusters.d/cluster1.yml
---
v2:
  metadata:
    title: "Cluster 1"
  login:
    host: "cluster1.my_center.edu"
  job:
    adapter: "..."
    ...
  batch_connect:
    basic:
      script_wrapper: |
        module purge
        %s
      set_host: "host=$(hostname -A | awk '{print $1}')"
    vnc:
      script_wrapper: |
        module purge
        export PATH="/usr/local/turbovnc/bin:$PATH"
        export WEBSOCKIFY_CMD="/usr/local/websockify/run"
        %s
      set_host: "host=$(hostname -A | awk '{print $1}')"
3.2. Steps to Enable in Apache
This requires modifying the YAML portal configuration file located at /etc/ood/config/ood_portal.yml as such:
# /etc/ood/config/ood_portal.yml
---
host_regex: '[\w.-]+\.my_center\.edu'
node_uri: '/node'
rnode_uri: '/rnode'
You can read more about these options under Configure Reverse Proxy.
Tip
What if my site foregos the FQDN in the host names for compute nodes, and we have compute names that give their hosts as:
ab001 … ab100 (for the AB cluster)
pn001 … pn500 (for the PN cluster)
xy001 … xy125 (for the XY cluster)
You could then use the following regular expression in your configuration file:
host_regex: '(ab|pn|xy)\d+'
node_uri: '/node'
rnode_uri: '/rnode'
Warning
Do not add start (^, A) or end ($, Z) of string/line anchors as this regular expression will be inserted into another regular expression.
Danger
Failing to add an appropriate regular expression to the Reverse Proxy opens you up to possible phishing attacks. As a malicious party could send links to unsuspecting users as:
https://ondemand.my_center.edu/rnode/phishing.site.com/80/...
And users will implicitly trust the link since it points to the trusting domain of ondemand.my_center.edu.
Build/install the updated Apache configuration file:
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
Restart the Apache service to have the changes take effect:
3.3. Verify it Works
We can test that the reverse proxy is now functional by starting up a simple server on a compute node and connecting to it through the proxy with our browser.
SSH to any compute node that matches the regular expression above:
ssh n0001.ten.osc.edu
Start up a very simple listening server on a high number port:
nc -l 5432
In your browser navigate to this server using the Apache reverse proxy with the following URL format:
http://ondemand.my_center.edu/node/<host>/<port>/...
So for our simplified case lets use:
http://ondemand.my_center.edu/node/n0001.ten.osc.edu/5432/
Go back to your SSH session and verify that it received the browser request:
nc -l 5432
# GET /node/n0691.ten.osc.edu/5432/ HTTP/1.1
# Host: n0691.ten.osc.edu:5432
# Upgrade-Insecure-Requests: 1
...
Note
As we don’t have the simple server return anything to the browser, you can ignore any errors or warnings you see in your browser.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Feature
Property
Title
dashboard_title
Logo
dashboard_logo
Logo height
dashboard_logo_height
Favicon
public_url
Brand background color
brand_bg_color
Brand foreground color
brand_link_active_bg_color
Replace header title with logo
dashboard_header_img_logo
Use white text on black background for navbar.
navbar_type
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#announcements
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Feature
Property
Title
dashboard_title
Logo
dashboard_logo
Logo height
dashboard_logo_height
Favicon
public_url
Brand background color
brand_bg_color
Brand foreground color
brand_link_active_bg_color
Replace header title with logo
dashboard_header_img_logo
Use white text on black background for navbar.
navbar_type
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#message-of-the-day-motd
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Feature
Property
Title
dashboard_title
Logo
dashboard_logo
Logo height
dashboard_logo_height
Favicon
public_url
Brand background color
brand_bg_color
Brand foreground color
brand_link_active_bg_color
Replace header title with logo
dashboard_header_img_logo
Use white text on black background for navbar.
navbar_type
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#branding
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Custom CSS files
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Feature
Property
Title
dashboard_title
Logo
dashboard_logo
Logo height
dashboard_logo_height
Favicon
public_url
Brand background color
brand_bg_color
Brand foreground color
brand_link_active_bg_color
Replace header title with logo
dashboard_header_img_logo
Use white text on black background for navbar.
navbar_type
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#overriding-pages
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#add-urls-to-help-menu
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Name
Support URL
User Documentation
Developer Documentation
Change Password URL
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#add-shortcuts-to-files-menu
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#configuration-profiles
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Manual Profile Selection
Automatic Profile Selection
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#changing-the-navigation-bar
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Understanding the default navigation bar
Limit auto generated menu bars
Using manifests to create menu items
Fully customizing the navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#interactive-apps-menu
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#set-upload-limits
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#set-download-limits
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#block-or-allow-directory-access
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#disabling-users
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#set-default-ssh-host
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#set-ssh-allowlist
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#set-ood-ssh-port
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#shell-app-ssh-command-wrapper
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#fix-unauthorized-websocket-connection-in-shell-app
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#custom-job-composer-templates
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Templates Overview
Job Template Details
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#job-composer-script-size-limit
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#hiding-job-arrays
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#custom-error-page-for-missing-home-directory-on-launch
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#pinning-applications-to-the-dashboard
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Pinned Apps customizations
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#custom-layouts-in-the-dashboard
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#customize-text-in-ondemand
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Change the Dashboard Tagline
Change quota messages in the Dashboard
Customize Text in the Job Composer’s options form
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
/etc/ood/config/locales/en.yml
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#disk-quota-warnings-on-dashboard
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Individual User Quota
Individual Fileset Quota
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#balance-warnings-on-dashboard
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
User Balance
Project Balance
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#maintenance-mode
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#grafana-support
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#disable-host-link-in-batch-connect-session-card
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#set-illegal-job-name-characters
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#customize-dex-theme
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument to -N option must not contain /
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#xdmod-integration
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument to -N option must not contain /
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#accessing-remote-file-systems
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument to -N option must not contain /
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#cancel-interactive-sessions
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument to -N option must not contain /
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#custom-pages
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument to -N option must not contain /
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/customizations.html#support-tickets
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Configuration
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Customizations
Edit on GitHub
Customizations
Tip
Check out the PUN environment for an overview of how environment variables can be added.
Announcements
To add an announcement message that appears at the top of the dashboard you can create a file at /etc/ood/config/announcement.(md|yml) or /etc/ood/config/announcements.d/any_file_name.(md|yml).
On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.
For example, if I create an announcement.md file with the contents:
**NOTICE:** There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[http://bit.ly/2jhfyh7](http://bit.ly/2jhfyh7).
the user would see this message at the top of the dashboard:
Fig. 1 Example of the Dashboard announcement.
If the announcement file has the extension yml and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:
Table 2 Config Files
type
warning, info, success, or danger
this is the Bootstrap alert style
msg
string containing markdown formatted message
if this is a blank string (only whitespace), the alert will not display
Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:
type: warning
msg: |
  <% if Time.now < Time.new(2018, 9, 24, 12, 0, 0) %>
  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm
  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.
  <% end %>
Note
Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.
The file path for the announcement message can be customize using configuration properties, see OnDemand configuration documentation.
Message of the Day (MOTD)
You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.
To display a MOTD file on the Dashboard ensure that the environment variables $MOTD_PATH and $MOTD_FORMAT are set, where
MOTD_PATH="/etc/motd" # this supports both file and RSS feed URIs
MOTD_FORMAT="txt" # markdown, txt, rss, markdown_erb, txt_erb
Tip
The _erb formats support ERB rendering to generate more dynamic messages.
Warning
Some MOTD formats like rss, markdown and markdown_erb can contain malicous HTML content. For your safety, by default, the Open OnDemand system will not render HTML. We provide a configuration to enable HTML rendering in MOTD should you need to render HTML.
Fig. 2 Message of the Day appears in the body of the index page.
We recommend setting this in /etc/ood/config/apps/dashboard/env.
Branding
You can customize the logo, favicon, title, and navbar colors of OnDemand.
We recommend setting these values using the OnDemand configuration properties. Currently only the dashboard uses the colors in the navbar.
Table 3 Branding
Feature
Property
Details
Title
dashboard_title
The title appears in the navbar and is controlled by the property dashboard_title. The default value is “Open OnDemand”.
Logo
dashboard_logo
The default value for dashboard_logo is /public/logo.png and this should be the URL to the logo. By default if you place a logo.png at /var/www/ood/public/logo.png it will be accessible via the URL https://your.ondemand.institution.edu/public/logo.png. SVG logo format is also supported.
Logo height
dashboard_logo_height
The CSS height of the dashboard logo.
Favicon
public_url
The favicon is expected to exist at the path $public_url/favicon.ico. For a default OOD installation the favicon will be located at /var/www/ood/public/favicon.ico.
Brand background color
brand_bg_color
Controls the background color of the navbar in the dashboard
Brand foreground color
brand_link_active_bg_color
Controls the background color the active link in the navbar in the dashboard
Replace header title with logo
dashboard_header_img_logo
Value should be url to logo i.e. /public/logo.png. the background color the active link in the navbar in the dashboard
Use white text on black background for navbar.
navbar_type
By default we use inverse for this value, which specifies to use Bootstrap 3’s inverted navbar where text is white and background is black (or dark grey). You can set this to default to use black text on light grey background if it fits your branding better.
Note
It is possible to configure these settings using environment variables, although this is deprecated. For information about the properties and environment variables, see the OnDemand configuration documentation.
Fig. 3 Nav bar if I set brand_bg_color to #0000ff and brand_link_active_bg_color to #ff0000 and dashboard_title to OSC OnDemand
Custom CSS files
For more control on the look and feel of the dashboard pages, use custom CSS files. These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.
Add your CSS file references to the custom_css_files array property. Drop the files into the Apache public assets folder, the default location is: /var/www/ood/public. The system will prepend the /public URL path, based on the public_url property, to load the files correctly.
Example: to load the following CSS file: /var/www/ood/public/myfolder/custom-branding.css, add the configuration below. This will result in a CSS tag added to all dashboard pages with the path: /public/myfolder/custom-branding.css.
custom_css_files: ["/myfolder/custom-branding.css"]
Overriding Pages
Open OnDemand is built with Ruby on Rails which uses partials to build the web pages that are ultimately served to the clients.
All partials are held within dashboard’s views folder. These are the default partials that get distributed when you install the package.
Open OnDemand provides a facility to override any of these partial pages by supplying new files in /etc/ood/config/apps/dashboard/views.
Let’s look at an example where a center can provide a different, specialized, footer for the bottom of the page. Overriding the partial that has been distributed.
First, you would need to find the original partial that is being distributed.
We can find this file’s location at layouts/_footer.html.erb (relative to the dashboard’s views folder).
To override it, we simply provide a new file of the same name and path in the /etc/ood/config/apps/dashboard/views folder.
So, the full file path would be /etc/ood/config/apps/dashboard/views/layouts/_footer.html.erb. By providing a simple html file like the one below, placed in the location in the previous sentence, your center has now provided a different footer than the one distributed by the Open OnDemand package.
<div class="text-center h-5 my-3" >
  My center's custom footer.
<div>
Add URLs to Help Menu
These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in /etc/ood/config/apps/dashboard/env.
Table 4 Dashboard URLs
Name
Environment variable
Example value
Support URL
OOD_DASHBOARD_SUPPORT_URL
https://www.osc.edu/contact/supercomputing_support
User Documentation
OOD_DASHBOARD_DOCS_URL
https://www.osc.edu/ondemand
Developer Documentation
OOD_DASHBOARD_DEV_DOCS_URL
https://osc.github.io/ood-documentation/master/app-development.html (link appears in Develop dropdown if developer mode enabled for user)
Change Password URL
OOD_DASHBOARD_PASSWD_URL
https://my.osc.edu
Custom Help URL (Also requires locale en.dashboard.nav_help_custom)
OOD_DASHBOARD_HELP_CUSTOM_URL
https://idp.osc.edu/auth/realms/osc/account/identity
Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property help_menu. Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.
help_menu supports all the link definitions developed for the custom navigation configuration. For more information on how to create custom links, see for example adding urls to menus.
For information about how to configure properties, see the OnDemand configuration documentation.
help_menu:
  - group: "Documentation"
  - title: "Jupyter Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/jupyter"
  - title: "Support Docs"
    icon: "fas://book"
    url: "https://mydomain.com/path/support/docs"
  - group: "Custom Pages"
  - page: "rstudio_guide"
    title: "RStudio Guide"
    icon: "fas://window-restore"
  - group: "Profiles"
  - profile: "team1"
    title: "Team 1"
    icon: "fas://user"
Add Shortcuts to Files Menu
The Files menu by default has a single link to open the Files app in the user’s Home Directory. More links can be added to this menu, for Scratch space and Project space directories.
Adding more links currently requires adding a custom initializer to the Dashboard app. Ruby code is placed in the initializer to add one or more Ruby FavoritePath (or Pathname for backwards compatibility) objects to the OodFilesApp.candidate_favorite_paths array, a global attribute that is used in the Dashboard app.
FavoritePath is instantiated with a single String or Pathname argument, the directory path, and with an optional keyword argument title specifying a human readable title for that path.
Start by creating the file /etc/ood/config/apps/dashboard/initializers/ood.rb as such:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

Rails.application.config.after_initialize do
  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add project space directories
    projects = User.new.groups.map(&:name).grep(/^P./)
    paths.concat projects.map { |p| FavoritePath.new("/fs/project/#{p}")  }

    # add User scratch space directory
    paths << FavoritePath.new("/fs/scratch/#{User.new.name}")

    # Project scratch is given an optional title field
    paths.concat projects.map { |p| FavoritePath.new("/fs/scratch/#{p}", title: "Scratch")  }
  end
end
The variable paths is an array of FavoritePath objects that define a list of what will appear in the Dashboard menu for Files
At OSC, the pattern for project paths follows /fs/project/project_name. So above we:
get an array of all user’s groups by name
filter that array for groups that start with P (i.e., PZS0002, PAW0003, …)
using map we turn this array into an array of FavoritePath objects to all the possible project directories the user could have.
extend the paths array with this list of paths
For possible scratch space directories, we look for either /fs/scratch/project_name or /fs/scratch/user_name
Additionally project scratch directories have a ‘title’ attribute and will with in the dropdown with both the title and the path.
On each request, the Dashboard will check for the existence of the directories in OodFilesApp.candidate_favorite_paths array and whichever directories exist and the user has access to will appear as links in the Files menu under the Home Directory link.
Fig. 4 Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.
You must restart the Dashboard app to see a configuration change take effect. This can be forced from the Dashboard itself by selecting Help → Restart Web Server from the top right menu.
If you access the Dashboard, and it crashes, then you may have made a mistake in ood.rb file, whose code is run during the initialization of the Rails app.
Configuration Profiles
Note
The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible. See the list of supported properties in the configuration documentation
Configuration properties can be organized in a hierarchy using profiles. With profiles, administrators can create different configuration settings within the same OnDemand installation. A profile can be pre-selected or dynamically changed while using the Dashboard application.
To define profile properties, we have to group them under a profile name within the profiles keyword. Multiple profiles can be created using different files, the configuration logic will aggregate all profiles into a single consolidated object.
profiles:
  profile_name:
    config_property: config_value
OnDemand uses an inheritance and override approach for profiles. The root profile is the default profile created by the system based on all the properties defined outside any profile definition. All other profiles will inherit these values.
Then, profile properties can override these values or define new ones as required.
The example below shows how the root profile defines a value for pinned_apps and pinned_apps_menu_length properties. The rstudio_group profile inherits the property value for pinned_apps_menu_length, and overrides the value for pinned_apps. As well, it defines a value for the property pinned_apps_group_by.
pinned_apps: [sys/*]
pinned_apps_menu_length: 10

profiles:
  rstudio_group:
    pinned_apps: [sys/rstudio]
    pinned_apps_group_by: "department"
Manual Profile Selection
The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected. Profile selection can be done using configurable navigation links. These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.
To add profile links to the Help navigation dropdown menu use the configuration property profile_links. For more information on how to add profile links to the navigation bar in various places, see menus for profile links.
profile_links:
  - group: "Profiles"
  - profile: ""
    title: "Root Profile"
    icon: "fas://cog"
  - profile: rstudio_group
    title: "Rstudio Profile"
    icon: "fas://user"
  - profile: jupyter_group
    title: "Jupiter Profile"
    icon: "fas://user"
Tip
Use the group property to add a section header or to organize your profiles as shown above. Profile links can be configured as well using the Help menu customizations.
Note
Your profile selection is stored in your OnDemand user settings file. The profile key in this YAML file provides the value used to select your current profile. The user settings file is stored in your OnDemand data folder, this is usually ~/ondemand/data/sys/dashboard/.ood. Manual updates to this file will require an application restart to load the new values.
Automatic Profile Selection
Request Hostname profile selection: use the current request hostname as the selected profile. To enable this feature, set the configuration property host_based_profiles to true. A request to https://www.ondemand.com/pun/sys/dashboard will use www.ondemand.com as the selected profile name.
Configure the profiles using the hostname and the system will use the profile properties automatically.
profiles:
  www.ondemand.com:
    config_property: config_value
Tip
If you have a need to create multiple profile definitions that have the same configuration, you could use aliases. This is a feaure of YAML files. You can use YAML anchors and aliases to set the same profile configuration to more than one definition without duplication. This YAML feature only works when defined and used within the same file.
The example below creates 4 profiles all with the same configuration:
profiles:
  www.production.com: &production_profile # Anchor definition
    config_property: config_value
    config_property: config_value
    config_property: config_value

  www.local.com: *production_profile # Defining an alias to the previously set anchor.
  www.test.com: *production_profile
  www.staging.com: *production_profile
Changing the Navigation bar
There are a couple ways to change the navigation bar in Open OnDemand, some are simpler than others.
This section provides the outline of how the navigation bar is generated to begin with, then details the various ways to modify it.
Once you understand how the navigation bar is generated automatically, you can take steps to custimize it as you see fit.
Understanding the default navigation bar
Some navigation menus and links are built-in to the system. The system will generate dropdown menus for Files, Jobs, Clusters and Interactive Apps automatically. It will also generate the link for My Interactive Sessions by default.
Here’s an image of you’d expect to see by default.
Open OnDemand is a platform for other applications, like Jupyter & RStudio. As such, the default navigation bar builds itself based on what applications it has discovered. The system will search /var/www/ood/apps/sys/ for these applications.
Every application should have Manifest yml files. The system reads these manifests files and builds additional dropdown menus (or adds to existing menus) based on the category field.
By default, the system will generate a new dropdown menu for every category it encounters. Within each dropdown menu it will add seperators for each subcategory it encounters.
Limit auto generated menu bars
As described in the previous section, the system will generate new dropdown menus for every category it discovers.
If you wish to add or remove which categories create dropdown menus use the nav_categories configuration property.
Tip
Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Warning
Prior to 3.0, controlling which categories appear in the navigation bar was controlled by a Ruby initializer that you needed to modify. While the 2.x series will still support this scheme, Open OnDemand 3.0 will not. 3.0 will only support the nav_categories property.
Here is the 2.0 documentation for controling the navbar.
Using manifests to create menu items
As described in Understanding the default navigation bar, the system automatically creates dropdown menus based on the applications it encounters.
So, with that knowledge, one can create or add to dropdown menus by creating applications with the correct information in their manifest.yml.
It’s fairly simple to make this application. Simply create the directory in the correct location and create a manifest.yml.
sudo mkdir /var/www/ood/apps/sys/<NEW MENU ITEM>
sudo vi /var/www/ood/apps/sys/<NEW MENU ITEM>/manifest.yml
---
# This is the text that will show up in the dropdown menu.
name: Add Menu Items to the navbar

# This will create the 'Links' dropdown menu if it doesn't already exist.
category: Links
description: |-
  A description of what the menu item does.
icon: fa://clock-o   # icon for the link.
url: 'https://openondemand.org/'

# open link in new browser window or same browser window.
new_window: true
Tip
This scheme may be fine with one or two additional links. Should you need more granular control over the navigation bar, read Fully customizing the navigation bar below.
Fully customizing the navigation bar
Since 3.0, Open OnDemand provides a way to completely control the navigation bar through the nav_bar and help_bar ondemand.d/*.yml files configuration properties.
Warning
As described in Understanding the default navigation bar, the system auto-generates dropdown menus based on the applications it discovers. If the nav_bar or help_bar configurations are set, the system will only show what you’ve defined.
Before we look at how to modify it in detail, let’s look at what the default configuration would be (without showing any discovered apps).
# 'nav_bar' is the left side of the navigation bar.
nav_bar:
  # 'apps' dropdown menu is shown if you've set 'pinned_apps'.
  - apps
  - files
  - jobs
  - clusters
  - interactive apps
  - my interactive sessions

  # 'all apps' is disabled by default, but would be next if you set 'show_all_apps_link'.
  # - all apps

# 'help_bar' is the right side of the navigation bar.
help_bar:
  - develop
  - help
  - user
  - logout
The configuration above would be equvialent to the default navigation bar as described in Understanding the default navigation bar.
As menus are dynamically discovered from your system, this documentation can only cover how a fresh install - with no other applications - would behave.
A custom navigation definition is a list of navigation items. A navigation item could be a navigation menu or a navigation link. A navigation menu contains a list of navigation links with optional link groups.
There are several ways of creating a navigation menu.
Menus by Application category
One of the easiest ways to create menus is to create them based off of the applications categories.
The title of the dropdown menu will be the category itself, and menu items (applications) will be grouped by their subcategory. It is not possible to set an icon. The category matching is case insensitive.
Here’s an example using the interactive apps category. Just like the default navigation bar, this will generate a dropdown menu of all the applications the system has discovered in that category.
As you can see from the image, the system has discovered eight applications in two subcategories.
nav_bar:
  - "interactive apps"
Predefined templates
As you can see from the example default configuration in fully-customizing-the-navbar, there are several pre-defined navigation menus that you can use.
A complete list of predefined templates is:
all_apps - The link to the all applications page.
apps - A drop down menu of pinned_apps. Note that you need to set pinned_apps for this to show up.
sessions - The link to “My Interactive Sessions” page.
develop - The dropdown menu for developers, titled “Develop”.
help - The “Help” dropdown menu.
log_out - The link to logout, titled “Logout”.
user - The “Logged in as <user>” text.
Here’s an example of defining all of them and what that would look like.
nav_bar:
  - "all_apps"
  - "apps"
  - "sessions"
  - "develop"
  - "help"
  - "log_out"
  - "user"
Menus based on applications
You can create dropdown menus based on applications the system can discover.
Menu items are automatically grouped based on the applications subcategory. Use the apps array to define the app tokens for this navigation menu.
The order of the menu items is based on the order you’ve defined.
nav_bar:
  - title: "My Apps"
    icon: "fas://window-restore"
    apps:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
Menus based on links
Menus based on links provide even more granular control on how the dropdown menu is generated.
As seen in the previous sections, using an apps array will automatically generate submenus based on the subcategory of the applications that have been discovered.
When using links, we can override this behaviour to provide different titles to the submenus, or with no submenus and subtitles at all.
Let’s look at this example using the same application tokens, but using links instead of apps. The system will discover and generate list items for the same eight applications, only without any submenus. It is simply a list of all the discovered applications with no further grouping.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - "sys/Rstudio/*"
      - "sys/bc_desktop"
To add submenus, simply use the group attribute.
When links are used with the group attribute, the discovered applications will now be grouped and submenu titles created based on the configuration provided.
This will look and feel similar to menus-based-on-applications with the exception being that submenus are defined by the group configuration instead of the subcategory of the applications in the list.
nav_bar:
  - title: "My Apps"
    icon: "fa://code"
    links:
      - group: "RStudio"
      - "sys/Rstudio/*"
      - group: "Remote"
      - "sys/bc_desktop"
Tip
You can also used predefined links (described above) in the links section here.
Menus for profile links
If you’ve enabled Profiles <profiles_guide> you can create navigation bar menus and links to those profiles through the profile attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    profile: "team1"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        profile: "team1"
        new_tab: true # optional, defaults to false
Menus for custom pages
If you’ve enabled custom_pages_guide you can create navigation menus or single links directly to those pages through the the page attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    page: "documentation"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        page: "documentation"
        new_tab: true # optional, defaults to false
Menus for URLs
You can even create menu items for relative and absolute URLs to link anywhere through the url attribute.
nav_bar:
  # Single top level link
  - title: "Title"
    icon: "fa://desktop" # optional, defaults to fas://cog
    url: "/docs"
    new_tab: true # optional, defaults to false

  # Dropdown menu
  - title: "Menu Item"
    links:
      - title: "Title"
        icon: "fa://desktop" # optional, defaults to fas://cog
        url: "https://openondemand.org/"
        new_tab: true # optional, defaults to false
Interactive Apps Menu
To define a custom interactive apps menu, use the configuration property interactive_apps_menu. The custom menu will replace the Interactive Apps left hand side navigation in the Interactive Apps and My Interactive Sessions pages.
interactive_apps_menu property supports a single navigation item. How to configure navigation items is described in the Custom Dashboard Navbar section
interactive_apps_menu:
  title: "Custom Apps"
  links:
    - group: "Desktop"
    - apps: "sys/bc_desktop"
    - group: "Servers"
    - apps: "sys/Rstudio/*"
Set Upload Limits
By default, the file size upload limit is 10737420000 bytes (~10.7 GB).
If you want set this to a lower value, set the FILE_UPLOAD_MAX configuration in the file apps’ configuration file /etc/ood/config/apps/dashboard/env.
If you want to set it to a higher value set nginx_file_upload_max in /etc/ood/config/nginx_stage.yml to the desired value. If you have FILE_UPLOAD_MAX set from above, unset it.
If the values differ, the files app will choose the smaller of the two as the maximum upload limit.
Warning
Both of these configurations are expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
If you want to disable file upload altogether, set FILE_UPLOAD_MAX to 0 and leave the nginx_file_upload_max configuration alone (or comment it out so the default is used).
Set Download Limits
By default, the maximum file download size is 10.7 GB (10737418240 bytes). If you wish to change this, you can set the OOD_DOWNLOAD_DIR_MAX configuration environment variable in the /etc/ood/config/apps/dashboard/env file to the desired value in bytes.
For example, to set the limit to 5 GB, you can add the following line to the /etc/ood/config/apps/files/env file:
OOD_DOWNLOAD_DIR_MAX=5368709120
Note that this will limit the download size for all users of the Open OnDemand instance.
Warning
This configuration value is expected to be numbers only (no characters) and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.
Values like 1000M or 20G will not be accepted and may cause errors.
Block or Allow Directory Access
By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand can never read files the user cannot read).
By setting a colon delimited OOD_ALLOWLIST_PATH environment variable, the Job Composer, File Editor, and Files app respect the allowlist in the following manner:
Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths
Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths
Users should not be able to get around this using symlinks
We recommend setting this environment variable in /etc/ood/config/nginx_stage.yml as a YAML mapping (key value pairs) in the mapping (hash/dictionary) pun_custom_env i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:
pun_custom_env:
 OOD_ALLOWLIST_PATH: "/users:/fs/project:/fs/scratch"
Warning
This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.
Disabling Users
You can use the nginx stage configuration for disabling users to disable access to specific users based on the users’ default shell.
For example you could disable access to Open OnDemand for any user with the /usr/bin/false default shell.
Set Default SSH Host
Warning
The shell app does not work out of the box because all SSH hosts have to be explicitly allowed through the allowlist (see the section below).
Because there are no hosts configured, no hosts are allowed.
In /etc/ood/config/apps/shell/env set the env var OOD_DEFAULT_SSHHOST to change the default ssh host. Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).
This will control what host the shell app ssh’s to when the URL accessed is /pun/sys/shell/ssh/default which is the URL other apps will use (unless there is context to specify the cluster to ssh to).
Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add default=true attribute to the login section like the example below.
# /etc/ood/config/clusters.d/my_cluster.yml
---
v2:
  metadata:
    title: "My Cluster"
  login:
    host: "my_cluster.my_center.edu"
    default: true
Set SSH Allowlist
In 1.8 and above we stopped allowing ssh access by default. Now you have explicitly set what hosts users will be allowed to connect to in the shell application.
Every cluster configuration with v2.login.host that is not hidden (it has v2.metadata.hidden attribute set to true) will be added to this allowlist.
To add other hosts into the allow list (for example compute nodes) add the configuration OOD_SSHHOST_ALLOWLIST to the /etc/ood/config/apps/shell/env file.
This configuration is expected to be a colon (:) separated list of GLOBs.
Here’s an example of of this configuration with three such GLOBs that allow for shell access into any compute node in our three clusters.
# /etc/ood/config/apps/shell/env
OOD_SSHHOST_ALLOWLIST="r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu"
Set OOD SSH Port
As of version 2.1 you are allowed to configure a non-standard ssh port.
To change the ssh port for submitting jobs in OOD, you need to add the configuration OOD_SSH_PORT to the /etc/ood/config/apps/dashboard/env file.
Here’s an example of of this configuration.
# /etc/ood/config/apps/dashboard/env
OOD_SSH_PORT="2222"
Shell App SSH Command Wrapper
Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.
This is helpful when you pass add additional environment variable through ssh (-o SendEnv=MY_ENV_VAR) or ensure some ssh command options be used.
To use your ssh wrapper configure OOD_SSH_WRAPPER=/usr/bin/changeme to point to your script in /etc/ood/config/apps/shell/env. Also be sure to make your script executable.
Here’s a simple example of what a wrapper script could look like.
#!/bin/bash

args="-o SendEnv=MY_ENV_VAR"

exec /usr/bin/ssh "$args" "$@"
Fix Unauthorized WebSocket Connection in Shell App
If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes X-OOD-Failure-Reason: invalid origin, you may need to set the OOD_SHELL_ORIGIN_CHECK configuration option.
There is a security feature that adds proper CSRF protection using both the Origin request header check and a CSRF token check.
The Origin check uses X-Forwarded-Proto and X-Forwarded-Host that Apache mod_proxy sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.
In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set OOD_SHELL_ORIGIN_CHECK env var to the correct https string, or disable the origin check altogether by setting OOD_SHELL_ORIGIN_CHECK=off (or any other value that does not start with “http”) in the /etc/ood/config/apps/shell/env file.
Either way the CSRF token will still provide protection from this vulnerability.
# /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn't start with http
OOD_SHELL_ORIGIN_CHECK='off'

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK='https://my.other.origin'
Custom Job Composer Templates
Below explains how job templates work for the Job Composer and how you can add your own. Here is an example of the templates we use at OSC for the various clusters we have
Job Templates Overview
“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:
copy the directory of a job they already ran or an example job
edit the files
submit a new job
“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.
Copy a directory of a job already ran or an example job
User can create a new job from a “default” template. A custom default template can be defined at /etc/ood/config/apps/myjobs/templates/default or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates/default. If no default template is specified, the default is /var/www/ood/apps/sys/myjobs/example_templates/torque
user can select a directory to copy from a list of “System” templates the admin copied to /etc/ood/config/apps/myjobs/templates or under the app deployment directory at /var/www/ood/apps/sys/myjobs/templates during installation
user can select a directory to copy from a list of “User” templates that the user has copied to $HOME/ondemand/data/sys/myjobs/templates
user can select a job directory to copy that they already created through “Job Composer” from $HOME/ondemand/data/sys/myjobs/projects/default
Edit the files
user can open the copied job directory in the File Explorer and edit files using the File Editor
Submit a new job
user can use the Job Options form specify which host to submit to, what file is the job script
user can use the web interface to submit the job to the batch system
after the job is completed, the user can open the directory in the file explorer to view results
Job Template Details
A template consists of a folder and a manifest.yml file.
The folder contains files and scripts related to the job.
The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.
name: A Template Name
host: ruby
script: ruby.sh
notes: Notes about the template, such as content and function.
In the event that a job is created from a template that is missing from the manifest.yml, “Job Composer” will assign the following default values:
name The name of the template folder.
host The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config
script The first .sh file appearing in the template folder.
notes The path to the location where a template manifest should be located.
Job Composer Script Size Limit
Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are _any_ files less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65kb).
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# show any file less than or equal to 15 kb
OOD_MAX_SCRIPT_SIZE_KB=15
Hiding Job Arrays
When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on supported clusters, an option was added.
To reconfigure this, simply set the environment variable in the job composers’ env file /etc/ood/config/apps/myjobs/env like so:
# Don't show job arrays field even on supported clusters
OOD_HIDE_JOB_ARRAYS=True
Custom Error Page for Missing Home Directory on Launch
Some sites have the home directory auto-create on first ssh login, for example via pam_mkhomedir.so. This introduces a problem if users first access the system through OnDemand, which expects the existence of a user’s home directory.
In OnDemand <= 1.3 if the user’s home directory was missing a non-helpful single string error would display. Now a friendly error page displays. This error page can be customized by adding a custom one to /etc/ood/config/pun/html/missing_home_directory.html.
The default error page looks like this:
An example of a custom error page has been provided at /opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir and can be copied to /etc/ood/config/pun/html/missing_home_directory.html. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:
See this Discourse discussion for details.
Pinning Applications to the Dashboard
In version 2.0 you can now pin app Icons to the dashboard that link to the application form.
When configured a widget like the one below will appear on the dashboard’s landing page.
The configuration for what apps to pin allows for three variants.
You can configure specific apps with a string of the type router/app_name. For example sys/jupyter is the system installed app named jupyter.
Secondly you can configure globs like sys/* to pin all system installed apps. Or Maybe sys/minimal_* to pin all system installed apps that begin with ‘minimal’.
Lastly you can choose to pin apps based off of fields in their manifest.yml file. You can match by type, category, subcategory and metadata fields. These matches are cumulative. Meaning an app has to match all of these to be pinned. In the examples below there is a configuration of type sys and category minimal. This configuration will only pin system installed apps that are in the minimal category. An app has to meet both these criteria to be pinned to the dashboard.
Full examples are below:
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - sys/jupyter           # pin a specific system installed app called 'jupyter'

  - sys/bc_desktop/desk1  # pinned desktop app must contain exact desktop name - 'desk1'

  - 'sys/*'               # pin all system install apps. This also works for usr/* and dev/*

  - category: 'minimal'   # pin all the apps in the 'minimal' category

  - type: sys             # pin all system installed apps in the minimal category.
    category: 'minimal'

  # pin all system installed apps in the minimal category and the
  # class instruction subcategory
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'

  # pin all system installed apps in the minimal category, the
  # class instruction subcategory and the metadata field 'field_of_science'
  # with an exact match on biology
  - type: sys
    category: 'minimal'
    subcategory: 'class_instruction'
    field_of_science: 'biology'

  # pin any app with an exact match on the metadata field_of_science of biology
  - field_of_science: 'biology'

  # pin any app with an glob match *bio* on the metadata field_of_science
  - field_of_science: '*bio*'
Administrators can also configure the pinned apps to be grouped by any field in the manifest.yml including metadata fields with the pinned_apps_group_by configuration.
This will create a row and a heading for each group like so (the image was generated from grouping by category):
One can also change the menu length in the ‘App’s menu item. If you’ve pinned more than 6 apps and you want to them to show up in this dropdown list, simply increase the length with the option below.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps_menu_length: 6        # the default number of items in the dropdown menu list
pinned_apps_group_by: category    # defaults to nil, no grouping
Pinned Apps customizations
To customize the text, icon, or color of the pinned app tile, use the tile configuration property in the application manifest or form. The form values will take precedence over any set in the manifest. All the values are optional and any set will override the default from the application.
tile:
  title: "Custom Title"
  icon: fa://desktop
  border_color: "red"
  sub_caption: |
    Custom Text Line 1
    Text Line 2
    Text Line 3
The CSS for the pinned app tiles has been optimized to support upto three lines of text for the sub_caption property.
Custom layouts in the dashboard
Administrators can now customize what widgets appear on the dashboard and how they’re layed out on the page.
In it’s simplest form this feature allows for a rearrangement of existing widgets. As of 2.1 the existing widgets are:
pinned_apps - Pinned Apps described above
recently_used_apps - the four most recently used interactive applications. Launching these applications will start a new interactive session with the previously submitted parameters.
sessions - the three most recent active interactive sessions
motd - the Message of the Day
xdmod_widget_job_efficiency - the XDMoD widget for job efficiency
xdmod_widget_jobs - the XDMoD widget for job information
This feature also allows for administrators to add custom widgets. Simply drop new files into /etc/ood/config/apps/dashboard/views/widgets and reference them in the configuration. These partial files can be any format Rails recognizes, notably .html or .html.erb extensions.
Also if you use subdirectories under widgets, they can be referenced by relative paths. For example views/widgets/cluster/_my_cluster_widget.html.erb would be referenced in the configuration as cluster/my_cluster_widget.
Warning
Rails expects files to be prefixed with an underscore. For example if you configured my_new_widget the filename should be _my_new_widget.html.
Without setting this configuration, the dashboard will arrange itself depending on what features are enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly based on a default layout.
Here’s the default configuration when all of these features are enabled.
# /etc/ood/config/ondemand.d/ondemand.yml
dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
rows are an array of row elements. Each row element has a columns field which is an array column elements. Each column element two fields. A width field that specifies the width in the bootstrap grid layout which defaults to 12 columns in total. It also has a widgets field which is an array of existing or newly added widgets to render in that column.
Customize Text in OnDemand
Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.
Initial translation dictionary files with defaults that work well for OSC and using the English locale (en) have been added (/var/www/ood/apps/sys/dashboard/config/locales/en.yml and /var/www/ood/apps/sys/myjobs/config/locales/en.yml). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:
Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to /etc/ood/config/locales/en.yml and modify that copy.
If you want apps to look for these dictionary files in a different location than /etc/ood/config/locales/en.yml you can change the location by defining OOD_LOCALES_ROOT environment variable.
The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a /etc/ood/config/locales/fr.yml and then configure the Dashboard to use this locale by setting the environment variable OOD_LOCALE=fr where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.
In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.
Table 5 OnDemand Locale Files
File path
App
Translation namespace
/var/www/ood/apps/sys/dashboard/config/locales/en.yml
Dashboard
dashboard
/var/www/ood/apps/sys/myjobs/config/locales/en.yml
Job Composer
jobcomposer
/etc/ood/config/locales/en.yml
All localizable apps will check this path, unless OOD_LOCALES_ROOT is set.
Any
Warning
Translations have certain variables passed to them for example %{support_url}. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.
Note
Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the YAML spec.
Note
OnDemand uses the convention that translations that accept HTML with be suffixed with _html. Any other translation will be displayed as plain text.
Change the Dashboard Tagline
en:
  dashboard:
    welcome_html: |
      %{logo_img_tag}
      <p class="lead">OnDemand provides an integrated, single access point for all of your HPC resources.</p>
    motd_title: "Message of the Day"
The welcome_html interpolates the variable logo_img_tag with the default logo, or the logo specified by the environment variable OOD_DASHBOARD_LOGO.
You may omit this variable in the value you specify for welcome_html if you prefer.
Change quota messages in the Dashboard
Two messages related to file system usage that sites may want to change:
quota_additional_message - gives the user advice on what to do if they see a quota warning
quota_reload_message - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes
Customize Text in the Job Composer’s options form
The OSC-default value for options_account_help says that the account field is optional unless a user is a member of multiple projects.
Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string options_account_help.
Disk Quota Warnings on Dashboard
You can display warnings to users on the Dashboard if their disk quota is nearing its limit. This requires an auto-updated (it is recommended to update this file every 5 minutes with a cronjob) JSON file that lists all user quotas. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "quotas": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and quotas is a list of quota objects (see below).
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_QUOTA_PATH as a colon-delimited list of all JSON file paths in the /etc/ood/config/apps/dashboard/env file. In addition to pointing to files OOD_QUOTA_PATH may also contain HTTP(s) or FTP protocol URLs. Colons used in URLs are correctly handled and are not treated as delimiters.
Warning
Sites using HTTP(s) or FTP for their quota files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 95% (0.95), but this can be changed with the environment variable OOD_QUOTA_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_QUOTA_PATH="/path/to/quota1.json:https://example.com/quota2.json"
OOD_QUOTA_THRESHOLD="0.80"
Individual User Quota
If the quota is defined as a user quota, then it applies to only disk resources used by the user alone. This is the default type of quota object and is given in the following format:
{
  "type": "user",
  "block_limit": 5000000,
  "file_limit": 1000000,
  "path": "/path/to/volume2",
  "total_block_usage": 400000,
  "total_file_usage": 1000,
  "user": "user1"
}
Warning
A block must be equal to 1 KiB for proper conversions.
Individual Fileset Quota
If the quota is defined as a fileset quota, then it applies to all disk resources used underneath a given volume. This requires the object to be repeated for each user that uses disk resources under this given volume. The format is given as:
{
  "type": "fileset",
  "user": "user1",
  "path": "/path/to/volume2",
  "block_usage": 500,
  "total_block_usage": 1000,
  "block_limit": 2000,
  "file_usage": 1,
  "total_file_usage": 5,
  "file_limit": 10
}
Where block_usage and file_usage are the disk resource usages attributed to the specified user only.
Note
For each user with resources under this fileset, the above object will be repeated with just user, block_usage, and file_usage changing.
Balance Warnings on Dashboard
You can display warnings to users on the Dashboard if their resource balance is nearing its limit. This requires an auto-updated (it is recommended to update this file daily with a cronjob) JSON file that lists all user balances. The JSON schema for version 1 is given as:
{
  "version": 1,
  "timestamp": 1525361263,
  "config": {
    "unit": "RU",
    "project_type": "project"
  },
  "balances": [
    {},
    {}
  ]
}
Where version defines the version of the JSON schema used, timestamp defines when this file was generated, and balances is a list of quota objects (see below).
The value for config.unit defines the type of units for balances and config.project_type would be project, account, or group, etc. Both values are used in locales and can be any string value.
You can configure the Dashboard to use this JSON file (or files) by setting the environment variable OOD_BALANCE_PATH as a colon-delimited list of all JSON file paths.
Warning
Sites using HTTP(s) or FTP for their balance files may see slower dashboard load times, depending on the responsiveness of the server providing the quota file(s).
The default threshold for displaying the warning is at 0, but this can be changed with the environment variable OOD_BALANCE_THRESHOLD.
An example is given as:
# /etc/ood/config/apps/dashboard/env

OOD_BALANCE_PATH="/path/to/balance1.json:/path/to/balance2.json"
OOD_BALANCE_THRESHOLD=1000
User Balance
If the balance is defined as a user balance, then it applies to only that user. Omit the project key:
{
  "user": "user1",
  "value": 10
}
Project Balance
If the balance is defined as a project balance, then it applies to a project/account/group, whatever is defined for config.project_type:
{
  "user": "user1",
  "project": "project1",
  "value": 10
}
Maintenance Mode
As an administrator you may want to have some downtime of the Open OnDemand service for various reasons, while still telling your customers that the downtime is expected.
You can do this by setting Open OnDemand in ‘Maintenance Mode’. While Maintenance mode is active, Apache will not serve requests for paths outside the /public/maintenance/* wildcard. Instead, it will serve the /var/www/ood/public/maintenance/index.html file, which you can change or brand to be your own. Changes to this file will persist through upgrades. Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed in the /var/www/ood/public/maintenance/ directory. You can also put symbolic links into the /var/www/ood/public/maintenance/ directory, if you want to reuse assets located elsewhere in your file system.
While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose IP does not match one of the configured allowlist regular expressions. The allowlist is to allow staff, localhost or a subset of your users access while restricting others.
In this example we allow access to anyone from 192.168.1..* which is the 192.168.1.0/24 CIDR and the single IP ‘10.0.0.1’.
These are the settings you’ll need for this functionality.
# /etc/ood/config/ood_portal.yml
use_rewrites: true
use_maintenance: true
maintenance_ip_allowlist:
  # examples only! Your ip regular expressions will be specific to your site.
  - '192.168.1..*'
  - '10.0.0.1'
To start maintenance mode (and thus start serving this page) simply touch /etc/ood/maintenance.enable to create the necessary file. When your downtime is complete just remove the file and all the traffic will be served normally again. The existence of this file is what starts or stops maintenance mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to take affect.
Grafana support
It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.
Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization. Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust org_name to match whatever organization you wish to be anonymous.
Warning
Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana. It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.
[auth.anonymous]
enabled = true
org_name = Public
org_role = Viewer

[security]
allow_embedding = true
The dashboard used by OSC is the OnDemand Clusters dashboard.
Settings used to access Grafana are configured in the cluster config. The following is an example from OSC:
custom:
  grafana:
    host: "https://grafana.osc.edu"
    orgId: 3
    dashboard:
      name: "ondemand-clusters"
      uid: "aaba6Ahbauquag"
      panels:
        cpu: 20
        memory: 24
    labels:
      cluster: "cluster"
      host: "host"
      jobid: "jobid"
    cluster_override: "mysite"
When viewing a dashboard in Grafana choose the panel you’d wish to display and select Share. Then choose the Embed tab which will provide you with the iframe URL that will need to be generated within OnDemand. The time ranges and values for labels (eg: var-cluster=) will be autofilled by OnDemand.
orgId is the orgId query parameter
The dashboard name is the last segment of the URI before query parameters
The uid is the UID portion of URL that is unique to every dashboard
The panelId query parameter will be used as the value for either cpu or memory depending on the panel you have selected
The values for labels are how OnDemand maps labels in Grafana to values expected in OnDemand. The jobid key is optional, the others are required.
The cluster_override can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.
Disable Host Link in Batch Connect Session Card
Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).
However, some sites may want to disable this feature because they do not allow ssh sessions on the compute nodes.
To disable this, simply set the environment variable in the dashboards’ env file /etc/ood/config/apps/dashboard/env to a falsy value (0, false, off).
# don't show ssh link in batch connect card
OOD_BC_SSH_TO_COMPUTE_NODE=off
If you wish to disable on a per-cluster basis, you can set the following in your cluster YAML configuration.
v2:
   # ...
   batch_connect:
     ssh_allow: false
Set Illegal Job Name Characters
If you encounter an issue in running batch connect applications complaining about invalid job names like the error below.
Unable to read script file because of error: ERROR! argument to -N option must not contain /
To resolve this set OOD_JOB_NAME_ILLEGAL_CHARS to / for all OOD applications in the pun_custom_env attribute of the /etc/ood/config/nginx_stage.yml file.
# /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
Customize Dex Theme
It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication. Refer to the upstream Dex template docs for additional information on templating Dex.
The simplest approach is to copy the OnDemand theme and make changes. This is idea if you wish to make the following changes:
Change navigation or login page logos
Change favicon
Change CSS styles
cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
To update the theme you must modify /etc/ood/config/ood_portal.yml and regenerate the Dex configuration:
dex:
# ...
  frontend:
    theme: mycenter
The default ondemand theme can also be configured using the following configuration keys within /etc/ood/config/ood_portal.yml:
dex:
# ...
  frontend:
    issuer: "MyCenter OnDemand"
    extra:
      navLogo: "/public/nav-logo.png"
      loginLogo: "/public/logo.png"
      loginTitle: "Log in with your Center username and password"
      loginButtonText: "Log in with your Center account"
      usernamePlaceholder: "center-username"
      passwordPlaceholder: "center-password"
      loginAlertMessage: "Login services will be down during center maintenance between 8:00 AM EST and 10:00 AM EST"
      loginAlertType: "warning"
Changes are applied by running update_ood_portal and restarting the ondemand-dex service.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
XDMoD Integration
XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.
Fig. 5 Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.
Steps to enable the XDMoD reports in the OnDemand Dashboard:
Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml
pun_custom_env:
  OOD_XDMOD_HOST: "https://xdmod.osc.edu"
Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini
domains = "https://ondemand.osc.edu"
Configure identity provider to include OnDemand host in HTTP Content-Security-Policy for frame-ancestors since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:
frame-ancestors https://*.osc.edu 'self'
If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:
v2:
 metadata:
   title: "HPC Cluster"
 login:
   host: "frontend"
 job:
   adapter: "slurm"
   cluster: "hpc"
   bin: "/usr/bin"
 custom:
   xdmod:
     resource_id: 1
In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion which defaults to 24 hours (86400 seconds) with a text message specified by locale key en.jobcomposer.xdmod_url_warning_message. To disable this message, set the value you your locale file under /etc/ood/config/locales. For example, in the default locale we have these values:
en:
  jobcomposer:
    xdmod_url_warning_message: "This job may not appear in Open XDMoD until 24 hours after the completion of the job."
    xdmod_url_warning_message_seconds_after_job_completion: 86400
Which results in these warning messages appearing in Job Composer:
Accessing Remote File Systems
Since 2.1 you can use rclone to interact with remote file systems. Since every command in Open OnDemand is issued as the user, the user themselves are required to setup their rclone remotes.
You can refer to the OSC’s rclone documentation on how to configure rclone remotes.
To enable this feature ensure that rclone is installed on the same machine that Open OnDemand is installed. You also have to enable the feature through the configuration entry for enabling remote filesystems.
Cancel Interactive Sessions
We can now cancel an interactive session from the session panel without deleting the session card. This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.
This feature is disabled behind a feature toggle. To enable it, set the configuration property cancel_session_enabled: true. For more information on how to configure properties, see configuration documentation.
When enabled, the cancel button will appear for active sessions. When the session is cancelled, the job will be cancelled in the scheduler, the status will change to completed, and the session card will be kept. For completed sessions, the system will only show the delete button.
Custom Pages
Custom pages allow administrators to add custom content to new dashboard pages. These new pages are configured using layouts and widgets, in the same way as customizing the layout for the dashboard.
To create a custom page, add a layout under a new page_code to the custom_pages property object. For more information on how to setup dashboard properties, see OnDemand configuration files
Custom pages have their own URL based on their page_code: /sys/pun/dashboard/custom/page_code.
The example configuration below creates a custom page with the page_code: documentation. It will render a layout with the pinned_apps widget under the URL: /sys/pun/dashboard/custom/documentation.
custom_pages:
  documentation:
    rows:
      - columns:
          - width: 12
            widgets:
              - "pinned_apps"
Links to the custom pages can be added the Help dropdown menu. To add links to the Help menu use the configuration property help_menu. See the documentation on adding urls to the Help menu for details and examples.
Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar. See How to add menus for custom pages.
# Adding a link to the custom page with page_code = "documentation"
help_menu:
  - group: "Custom Pages"
  - page: "documentation"
    title: "Site Documentation"
    icon: "fas://book"
Support Tickets
The Dashboard now supports sending a support ticket to your institution Help Desk system. The feature uses email as the delivery mechanism, but it could be extended to support others.
To enable this feature, define the settings needed using the the configuration property support_ticket. Once this configuration object is defined, the Submit Support Ticket link will be shown in the Help navigation menu and in all interactive session cards.
The support ticket page has a simple form to gather information that will be submitted to the support system via email. If triggered from a session card, the system will automatically add information about the selected session to the body of the email to help troubleshoot the issue.
A brief description of the default form fields used in the support ticket form:
Username: Logged in user. Username will be added to the support ticket body for reference.
Email: Email address to communicate regarding this support ticket. A single email address is supported.
CC: Additional email address to communicate regardig this ticket. A single email address is supported.
Subject: Brief description of the problem.
Attachments: Add screeshots of the problem to help with debugging and troubleshooting.
Description: Detail description of the problem.
Configuration
These are the most common configuration properties needed to enable and setup the support ticket feature:
description: Text to customize the support ticket header.
email: Section to configure how the email is sent to the support system.
to: The destination email address of your Help Desk.
from: The address to set in the from field when sending the email. It defaults to the email submitted in the support ticket form. This is useful to prevent the incoming emails being considered spam.
delivery_method: Rails setting to set the transport mechanism to use. This is usually smtp. For more information see the Rails documentation on mailers.
delivery_settings: Rails settings object to set the transport configuration properties. See example below or the Rails documentation on mailers.
Warning
Use caution when supplying username and password in delivery_settings. These files are readable by unprivileged users and as such this information can be found by a sophsticated user without privilege escelation.
Sample configuration:
support_ticket:
  # Optional.
  # Validation configuration for attachments.
  attachments:
    # Maximum number of attachments. Defaults to 4
    max_items: 1
    # Maximum size for a single attachment in bytes. Defaults to 6MB
    # Common file sizes:
    #  2MB = 2097152
    #  5MB = 5242880
    #  6MB = 6291456
    #  10MB = 10485760
    max_size: 2097152
  # Optional.
  # Text added to the page under the support ticket header
  description: |
    My optional description Text for the support ticket feture

  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    # Required.
    # Your support system email address. The email will be sent to this address
    to: "support@support.system.com"
    # Optional.
    # To set the email from field. Defaults to the email set in the form.
    # The email set in the form will always be added to the reply-to email field
    from: "config@example.com"

    # delivery_method and delivery_settings are Rails configuration items
    # that can be set in this file to simplify configuration.
    # If you prefer, you can configure Rails in the usual way.
    delivery_method: "smtp"
    delivery_settings:
      address: 'smtp.gmail.com'
      port: 587
      domain: 'example.com'
      user_name: '<username>'
      password: '<password>'
      authentication: 'plain'
      enable_starttls_auto: true
      open_timeout: 15
      read_timeout: 15
Customizations
The support ticket form can be customized using the form and attributes configuration properties. In the same way that you can configure the form for interactive applications, the support ticket form fields can be arranged or changed as required.
Note
Please note that the email field must be present in the form for the support ticket feature to be functional.
Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body. Override the default email template with your own by dropping a file named _email.text.erb into the folder /etc/ood/config/apps/dashboard/views/support_ticket/email/
This is the default form for submitting support tickets. You can use this YAML as a starting place for removing and/or adding fields.
support_ticket:
  email: must supplied by you

  attributes:
    username:
      value: "<%= CurrentUser.name %>"
      readonly: true
    email:
      widget: email_field
      required: true
    cc:
      widget: email_field
    subject:
      required: true
    session_id:
      widget: hidden_field
    session_description:
      hide_when_empty: true
      disabled: true
    attachments:
      widget: file_attachments
    description:
      widget: text_area
      required: true
      rows: 10
    queue:
      widget: hidden_field

  form:
    - username
    - email
    - cc
    - subject
    - session_id
    - session_description
    - attachments
    - description
    - queue
The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.
support_ticket:
  # email section is required and should always be present.
  # It configures how the support ticket email is sent
  email:
    to: "support@support.system.com"

  attributes:
    email:
      required: true
    subject:
      value: "OnDemand Problem: "
  form:
    - email
    - subject
    - department
# /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb
Email Intro
Department: <%= @context.support_ticket.department %>
Subject Copy: <%= @context.support_ticket.subject %>

Other static data.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/debug.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring
Edit on GitHub
Debugging and Monitoring
OnDemand has a lot of moving parts and you may have to troubleshoot all sorts of things.
These pages should help you monitor & debug components or failure modes. As well as how to monitor your Open OnDemand deployment.
Apache httpd tips
Log locations
Restart services
Show VirtualHosts
Performance Tuning
Debugging Interactive Apps
Log location
App completes without being able to connect to it.
Logging
System Logs
Session Data
Prometheus Monitoring
Install via RPM
Install from Source
Test Prometheus Exporter
Prometheus Configuration
Grafana Dashboard
Process Exporter
Adding Google Analytics
Configure Open OnDemand
Querying Google Analytics
More Info
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/debug/debug-apache.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Log locations
Restart services
Show VirtualHosts
Performance Tuning
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring » Apache httpd tips
Edit on GitHub
Apache httpd tips
Tip
While this page is helpful it is no replacement for Apache Httpd’s documentation. If you are an administrator responsible for Open OnDemand, you are now an administrator of Apache Httpd as well. As such, you should get comfortable with it as from time to time you will have to troubleshoot it.
Log locations
Information about apache log location.
Restart services
RHEL/CentOS 7RHEL/Rocky 8 & 9Ubuntu & Debian
sudo systemctl try-restart httpd24-httpd
Show VirtualHosts
OpenOnDemand creates it’s own VirtualHost in Apache. Apache will route requests based off of the hostname in the request to different VirtualHosts and the ServerName you may have configured.
Showing virtualhosts can help debug Apache request routing. The output from these commands will show you how Apache is routing based off of the ServerName in the VirtualHost.
If you’re seeing the default Apache webpage you likely have to configure the ServerName which corresponds directly to Apache’s ServerName configuration (and restart Apache).
Or you’re using the wrong hostname in your browser.
RHEL/CentOS 7RHEL/Rocky 8 & 9Ubuntu & Debian
sudo /opt/rh/httpd24/root/sbin/httpd -S
Performance Tuning
If you’re servicing many clients at time (more than 50) you will likely need to change the Apache Httpd’s MPM configuration. The default configuration may degrade service when Httpd has to serve many clients (I.e., when you have a lot of customers using Open OnDemand).
We suggest configurations similar to this.
Note
The most important directives are MaxRequestWorkers, which controls the number of simultaneous requests and ServerLimit combined with ThreadsPerChild, which when multiplied must be at least as big as the value for MaxRequestWorkers.
It’s best to keep ServerLimit at or below the number of cores for the OnDemand web host.
The example configuration below can handle about 256 simultaneous requests. Use this as an example and increase or decrease MaxRequestWorkers accordingly (based on your resources, cpus & memory and how much traffic you anticipate) then recalculate ServerLimit, ThreadsPerChild and whatever else you may want to change.
# conf.modules.d will vary depending on the platform and version.
# $APACHE_HOME/conf.modules.d/mpm.conf

# MPM event is actually important for idle VNC connections alive. You may
# need delete occurences of mpm_prefork_module if you have that configured.
LoadModule mpm_event_module modules/mod_mpm_event.so

<IfModule mpm_event_module>

  # ServerLimit is MaxRequestWorkers / ThreadsPerChild
  ServerLimit            8
  StartServers           2
  MaxRequestWorkers      256
  MinSpareThreads        25
  MaxSpareThreads        75
  ThreadsPerChild        32
  MaxRequestsPerChild    0
  ThreadLimit            256
  ListenBacklog          255
</IfModule>
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/debug/debug-interactive-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Log location
App completes without being able to connect to it.
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring » Debugging Interactive Apps
Edit on GitHub
Debugging Interactive Apps
Log location
Information about interative app log location.
App completes without being able to connect to it.
If your application goes from queued to starting to completed without ever allowing you to connect to it, the application failed to start correctly.
First, review the output for that session. You’re likely to see some errors there.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/monitoring/logging.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
System Logs
Session Data
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring » Logging
Edit on GitHub
Logging
This page provides an overview of the locations Open OnDemand writes logs and useful session data and provides context around these locations.
In general administrators will want to note whether they need to see:
System type logs for authentication to the web-node itself or OOD’s own configuration.
Session data for things like connecting to interactive apps (Jupyter, Rstudio, Codeserver, etc.) from the user’s PUN, which is already running on the web-node.
System Logs
These logs will provide information around authentication and internal Open OnDemand errors. They are very useful when initially installing and configuring Open OnDemand.
Apache Logs
For logs relating to issues about:
Authenticating to the web-node
Configuring OnDemand
There are two locations to check depending on what information is needed:
/var/log/httpd/<hostname>_error.log
OnDemand will log to this location for its own configuration errors.
/var/log/httpd/<hostname>_access.log
Where OnDemand will log succsseful logins.
Warning
There are no entries for failed logins.
NGINX Logs
The NGINX logs are the output of the user PUN. These logs will capture things relevant to a particular user such as:
Debuggin issues related to job submissions for a user. For example, commands being issued to the scheduler (sbatch, qsub, etc) can be seen here by searching for execve.
Issues related to PUNs crashing and/or pages not rendering correctly.
These logs are located at:
/var/log/ondemand-nginx/<user>
Note
These logs by default have root:root ownership. It may be beneficial to chown an appropriate staff group on these files for troubleshooting down the road.
Session Data
These files will provide information around connections between the user’s PUN and a compute-node.
These logs provide information around connections and are also the working directory of the job and location of stderr and stdout for a job (typically to output.log). Other apps will also output information they may need there as well for connections and errors.
Note
The files will be owned by the user and so admins will need to ensure they are either able to substitue user or escalate to root in order to see these files.
In general the session data or job submission files for apps across the dashboard, such as the Job Composer, Batch Connect, or Frame-renderer, all start from the root of:
~/ondemand/data/sys/
Interactive Apps
User session data for batch connect apps can be seen from a user’s home directory at:
~/ondemand/data/sys/dashboard/batch_connect/sys/<app>/output/<session
This file is used for the session data presented on the interactive apps page and data used to connect to the batch connect app.
Note
There may be more than one file in the <session id> directory, but in the Interactive Apps page you can match the Session ID you see there to the directory with the desired output.log to debug.
One important thing to note is if trying to launch a Jupyter or Rstudio session and encountering failures, the output.log would show you things like what modules are being loaded and what kernels are available.
Example
Suppose a user is having trouble connecting to a Codeserver session they created. To see what data is being used by this batch connect app for the connection, look in:
cat ~/ondemand/data/sys/dashboard/batch_connect/sys/<app>/output/<session id>/output.log
This should result in output that will give the logging information around what happened as this session was started to include ports, address, app version, and the token used for the connection.
You would also see any ERROR and WARN messages as well which will likely be beneficial to debug failed connections or launches.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/monitoring/prometheus.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Install via RPM
Install from Source
Test Prometheus Exporter
Prometheus Configuration
Grafana Dashboard
Process Exporter
Adding Google Analytics
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring » Prometheus Monitoring
Edit on GitHub
Prometheus Monitoring
OnDemand provides the ondemand_exporter that allows for monitoring some metrics specific to OnDemand.
General metrics provided:
Number of active PUNs and type of apps running
Types of web connections for OnDemand
Aggregate PUN resource consumption
Passenger app resource consumption aggregated by app
Dependencies:
OnDemand >= 1.8
RPM Installs - ondemand-passenger >= 6.0.4-6
Install via RPM
For yum/dnf based systems the ondemand_exporter can be installed via RPM.
sudo yum install ondemand_exporter
The RPM will install the following files that should work out of the box:
RHEL/CentOS 7 only: /opt/rh/httpd24/root/etc/httpd/conf.d/ondemand_exporter.conf
RHEL/Rocky/AlmaLinux 8 & 9 only: /etc/httpd/conf.d/ondemand_exporter.conf
/etc/sudoers.d/ondemand_exporter
Ensure that the new Apache configuration is loaded by restarting Apache
RHEL/CentOS 7RHEL/Rocky/Alma Linux 8 & 9
sudo systemctl restart httpd24-httpd
Start the service
sudo systemctl start ondemand_exporter
Install from Source
Check for the ondemand_exporter Latest Release version number. Replace VERSION with latest release version
Warning
If Passenger was not installed using ondemand-passenger RPM then it is required that before starting the ondemand_exporter daemon you must specify the path to passenger-status via the --path.passenger-status flag.
VERSION="0.10.0"
ARCHIVE="ondemand_exporter-${VERSION}.linux-amd64"
wget -O /tmp/${ARCHIVE}.tar.gz https://github.com/OSC/ondemand_exporter/releases/download/v${VERSION}/${ARCHIVE}.tar.gz
tar xf /tmp/${ARCHIVE}.tar.gz -C /tmp
sudo install -o root -g root -m 0755 /tmp/${ARCHIVE}/ondemand_exporter /usr/bin/ondemand_exporter
sudo install -o root -g root -m 0440 /tmp/${ARCHIVE}/files/sudo /etc/sudoers.d/ondemand_exporter
sudo install -o root -g root -m 0644 /tmp/${ARCHIVE}/files/ondemand_exporter.service /etc/systemd/system/
sudo systemctl daemon-reload
RHEL/CentOS 7RHEL/Rocky/Alma Linux 8 & 9
sudo install -o root -g root -m 0440 /tmp/${ARCHIVE}/files/apache.conf /opt/rh/httpd24/root/etc/httpd/conf.d/ondemand_exporter.conf
sudo systemctl restart httpd24-httpd
(Optional) If Passenger was not installed via ondemand-passenger RPM. Adjust the path to passenger-status as needed
sudo mkdir /etc/systemd/system/ondemand_exporter.service.d
sudo cat > /etc/systemd/system/ondemand_exporter.service.d/passenger-status.conf <<'EOF'
[Service]
Environment="PASSENGER_STATUS=/usr/sbin/passenger-status"
EOF
sudo systemctl daemon-reload
Start the service
sudo systemctl start ondemand_exporter
Test Prometheus Exporter
By default the exporter listens on port 9301 and can be tested using curl.
curl http://localhost:9301/metrics
Prometheus Configuration
The following is an example of how to configure the Prometheus scrape if the OnDemand host is web.example.com and the OnDemand ServerName is ondemand.example.com.
- job_name: ondemand
  metrics_path: /metrics
  scrape_timeout: 20s
  scrape_interval: 2m
  static_configs:
  - targets:
    - web.example.com:9301
    labels:
      environment: production
      service: ondemand.example.com
Grafana Dashboard
An example Grafana Dashboard is available.
Process Exporter
If you’re site is using the Process Exporter with Prometheus the following is an example configuration that can be used to collect metrics similar to the ondemand_exporter about running processes for OnDemand.
process_names:
- name: ood-pun
  comm:
  - nginx
  - Passenger
  - Passenger NodeA
  - PassengerAgent
  - ruby
- name: "{{.Comm}}:{{.Username}}"
  cmdline:
  - ".+"
The above example only makes sense on a host that is only running OnDemand and not other services that might also be using NGINX, Passenger or Ruby.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/analytics/google-analytics.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Configure Open OnDemand
Querying Google Analytics
More Info
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Debugging and Monitoring » Adding Google Analytics
Edit on GitHub
Adding Google Analytics
If you wish you can setup your Open-OnDemand instance to send usage data to Google Analytics (GA) that you can then query and report on, this page walks through how to do just that.
Note
You’ll need to have a Google Analytics account setup as a prerequisite to this.
To query GA You’ll need to have to have a service account setup with the appropriate permissions. See info on Google service accounts and Google IAM roles for more details on that.
Configure Open OnDemand
Refer to the ondemand.d configuration property google_analytics_tag_id on how to configure this feature.
Querying Google Analytics
Warning
This documentation is for GA version 3. With the newer versions of GA this may not work as intended. As OSC does not use GA we’re unable to update these examples ourselves, but would accept updates for the same.
Now that you have Open-OnDemand sending information to GA and it’s all configured correctly, you can now query GA for this information, parse it and present it in any fashion you like.
Here’s a small portion of how we query GA in ruby, but there are many GA client libraries available.
This example is not complete and is only meant to illustrate how to query GA given the defined metric set above. Let’s go through each of these things.
# Dimensions - here we want dimensions 1, 3 and something called pagePath which is the web
# page requested. pagePath is a google predefined dimension that we populated. Dimensions 1
# and 3 were created above and are the username and timestamp (this is why the order in
# which they're defined is important).
DIMENSIONS = %w(
  ga:dimension3
  ga:dimension1
  ga:pagePath
)

# we only want to report the hit metrics
METRICS    = %w(
  ga:hits
)

# First we specify the host so that we only get metrics from a specific host. Secondly,
# we filter only only 200 responses (dimension6 is status code) and we don't want to
# report on file editor edits.
FILTERS    = %W(
  ga:hostname==#{HOST};ga:dimension6==200;ga:pagePath!=/pun/sys/file-editor/edit
)

# now we can create our analytics object and make the query
analytics = Google::Apis::AnalyticsV3::AnalyticsService.new

# Here we query for the data that we want. A lot of things are omitted in this example
# for brevity like START_DATE (dynamic query times like the first day of the month)
# or GA_PROFILE (part of our credentials). And the fact that this is in a loop paginating
# the results, updating 'start_index' and only requesting STEP_SIZE (10,000 in our case)
# results at a time.
results = analytics.get_ga_data(
  "ga:#{GA_PROFILE}",
  START_DATE,
  END_DATE,
  METRICS.join(','),
  dimensions:  DIMENSIONS.empty? ? nil : DIMENSIONS.join(','),
  filters:     FILTERS.empty?    ? nil : FILTERS.join(','),
  sort:        SORT.empty?       ? nil : SORT.join(','),
  start_index: start_index,
  max_results: STEP_SIZE
)

target = open('my-report', "w")

# now we can write out the results in a format that I want for my reporting.
results.rows.each do |row|
  begin
    app = row[2]
    row[2] = parse_uri(app, user: row[1])
    row << app
    target.write "#{row.join('|')}\n"
end
More Info
For reference, here’s more detailed information about implementations and protocols described in this document.
See our analytics lua code for the implementation of how we’re extracting this information, parsing it and sending it to Google.
See the GA measurement protocol for more details on the format we’re sending this data in.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/enable-desktops.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Enable Interactive Desktop
Edit on GitHub
Enable Interactive Desktop
This installation guide will walk you through setting up an Interactive Desktop app that your users will be able to use to launch a Gnome 2, Mate, or Xfce desktop on a compute node within your HPC cluster. The user should then be able to connect to a running session through their browser using the noVNC client.
Danger
Confirm that you have walked through the Setup Interactive Apps instructions for interactive apps before continuing on.
Quick Start Guide
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
Change to Xfce Desktop
Remove Form Field
Hard-code a Form Field
Change a Label
Add Help Message to Field
Change Field Default Value
Minimal LinuxHost Form
4. Custom Job Submission
Slurm
Torque
PBS Professional
LinuxHost Adapter
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/enable-desktops/software-requirements.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Enable Interactive Desktop » 1. Software Requirements
Edit on GitHub
1. Software Requirements
The interactive Desktop app requires a Desktop Environment be installed on the nodes that the batch job is meant to run on, NOT the OnDemand node.
The following desktops are currently supported:
Xfce Desktop 4+
Mate Desktop 1+ (default)
Gnome Desktop 2 (currently we do not support Gnome 3)
Warning
Do NOT install the Desktop Environment on the OnDemand node. The above Desktop Environments are ONLY for the compute or login nodes you intend on launching Desktops on within batch jobs.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/enable-desktops/add-cluster.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Enable Interactive Desktop » 2. Add a Cluster
Edit on GitHub
2. Add a Cluster
We now need to add this cluster as a Desktop option in the Interactive Apps list. All customization is done underneath the root directory /etc/ood/config/apps/bc_desktop which requires escalated privileges to modify.
Start by creating the working directory:
mkdir -p /etc/ood/config/apps/bc_desktop
For each cluster that we want to launch a Desktop session on we will need a corresponding User Form (form.yml.erb) configuration file in YAML format located in this directory.
Assuming we want to launch a desktop on OSC’s Oakley cluster we would have:
# /etc/ood/config/apps/bc_desktop/oakley.yml
---
title: "Oakley Desktop"
cluster: "oakley"
Warning
The cluster attribute above MUST match a valid cluster configuration file located underneath /etc/ood/config/clusters.d/.
Navigate to your OnDemand site, in particular the Dashboard App, and you should see in the top dropdown menu “Interactive Apps” ⇒ “Oakley Desktop” (or whatever you set as the title).
After choosing “Oakley Desktop” from the menu, you should be presented with a form to “Launch” a Desktop session to the given cluster.
Most likely if you click “Launch” it will fail miserably. That is because we will need to configure the submission parameters for cluster’s resource manager.
Note
If by some chance when you click “Launch” and it actually successfully submits a job to your cluster, it is highly recommended that you click the link under “Session ID:”. This will open the file browser underneath the working directory of the batch job. This will allow you to read all the logs generated to help debug any issues that may crop up.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/enable-desktops/modify-form-attributes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
Change to Xfce Desktop
Remove Form Field
Hard-code a Form Field
Change a Label
Add Help Message to Field
Change Field Default Value
Minimal LinuxHost Form
4. Custom Job Submission
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Enable Interactive Desktop » 3. Modify Form Attributes
Edit on GitHub
3. Modify Form Attributes
In some cases you may want to modify the form presented to the user as well as any other configurable options. Some examples:
Use an Xfce desktop instead of Mate desktop.
Remove the “Queue” form field as your scheduler will auto select the correct queue.
Hard-code the “Number of nodes” to just 1, so that users can’t launch desktops with multiple nodes.
Change the label for the form field “Account” to “Project”.
Add help text to a given form field.
Change default value for a form field.
The User Form (form.yml.erb) YAML configuration file is responsible for defining these form attributes and how they are presented to the user.
For each configuration file underneath:
/etc/ood/config/apps/bc_desktop/
a separate desktop app will be presented as an option to the user from the dashboard, with the simplest User Form (form.yml.erb) configuration file for an Interactive Desktop app given as:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
Before we begin modifying form attributes. Let us first take a look at the default form definition located in the source file /var/www/ood/apps/sys/bc_desktop/form.yml (do not modify):
# /var/www/ood/apps/sys/bc_desktop/form.yml
---
attributes:
  desktop: "mate"
  bc_vnc_idle: 0
  bc_vnc_resolution:
    required: true
  node_type: null
form:
  - bc_vnc_idle
  - desktop
  - bc_num_hours
  - bc_num_slots
  - node_type
  - bc_account
  - bc_queue
  - bc_vnc_resolution
  - bc_email_on_started
The attributes and form configuration options can all be overridden in our global YAML configuration file. But typically you will only modify the attributes options.
In the following sections you will find common examples on how to override the above options.
Warning
The form configuration option defines all the available attributes as well as the order they appear in the form (it is an array).
Caution must be taken if you decide to override the form configuration option. As this is an array, you can’t simply prepend or append, you will need to completely redefine it with your included modifications.
Change to Xfce Desktop
The default installation has the desktop attribute hard-coded to the value "mate". If you would like to change this to use "xfce" you can make the following edits to your custom YAML configuration file:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
attributes:
  desktop: "xfce"
And all Desktops will attempt to launch the Xfce desktop.
Note
Whenever you hard-code a form attribute to a value like "xfce" in the above case, no input field will appear in the form for the user to fill in. So in the above case, the user cannot specify the desktop attribute in the form because we hard-coded it.
Remove Form Field
To remove a form field such as “Queue” defined under the attribute bc_queue from the Desktop form you can make the following edits to your custom YAML configuration file:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
attributes:
  bc_queue: null
After refreshing the form in your browser you should not see the “Queue” field anymore.
Basically we are hard-coding the value of bc_queue to be the YAML type null. And as we discussed in the previous example whenever you hard-code an attribute, it will not show up in the form.
Warning
If you have any Custom Job Submission configuration files that use this attribute, they will receive empty strings "", so you will need to test if they are blank before handling them.
Hard-code a Form Field
If we want to remove a form field but define its value to something other than a blank string, we can set the attribute’s value directly.
For example, if you don’t want users to submit Desktops with more than 1 node under the attribute bc_num_slots, you can make the following edits to your custom YAML configuration file:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
attributes:
  bc_num_slots: 1
As in the previous two examples, since we are hard-coding the value of the attribute, the form field will not show up and the user is unable to change this value. For the above case, the attribute bc_num_slots will always return "1".
Warning
If you have any Custom Job Submission configuration files that use this attribute, care must be taken when handling the attribute as it will always come back as a Ruby String.
So if you hard-coded an attribute to the integer 1 it will come back as the string "1" and if you perform any arithmetic operations on this attribute it will require you convert this back to an integer with the method String#to_i.
Change a Label
You are able to modify the label for a corresponding attribute that appears above the input field in the form.
For example, if you want to change the label for the “Account” form field given by the bc_account attribute to instead display “Project”. This can be modified with the following edits to your custom YAML configuration file:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
attributes:
  bc_account:
    label: "Project"
The key here is that we are defining a hash for the bc_account attribute instead of hard-coding it to a specific value. This means we will only override the equivalent option for this attribute (for the above example we are overriding the label option for the bc_account attribute).
Now when you refresh the form in your browser, you should now see an input field with the label “Project”.
Warning
If you have any Custom Job Submission configuration files that use this attribute, changing the label of the attribute will not affect the value received by the user upon form submission.
But care must be taken that if by changing the label of the attribute you also change the meaning of the attribute, then you may have to handle it differently. For example, changing a label of “Number of processors” to “Number of nodes” will have consequences on how you submit the job.
Add Help Message to Field
You are also able to add a help message to any given form field through its corresponding attribute.
For example, if you would like to add a help message to the attribute bc_account you can make the following edits to your custom YAML configuration file:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
attributes:
  bc_account:
    help: "You can leave this blank if **not** in multiple projects."
The key here is that we are defining a hash for the bc_account attribute instead of hard-coding it to a specific value. This means we will only override the equivalent option for this attribute (for the above example we are overriding the help option for the bc_account attribute).
Now when you refresh the form in your browser, you should see the help message below the “Account” form input field.
Note
Help messages can be written in Markdown format, but it is best not to get carried away in the size of the help message.
Change Field Default Value
You are able to modify the default value of a form field for a given attribute, which should not be confused with hard-coding a value for an attribute.
For example, if you would like the form field “Number of hours” given by bc_num_hours to be 8 hours by default, but still allow the user to change it then you can make the following edits in your custom YAML configuration file:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
attributes:
  bc_num_hours:
    value: 8
The key here is that we are defining a hash for the bc_num_hours attribute instead of hard-coding it to a number. This means we want to override the equivalent option for this attribute (for the above example we are overriding the value option for the bc_num_hours attribute).
Now when you refresh the desktop form in your browser, you should see a default value of 8 in the “Number of hours” form field.
Note
There is a possibility you may see a number other than 8 in the above example. That is because the Interactive Apps tool built into the Dashboard remembers your last successful app launch for a corresponding app. So when you go back to the form page for that given app, it will auto-fill in the form with your previous values.
Minimal LinuxHost Form
Because the LinuxHost is not like a traditional scheduler, there are very few form items you’ll need to add or have your users choose from.
This is a minimal configuration to launch an XFCE desktop environment on a cluster we call owens_login. You’ll notice a lot of entries are null because they don’t really have any meaning in the LinuxHost Adapter.
# /etc/ood/config/apps/bc_desktop/owens_login_desktop.yml
---
title: Owens Login XFCE desktop
description: This launches a XFCE desktop on an Owens login nodes.
cluster: owens_login
form:
  - desktop
  - bc_num_hours
attributes:
  bc_num_hours:
    value: 1
  desktop: "xfce"
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/enable-desktops/custom-job-submission.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Slurm
Torque
PBS Professional
LinuxHost Adapter
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Enable Interactive Desktop » 4. Custom Job Submission
Edit on GitHub
4. Custom Job Submission
The Job Submission (submit.yml.erb) configuration file describes how the batch job should be submitted to your cluster. The location of this file must be specified in the respective /etc/ood/config/apps/bc_desktop/my_cluster.yml form configuration file, so that when a user submits the form, the specified submission configuration is used when submitting the batch job.
To customize job submission we will need to first edit our custom desktop app User Form (form.yml.erb) YAML file as such:
# /etc/ood/config/apps/bc_desktop/my_cluster.yml
---
title: "My Cluster Desktop"
cluster: "my_cluster"
submit: "submit/my_submit.yml.erb"
Notice we included the configuration option submit that points to our custom Job Submission (submit.yml.erb) YAML configuration file. This can be an absolute file path or a relative file path with respect to the /etc/ood/config/apps/bc_desktop/ directory. It is important to notice you must use this or some other directory outside the app’s root.
Note
The *.erb file extension will cause the YAML configuration file to be processed using the eRuby (Embedded Ruby) templating system. This allows you to embed Ruby code into the YAML configuration file for flow control, variable substitution, and more.
Danger
Do not put the Job Submission (submit.yml.erb) configuration file directly underneath /etc/ood/config/apps/bc_desktop. If you do, OOD will think this a different app’s form.yml. Instead we typically create the directory submit/ underneath the app’s root directory and put our Job Submission (submit.yml.erb) configuration files underneath that.
We can now create and modify the Job Submission (submit.yml.erb) configuration file at:
/etc/ood/config/apps/bc_desktop/submit/my_submit.yml.erb
Since it has the extension .erb we can take advantage of the Ruby language to make the configuration file dynamic. In particular, you will now have access to the user-submitted form arguments defined as:
bc_num_hours
Default: "1"
A Ruby String containing the number of hours a user requested for the Desktop batch job to run.
bc_num_slots
Default: "1"
A Ruby String containing either the number of nodes or processors (depending on the type of resource manager the cluster uses) a user requested.
bc_account
Default: ""
A Ruby String that holds the account the user supplied to charge the job against.
bc_queue
Default: ""
A Ruby String that holds the queue the user requested for the job to run on.
bc_email_on_started
Default: "0"
A Ruby String that can either be "0" (do not send the user an email when the job starts) or "1" (send an email to the user when the job starts).
node_type
Default: ""
A Ruby String that can be used for more advanced job submission. This is an advanced option that is disabled by default and does nothing if you do enable it, unless you add it to a custom job submission configuration file.
Some examples on how to submit jobs using the above form attributes are given in the following sections for the given resource manager.
Slurm
For most cases of Slurm you will want to modify how the bc_num_slots (number of nodes) is submitted to the batch server.
This can be handled in your custom job submission configuration file as such:
# /etc/ood/config/apps/bc_desktop/submit/my_submit.yml.erb
---
script:
  native:
    - "-N"
    - "<%= bc_num_slots.blank? ? 1 : bc_num_slots.to_i %>"
All batch script options are underneath the script configuration option. In particular since there is no option to modify number of nodes, we need to directly interact with the native command line arguments. This is specified as an array of sbatch arguments.
Note
It is recommended you use the corresponding batch script options before using the native fallback.
Torque
For most cases of Torque you will want to modify how the bc_num_slots (number of nodes) is submitted to the batch server.
This can be handled in your custom job submission configuration file as such:
# /etc/ood/config/apps/bc_desktop/submit/my_submit.yml.erb
---
script:
  native:
    resources:
      nodes: "<%= bc_num_slots.blank? ? 1 : bc_num_slots.to_i %>:ppn=28"
All batch script options are underneath the script configuration option. In particular since there is no option to modify number of nodes, we need to directly interact with the native command line arguments.
For more information on the available options for the native attribute when using Torque please see the pbs-ruby documentation.
Note
It is recommended you use the corresponding batch script options before using the native fallback.
PBS Professional
For most cases of PBS Professional you will want to modify how the bc_num_slots (number of CPUs on a single node) is submitted to the batch server.
This can be handled in your custom job submission configuration file as such:
# /etc/ood/config/apps/bc_desktop/submit/my_submit.yml.erb
---
script:
  native:
    - "-l"
    - "select=1:ncpus=<%= bc_num_slots.blank? ? 1 : bc_num_slots.to_i %>"
All batch script options are underneath the script configuration option. In particular since there is no option to modify number of nodes/cpus, we need to directly interact with the native command line arguments. This is specified as an array of qsub arguments.
If you would like to mimic how Torque handles bc_num_slots (number of nodes), then we will first need to change the form label of bc_num_slots that the user sees in the form. This can be done by modifying our Desktop app local YAML configuration file:
# /etc/ood/config/apps/bc_desktop/submit/my_submit.yml.erb
---
title: "Cluster1 Desktop"
cluster: "cluster1"
attributes:
  bc_num_slots:
    label: "Number of nodes"
submit: "submit/my_submit.yml.erb"
Now when we go to the Desktop app form in our browser it will have the new label “Number of nodes” instead of “Number of CPUs on a single node”.
Next we will need to handle how we submit the bc_num_slots since it means something different now. So now modify the job submission configuration file as such:
# /etc/ood/config/apps/bc_desktop/submit/my_submit.yml.erb
---
script:
  native:
    - "-l"
    - "select=<%= bc_num_slots.blank? ? 1 : bc_num_slots.to_i %>:ncpus=28"
You can also append mem=...gb to the select=... statement if you’d like.
Note
It is recommended you use the corresponding batch script options before using the native fallback.
LinuxHost Adapter
If you’re using the LinuxHost you actually don’t need a specialized submit.yml.erb. There is no need to specify resources like the other adapters above.
You can however, use it to override the adapter’s global fields for mount binding and specifying which container use.
# /etc/ood/config/apps/bc_desktop/submit/linuxhost_submit.yml.erb
 ---
 batch_connect:
   native:
      singularity_bindpath: /etc,/media,/mnt,/opt,/run,/srv,/usr,/var,/fs,/home
      singularity_container: /usr/local/modules/netbeans/netbeans_2019.sif
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
Enabling App Development
Interactive Apps
App Sharing
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » App Development
Edit on GitHub
App Development
OnDemand is made up of the platform (Apache and NGINX), Passenger apps and plugins. Passenger apps are rack based Ruby apps, wsgi based Python web apps, or Node.js apps that follow a convention for the app’s startup file.
The Dashboard app, Shell app, and all other core apps in OnDemand are Passenger apps that can be replaced by custom Passenger apps. Or you can create your own.
OnDemand’s Interactive Apps are plugins that contain configuration files and a job template for running a VNC Server or Web Server application (such as Jupyter or MATLAB) on a compute node.
App Development Guide
Enabling App Development
Enable in OnDemand v1.6+:
Enable in OnDemand v1.4 & v1.5:
Enable in OnDemand v1.3:
Specify dedicated host for development (optional)
Make everyone a developer by default (optional)
Interactive Apps
Manifest yml files
User Form (form.yml.erb)
Form Widgets
Dynamic Form Widgets
Render Template
Job Submission (submit.yml.erb)
Connection View
Sub-Apps and Reconfiguring exsting apps
Connection Parameters conn_params
Adding Additional Information to the session cards
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/enabling-development-mode.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
Enabling App Development
Enable in OnDemand v1.6+:
Enable in OnDemand v1.4 & v1.5:
Enable in OnDemand v1.3:
Specify dedicated host for development (optional)
Make everyone a developer by default (optional)
Interactive Apps
App Sharing
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » App Development » Enabling App Development
Edit on GitHub
Enabling App Development
Enable in OnDemand v1.6+:
Here are example steps to enable a user “efranz”, assuming efranz’s home directory is at /home/efranz:
Create a symlink so OnDemand finds efranz’s apps:
sudo mkdir -p /var/www/ood/apps/dev/efranz
cd /var/www/ood/apps/dev/efranz
sudo ln -s /home/efranz/ondemand/dev gateway
Have efranz access the Dashboard, and efranz will see the Develop dropdown
Enable in OnDemand v1.4 & v1.5:
Here are example steps to enable a user “efranz”, assuming efranz’s home directory is at /home/efranz:
Create a symlink so OnDemand finds efranz’s apps:
sudo mkdir -p /var/www/ood/apps/dev/efranz
cd /var/www/ood/apps/dev/efranz
sudo ln -s /home/efranz/ondemand/dev gateway
Create dev directory /home/efranz/ondemand/dev where efranz’s dev apps will go (or ask efranz to do that)
Have efranz access the Dashboard, and efranz will see the Develop dropdown
Enable in OnDemand v1.3:
Here are example steps to enable a user “efranz”, assuming efranz’s home directory is at /home/efranz:
Create dev directory /home/efranz/ondemand/dev where efranz’s dev apps will go (or ask efranz to do that)
Have efranz access the Dashboard, and efranz will see the Develop dropdown. (if this doesn’t happen, )
Note
The rest of the documentation below assumes you are working with OnDemand 1.4+.
Specify dedicated host for development (optional)
The default host for the shell app is typically a login node. If this node does not contain a similar environment as the host OnDemand is installed on, including access to Software Collection (SCL) packages, it may be useful to provide developers a dedicated development host they can SSH to. This could even be the OnDemand host itself. If you configure the OnDemand dashboard to know about the dedicated development host, the dashboard will present links to open the shell app to this host.
To specify a dedicated development host so OnDemand, set OOD_DEV_SSH_HOST environment variable for the dashboard in the file /etc/ood/config/apps/dashboard/env. For example at OSC one of our OnDemand installs uses ondemand-test.osc.edu for the development host so we have this line: OOD_DEV_SSH_HOST=”ondemand-test.osc.edu”
Make everyone a developer by default (optional)
To revert to the way developer enabling worked in OnDemand 1.3, change the nginx_stage app_root configuration for dev apps by modifying /etc/ood/config/nginx_stage.yml and replacing
app_root:
  dev: '/var/www/ood/apps/dev/%{owner}/gateway/%{name}'
  usr: '/var/www/ood/apps/usr/%{owner}/gateway/%{name}'
  sys: '/var/www/ood/apps/sys/%{name}'
with
app_root:
  dev: '~%{owner}/%{portal}/dev/%{name}'
  usr: '/var/www/ood/apps/usr/%{owner}/gateway/%{name}'
  sys: '/var/www/ood/apps/sys/%{name}'
Then users can just create the directory ~/ondemand/dev and the Develop dropdown will appear.
Warning
If you do this, it is recommended that you treat the node that OnDemand is running on as a login node, as you are effectively giving those users shell access by letting them run arbitrary code on the OnDemand node (of course the UID of the processes are still their regular unprivileged user UID).
If you do this, you still might want to restrict who sees the Develop dropdown in the Dashboard. To do that you can explicitly show or hide the dropdown in the Dashboard by setting Configuration.app_development_enabled to true based on one or more Ruby statements in the initializer /etc/ood/config/apps/dashboard/initializers/ood.rb. Code in the initializer runs as the user. This code also has access to the ood_support library in which we provide some helper classes to work with User’s and Groups. For example:
Rails.application.config.after_initialize do
  Configuration.app_development_enabled = OodSupport::Process.groups.include?(
    OodSupport::Group.new("devgrp")
  )
end
Or if you know the id of the group, this will avoid reading the /etc/group file:
Rails.application.config.after_initialize do
  Configuration.app_development_enabled = Process.groups.include?(5014)
end
Or a specific user list:
Rails.application.config.after_initialize do
  Configuration.app_development_enabled = %w(
    bgohar efranz bmcmichael
  ).include?(OodSupport::User.new.name)
end
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/interactive.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
Enabling App Development
Interactive Apps
Manifest yml files
User Form (form.yml.erb)
Form Widgets
Dynamic Form Widgets
Render Template
Job Submission (submit.yml.erb)
Connection View
Sub-Apps and Reconfiguring exsting apps
Connection Parameters conn_params
Adding Additional Information to the session cards
App Sharing
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » App Development » Interactive Apps
Edit on GitHub
Interactive Apps
Interactive apps can be developed and deployed using the same tools that are currently provided for all Open OnDemand applications but requires further Setup Interactive Apps.
An Interactive App is a plugin that follows a custom file/directory structure and API that can be described by the five stages: Manifest yml files, User Form (form.yml.erb), Render Template, Job Submission (submit.yml.erb) and Connection View.
Additionally, there is Adding Additional Information to the session cards.
A typical file/directory structure for an Interactive App can look like:
my_app/
├── form.yml
├── manifest.yml
├── submit.yml.erb
├── template
│   ├── before.sh.erb
│   └── script.sh.erb
├── view.html.erb
├── info.{md,html}.erb
└── completed.{md,html}.erb
Each of these files/directories are described below in their respective stage.
Stages of an Interactive App
Manifest yml files
User Form (form.yml.erb)
Configuration
Attributes
Predefined Attributes
Automatic Predefined Attributes
Customizing Attributes
Examples
User-defined Attributes
Hard-coded Attributes
Customize User-defined Attributes
Caching form items
Displaying form items in the session card
Configuring which cluster to submit to
Form Widgets
Dynamic Form Widgets
Your own form.js
Hiding select options
Hiding entire elements
Dynamic Min and Maxes
Setting values based on other elements
Render Template
ERB Objects
Session
Context
Template Files
Before Hook
Main Script
After Hook
Cleanup Hook
Job Submission (submit.yml.erb)
Configuration
Batch Connect Template types
Configure Script
Examples
VNC Server
Change Executable for Main Script
Specify Job Submission Parameters
Dynamically Set Submission Parameters
Setting Batch Connect Options Globally
Connection View
Session Information
Reverse Proxy
Stylizing
Examples
POST Password
Adding Native VNC instructions to the panel
Sub-Apps and Reconfiguring exsting apps
Quick Launch Apps
Connection Parameters conn_params
Configuration
Jupyter Notebook Example
Adding Additional Information to the session cards
info.{md,html}.erb
completed.{md,html}.erb
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/how-tos/app-development/app-sharing.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
Enabling App Development
Interactive Apps
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » App Development » App Sharing
Edit on GitHub
App Sharing
Overview
Apps may be shared via a variety of methods including:
System installed by admin for everyone to launch (access controlled via file permissions)
Source Code Sharing (share code, launch your own copy of an app). This is like how the Job Composer works, or how many groups collaborate when using HPC: they share their job scripts and code, and use their own copies to submit jobs.
Executable Sharing (peer to peer) is where a user deploys an app in their home directory that other users can launch. This is similar to adding to your PATH the bin directory of another user.
System Installed Apps
Admins may install apps to the system by copying the application directory to /var/www/ood/apps/sys. Default directory permissions (755) will allow all users with access to OnDemand to see and run that app. Apps may have their access restricted by changing the permissions on individual application directories. For example if a site does not wish to show licensed software to un-licensed users they might do the following:
# Given:
# - an app named $NEW_APP
# - a group named $NEW_APP_GROUP
# - and a user named $NEW_APP_USER

sudo cp -r "/path/to/$NEW_APP" /var/www/ood/apps/sys
sudo chmod 750 "/var/www/ood/apps/sys/$NEW_APP"
sudo chgrp "$NEW_APP_GROUP" "/var/www/ood/apps/sys/$NEW_APP"

sudo usermod -a -G "$NEW_APP_GROUP" "$NEW_APP_USER"
You can utilize file access lists (FACLs) to increase the granularity with whom you share the apps. For example, you could specify multiple groups and individual users to share with, or even exclude specific users or groups.
This app authorization mechanism (using file permissions) can also be useful for canary deployments (sharing an app under development with a subset of users, or just your development team).
Example Using File Permissions
[root@ood sys]# pwd
/var/www/ood/apps/sys
[root@ood sys]# ls -l
total 20
drwxr-xr-x. 14 root root 4096 Jul 26 15:20 activejobs
drwxr-xr-x.  3 root root  169 Jul 26 15:20 bc_desktop
drwxr-xr-x.  5 root root  157 Aug  1 18:19 bc_desktop_example_kde
drwxr-xr-x. 13 root root 4096 Jul 26 15:20 dashboard
drwxr-xr-x. 14 root root 4096 Jul 26 15:20 file-editor
drwxr-xr-x.  7 root root 4096 Jul 26 15:20 files
drwxr-xr-x. 14 root root 4096 Jul 26 15:20 myjobs
drwxr-xr-x.  7 root root  245 Jul 26 15:20 shell
To restrict usage to only members of the desktopers group:
[root@ood sys]# pwd
/var/www/ood/apps/sys
[root@ood sys]# chmod 750 bc_desktop_example_kde/
[root@ood sys]# chgrp desktopers bc_desktop_example_kde
[root@ood sys]# ls -l
total 20
drwxr-xr-x. 14 root root       4096 Jul 26 15:20 activejobs
drwxr-xr-x.  3 root root        169 Jul 26 15:20 bc_desktop
drwxr-x---.  5 root desktopers  157 Aug  1 18:19 bc_desktop_example_kde
drwxr-xr-x. 13 root root       4096 Jul 26 15:20 dashboard
drwxr-xr-x. 14 root root       4096 Jul 26 15:20 file-editor
drwxr-xr-x.  7 root root       4096 Jul 26 15:20 files
drwxr-xr-x. 14 root root       4096 Jul 26 15:20 myjobs
drwxr-xr-x.  7 root root        245 Jul 26 15:20 shell
Note that user ood is not a member of the desktopers supplemental group.
These changes take effect immediately, although when a user is added or removed from a group their PUN will need to be restarted for the change to take effect.
Code Sharing
Code sharing is when an application’s source code is shared between two or more users who run it as a personal development application. Models for this sharing can include using a web-based file repository such as Github, emailing Zip’d app directories, or a group readable directory symlinked to each user’s ~/ondemand/dev/ directory.
For an example of the later consider:
# As user mrodgers
owens-login01:mrodgers mrodgers$ pwd
# /fs/project/PZS0714/mrodgers
owens-login01:mrodgers mrodgers$ ls -l
# total 97856
# drwxr-xr-x 7 mrodgers PZS0714     4096 Aug  1 16:03 blender-batch-render-app
owens-login01:mrodgers mrodgers$ cd ~/ondemand/dev
owens-login01:mrodgers mrodgers$ ln -s /fs/project/PZS0714/mrodgers/blender-batch-render-app

# As user johrstrom
owens-login01:johrstrom johrstrom$ cd ~/ondemand/dev
owens-login01:johrstrom johrstrom$ ln -s /fs/project/PZS0714/mrodgers/blender-batch-render-app
User johrstrom will now see blender-batch-render-app in their Sandbox Apps, but because they do not own the files they will not be able to edit the files, or update dependencies, etc resulting in a slightly broken experience. Better still would be peer to peer app sharing.
Peer to Peer Executable Sharing
By setting a few environment variables it is possible to enable a more polished peer to peer app sharing experience. There are two reasons why this mode is not always enabled: the first is that app permissions are the only thing that prevents all a site’s OnDemand users from seeing a shared app, so it is important to get the permissions correct, and only to deploy apps that are production ready. The other reason to be careful with app sharing is that requires greater trust placed in app developers.
Warning
Executable sharing means the app and all its code runs as the user executing it, like everything else in OnDemand. User’s might not realize this. We currently do not provide an opt in screen warning users that this app “will have permission to do everything on their behalf and act as them”. As a result, you should fully trust whoever you enable to do share apps using executable sharing.
Enabling The App Sharing Dashboard
To enable App Sharing in the Dashboard, set OOD_APP_SHARING=1 in /etc/ood/config/apps/dashboard/env.
Set OOD_DASHBOARD_SUPPORT_EMAIL=your@email.edu to add a link to support for finding an app.
Set OOD_APP_CATALOG_URL=https://link.to.online/app/catalog to link externally to an advertised listing of apps available.
Pin usr apps to the dashboard and group them by category.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - 'usr/*'

pinned_apps_group_by: 'category'
Enabling App Sharing in the dashboard serves two primary purposes:
For shared app users, provide an interface to launch those apps
For app developers, provide an interface to help manage shared apps
Currently this significantly changes the interface of the Dashboard. The MOTD moves to the right of the screen and shared apps appear below the welcome logo and text.
Before:
After:
Controlling Who Can Share and Access Apps
Shared apps are deployed to /var/www/ood/apps/usr/$USER/gateway/$APPNAME. We recommend gateway be a symlink to the user’s home directory at $HOME/ondemand/share and by default set 750 permissions on /var/www/ood/apps/usr/$USER. This approach has these benefits (assuming users named efranz and an0047:
The admin as root controls who can share apps by creating root owned directories like /var/www/ood/apps/usr/efranz and /var/www/ood/apps/usr/an0047.
The admin controls who can access that user’s shared apps by setting permissions on this directory. Thus by setting 750 on /var/www/ood/apps/usr/an0047 this ensures that an0047 can only share apps with users in his primary group. At times we have created a supplemental group (shinyusr) and chgrp the share directory to this group so that the developer can share apps with every user in this group.
The developer who can share apps can modify permissions on the app directories themselves i.e. /var/www/ood/apps/usr/an0047/gateway/customapp so that only a subset of the users he could share with have access. This can be done through FACLs or using the same chgrp + 755 approach
In summary, to enable a new user to create shared apps, run these commands:
# given a user efranz
sudo mkdir -p /var/www/ood/apps/usr/efranz
cd /var/www/ood/apps/usr/efranz
chmod 750 .
ln -s ~efranz/ondemand/share gateway
Example of Executable Sharing
This is with two users Eric (efranz) and Bob (an0047).
Eric has a dev app “MATLAB”, and interactive plugin app. Eric can
Launch MATLAB
View and Edit the code
Bob (an0047) cannot see this app because it is isolated in Eric’s “Sandbox” i.e. ~efranz/ondemand/dev/matlab:
If Eric shares the git repo path or URL with Bob, Bob can clone this into his home directory if he is enabled as a developer. This is called “Source Code Sharing”.
Eric can share this app with Bob by selecting “My Shared Apps” and cloning the MATLAB repo to deploy ~efranz/ondemand/share/matlab
Now when Bob accesses the OnDemand home page he sees Eric’s MATLAB app and can launch it:
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/install-ihpc-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Install Other Interactive Apps
Edit on GitHub
Install Other Interactive Apps
For Jupyter, we provide a tutorial for copying a generic Jupyter batch connect template and modifying it to work at your center. See Add a Jupyter App to install Jupyter.
If you have developed an app and would like to contribute it to the community, please post a description and link to the app to https://discourse.osc.edu/c/open-ondemand. In order to submit the code of an interactive app that you developed to the GitHub repository, it should be available on the developer’s GitHub and well commented. The comments need to include, but not limited to, mentioning if there are parts of the app that are site-specific. Also, the following files must be included:
LICENSE file - the license should be open source. If you are not sure what to choose, OnDemand uses MIT License.
README.md file - which specifies all the dependencies as well as cluster specific instructions
Table 6 Generic Interactive App Templates
Name
GitHub URL
Jupyter
https://github.com/OSC/bc_example_jupyter
While we don’t yet provide this for other interactive apps, here is a list of interactive apps that are currently deployed at OSC and other contributing institutions.
Table 7 Interactive App
Name
Institution
GitHub URL
Abaqus/CAE
OSC
https://github.com/OSC/bc_osc_abaqus
University of Utah
https://github.com/CHPC-UofU/bc_osc_abaqus
ANSYS Workbench
OSC
https://github.com/OSC/bc_osc_ansys_workbench
COMSOL Multiphysics
OSC
https://github.com/OSC/bc_osc_comsol
University of Utah
https://github.com/CHPC-UofU/bc_osc_comsol
MATLAB
OSC
https://github.com/OSC/bc_osc_matlab
University of Utah
https://github.com/CHPC-UofU/bc_osc_matlab
Jupyter
OSC
https://github.com/OSC/bc_osc_jupyter
University of Utah
https://github.com/CHPC-UofU/bc_osc_jupyter
University of Utah
https://github.com/CHPC-UofU/bc_jupyter_dynpart
Stanford
https://github.com/stanford-rc/sh_ood-apps#sh_jupyter
TechSquareInc
https://gitlab.com/mjbludwig/jupyter_experimental
Jupyter + Spark
OSC
https://github.com/OSC/bc_osc_jupyter_spark
Paraview
OSC
https://github.com/OSC/bc_osc_paraview
RStudio Server
OSC
https://github.com/OSC/bc_osc_rstudio_server
University of Utah
https://github.com/CHPC-UofU/bc_osc_rstudio_server
Stanford
https://github.com/stanford-rc/sh_ood-apps#sh_rstudio
VMD
OSC
https://github.com/OSC/bc_osc_vmd
QGIS
OSC
https://github.com/OSC/bc_osc_qgis
RELION (for REgularised LIkelihood OptimisatioN)
Shanghai Jiao Tong University (SJTU)
https://github.com/SJTU-HPC/bc_relion
Stata
OSC
https://github.com/OSC/bc_osc_stata
Shiny App
University of Utah
https://github.com/CHPC-UofU/bc_osc_example_shiny
Tensorboard
Stanford
https://github.com/stanford-rc/sh_ood-apps#sh_tensorboard
Visual Studio Code
OSC
https://github.com/OSC/bc_osc_codeserver
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps
Edit on GitHub
Tutorials: Interactive Apps
Below is a list of tutorials for developing interactive apps.
Tutorials
Add a Jupyter App
1. Software Requirements
2. Copy Jupyter App
3. Customize Attributes
4. Modify Submit Parameters
5. Deploy Jupyter App
Add an RStudio App
1. Copy RStudio App
2. Software Requirements
3. Setup Singularity
4. Customize Attributes
5. Deploy RStudio App
Add a MATLAB App
1. Software Requirements
2. Copy MATLAB App
3. Customize Attributes
4. Edit Launch Script
5. Modify Submit Parameters
6. Edit Form.js
7. Deploy MATLAB App
8. Known Issues
Add a Jupyter App on a Kubernetes Cluster
container spec
resource requests
configmap
mounts
init containers
submit yml in full
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
The container
Switch between SLURM and Kubernetes
container spec
mounts
submit yml in full
Add Custom Queues/Partitions
Use a Local Static List
Use a Global Static List
Troubleshooting Interactive Apps
The window cannot be resized/moved/maximized
MATLAB throws Java errors when the window is resized
Job finishes instantly because, desktop app backgrounds itself
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/add-jupyter.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
1. Software Requirements
2. Copy Jupyter App
3. Customize Attributes
4. Modify Submit Parameters
5. Deploy Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Add a Jupyter App
Edit on GitHub
Add a Jupyter App
This tutorial will walk you through creating an interactive Jupyter app that your users will use to launch a Jupyter Notebook Server within a batch job on a compute node. The user will then be able to connect to the running server through their browser and take advantage of the resources provided within the batch job.
Danger
Confirm that you have walked through the Setup Interactive Apps instructions for interactive apps before continuing on.
Quick Start Guide
1. Software Requirements
2. Copy Jupyter App
3. Customize Attributes
4. Modify Submit Parameters
Slurm
Torque
PBS Professional
Other Resource Manager
5. Deploy Jupyter App
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/add-rstudio.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
1. Copy RStudio App
2. Software Requirements
3. Setup Singularity
4. Customize Attributes
5. Deploy RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Add an RStudio App
Edit on GitHub
Add an RStudio App
This tutorial will walk you through creating an interactive RStudio app that your users will use to launch a RStudio Server within a batch job on a compute node. The user will then be able to connect to the running server through their browser and take advantage of the resources provided within the batch job.
Quick Start Guide
1. Copy RStudio App
2. Software Requirements
3. Setup Singularity
Download The Singularity Image
Alternatively, Build The Singularity Image
4. Customize Attributes
5. Deploy RStudio App
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/add-matlab.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
1. Software Requirements
2. Copy MATLAB App
3. Customize Attributes
4. Edit Launch Script
5. Modify Submit Parameters
6. Edit Form.js
7. Deploy MATLAB App
8. Known Issues
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Add a MATLAB App
Edit on GitHub
Add a MATLAB App
This tutorial will walk you through creating an interactive MATLAB app that your users will use to launch a MATLAB within a batch job on a compute node. MATLAB will be launched within the context of an XFCE desktop to provide a window manager and terminal. The user will then be able to connect to the application through their browser and take advantage of the resources provided within the batch job.
Danger
Confirm that you have walked through the Setup Interactive Apps instructions for interactive apps as well as Enable Interactive Desktop before continuing on.
Quick Start Guide
1. Software Requirements
2. Copy MATLAB App
3. Customize Attributes
4. Edit Launch Script
Invoking MATLAB without a Window Manager
Use XFCE for the Window Manager
Use Mate for the Window Manager
Use Fluxbox for the Window Manager
5. Modify Submit Parameters
Slurm
Torque
PBS Professional
Other Resource Manager
6. Edit Form.js
7. Deploy MATLAB App
8. Known Issues
If you get Java errors
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/k8s-jupyter.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
container spec
resource requests
configmap
mounts
init containers
submit yml in full
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Add a Jupyter App on a Kubernetes Cluster
Edit on GitHub
Add a Jupyter App on a Kubernetes Cluster
This tutorial will walk you through creating an interactive Jupyter app that your users will use to launch a Jupyter Notebook Server in a kubernetes cluster.
It assumes you have a working understanding of app development already. The purpose of this document is to describe how to write apps specifically for a kubernetes cluster, so it skips a lot of important details about app development that may be found in other tutorials like Add a Jupyter App.
We’re going to be looking at the bc k8s jupyter app which you can fork, clone and modify for your site. This page also holds the submit yml in full for reference.
Refer to interactive K8s Jupyter using HPC-like containers for details on running Jupyter on Kubernetes with containers that behave more like traditional HPC jobs.
container spec
Let’s look at this section first. Here you must specify the name, image and command. The name determines the Pod Id (the job name in HPC parlance).
working_dir is the working directory of the container. This is optional as a container may specify this. restart_policy is also optional and is Never by default.
Next you can specify additional environment variables in env.
container:
  name: "jupyter"
  image: "docker.io/jupyter/scipy-notebook:python-3.9.7"
  command: "/usr/local/bin/start.sh /opt/conda/bin/jupyter notebook --config=/ood/ondemand_config.py"
  working_dir: "<%= Etc.getpwnam(ENV['USER']).dir %>"
  restart_policy: 'OnFailure'
  env:
    NB_UID: "<%= user.uid %>"
    NB_USER: "<%= user.name %>"
    NB_GID: "<%= user.group.id %>"
    HOME: "<%= user.home %>"
Here is the default environment. You can use a null here to unset any of these.
USER: username,
UID: run_as_user,
HOME: home_dir,
GROUP: group,
GID: run_as_group,
KUBECONFIG: '/dev/null'
resource requests
port is is the port the container is going to listen on. cpu and memory are the cpu and memory request. Note that memory here has Gi which is the unit.
container:
  # ...
  port: "8080"
  cpu: "<%= cpu %>"
  memory: "<%= memory %>Gi"
Kubernetes has some flexibility in requests. One can make _requests_ and _limits_ which are like hard and soft limits. In the example above, they’re both the same.
Here’s an example utilizing requests and limits for both memory and cpu. Note that we’re using millicores in cpu_request.
container:
  # ...
  port: "8080"
  cpu_request: "0.200"
  cpu_limit: "4"
  memory_request: "500Mi"
  memory_limit: "4Gi"
See kubernetes pod memory and kubernetes pod cpu for more details.
configmap
A Kubernetes configmap is a way to apply configurations to a container. In this example, we’re using a configmap to generate the config file for Jupyter. We’ll see later how we use init containers to update it, but let’s see how we initialize it.
You need to specify filename which is the name of the file. data is the contents of the file. mount_path is the directory in the container the file will be mounted to. files here is an array so you can add many files to a single configmap.
configmap:
  files:
    - filename: "<%= configmap_filename %>"
      data: |
        c.NotebookApp.port = 8080
        c.NotebookApp.ip = '0.0.0.0'
        c.NotebookApp.disable_check_xsrf = True
        c.NotebookApp.allow_origin = '*'
        c.Application.log_level = 'DEBUG'
      mount_path: '/ood'
mounts
This example mounts the host’s directory into the container. Even though these are containers, users often want to persist the files they work on. This example mounts the home directory, but could mount any project or scratch space just the same.
When mounting a host directory host_type must alwasy be Directory. This example shows how to mount host directories and nfs storage locations.
mounts:
  - type: host
    name: home
    host_type: Directory
    path: <%= user.home %>
    destination_path: <%= user.home %>
  - type: nfs
    name: cold-storage
    host: some.nfs.host:3333
    path: /some/location
    destination_path: /some/container/location
init containers
If you’re app needs some work to be done before the app itself (the container) starts up, we provide a way to specify init containers.
We provide docker.io/ohiosupercomputer/ood-k8s-utils for some simple reusable functionality.
You must specify a name, an image and the command to be run.
init_containers:
- name: "init-secret"
  image: "<%= utility_img %>"
  command:
  - "/bin/save_passwd_as_secret"
  - "user-<%= user.name %>"
Tip
If you’re mounting a users $HOME directory into the container, you likely don’t need init containers. They’re provided for sites & use cases where you’re not mounting the users $HOME directory. This example does both because it is just an example.
Let’s walk through these init containers and what they’re doing.
init-secret does just that. It initialzies a kubernetes secret. add-passwd-to-cfg then reads that secret and creates a salt and sha1 of this secret (these are needed specifically for Jupyter). Lastly it adds a single line to our configmap, which is the c.NotebookApp.password. add-hostport-to-cfg does something similar, reading the host and port of the pod and sets the c.NotebookApp.base_url of the same configmap.
submit yml in full
# submit.yml.erb
<%
 pwd_cfg = "c.NotebookApp.password=u\'sha1:${SALT}:${PASSWORD_SHA1}\'"
 host_port_cfg = "c.NotebookApp.base_url=\'/node/${HOST_CFG}/${PORT_CFG}/\'"

 configmap_filename = "ondemand_config.py"
 configmap_data = "c.NotebookApp.port = 8080"
 utility_img = "docker.io/ohiosupercomputer/ood-k8s-utils:v1.0.0"

 user = OodSupport::User.new
%>
---
script:
accounting_id: "<%= account %>"
wall_time: "<%= wall_time.to_i * 3600 %>"
native:

  # here's the bulk of setting up the container. You'll likely need to specify all of these.
  container:
    name: "jupyter"
    image: "docker.io/jupyter/scipy-notebook:python-3.9.7"
    command: "/usr/local/bin/start.sh /opt/conda/bin/jupyter notebook --config=/ood/ondemand_config.py"
    working_dir: "<%= Etc.getpwnam(ENV['USER']).dir %>"
    restart_policy: 'OnFailure'
    env:
      NB_UID: "<%= user.uid %>"
      NB_USER: "<%= user.name %>"
      NB_GID: "<%= user.group.id %>"
      HOME: "<%= user.home %>"
    port: "8080"
    cpu: "<%= cpu %>"
    memory: "<%= memory %>Gi"
  configmap:
    files:
      - filename: "<%= configmap_filename %>"
        data: |
          c.NotebookApp.port = 8080
          c.NotebookApp.ip = '0.0.0.0'
          c.NotebookApp.disable_check_xsrf = True
          c.NotebookApp.allow_origin = '*'
          c.Application.log_level = 'DEBUG'
        mount_path: '/ood'
  mounts:
    - type: host
      name: home
      host_type: Directory
      path: <%= user.home %>
      destination_path: <%= user.home %>
  init_containers:
  - name: "init-secret"
    image: "<%= utility_img %>"
    command:
    - "/bin/save_passwd_as_secret"
    - "user-<%= user.name %>"
  - name: "add-passwd-to-cfg"
    image: "<%= utility_img %>"
    command:
    - "/bin/bash"
    - "-c"
    - "source /bin/passwd_from_secret; source /bin/create_salt_and_sha1; /bin/add_line_to_configmap \\\"<%= pwd_cfg %>\\\" <%= configmap_filename %>"
  - name: "add-hostport-to-cfg"
    image: "<%= utility_img %>"
    command:
    - "/bin/bash"
    - "-c"
    - "source /bin/find_host_port; /bin/add_line_to_configmap \\\"<%= host_port_cfg %>\\\" <%= configmap_filename %>"
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/k8s-like-hpc-jupyter.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
The container
Switch between SLURM and Kubernetes
container spec
mounts
submit yml in full
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Edit on GitHub
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
This tutorial will walk you through creating an interactive Jupyter app that your users will use to launch a Jupyter Notebook Server in a kubernetes cluster. The container will behave much like a HPC compute node. This has the benefit that a single app can serve both traditional HPC as well as Kubernetes.
It assumes you have a working understanding of app development already. The purpose of this document is to describe how to write apps specifically for a kubernetes cluster, so it skips a lot of important details about app development that may be found in other tutorials like Add a Jupyter App.
We’re going to be looking at the bc osc jupyter app which is OSC’s production Jupyter app. You can fork, clone and modify for your site. This page also holds the submit yml in full for reference.
Refer to the interactive K8s Jupyter app for additional details on items defined in submit.yml.erb as well as a more traditional container approach.
The container
The container to make Kubernetes pods look like HPC compute would end up needing all the OS packages present on the HPC environment. The OS of the container itself would also need to compatible with packages installed on HPC environment so if you run RHEL 8 on HPC you would also need to run RHEL 8 inside the container.
Things like Lmod and HPC applications will need to be run inside the Pod’s container just like if a job was spawned in a traditional HPC resource manager.
Switch between SLURM and Kubernetes
The first big change from a traditional HPC interactive app is the main YAML structure is wrapped in a large if statement based on the cluster choice. If a user chooses one of the HPC clusters, the SLURM submit YAML is rendered, otherwise the Kubernetes YAML is rendered. In the following examples the SLURM clusters are named owens and pitzer and the Kubernetes cluster is named kubernetes.
Here is the beginning of the block:
<% if cluster =~ /owens|pitzer/ -%>
---
batch_connect:
  template: "basic"
  conn_params:
    - jupyter_api
script:
...SLURM specific...
Here is the logic to select Kubernetes:
<% elsif cluster =~ /kubernetes/
...Ruby variables setup here...
container spec
Let’s look at this section first of the Kubernetes block. Here you must specify the name, image and command. The name determines the Pod Id (the job name in HPC parlance).
The image should be the HPC container image and command will be the job script that has been adapted to work with both SLURM and Kubernetes. The command will be run from the user’s home directory and will cover mount requirements in mount requirements.
Warning
These examples use images from the Ohio SuperComputer Center’s private registry. They will not work at your site as this registry requires authentication.
One important aspect of the command is that the job script executed is built using the standard before.sh, script.sh and after.sh that one would normally use to build the job script for interactive apps running on HPC resources. The way this pod is being setup, the same job script that runs on SLURM would also be used to launch the container in Kubernetes.
Next you can specify additional environment variables in env.
native:
  container:
    name: "jupyter"
    image: "docker-registry.osc.edu/ondemand/ondemand-base-rhel7:0.3.1"
    image_pull_policy: "IfNotPresent"
    command: ["/bin/bash","-l","<%= staged_root %>/job_script_content.sh"]
    restart_policy: 'OnFailure'
mounts
For a pod to look like an HPC environment the home directory of the user and any shared filesystems would need to be mounted on Kubernetes worker nodes and then made available to the pod.
In the example a Ruby structure is created to streamline some of the direct mounts where the path outside the container is the same as the path inside the container:
mounts = {
  'home'    => OodSupport::User.new.home,
  'support' => OodSupport::User.new('support').home,
  'project' => '/fs/project',
  'scratch' => '/fs/scratch',
  'ess'     => '/fs/ess',
}
These mounts are defined in the YAML using a loop:
mounts:
<%- mounts.each_pair do |name, mount| -%>
  - type: host
    name: <%= name %>
    host_type: Directory
    path: <%= mount %>
    destination_path: <%= mount %>
<%- end -%>
Additional mounts are needed to make the pod behave like a HPC compute node. Following are mounted into the container:
MUNGE socket so SLURM commands inside the pod can work
SLURM configuration so SLURM commands inside the pod know about scheduler host
SSSD pipes and configuration as well as nsswitch.conf so ID lookups inside the pod will work
Lmod initialization script
Lmod HPC applications
- type: host
  name: munge-socket
  host_type: Socket
  path: /var/run/munge/munge.socket.2
  destination_path: /var/run/munge/munge.socket.2
- type: host
  name: slurm-conf
  host_type: Directory
  path: /etc/slurm
  destination_path: /etc/slurm
- type: host
  name: sssd-pipes
  host_type: Directory
  path: /var/lib/sss/pipes
  destination_path: /var/lib/sss/pipes
- type: host
  name: sssd-conf
  host_type: Directory
  path: /etc/sssd
  destination_path: /etc/sssd
- type: host
  name: nsswitch
  host_type: File
  path: /etc/nsswitch.conf
  destination_path: /etc/nsswitch.conf
- type: host
  name: lmod-init
  host_type: File
  path: /apps/<%= compute_cluster %>/lmod/lmod.sh
  destination_path: /etc/profile.d/lmod.sh
- type: host
  name: intel
  host_type: Directory
  path: /nfsroot/<%= compute_cluster %>/opt/intel
  destination_path: /opt/intel
- type: host
  name: apps
  host_type: Directory
  path: /apps/<%= compute_cluster %>
  destination_path: <%= apps_path %>
submit yml in full
# submit.yml.erb
<%-
  cores = num_cores.to_i

  if cores == 0 && cluster == "pitzer"
    # little optimization for pitzer nodes. They want the whole node, if they chose 'any',
    # it can be scheduled on p18 or p20 nodes. If not, they'll get the constraint below.
    base_slurm_args = ["--nodes", "1", "--exclusive"]
  elsif cores == 0
    # full node on owens
    cores = 28
    base_slurm_args = ["--nodes", "1", "--ntasks-per-node", "28"]
  else
    base_slurm_args = ["--nodes", "1", "--ntasks-per-node", "#{cores}"]
  end

  slurm_args = case node_type
              when "gpu-40core"
                base_slurm_args + ["--constraint", "40core"]
              when "gpu-48core"
                base_slurm_args + ["--constraint", "48core"]
              when "any-40core"
                base_slurm_args + ["--constraint", "40core"]
              when "any-48core"
                base_slurm_args + ["--constraint", "48core"]
              when "hugemem"
                base_slurm_args + ["--partition", "hugemem", "--exclusive"]
              when "largemem"
                base_slurm_args + ["--partition", "largemem", "--exclusive"]
              when "debug"
                base_slurm_args += ["--partition", "debug", "--exclusive"]
              else
                base_slurm_args
              end

-%>
<% if cluster =~ /owens|pitzer/ -%>
---
batch_connect:
  template: "basic"
  conn_params:
    - jupyter_api
script:
  accounting_id: "<%= account %>"
<% if node_type =~ /gpu/ -%>
  gpus_per_node: 1
<% end -%>
  native:
    <%- slurm_args.each do |arg| %>
    - "<%= arg %>"
    <%- end %>
<% elsif cluster =~ /kubernetes/
   if node_type =~ /owens/
     compute_cluster = "owens"
     apps_path = "/usr/local"
     # Memory per core with hyperthreading enabled
     memory_mb = num_cores.to_i * 2200
   elsif node_type =~ /pitzer/
     compute_cluster = "pitzer"
     apps_path = "/apps"
     # Memory per core with hyperthreading enabled
     memory_mb = num_cores.to_i * 4000
   end
   mounts = {
     'home'    => OodSupport::User.new.home,
     'support' => OodSupport::User.new('support').home,
     'project' => '/fs/project',
     'scratch' => '/fs/scratch',
     'ess'     => '/fs/ess',
   }
-%>
---
script:
  accounting_id: "<%= account %>"
  wall_time: "<%= bc_num_hours.to_i * 3600 %>"
  <%- if node_type =~ /gpu/ -%>
  gpus_per_node: 1
  <%- end -%>
  native:
    container:
      name: "jupyter"
      image: "docker-registry.osc.edu/ondemand/ondemand-base-rhel7:0.3.1"
      image_pull_policy: "IfNotPresent"
      command: ["/bin/bash","-l","<%= staged_root %>/job_script_content.sh"]
      restart_policy: 'OnFailure'
      env:
        NB_UID: "<%= Etc.getpwnam(ENV['USER']).uid %>"
        NB_USER: "<%= ENV['USER'] %>"
        NB_GID: "<%= Etc.getpwnam(ENV['USER']).gid %>"
        CLUSTER: "<%= compute_cluster %>"
        KUBECONFIG: "/dev/null"
      labels:
        osc.edu/cluster: "<%= compute_cluster %>"
      port: "8080"
      cpu: "<%= num_cores %>"
      memory: "<%= memory_mb %>Mi"
    mounts:
    <%- mounts.each_pair do |name, mount| -%>
      - type: host
        name: <%= name %>
        host_type: Directory
        path: <%= mount %>
        destination_path: <%= mount %>
    <%- end -%>
      - type: host
        name: munge-socket
        host_type: Socket
        path: /var/run/munge/munge.socket.2
        destination_path: /var/run/munge/munge.socket.2
      - type: host
        name: slurm-conf
        host_type: Directory
        path: /etc/slurm
        destination_path: /etc/slurm
      - type: host
        name: sssd-pipes
        host_type: Directory
        path: /var/lib/sss/pipes
        destination_path: /var/lib/sss/pipes
      - type: host
        name: sssd-conf
        host_type: Directory
        path: /etc/sssd
        destination_path: /etc/sssd
      - type: host
        name: nsswitch
        host_type: File
        path: /etc/nsswitch.conf
        destination_path: /etc/nsswitch.conf
      - type: host
        name: lmod-init
        host_type: File
        path: /apps/<%= compute_cluster %>/lmod/lmod.sh
        destination_path: /etc/profile.d/lmod.sh
      - type: host
        name: apps
        host_type: Directory
        path: /apps/<%= compute_cluster %>
        destination_path: <%= apps_path %>
    node_selector:
      osc.edu/role: ondemand
<% end -%>
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/add-custom-queue.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Use a Local Static List
Use a Global Static List
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Add Custom Queues/Partitions
Edit on GitHub
Add Custom Queues/Partitions
This tutorial will walk you through replacing the bc_queue form attribute in your Interactive App with a custom HTML <select> element (a drop-down list of options) that allows the user to choose from a list of queues/partitions to submit their batch job to.
Warning
This tutorial will assume that you have walked through and setup a working instance of the Jupyter Interactive App following the directions outlined under Add a Jupyter App.
As there are multiple solutions to add custom queues/partitions to your Interactive Apps, we document a few such solutions that range in complexity as well as possible access restrictions that a developer may have.
Possible Solutions
Use a Local Static List
Use a Global Static List
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-interactive-apps/troubleshooting.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
The window cannot be resized/moved/maximized
MATLAB throws Java errors when the window is resized
Job finishes instantly because, desktop app backgrounds itself
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Interactive Apps » Troubleshooting Interactive Apps
Edit on GitHub
Troubleshooting Interactive Apps
The window cannot be resized/moved/maximized
While a window manager is not strictly required to be able to set up a desktop/VNC application, one is required to be able to perform many common tasks like moving a window, resizing it, or even locating the window after it has been minimized. The OnDemand team has experience working with XFCE, Mate and Fluxbox (in order of preference). Select one of the window manager / desktop options and ensure that it is installed on the compute nodes.
You will then need to edit $APP/template/script.sh.erb to start the window manager / desktop before the interactive app itself. Examples:
Use XFCE for the Window Manager
Use Mate for the Window Manager
Use Fluxbox for the Window Manager
MATLAB throws Java errors when the window is resized
A remedy for MATLAB throwing Java errors when its window is resized, moved, or displayed on a secondary monitor is detailed in MATLAB’s Known Issues.
Job finishes instantly because, desktop app backgrounds itself
Many apps are convenient in that their launch command blocks instead of backgrounding itself. By blocking the process our script is prevented from ending immediately, which in turn would prevent the user from accomplishing anything useful. Some GUI applications like Stata put themselves into the background. For apps like Stata it is necessary to perform the blocking ourselves:
# Launch Stata GUI
xstata-mp

# Get the PID of the last xstata-mp process started that $USER owns
stata_pid=$( pgrep -u "$USER" 'xstata-mp' | tail )
# As long as the PID directory exists we wait
while [[ -d "/proc/$stata_pid" ]]; do
  sleep 1
done
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-passenger-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Passenger Apps
Edit on GitHub
Tutorials: Passenger Apps
A Passenger App is any Rack-based Ruby app, WSGI-based Python app, or Node.js app that has a “startup file” following the convention that Phusion Passenger Web Application Server instances use to start the process. OnDemand uses the NGINX Integration mode for Passenger, where NGINX and Passenger and individual web app processes all communicate using UNIX domain sockets.
At the bottom of the page is a list of tutorials for developing Passenger apps for OnDemand.
Tutorials
Creating a Status App
Overview of App
Clone and Setup
Edit to Run and Parse Quota
Brand App
Publish App
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-passenger-apps/ps-to-quota.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Overview of App
Clone and Setup
Edit to Run and Parse Quota
Brand App
Publish App
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Tutorials: Passenger Apps » Creating a Status App
Edit on GitHub
Creating a Status App
Overview of App
We will make a copy of a status app that displays the running Passenger processes on the OnDemand host. We will use this as a starting point to create a new status app that displays quota information in a table.
The app we will be copying is: https://github.com/OSC/ood-example-ps. Running this app looks like:
Fig. 7 What app looks like after cloning and launching.
After this tutorial the resulting app will be:
Fig. 8 What app looks like after modifying in this tutorial.
This assumes you have followed the directions to Enabling App Development on the Dashboard.
The app uses the custom branded Bootstrap 3 that Job Composer and Active Jobs apps use.
The navbar contains a link back to the dashboard.
On a request, the app runs a shell command, parses the output, and displays the result in a table.
It is built in Ruby using the Sinatra framework, a lightweight web framework similar to Python’s Flask and Node.js’s Express
Benefits
This serves as a good starting point for any status app to build for OnDemand, because
the app has the branding matching other OnDemand apps
all status apps will do something similar on a request to the app:
get raw data from a shell command or http request
parse the raw data into an intermediate object representation
use that intermediate object representation to display the data formatted as a table or graph
the app can be deployed without requiring a build step because gem dependencies (specified in Gemfile and Gemfile.lock) are pure ruby and match those that are provided by the ondemand-gems rpm
most of the app can be modified without requiring a restart due to proper use of Sinatra reloader extension
app has a built in scaffold for unit testing using minitest
OnDemand System Gems
This app is able to run in OnDemand 1.8+ without installing the gems specified in the Gemfile.
All pre-installed Ruby gems used by OnDemand are available to make it easier to develop simple apps. These include gems used by this example app:
sinatra
sinatra-contrib
erubi
On the OnDemand web host, you can execute the command source scl_source enable ondemand and then gem list to see all available gems. These gems are provided by a separate ondemand-gems rpm that is installed when you do yum install ondemand. The name of the RPM includes the OnDemand release version, such as ondemand-gems-1.7.12-1.7.12-1.el7.x86_64.rpm. This ensures that if you do yum update this gem will not be removed - so apps can depend on the presence of these gems.
Files and Their Purpose
Table 8 Main files
File
Description
config.ru
entry point of the Passenger Ruby app
app.rb
Sinatra app config and routes; this in a separate file from config.ru so that code reloading will work
command.rb
class that defines an AppProcess struct, executes ps, and parses the output of the ps command producing an array of structs
test/test_command.rb
a unit test of the parsing code
views/index.html
the main section of the html page template using an implementation of ERB called erubi which auto-escapes output of ERB tags by default (for security)
views/layout.html
the rendered HTML from views/index.html is inserted into this layout, where css and javascript files are included
Table 9 Other files
File
Description
Gemfile, Gemfile.lock
defines gem dependencies for the app (see Bundler’s Rationale)
tmp/
tmp directory is kept so its easier to touch tmp/restart.txt when you want to force Passenger to restart an app
public/
serve up static assets like Bootstrap css; in OnDemand, NGINX auto-serves all files under public/ directly, without going through the Passenger process, which makes this much faster; as a result, each static file is in a directory with an explicit version number, so if these files ever change we change the version, which is one cache busting strategy
Rakefile
this provides a default rake task for running the automated tests under test/, so you can run the tests by running the command rake
test/minitest_helper.rb
contains setup code common between all tests
vendor/bundle
This directory is added if you execute bin/bundle install --path vendor/bundle to store app specific gems. This is necessary if you want to add gems or specify specific gem versions used by the app that deviate from those provided by system gemset, or if you are using OnDemand 1.7 or earlier.
Clone and Setup
Login to Open OnDemand, click “Develop” dropdown menu and click the “My Sandbox Apps (Development)” option.
Click “New App” and “Clone Existing App”.
Fill out the form:
Directory name: quota
Git remote: https://github.com/OSC/ood-example-ps
Check “Create new Git Project from this?”
Click Submit
Launch the app by clicking the large blue Launch button. In a new browser window/tab you will see the output of a ps command filtered using grep.
Switch browser tab/windows back to the dashboard Details view of the app and click the Files button on the right to open the app’s directory in the File Explorer.
Edit to Run and Parse Quota
The app runs and parses this command:
ps aux | grep '[A]pp'
We will change it to run and parse this command:
quota -spw
Update test/test_command.rb
Run the command to get example data. Copy and paste the output into the test, and update the assertions to expect an array of “quotas” instead of “processes” with appropriate attributes.
Diff:
  def test_command_output_parsing
    output = <<-EOF
-
-efranz    30328  0.1  0.1 462148 28128 ?        Sl   20:28   0:00 Passenger RackApp: /users/PZS0562/efranz/ondemand/dev/quota
-
+Disk quotas for user efranz (uid 10851):
+     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
+10.11.200.32:/PZS0562/  99616M    500G    500G       0    933k   1000k   1000k       0
EOF
-    processes = Command.new.parse(output)
+    quotas = Command.new.parse(output)

-    assert_equal 1, processes.count
+    assert_equal 1, quotas.count, "number of structs parsed should equal 1"

-    p = processes.first
+    q = quotas.first

-    assert_equal "efranz", p.user
-    assert_equal "462148", p.vsz
-    assert_equal "28128", p.rss
-    assert_equal "0:00", p.time
-    assert_equal "Passenger RackApp: /users/PZS0562/efranz/ondemand/dev/quota", p.command
+    assert_equal "10.11.200.32:/PZS0562/", q.filesystem, "expected filesystem value not correct"
+    assert_equal "99616M", q.blocks, "expected blocks value not correct"
+    assert_equal "500G", q.blocks_limit, "expected blocks_limit value not correct"
+    assert_equal "933k", q.files, "expected files value not correct"
+    assert_equal "0", q.files_grace, "expected files_grace value not correct"
  end
Resulting test method:
class TestCommand < Minitest::Test

  def test_command_output_parsing
    output = <<-EOF
Disk quotas for user efranz (uid 10851):
    Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
10.11.200.32:/PZS0562/  99616M    500G    500G       0    933k   1000k   1000k       0
EOF
    quotas = Command.new.parse(output)

    assert_equal 1, quotas.count, "number of structs parsed should equal 1"

    q = quotas.first

    assert_equal "10.11.200.32:/PZS0562/", q.filesystem, "expected filesystem value not correct"
    assert_equal "99616M", q.blocks, "expected blocks value not correct"
    assert_equal "500G", q.blocks_limit, "expected blocks_limit value not correct"
    assert_equal "933k", q.files, "expected files value not correct"
    assert_equal "0", q.files_grace, "expected files_grace value not correct"
  end
end
Update command.rb
Run the test by running the rake command and you will see it fail:
$ rake
Run options: --seed 58990

# Running:

F

Finished in 0.000943s, 1060.4569 runs/s, 1060.4569 assertions/s.

  1) Failure:
TestCommand#test_command_output_parsing [/users/PZS0562/efranz/ondemand/dev/quota/test/test_command.rb:14]:
number of structs parsed should equal 1.
Expected: 1
  Actual: 3

1 runs, 1 assertions, 1 failures, 0 errors, 0 skips
rake aborted!
Command failed with status (1)

Tasks: TOP => default => test
(See full trace by running task with --trace)
Warning
To run commands like rake through the shell you need to make sure you are on a host that has the correct version of Ruby installed. For OnDemand that likely means using Software Collections with the same packages used to install OnDemand.
With SCL, running rake with ondemand SCL package looks like:
scl enable ondemand -- rake
You can avoid this by loading the SCL packages in your .bashrc or .bash_profile file. For example, in my .bash_profile I have:
if [[ ${HOSTNAME%%.*} == webtest04*  ]]
then
  scl enable ondemand -- bash
fi
This means when I login to the host webtest04.osc.edu the SCL packages will be enabled in a new bash session. If you did the same you would replace webtest04 with the hostname of the node you are developing on.
To get the unit test to pass we need to:
Change the command we are using.
Fix the command output parsing.
Fix the struct definition.
class Command
  def to_s
-    "ps aux | grep '[A]pp'"
+    "quota -spw"
  end

-  AppProcess = Struct.new(:user, :pid, :pct_cpu, :pct_mem, :vsz, :rss, :tty, :stat, :start, :time, :command)
+  Quota = Struct.new(:filesystem, :blocks, :blocks_quota, :blocks_limit, :blocks_grace, :files, :files_quota, :files_limit, :fil

  # Parse a string output from the `ps aux` command and return an array of
  # AppProcess objects, one per process
  def parse(output)
    lines = output.strip.split("\n")
-    lines.map do |line|
-      AppProcess.new(*(line.split(" ", 11)))
+    lines.drop(2).map do |line|
+      Quota.new(*(line.split))
    end
  end
After the changes part of the command.rb will look like this:
class Command
  def to_s
    "quota -spw"
  end

  Quota = Struct.new(:filesystem, :blocks, :blocks_quota, :blocks_limit, :blocks_grace, :files, :files_quota, :files_limit, :files_grace)

  # Parse a string output from the `ps aux` command and return an array of
  # AppProcess objects, one per process
  def parse(output)
    lines = output.strip.split("\n")
    lines.drop(2).map do |line|
      Quota.new(*(line.split))
    end
  end
Now when we run the test they pass:
$ rake
Run options: --seed 60317

# Running:

.

Finished in 0.000966s, 1035.1494 runs/s, 6210.8963 assertions/s.

1 runs, 6 assertions, 0 failures, 0 errors, 0 skips
Update app.rb and view/index.html
Update app.rb:
helpers do
  def title
-    "Passenger App Processes"
+    "Quota"
  end
end

# Define a route at the root '/' of the app.
get '/' do
  @command = Command.new
-  @processes, @error = @command.exec
+  @quotas, @error = @command.exec

  # Render the view
  erb :index
end
In views/index.erb, replace the table with this:
<table class="table table-bordered">
  <tr>
    <th>Filesystem</th>
    <th>Blocks</th>
    <th>Blocks Quota</th>
    <th>Blocks Limit</th>
    <th>Blocks Grace</th>
    <th>Files</th>
    <th>Files Quota</th>
    <th>Files Limit</th>
    <th>Files Grace</th>
  </tr>
  <% @quotas.each do |quota| %>
  <tr>
    <td><%= quota.filesystem %></td>
    <td><%= quota.blocks %></td>
    <td><%= quota.blocks_quota %></td>
    <td><%= quota.blocks_limit %></td>
    <td><%= quota.blocks_grace %></td>
    <td><%= quota.files %></td>
    <td><%= quota.files_quota %></td>
    <td><%= quota.files_limit %></td>
    <td><%= quota.files_grace %></td>
  </tr>
  <% end %>
</table>
These changes should not require an app restart. Go to the launched app and reload the page to see the changes.
Brand App
The app is looking good, but the details page still shows the app title “Passenger App Processes”. To change this and the icon, edit the manifest.yml:
-name: Passenger App Processes
-description: Display your running Passenger app processes in a table
+name: Quota
+description: Display quotas
+icon: fa://hdd-o
The icon follows format of fa://{FONTAWESOMENAME} where you replace {FONTAWESOMENAME} with an icon from https://fontawesome.com/icons/. In this case we are using fa-hdd-o which we write in the manifest as fa://hdd-o. You can see details on this icon at https://fontawesome.com/icons/hdd?style=regular
Publish App
Publishing an app requires two steps:
Updating the manifest.yml to specify the category and optionally subcategory, which indicates where in the dashboard menu the app appears.
Having an administrator checkout a copy of the production version to a directory under /var/www/ood/apps/sys.
Steps:
Add category to manifest so the app appears in the Files menu:
name: Quota
description: Display quotas
icon: fa://hdd-o
+category: Files
+subcategory: Utilities
Version these changes. Click Shell button on app details view, and then commit the changes:
git add .
git commit -m "update manifest for production"

# if there is an external remote associated with this, push to that
git push origin master
As the admin, sudo copy or git clone this repo to production
# as sudo on OnDemand host:
cd /var/www/ood/apps/sys
git clone /users/PZS0562/efranz/ondemand/dev/quota
Reload the dashboard.
Fig. 9 Every user can now launch the Quota from the Files menu.
Warning
Accessing this new app for the first time will cause your NGINX server to restart, killing all websocket connections, which means resetting your active web-based OnDemand Shell sessions.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-dashboard-apps.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Developing The OOD Dashboard
Edit on GitHub
Developing The OOD Dashboard
Warning
Enabling App Development must be completed first for this tutorial to work.
Open OnDemand is composed of several apps, one of which is the dashboard app. You can see some of the other apps that make up OOD here.
This tutorial aims to equip admins with the knowledge and tools for developing the Open OnDemand dashboard and shell apps directly from within OnDemand itself.
Tutorials
Developing the Dashboard App
Things To Know
Create a Dev Dashboard
Add .env.local File
Set Dev Configuration Directory
Add Dev Configurations
Develop OOD in OOD
Developing the Shell App
Create a Dev Shell
Develop the Shell
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-dashboard-apps/dashboard.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
Developing the Dashboard App
Things To Know
Create a Dev Dashboard
Add .env.local File
Set Dev Configuration Directory
Add Dev Configurations
Develop OOD in OOD
Developing the Shell App
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Developing The OOD Dashboard » Developing the Dashboard App
Edit on GitHub
Developing the Dashboard App
Warning
You muse have followed Enabling App Development for any part of this tutorial to work.
Things To Know
We are going to be using bundler through a script which comes with OOD located in the root of the dashboard at bin/setup. What this will do for us is essentially run bundler and npm to ensure are environment is correct. This is all being pulled from the dashboard Gemfile. You could, in theory, add whatever you like to this Gemfile and rebuild OOD with that new gem for development work, as an example.
Also, it is recommended to set this to your local app environment so that bundler does not try and install the gems on the system, as unlike npm which starts builds locally by default, bundler attempts system installs by default.
Create a Dev Dashboard
clone the OOD repo into: cd ~/ondemand/misc then git clone git@github.com:OSC/ondemand.git
Work out of the dev directory/space: cd ~/ondemand/dev/.
Symlink to the dashboard app in the cloned repo: ln -s ../misc/ondemand/apps/dashboard/dashboard/ dashboard
Make a branch and to begin word on your dev dashboard: git checkout -b dev_work
Rebuild the ood dashboard app: bin/setup.
Navigate to the Sandbox and launch your dashboard app to use the dev_work.
Notice the url for this /pun/dev/dashboard app. No longer do you see /pun/sys/dashboard/ but instead /pun/dev/dashboard/.
Add .env.local File
Now that we have a our dev dashboard running, a good first step is to next ensure it looks different from the production dashboard. This will help ensure not ending up in the wrong tab, using sys/dashboard instead of dev/dashboard, and possibly causing confusion.
Use an editor or IDE and do the following:
cd ~/ondemand/dev/dashboard
touch .env.local
vim .env.local
The idea here is to make sure the dev dashboard looks different so we don’t have to check that url in the browser to know which dashboard we are in.
Inside the .env.local we can add an environment variable to change the color of the dev dashboard like so:
# .env.local file
OOD_BRAND_BG_COLOR='grey'
Now click the Develop dropdown menu on the upper right corner and click Restart Web Server. After a few moments you should now see the dashboard with a grey background in the banner. This will help to distinguish your dev environment from the production.
Fig. 10 Different banner color for the dev dashboard
Set Dev Configuration Directory
Our dev dashboard is still using the same configuration files as the system dashboard, but we can change this.
Go back into .env.local and set a new path for the dev dashboard to pick up its own configurations using the OOD_CONFIG_D_DIRECTORY environment variable like so:
# .env.local file
OOD_CONFIG_D_DIRECTORY="~/ondemand/dev/dashboard/config/ondemand.d/"
We need to restart the PUN when we add or change environment variables with bin/setup.
Add Dev Configurations
Now, we can begin to set our own configurations in our new ondemand.d directory for the dev dashboard and see the changes. Let’s add some configs to our dev dashboard to get an idea what can be done and play with the layout.
We will add pinned_apps to our dev dashboard as an example to see how this works.
Create a file in the ~/ondemand/dev/dashboard/config/ondemand.d/ directory named ondemand.yml then open the file and add the following:
pinned_apps:
  - sys/*
pinned_apps_menu_length: 4
pinned_apps_group_by: category
Assuming youre restarted the PUN when you set the new config directory above, you should be able to simply refresh the browser and see the new pinned apps layout take effect. If not though, simply restart the PUN as usual to force the changes.
Fig. 11 Dev dashboard with its own pinned apps configuration
Now, we can begin to add other configurations to this new ondemand.yml and keep restarting the PUN to see our changes.
This is a great way to test out new features, or play with any features you may be interested in with OOD before making the changes in production or spinning up a whole dev environment with a VM.
At this point you have all the pieces needed to use the Customizations page and play with those changes in your dev dashboard.
But, what if we want to add something to Open OnDemand?
Develop OOD in OOD
With all the above in place, you can also begin to add features and functionality to OOD in this development setting to then see how this will actually run and work.
Suppose you see a feature being worked on in the OOD repo on the branch new_feature. How could you pull this work down and see its current state while also trying to build it out?
First, launch the shell and go into your dev dashboard root then:
git pull
git checkout new_feature
bin/setup
After the build you now have the feature ready to be worked right there in your dev dashboard.
Go ahead and enter you Sandbox and launch the dev dashboard. What you are in once that is done is the current state the feature is in.
If you are not making any changes to the configurations, as the steps above mostly do, then each change to the code simply requires page refreshes to see the feature work.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/tutorials/tutorials-dashboard-apps/shell-app.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Create a Dev Shell
Develop the Shell
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Developing The OOD Dashboard » Developing the Shell App
Edit on GitHub
Developing the Shell App
The shell app is significantly different from the dashboard app. It is purely a node.js app. This means that we only need to use npm to build and do dev work.
Create a Dev Shell
clone the OOD repo into: cd ~/ondemand/misc then git clone git@github.com:OSC/ondemand.git
Work out of the dev directory/space: cd ~/ondemand/dev/.
Symlink to the shell app in the cloned repo: ln -s ../misc/ondemand/apps/dashboard/shell/ shell
Make a branch and to begin word on your dev dashboard: git checkout -b dev_work
Rebuild the shell app: bin/setup.
Navigate to the Sandbox and launch your dev shell app to use the dev_work branch.
Notice the url for this app. No longer do you see */sys/shell but instead */dev/shell.
Build Old Version of Shell
pull down ondemand in ~/ondemand/misc
then list versions with git tags
run git checkout <version>
now make a branch with your changes and use bin/setup to rebuild if needed
Then for the shell app from a login terminal run:
cd dev
ln -s ../misc/ondemand/apps/dashboard/shell/ shell-18
And then step into that symlinked directory and run: #. bin/setup
If you go start this app from sandbox you’ll notice a different url than before, showing you are in a dev shell: pun/dev/shell-1.8
Issues and Errors
Ensure you are using the correct version of Node when you go to build using nvm if possible. Sometimes this can be set automatically for you in your .bashrc so just ensure you are on the version you should be when you run bin/setup.
Develop the Shell
At this point we have a working dev shell and can start to make changes to this code and issue rebuilds for npm with bin/setup when needed.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html#overview
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html#system-context
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html#container-context
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html#request-flow
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/architecture.html#other-request-flow-diagrams
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Architecture
Edit on GitHub
Architecture
Below are some diagrams of OnDemand’s architecture:
Overview is a high level visual generated from Powerpoint.
System context and Container context diagrams below follow the C4. model for software diagrams, are more technically detailed and are built using draw.io
Request flow diagram is a sequence diagram built using plantuml.
Overview
Apache is the server front end, running as the Apache user, and accepting all requests from users and serves four primary functions:
Authenticates user.
Starts Per-User NGINX processes (PUNs).
Reverse proxies each user to her PUN via Unix domain sockets.
Reverse proxies to interactive apps running on compute nodes (RStudio, Jupyter, VNC desktop) via TCP sockets.
The Per-User NGINX serves web apps in Ruby and NodeJS and is how users submit jobs and start interactive apps.
System context
Users use OnDemand to interact with their HPC resources through a web browser.
All the gray components are specific to a given site and outside the OnDemand system.
Container context
Tip
In the C4 nomenclature, ‘containers’ are one level below the system context. This is not to be confused with Linux containers via cgroups and namespaces (i.e. Docker or Singularity or OCI containers).
The Front-end proxy is the only component that is shared with all clients. The Front-end proxy will create Per User Nginx (PUN) processes (light blue boxes labeled “Per User Instance”).
Everything contained in the dotted line is a part of the OnDemand system (see blue box in System context diagram).
Everything outside of it in gray is site specific components.
The “Per User Instance” light blue boxes are replicated for every user accessing the system.
Request Flow
This is the request flow through the OnDemand system. A user initiates a request through a browser and this illustrates how that request propagates through the system to a particular application (including the dashboard).
Other Request Flow Diagrams
Dashboard Access
Passenger App
User App Sharing
Authentication
Linux Host Adapter
Rstudio Job
Shell Session
VNC Desktop Job
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference
Edit on GitHub
Configuration Reference
This is reference documentation for all the configuration files and commands that make up the Open OnDemand infrastructure.
Files
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
Commands
ood-portal-generator
nginx-stage
Overviews
PUN environment
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/files/ood-portal-yml.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
Configure General Options
Configure Public Assets
Configure Logout Redirect
Configure Reverse Proxy
Configure per-user NGINX
Configure OpenID Connect
Configure User Registration
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » ood_portal.yml
Edit on GitHub
ood_portal.yml
Relying on the default build is fine for a demo deployment, but it is not recommended for a production environment. Options can be configured by default under the file /etc/ood/config/ood_portal.yml.
The RPMs copy this file from /opt/ood/ood-portal-generator/ood_portal_example.yml during the installation.
All the default options are listed in this configuration file. Feel free to read it through before continuing on.
Configure General Options
listen_addr_port (String, Array<String>, null)
the address and port server listens on for connections
Default
Don’t add a Listen directive in this Apache config (typically it exists in another config)
listen_addr_port: null
Example
Explicitly listen on port 443
listen_addr_port: "443"
servername (String, null)
the host name used to access the Open OnDemand portal
Default
Access website through IP address only
servername: null
Example
Access website through the host name www.example.com
servername: "www.example.com"
server_aliases (Array<String>, [])
Aliases for this server. These will result in the apache ServerAlias configuration allowing one server to respond to multiple hostnames.
Default
There ar no server aliases.
server_aliases: []
Example
Along with the servername also respond to the hostname class.my-cool-site.example.edu.
servername: "class.my-cool-site.example.edu"
proxy_server (String, null)
The proxy server, if one exists. Used when you have a proxy in front of the Open OnDemand server(s).
Default
No proxy server
proxy_server: null
Example
Access website through the proxy name www.example-proxy.com
proxy_server: "www.example-proxy.com"
port (Integer, null)
the port used to access the Open OnDemand portal (if different than 80 or 443)
Default
Use port 80 or port 443 if SSL is enabled
port: null
Example
Use a higher numbered port to access the website
port: 8080
ssl (Array<String>, null)
a list of Apache directives that enable SSL support
Default
Disable SSL support
ssl: null
Example
Supply ssl information.
ssl:
   - SSLCertificateFile /etc/letsencrypt/live/change-me/cert.pem
   - SSLCertificateKeyFile /etc/letsencrypt/live/change-me/privkey.pem
   - SSLCertificateChainFile /etc/letsencrypt/live/change-me/chain.pem
disable_logs (Boolean, false)
Disable logs in favor of supplying log directives in some other configuration file.
Default
Logs are enabled and defined in this virtual host.
disable_logs: false
Example
Disable logs in favor of supplying log directives in some other configuration file.
disable_logs: true
logroot (String)
the root directory where log files are stored (can be relative to ServerRoot)
Default
Store logs in $ServerRoot/logs directory
logroot: "logs"
Example
Store logs in a different directory
logroot: "/path/to/my/logs"
errorlog (String, 'error.log')
The Error log filename
Default
“error.log”
errorlog: "error.log"
Example
“my.site.error.log”
errorlog: "my.site.error.log"
accesslog (String, 'access.log')
The Access log filename
Default
“access.log”
accesslog: "access.log"
Example
“my.site.access.log”
accesslog: "my.site.access.log"
logformat (String, apache conbined format)
The log format.
Default
apache combined format
logformat: null
Example
Change the error and access log format.
logformat: '"%v %h \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" %{SSL_PROTOCOL}x %T"'
use_rewrites (Boolean)
Should RewriteEngine be used
Default
Use RewriteEngine
use_rewrites: true
Example
Disable RewriteEngine usage
use_rewrites: false
use_maintenance (Boolean)
Enable Rewrite rules for supporting maintenance mode of OnDemand Requires use_rewrites to be true
Default
Support maintenance mode support
use_maintenance: true
Example
Disable maintenance mode support
use_maintenance: false
maintenance_ip_allowlist (Array<String>)
List of IP regular expressions to be allowed to access OnDemand when maintenance is enabled
Default
No IPs are allowed.
maintenance_ip_allowlist: []
Example
Allow 192.168.1.0/24 and 10.0.0.1 to access OnDemand during maintenance
maintenance_ip_allowlist:
  - '192.168.1..*'
  - '10.0.0.1'
security_csp_frame_ancestors (Boolean)
Set Header Content-Security-Policy frame-ancestors.
Default
Set Content-Security-Policy frame-ancestors to servername
security_csp_frame_ancestors: https://ondemand.example.com
Example
Disable Content-Security-Policy header
security_csp_frame_ancestors: false
security_strict_transport (Boolean)
Set Header Strict-Transport-Security to help enforce SSL
Default
Set Strict-Transport-Security if SSL is defined for OnDemand
security_strict_transport: true
Example
Disable Strict-Transport-Security header
security_strict_transport: false
lua_root (String)
the root directory where the Lua handler code resides
Default
Point to the install location of the ood_mod_proxy lua library
lua_root: "/opt/ood/mod_ood_proxy/lib"
Example
Point to a different directory
lua_root: "/path/to/lua/handlers"
lua_log_level (String, null)
the verbosity of the Lua module in the logs
Default
Use default log level of info
lua_log_level: null
Example
Decrease verbosity
lua_log_level: "warn"
user_map_cmd (String)
the system command used to map authenticated user name to a system user name
Default
Since 2.0 there is no provided user map command.
user_map_cmd: null
Example
Capture system user name from regular expression
user_map_cmd: "/opt/site/site_mapper.sh"
user_map_match (String)
The lua pattern to map authenticated user name to a system user name.
user_map_match was added in 2.0 to be a simpler replacement for user_map_cmd above. match has precedence over cmd if they’re both configured.
Note that lua patterns are not regular expressions. So boolean OR matches like | for example are not supported. See the documentation on lua patterns for details more.
You can test your configuration out in a lua shell like so:
> string.match('ktrout@example.edu', '^([^@]+)@example.edu$')
ktrout
Default
Match any characters 0 or more times.
user_map_match: '.*'
Example
Capture system user name from email pattern.
user_map_match: '^([^@]+)@example.edu$'
user_env (String, null)
the CGI environment variable that holds the authenticated user name used as the argument for the user mapping command
Default
Use REMOTE_USER if not defined
user_env: null
Example
Use a custom environment variable instead
user_env: "OIDC_CLAIM_preferred_username"
map_fail_uri (String, null)
the URI a user is redirected to if we fail to map the authenticated user name to a system user name
Default
Don’t redirect the user and just display an error message
map_fail_uri: null
Example
Redirect the user to a registration page you set up beforehand
map_fail_uri: "/register"
pun_stage_cmd (String)
the system command used to launch the nginx stage command with sudo privileges
Default
Use default install location
pun_stage_cmd: "sudo /opt/ood/nginx_stage/sbin/nginx_stage"
Example
Use a different install location
pun_stage_cmd: "sudo /path/to/nginx_stage"
auth (Array<String>)
The list of Apache directives defining how authentication is handled for various protected resources on the website. See Authentication for more details.
Default
Empty. No authentication. Open OnDemand will not work at all without authentication of some kind.
auth: []
Example
Open ID Connect authentication.
auth:
  - "AuthType openid-connect"
  - "Require valid-user"
custom_vhost_directives (Array<String>, [])
Supply custom directives at the virtual host level.
Default
No custom virtual host directives.
custom_vhost_directives: []
Example
Add a single custom virutal host directive to set an environment variable.
custom_vhost_directives:
  - SetEnv FOO BAR
custom_location_directives (Array<String>, [])
Supply custom directives for every Location in the virtual host.
Default
No custom location directives.
custom_location_directives: []
Example
Add a single custom location directive to set an environment variable.
custom_location_directives:
  - SetEnv FOO BAR
root_uri (String)
the URI a user is redirected to when they access the root of the website (e.g., https://www.example.com/)
Default
Redirect the user to the dashboard
root_uri: "/pun/sys/dashboard"
Example
Redirect to a different URI
root_uri: "/my_uri"
analytics (Hash, null)
the object describing how to track server-side analytics with a Google Analytics account and property
Default
Do not track analytics
analytics: null
Example
See Adding Google Analytics
Configure Public Assets
This is a location where files can be served without a user being authenticated. Useful to serve favicon, images, or user documentation. If either of these properties are null then users won’t be able to access public assets through the website.
public_uri (String, null)
the URI used to access public assets (no authentication needed)
Default
Access as http://www.example.com/public
public_uri: "/public"
Example
Access under a different URI
public_uri: "/assets"
public_root (String, null)
the root directory where the public assets are served from
Default
Using a default installation
public_root: "/var/www/ood/public"
Example
Serve files under a different directory
public_root: "/path/to/public/files"
Configure Logout Redirect
The dashboard will send the user to this URI when they click the Logout button. This URI will then redirect the user to the logout mechanism for your corresponding authentication mechanism. If either of these properties are null then users will get an error when they try to logout from the dashboard.
logout_uri (String, null)
the URI used to logout from an Apache session
Default
Access as http://www.example.com/logout
logout_uri: "/logout"
Example
Access under a different URI
logout_uri: "/log_me_out"
logout_redirect (String, null)
the URI the user is redirected to when accessing the logout URI above
Default
Fallback to the dashboard’s log out page
logout_redirect: "/pun/sys/dashboard/logout"
Example
See:
Shibboleth
Configure Keycloak with CILogon
Configure Reverse Proxy
The reverse proxy will proxy a request to any specified host and port through IP sockets. This is different than what is used for proxying to per-user NGINX processes through Unix domain sockets. This can be used to connect to Jupyter notebook servers, RStudio servers, VNC servers, and more… This is disabled by default as it can be security risk if not properly setup using a good host_regex.
A URL request to the node_uri will reverse proxy to the given host and port using the full URI path. So a request to the frontend Apache proxy that looks like:
GET /<node_uri>/<host>/<port>/... HTTP/1.1
Host: ondemand.example.edu
will be reverse proxied to the backend server with the following request format:
GET /<node_uri>/<host>/<port>/... HTTP/1.1
Host: <host>:<port>
A URL request to the rnode_uri will reverse proxy to the given host and port using the relative URI path. So a request to the frontend Apache proxy that looks like:
GET /<rnode_uri>/<host>/<port>/... HTTP/1.1
Host: ondemand.example.edu
will be reverse proxied to the backend server with the following request format:
GET /... HTTP/1.1
Host: <host>:<port>
Notice that we strip off the portion of the URI request path that is used to determine the backend web server.
Both formats are provided to better support the varying capabilities for the multitude of web application servers. For the case of using node_uri the developer will need to modify the web server to accommodate requests with a sub-URI that follows the dynamic formatting of /<node_uri>/<host>/<port>. For the case of using rnode_uri the developer needs to confirm that all assets and links supplied by the web server are relative and not absolute.
host_regex (String)
Warning
Wildcards like . should be avoided because they cause issues in parsing. host_regex should always have a domain name that your center owns (for security) and should specify lists of character classes like [w.-] (for proper functionality).
The regular expression used as a allowlist for allowing a user to reverse proxy to a given host.
Default
Allow proxying to all hosts in the world (please change this if you enable this feature)
host_regex: "[^/]+"
Example
Restrict access to only within internal network
host_regex: "[\\w.-]+\\.example\\.com"
node_uri (String, null)
the URI used to reverse proxy a user to a server running on a given host and port that knows the full URI path
Default
This feature is disabled by default
node_uri: null
Example
Use the recommended URI by our team
node_uri: "/node"
rnode_uri (String, null)
the URI used to reverse proxy a user to a server running on a given host and port that knows the relative URI path
Default
This feature is disabled by default
rnode_uri: null
Example
Use the recommended URI by our team
rnode_uri: "/rnode"
Configure per-user NGINX
The reverse proxy will proxy a request under the pun_uri URI to the user’s per-user NGINX (PUN) process through Unix domain sockets. It will send process signals to the user’s PUN through the nginx_uri URI. If either of these properties are null then PUN access will be disabled.
nginx_uri (String, null)
the URI used to control the PUN process
Default
User’s can send signals to PUN through http://www.example.com/nginx
nginx_uri: "/nginx"
Example
Use a different URI
node_uri: "/my_pun_controller"
pun_uri (String, null)
the URI used to access the PUN process
Default
User’s access their PUN through http://www.example.com/pun
pun_uri: "/pun"
Example
Use a different URI
pun_uri: "/my_pun_apps"
pun_socket_root (String)
the root directory that contains the socket files for the running PUNs
Default
Using a default installation
pun_socket_root: "/var/run/ondemand-nginx"
Example
Socket files are located in a different directory
pun_socket_root: "/path/to/pun/sockets"
pun_max_retries (Integer)
the number of times the proxy attempt to connect to the PUN before giving up and displaying an error to the user
Default
Only try 5 times
pun_max_retries: 5
Example
Try 25 times
pun_max_retries: 25
PUN Pre Hook command is functionality to initialize things as root before the PUN starts up.
Authentication information like OIDC tokens are not passed to OnDemand apps like the dashboard. This feature is useful when you need to use things like OIDC tokens in some initialization process before the PUN starts. For example, you can configure your ~/.kube/config with OIDC information with this feature.
There is currently only one thing passed into this command and that is the username. It’s passed as a named argument like so: --user USERNAME.
You may pass in environment variables from apache to this command, though they are prefixed with OOD_. For example if you configure this to pass OIDC_ACCESS_TOKEN to the pre hook command, you can read the variable as OOD_OIDC_ACCESS_TOKEN.
Additionally you may add entries to /etc/ood/config/hook.env and source this file for additional environment variables. For example environment specific information for your test and production environments.
pun_pre_hook_root_cmd (String, null)
Run a hook command as root before the the PUN starts up.
Default
No pun pre hook.
pun_pre_hook_root_cmd: null
Example
Run a pre hook called “my_site_hook.sh”.
pun_pre_hook_root_cmd: "/path/to/my_site_hook.sh"
pun_pre_hook_exports (String, null)
A comma seperated list of environment variables to export to the pun_pre_hook_root_cmd.
Default
Don’t pass any environment variables.
pun_pre_hook_exports: null
Example
Export OIDC_ACCESS_TOKEN and OIDC_CLAIM_EMAIL environment variables to the pun_pre_hook_root_cmd.
pun_pre_hook_exports: "OIDC_ACCESS_TOKEN,OIDC_CLAIM_EMAIL"
Configure OpenID Connect
If using OpenID Connect for authentication, these are a few properties you will need to tweak. For a better understanding of these options you should read more on mod_auth_openidc.
oidc_uri (String, null)
the redirect URI used by mod_auth_openidc for authentication
Default
This is disabled by default
oidc_uri: null
Example
Enable it on a recommended URI
oidc_uri: "/oidc"
oidc_discover_uri (String, null)
the URI a user is redirected to if they are not authenticated by mod_auth_openidc and is used to discover the ID provider the user will use to login through
Default
This is disabled by default
oidc_discover_uri: null
Example
Enable it to a recommended URI
oidc_discover_uri: "/discover"
oidc_discover_root (String, null)
the root directory on the file system that serves the HTML code used for the discovery page
Default
This is disabled by default
oidc_discover_root: null
Example
Enable it to the recommended path
oidc_discover_root: "/var/www/ood/discover"
Configure User Registration
If you are using a grid-mapfile to map the authenticated user name to a system user name, then this will be used to generate mappings in the file for a user’s first time accessing your website. Setting either property below to null will disable this feature.
Note
This is unnecessary if you use regular expressions for mapping the authenticated user name to a system user name.
register_uri (String, null)
the URI a user is redirected to if no mapping exists between an authenticated user name and a system user name
Default
This is disabled by default. An error is displayed the user if mapping fails.
register_uri: null
Example
Enable it to a recommended URI
register_uri: "/register"
register_root (String, null)
the root directory on the file system that serves the HTML code used for the registration page
Default
This is disabled by default. An error is displayed the user if mapping fails.
register_root: null
Example
Enable it to the recommended path
register_root: "/var/www/ood/register"
oidc_provider_metadata_url (String, null)
Refer to OIDCProviderMetadataURL in auth_openidc.conf.
Default
This is disabled by default, and no OIDC configurations will be added.
oidc_provider_metadata_url: null
Example
Set OIDCProviderMetadataURL
oidc_provider_metadata_url: "https://example.com:5554/.well-known/openid-configuration"
oidc_client_id (String, null)
Refer to OIDCClientID in auth_openidc.conf.
Default
This is disabled by default, and no OIDC configurations will be added.
oidc_client_id: null
Example
Set OIDCClientID
oidc_client_id: "ondemand.example.com"
oidc_client_secret (String, null)
Refer to OIDCClientSecret in auth_openidc.conf.
Default
This is disabled by default.
oidc_client_secret: null
Example
Set OIDCClientSecret
oidc_client_secret: "ondemand.example.com"
oidc_remote_user_claim (String)
Refer to OIDCRemoteUserClaim in auth_openidc.conf.
Default
The default value is email if no Dex connectors are defined. If connectors are defined the default is preferred_username
oidc_remote_user_claim: "email"
Example
Set OIDCRemoteUserClaim
oidc_remote_user_claim: "preferred_username"
oidc_scope (String)
Refer to OIDCScope in auth_openidc.conf.
Default
The default value is openid profile email.
oidc_scope: "openid profile email"
Example
Set OIDCScope
oidc_scope: "openid profile email groups"
oidc_session_inactivity_timeout (Integer)
Refer to OIDCSessionInactivityTimeout in auth_openidc.conf.
Default
The default value is 28800.
oidc_session_inactivity_timeout: 28800
Example
Set OIDCSessionInactivityTimeout
oidc_session_inactivity_timeout: 57600
oidc_session_max_duration (Integer)
Refer to OIDCSessionMaxDuration in auth_openidc.conf.
Default
The default value is 28800.
oidc_session_max_duration: 28800
Example
Set OIDCSessionMaxDuration
oidc_session_max_duration: 57600
oidc_state_max_number_of_cookies (String)
Refer to OIDCStateMaxNumberOfCookies in auth_openidc.conf.
Default
The default value is 10 true.
oidc_state_max_number_of_cookies: "10 true"
Example
Set OIDCStateMaxNumberOfCookies
oidc_state_max_number_of_cookies: "20 true"
oidc_cookie_same_site (String)
Refer to OIDCCookieSameSite in auth_openidc.conf.
Default
The default value is On when SSL is disabled or Off when SSL is enabled.
oidc_cookie_same_site: "On"
Example
Set OIDCCookieSameSite
oidc_cookie_same_site: "Off"
oidc_settings (Hash, {})
A Hash to supply additional OIDC settings.
Default
The default value is an empty Hash.
oidc_settings: {}
Example
Set OIDCStateMaxNumberOfCookies
oidc_settings:
  OIDCPassIDTokenAs: serialized
  OIDCPassRefreshToken: On
dex_uri (String, null, false)
The Dex URI used behind the Apache reverse proxy. Setting this value to some path will result in Dex listening on local host as well as only using HTTP for proxied communication.
Default
The default value is /dex
dex_uri: /dex
Example
Disable Dex behind a reverse proxy
dex_uri: false
dex (Hash, null, false)
The Hash to define Dex configurations. A value of false or null will disable Dex configuration generation. Refer to OnDemand Dex configuration reference for details.
Default
The default value is an empty Hash.
dex: {}
Example
Disable Dex configuration management
dex: false
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/files/nginx-stage-yml.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
Configuration Options
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » nginx_stage.yml
Edit on GitHub
nginx_stage.yml
Many of the options in the per-user NGINX staging and configuration can be configured within nginx_stage. In a default installation this YAML configuration file is located at:
/etc/ood/config/nginx_stage.yml
On a fresh installation you may need to create this file or copy the default file from:
/opt/ood/nginx_stage/share/nginx_stage_example.yml
In most cases it is recommended that you don’t edit this file as the chosen defaults should work out of the box for most scenarios.
Warning
Modifying application specific configuration options or URI options can have unintended consequences for some of the Open OnDemand applications, so be sure you know what you are doing.
Configuration Options
ondemand_version_path (String)
path to the OnDemand version file
Default
Set to default path
ondemand_version_path: "/opt/ood/VERSION"
Example
Supply a custom version file with a different version in it
ondemand_version_path: "/path/to/VERSION"
ondemand_portal (String, null)
unique name of this OnDemand portal used to namespace multiple hosted portals
Default
Do not set a custom namespace for this portal
ondemand_portal: null
Example
Use a custom namespace for this portal
ondemand_portal: "custom"
Note
If this is not set then most apps will use the default namespace ondemand.
ondemand_title (String, null)
title of this OnDemand portal that apps should display in their navbar
Default
Do not set a custom title for this portal
ondemand_title: null
Example
Use a custom title for this portal
ondemand_title: "My Custom Portal"
Note
If this is not set then most apps will use the default title Open OnDemand.
pun_custom_env (Object, null)
Custom environment variables to set for the PUN environment.
Default
No new environment variables.
pun_custom_env: {}
Example
Set some custom environment variables.
pun_custom_env:
   OOD_DASHBOARD_TITLE: "Open OnDemand"
   OOD_BRAND_BG_COLOR: "#53565a"
   OOD_BRAND_LINK_ACTIVE_BG_COLOR: "#fff"
pun_custom_env_declarations (Array, null)
List of environment variables to pass onto PUN environment from /etc/ood/profile. Example below shows some default env vars that are declared.
Default
No declarations of new environment variables.
pun_custom_env: {}
Example
Decleary several environment variables to pass to the PUN.
pun_custom_env:
  - PATH
  - LD_LIBRARY_PATH
  - MANPATH
  - SCLS
  - X_SCLS
template_root (String)
the root directory containing the ERB templates used in generating the NGINX configuration files
Default
Set to default installation location
template_root: "/opt/ood/nginx_stage/templates"
Example
Use custom templates
template_root: "/path/to/my/templates"
proxy_user (String)
the user name that the Apache proxy runs as so permissions can be added to the Unix domain sockets
Default
Set to the typical apache user
proxy_user: "apache"
Example
Use a different user for the Apache proxy
proxy_user: "proxy_user"
nginx_bin (String)
the path to the NGINX binary
Default
Use NGINX installed by OnDemand Software Collections
nginx_bin: "/opt/ood/ondemand/root/usr/sbin/nginx"
Example
NGINX is installed in a different directory
nginx_bin: "/path/to/sbin/nginx"
nginx_signals (Array<String>)
valid signals that can be sent to the NGINX process
Default
Supported NGINX signals
nginx_signals: [stop, quit, reopen, reload]
Example
Further restrict valid signals
nginx_signals: [stop]
Note
This option is sent as -s signal to the NGINX command line.
mime_types_path (String)
the path to the system-installed NGINX mime.types file
Default
Use the NGINX installed by OnDemand Software Collections file
mime_types_path: "/opt/ood/ondemand/root/etc/nginx/mime.types"
Example
Use a custom mime file
mime_types_path: "/path/to/custom/mime.types"
passenger_root (String)
the locations.ini file that describes Passenger installation
Default
Use the file supplied by Passenger from OnDemand Software Collections
passenger_root: "/opt/ood/ondemand/root/usr/share/ruby/vendor_ruby/phusion_passenger/locations.ini"
Example
Use a custom file
passenger_root: "/path/to/custom/locations.ini"
passenger_ruby (String)
the path to the Ruby binary that Passenger uses for itself and web apps
Default
Use the Ruby wrapper script supplied by this code
passenger_ruby: "/opt/ood/nginx_stage/bin/ruby"
Example
Use the binary supplied by Ruby 2.4 installed by Software Collections
passenger_ruby: "/opt/rh/rh-ruby25/root/usr/bin/ruby"
passenger_nodejs (String, null)
the path to the Node.js binary that Passenger uses for web apps
Default
Use the Node.js wrapper script supplied by this code
passenger_nodejs: "/opt/ood/nginx_stage/bin/node"
Example
Use the binary supplied by Node.js installed by Software Collections
passenger_nodejs: "/opt/rh/rh-nodejs6/root/usr/bin/node"
passenger_python (String, null)
the path to the Python binary that Passenger uses for web apps
Default
Use the Python wrapper script supplied by this code
passenger_python: "/opt/ood/nginx_stage/bin/python"
Example
Use the system-installed Python binary
passenger_python: "/usr/bin/python"
passenger_pool_idle_time (Integer)
The maximum number of seconds that an application process may be idle. Set to false if you don’t want this specified in the nginx config
Default
Set idle time to 300
passenger_pool_idle_time: 300
Example
Increase idle time
passenger_pool_idle_time: 900
passenger_log_file (String)
The log file that passenger will write standard out and standard error to.
Note
You may use the variable %{user} to write user specific files.
Default
Write to a per user location in /var/log/ondemand-nginx/.
passenger_log_file: '/var/log/ondemand-nginx/%{user}/error.log'
Example
Write to a per user location in /some/other/location/.
passenger_log_file: '/some/other/location/%{user}/error.log'
passenger_options (Hash)
A Hash of additional Passenger options Keys without passenger_ prefix will be ignored
Default
No additional Passenger options defined
passenger_options: {}
Example
Define custom Passenger options
passenger_options:
  passenger_max_preloader_idle_time: 300
nginx_file_upload_max (Integer, 10737420000)
Max file upload size in bytes (e.g., 10737420000)
Default
~10 GB max upload.
nginx_file_upload_max: 10737420000
Example
Double the max upload.
nginx_file_upload_max: 21474840000
pun_config_path (String)
the interpolated path to the user’s PUN config file
Default
Namespace the user config files by their user name
pun_config_path: "/var/lib/ondemand-nginx/config/puns/%{user}.conf"
Example
Namespace configs under user directories
pun_config_path: "/var/lib/ondemand-nginx/config/puns/%{user}/nginx.conf"
pun_tmp_root (String)
the interpolated root directory used for NGINX tmp directories
Default
Namespace under user directories
pun_tmp_root: "/var/lib/ondemand-nginx/tmp/%{user}"
Example
Use a custom namespace for root directory
pun_tmp_root: "/path/to/%{user}-tmp"
Warning
NGINX will store the full request body in this location before sending it to the Passenger app. The size of the disk partition this directory resides in will limit the maximum file upload size.
pun_access_log_path (String)
the interpolated path to the NGINX access log
Default
Namespace access logs under user directories
pun_access_log_path: "/var/log/ondemand-nginx/%{user}/access.log"
Example
Use a custom location for the access log file
pun_access_log_path: "/custom/path/access-%{user}.log"
pun_error_log_path (String)
the interpolated path to the NGINX error log
Default
Namespace error logs under user directories
pun_error_log_path: "/var/log/ondemand-nginx/%{user}/error.log"
Example
Use a custom location for the error log file
pun_error_log_path: "/custom/path/error-%{user}.log"
pun_secret_key_base_path (String)
The secret key location. Note these are per user.
Default
Per User secret in var lib ondemand-nginx.
pun_secret_key_base_path: "/var/lib/ondemand-nginx/config/puns/%{user}.secret_key_base.txt"
Example
Use a custom location for secret files.
pun_secret_key_base_path: "/custom/secrets/%{user}.secret_key_base.txt"
pun_log_format (String)
The format of the access and error logs.
Default
The default.
pun_log_format: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"'
Example
Use a custom log format.
pun_log_format: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent'
pun_pid_path (String)
the interpolated path to the NGINX pid file
Default
Namespace pid files under user directories
pun_pid_path: "/var/run/ondemand-nginx/%{user}/passenger.pid"
Example
Use a custom location for the pid files
pun_pid_path: "/custom/path/pid-%{user}.pid"
pun_socket_path (String)
the interpolated path to the NGINX socket file
Default
Namespace socket files under user directories
pun_pid_path: "/var/run/ondemand-nginx/%{user}/passenger.sock"
Example
Use a custom location for the socket files
pun_pid_path: "/custom/path/socket-%{user}.sock"
Warning
The root directory containing the Unix domain socket file will have restricted permissions so that only the Apache proxy user can access this socket file.
Danger
Currently the proxy will only look for socket files following the format:
$OOD_PUN_SOCKET_ROOT/<user>/passenger.sock
It is not recommended to alter pun_pid_path unless you know what you are doing.
pun_sendfile_root (String)
the root directory that NGINX serves files from using sendfile
Default
Serve all files on file system
pun_sendfile_root: "/"
Example
Only serve files under home directories
pun_sendfile_root: "/home"
Warning
All URL requests to sendfile will be relative to the pun_sendfile_root. If you alter this configuration option you may break certain web applications that expect it under /.
pun_sendfile_uri (String)
the internal URL path used by NGINX to serve files from using sendfile (not directly accessible by the client browser)
Default
Serve files under a unique path
pun_sendfile_uri: "/sendfile"
Example
Server files under a custom URL path
pun_sendfile_root: "/custom/files"
pun_app_configs (Array<Hash>)
a list of interpolated hashes that define what wildcard app config file paths to include in a user’s NGINX config (the hashes are arguments for app_config_path)
Default
Serve a user’s dev apps, all shared apps, all system apps through NGINX
pun_app_configs:
  -
    env: dev
    name: "*"
    owner: "%{user}"
  -
    env: usr
    name: "*"
    owner: "*"
  -
    env: sys
    name: "*"
    owner: "*"
Example
Serve only system apps through NGINX
pun_app_configs:
  -
    env: dev
    name: "*"
    owner: "%{user}"
app_config_path (Hash)
an interpolated hash detailing the path to the NGINX app configs for each app type
Default
A recommended solution for app config locations
app_config_path:
  dev: "/var/lib/ondemand-nginx/config/apps/dev/%{owner}/%{name}.conf"
  usr: "/var/lib/ondemand-nginx/config/apps/usr/%{owner}/%{name}.conf"
  sys: "/var/lib/ondemand-nginx/config/apps/sys/%{name}.conf"
app_root (Hash)
an interpolated hash detailing the root directory where the app is installed for each app type
Default
A recommended solution for app deployment locations
app_root:
  dev: "/var/www/ood/apps/dev/%{owner}/gateway/%{name}"
  usr: "/var/www/ood/apps/usr/%{owner}/gateway/%{name}"
  sys: "/var/www/ood/apps/sys/%{name}"
Note
A common solution is to map the user shared app location as a symlink to the user’s home directory:
/var/www/ood/apps/usr/<owner>/gateway => ~<owner>/ondemand/share
This allows the owner of the app to update the app in real time as well as maintain file permissions.
Warning
Modifying this configuration option may break how the Dashboard app searches for apps.
app_request_uri (Hash)
an interpolated hash detailing the URL path used to access the given type of app (not including the base-URI)
Default
A recommended solution for app request URL’s
app_request_uri:
  dev: "/dev/%{name}"
  usr: "/usr/%{owner}/%{name}"
  sys: "/sys/%{name}"
Note
Modifying this will require you also modify app_request_regex.
Warning
Modifying this configuration option may break how the various apps link to each other.
app_request_regex (Hash)
a hash detailing the regular expressions used to determine the type of app and its corresponding parameters from a URL request (this should match what you used in app_request_uri)
Default
A recommended solution for app request URL regular expressions
app_request_regex:
  dev: "^/dev/(?<name>[-\\w.]+)"
  usr: "^/usr/(?<owner>[\\w]+)/(?<name>[-\\w.]+)"
  sys: "^/sys/(?<name>[-\\w.]+)"
Note
Modifying anything in this configuration option other than the allowed characters will require you modify app_request_uri as well.
app_token (Hash)
an interpolated hash detailing a uniquely identifiable string for each app
Default
A recommended solution for generating app tokens
app_token:
  dev: "dev/%{owner}/%{name}"
  usr: "usr/%{owner}/%{name}"
  sys: "sys/%{name}"
Note
Not currently used and may be deprecated in the future.
app_passenger_env (Hash)
a hash detailing the Passenger environment to run the type of app under
Default
A recommended solution for setting Passenger environments
app_passenger_env:
  dev: "development"
  usr: "production"
  sys: "production"
Warning
Modifying this configuration option can lead to unintended consequences for web apps such as issues with serving their assets.
user_regex (String)
regular expression used to validate a given user name
Default
Username can consist of any characters typically found in an email address
user_regex: '[\w@\.\-]+'
Example
Restrict user name to just alphanumeric characters
user_regex: '\w+'
min_uid (Integer)
the minimum user id required to start a per-user NGINX process as
Default
User id’s typically start at 1000
min_uid: 1000
Example
Using CentOS 6
min_uid: 500
Note
For RHEL6 and CentOS 6 the user id’s begin at 500.
disabled_shell (String)
Restrict starting a per-user NGINX process as a user with the given shell.
Default
Do not start a per-user NGINX for anyone with /access/denied shell.
disabled_shell: "/access/denied"
Example
Do not start a per-user NGINX for anyone with /usr/bin/false shell.
disabeled_shell: "/usr/bin/false"
Note
This will only restrict access to a per-user NGINX process started with the nginx_stage pun command (used by the Apache proxy). This doesn’t restrict the other administrative commands nginx_stage nginx and nginx_stage nginx_clean when manually starting and stopping the NGINX process.
disable_bundle_user_config (Integer)
Set BUNDLE_USER_CONFIG to /dev/null in the PUN environment. NB: This prevents a user’s ~/.bundle/config from affecting OnDemand applications.
Default
Disable bundle user configuration.
disable_bundle_user_config: true
Example
Enable bundle user configuration. This may adversly affect system deployed apps.
disable_bundle_user_config: false
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/files/ondemand-d-ymls.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
Configuration Properties with profile support
Configuration Properties
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » ondemand.d/*.yml files
Edit on GitHub
ondemand.d/*.yml files
Most of the configurations are now held within yml files in the /etc/ood/config/ondemand.d/ directory. Open OnDemand will read all the .yml and .yml.erb files within this directory for configurations.
To use a different directory other than this use the OOD_CONFIG_D_DIRECTORY environment variable in the /etc/ood/config/apps/dashboard/env file.
These properties support profile based configuration, see the profile configuration documentation.
Note
Simple properties (strings and booleans) can be configured using environment variables as well. The name of the environment variable will be the property name in capitals prepended with OOD_. eg: property brand_bg_color will be OOD_BRAND_BG_COLOR enviroment variable.
We recommend setting environment variables in /etc/ood/config/nginx_stage.yml as YAML mappings (key value pairs) in the mapping (hash/dictionary) pun_custom_env. Alternatively you can set these in the env files of the dashboard and the apps.
Warning
When using environment variables with nginx_stage.yml file, be careful to set the value using quotes i.e. OOD_BRAND_BG_COLOR: '#0000ff'. If you omit the quotes, YAML will see # as a comment and the value of the OOD_BRAND_BG_COLOR will be nil
Configuration Properties with profile support
dashboard_header_img_logo (String, null)
The url to the logo image for the main navigation. If no logo is configured, the dashboard_title property will be used as text.
Default
No logo image will be shown, just the dashboard_title text.
dashboard_header_img_logo: null
Example
Show /public/logo.png as the logo image.
dashboard_header_img_logo: "/public/logo.png"
disable_dashboard_logo (Bool, false)
Whether to show the dashboard_logo property in the homepage welcome message.
Default
false, the dashboard_logo logo will be shown in the homepage welcome message.
disable_dashboard_logo: false
Example
Disable the logo in the welcome message.
disable_dashboard_logo: true
dashboard_logo (String, null)
The url to the logo image for the homepage welcome message. If no logo is configured, the dashboard_title property will be used as text.
Default
No logo image will be shown with the welcome message.
dashboard_logo: null
Example
Show /public/welcome.png as the welcome message logo image.
dashboard_logo: "/public/welcome.png"
dashboard_logo_height (Integer, null)
HTML image overide for the height of the welcome message logo image configured with dashboard_logo
Default
null, no override will be applied and the original image height will be used.
dashboard_logo_height: null
Example
Adjust the image height to 150 pixels.
dashboard_logo_height: "150px"
brand_bg_color (String, null)
The CSS color override for the main navbar background. Any valid CSS color value can be used.
Default
Null, no background color override. The default theme color from the navbar_type property will be used.
brand_bg_color: null
Example
Use #007FFF (shade of blue) as the background color for the navbar.
brand_bg_color: "#007FFF"
brand_link_active_bg_color (String, null)
The CSS color override for background of the active navigation link in the navbar. Any valid CSS color value can be used.
Default
Null, no color override. The default theme color from the navbar_type property will be used.
brand_link_active_bg_color: null
Example
Use #007FFF (shade of blue) for the background color of the active navigation link.
brand_link_active_bg_color: "#007FFF"
dashboard_layout (Object, null)
Specify the dashboard layout. Rearrange existing widgets and add more custom widgets. See the documentation on custom dashboard layouts for details and examples.
Default
Null, do not change the default dashboard layout.
Example
See the dashboard layout documentation
pinned_apps (Array<Object>, null)
An array of pinned app objects specifying what apps to pin to the dashboard. See the documentation on pinned apps for details and examples.
Default
Null, don’t pin any apps to the dashboard.
Example
See the pinned apps documentation
pinned_apps_menu_length (Integer, 6)
The maximum number of pinned apps in the ‘Apps’ menu bar.
Default
Show 6 items in the menu.
pinned_apps_menu_length: 6
Example
Show 10 items in the menu.
pinned_apps_menu_length: 10
pinned_apps_group_by (String, null)
Group the pinned apps icons by this field in the dashboard.
Default
Null, do no group pinned apps by any field.
pinned_apps_group_by: null
Example
Group the pinned apps by category.
pinned_apps_group_by: "category"
profile_links (Array<Object>, [])
List of profiles to display in the Help navigation menu. This will allow users to change profiles. For more information see the profile selection documentation.
Default
Empty list, no profile links will be shown.
profile_links: []
Example
Add a link to the default and ondemand profiles to the Help menu.
profile_links:
  - id: ""
    name: "Default"
    icon: "house-user"
  - id: "ondemand"
    name: "OnDemand Profile"
    icon: "user"
custom_css_files (Array<String>, [])
List of relative URLs to the CSS files to include in all Dashboard pages. These CSS files can be used to customize the look and feel of the Dashboard.
The relative path will be prefixed with the value of the public_url property.
Default
Empty list, no custom css files will be included.
custom_css_files: []
Example
Add two custom CSS files: /myfolder/navigation.css and /myfolder/pinned_apps.css to the Dashboard.
custom_css_files: ["/myfolder/navigation.css", "/myfolder/pinned_apps.css"]
custom_javascript_files (Array<String>, [])
List of relative URLs to custom javascript files to include in all Dashboard pages. These javascript files can be used to customize the behavior of the Dashboard.
The relative path will be prefixed with the value of the public_url property.
Default
Empty list, no custom javascript files will be included.
custom_javascript_files: []
Example
Add two custom Javascript files: /myfolder/navigation.js and /myfolder/pinned_apps.js to the Dashboard.
custom_javascript_files: ["/myfolder/navigation.js", "/myfolder/pinned_apps.js"]
dashboard_title (String, 'Open OnDemand')
The text to use as the main navigation logo. If the dashboard_header_img_logo property is defined, this property will be used as the HTML image title.
Default
Open OnDemand text
dashboard_title: "Open OnDemand"
Example
Show My Institution as the logo text.
dashboard_title: "My Institution"
show_all_apps_link (Bool, false)
Whether to show the All Apps link in the navbar. This links to the Dashboard page showing all system installed applications.
Default
false, the All Apps link will not be shown in the navbar.
show_all_apps_link: false
Example
Include the All Apps link in the navbar.
show_all_apps_link: true
nav_bar (Array<Object>, [])
An array of navigation items to create a custom navbar. This property sets the navigation items for the left hand side navigation menu in the header.
See the documentation on custom navigation for details and examples.
Default
Empty array, show the default navbar.
Example
See the custom navigation documentation
help_bar (Array<Object>, [])
An array of navigation items to create a custom help navigation. This property sets the navigation items for the right hand side navigation menu on the header.
See the documentation on custom navigation for details and examples.
Default
Empty array, show the default help navigation.
Example
See the custom navigation documentation
help_menu (Array<Object>, [])
A single navigation item to add links to the Help dropdown menu. This property adds navigation items at the end of any exisiting links in the menu.
See the documentation on adding urls to the Help menu for details and examples.
Default
Empty array, no additional links will be added to the Help menu.
Example
See the documentation on adding urls to the Help menu
interactive_apps_menu (Object, {})
A single navigation item to create a custom interactive apps menu. This property sets the interactive applications to display in the left hand side menu on the Interactive Apps and Interactive Sessions pages.
See the documentation on interactive apps menu for details and examples.
Default
Empty object, No customizations, show the currently installed interactive applications.
Example
See the interactive apps menu documentation
custom_pages (Hash<String, Object>, {})
A hash with the definition of the layouts for the configured custom pages. The key is a string with the page code. The value is the custom page layout definition.
See the documentation on custom pages for details and examples.
Default
Empty hash, No custom pages defined.
Example
See the custom pages documentation
support_ticket (Object, {})
Configuration settings to enable and configure the support ticket feature.
See the documentation on Support Ticket for details and examples.
Default
Empty object, support ticket feature is disabled.
Example
See the Support Ticket documentation
navbar_type (String, 'dark')
The navbar theme type. There are 2 themes, light and dark. The selected theme will update the colors of the navbar.
Default
Set theme to dark.
navbar_type: "dark"
Example
Set theme to light.
navbar_type: "light"
public_url (String, '/public')
The prefix url used to load the favicon.ico and custom CSS files configured with the custom_css_files property.
Default
‘/public’ prefix url.
public_url: "/public"
Example
Use /public/resources as the prefix path to load these resources.
public_url: "/public/resources"
announcement_path (Array<String>, ['/etc/ood/config/announcement.md', '/etc/ood/config/announcement.yml', '/etc/ood/config/announcements.d'])
The file or directory path to load announcement messages from.
Default
The default files are: /etc/ood/config/announcement.md, /etc/ood/config/announcement.yml, and /etc/ood/config/announcements.d
announcement_path:
  - "/etc/ood/config/announcement.md"
  - "/etc/ood/config/announcement.yml"
  - "/etc/ood/config/announcements.d"
Example
Use /etc/ood/config/announcement.team1.d/ as the path to load announcements.
announcement_path: "/etc/ood/config/announcement.team1.d/"
nav_categories (Array<String>, ['Apps', 'Files', 'Jobs', 'Clusters', 'Interactive Apps'])
By default Open OnDemand will create dropdown menus on the navigation bar for certain categories listed below.
Use this property to add or remove which application categories will create dropdown menus on the navigation bar.
Default
Create dropdown menus on the navigation bar items for the categories Apps, Files, Jobs, Clusters and Interactive Apps.
nav_categories: ['Apps', 'Files', 'Jobs', 'Clusters', 'Interactive Apps']
Example
Only create dropdown menus on the navigation bar for the categories Apps, Files and Jobs.
nav_categories: ['Apps', 'Files', 'Jobs']
Configuration Properties
files_enable_shell_button (Bool, true)
While browsing files, by default, Open OnDemand will show a button to shell into that directory location. Use this configuration to disable that behaviour.
Default
True. Files App has will show a button to open a shell to that location.
files_enable_shell_button: true
Example
Disable the terminal button in the Files App.
files_enable_shell_button: false
bc_dynamic_js (Bool, false)
Enable dynamic interactive app forms. See Dynamic Form Widgets for more information on what this feature does.
Default
False. Interactive app forms will not be dynamic.
bc_dynamic_js: false
Example
Interactive app forms will be dynamic.
bc_dynamic_js: true
bc_clean_old_dirs(Bool, false)
Interactive Apps create a new directory ~/ondemand/data/sys/dashboard/batch_connect/... every time the application is launched. Over time users may create many directories that hold essentially old and useless data.
When enabled, the system will remove every directory that is older than 30 days. See bc_clean_old_dirs_days below to change the time range. You may wish to keep directories for longer or shorter intervals.
Default
False. Never delete these directories.
bc_clean_old_dirs: false
Example
Delete these directories after 30 days.
bc_clean_old_dirs: true
bc_clean_old_dirs_days(Integer, 30)
If you have bc_clean_old_dirs above enabled, the system will clean every directory that is older than 30 days. This configuration specifies how old a directory (in days) must be to be removed.
The system checks creation time, not modification time.
Default
Delete these directories after 30 days if bc_clean_old_dirs is enabled.
bc_clean_old_dirs_days: 30
Example
Delete these directories after 15 days if bc_clean_old_dirs is enabled.
bc_clean_old_dirs_days: 15
host_based_profiles (Bool, false)
Feature flag to enable automatic selection of configuration profiles based on the hostname of the request.
Default
False. Profiles will be selected manually based on the user settings file.
host_based_profiles: false
Example
Enable automatic hostname profile selection.
host_based_profiles: true
disable_bc_shell (Bool, false)
Some schedulers like LSF use the the -L flag to bsub for purposes other than setting the shell path. Interactive apps set the shell path to /bin/bash by default using various flags or editing scripts.
Default
False. All interactive apps will submit jobs with the shell path flag set.
disable_bc_shell: false
Example
Do not submit interactive jobs with any shell path.
disable_bc_shell: true
cancel_session_enabled (Bool, false)
Feature flag to enable the cancellation of active interactive sessions without deleting the session card.
Default
False. Active interactive sessions can only be deleted.
cancel_session_enabled: false
Example
Enable interactive sessions cancellations.
cancel_session_enabled: true
module_file_dir (String, null)
Specify a directory where cluster specific module files exist. It’s important that there be a file for each cluster because the system can then tie those modules to that specific cluster.
This directory should have module spider-json output for each cluster as indicated by the command below. Open OnDemand will read these files and potentially show them in a from for a cluster called my_cluster.
$LMOD_DIR/spider -o spider-json $MODULEPATH > /some/directory/my_cluster.json
Default
Null. No directory given.
module_file_dir: null
Example
Look for json files in the /etc/reporting/modules directory.
module_file_dir: "/etc/reporting/modules"
user_settings_file (String, '.ood')
The full path of the file to store user settings. This file is used to store any user defined settings.
Default
A file called ‘.ood’.
user_settings_file: "~/.config/ondemand/settings.yml"
Example
Use user_settings.txt as the file name for user settings and change the path slightly.
user_settings_file: "~/.config/local/open-ondemand/user_settings.txt"
facl_domain (String, null)
The File Access Control List (FACL) domain to use when setting FACLs on files or directories.
Default
No facl domain given.
facl_domain: null
Example
What we use at OSC.
facl_domain: "osc.edu"
auto_groups_filter (String, null)
Specify a filter for the automatic form option auto_groups.
Default
No filter given. All Unix groups will be shown.
auto_groups_filter: null
Example
Only show Unix groups that start with P.
auto_groups_filter: '^P.+'
bc_simple_auto_accounts (Boolean, false)
Use a simple accounting scheme that assumes all accounts are available on all clusters.
Default
False. The account list generated will be a list of all the accounts available across all clusters.
bc_simple_auto_accounts: false
Example
Enable simple accounts. This will generate a list of accounts that should be available on all clusters.
bc_simple_auto_accounts: true
remote_files_enabled (Boolean, false)
Enable remote file browsing, editing and downloading.
Default
Remote files are disabled.
remote_files_enabled: false
Example
Enable remote filesystems through rclone.
remote_files_enabled: true
remote_files_validation (Boolean, false)
Enable validating remote files on startup.
Default
Remote file systems will not be validated on startup.
remote_files_validation: false
Example
Remote file systems will be validated on startup.
remote_files_validation: true
upload_enabled (Boolean, true)
Enable uploading files.
Default
File uploads are enabled.
upload_enabled: true
Example
File uploads are disabled. Users will not be able to upload files through Open OnDemand.
upload_enabled: false
download_enabled (Boolean, true)
Enable downloading files.
Default
File downloads are enabled.
download_enabled: true
Example
File downloads are disabled. Users will not be able to download files through Open OnDemand.
download_enabled: false
hide_app_version (Boolean, false)
Hide the interactive application’s version.
Default
Interactive application versions are shown.
hide_app_version: false
Example
Never show interactive application versions.
hide_app_version: true
globus_endpoints (Array<Object>, null)
Add a Globus button to the file browser. The button opens the current directory in the Globus transfer web app.
In the example with multiple endpoints, suppose you use the local file browser to look at your local file system. If you were to navigate to your local /home and then click the Globus button, you would see a new tab open with the endpoint associated to that local path in the Globus interface.
If you then go back to the localfile browser and navigate to /project and then click the Globus button, you would now see the endpoint associated with that local /project directory open in the Globus interface in a new tab.
The gist here is you navigate to the desired directory using the local filebrowser then click the Globus button to show the corresponding endpoint in the Globus interface which opens in a new tab.
Note that endpoint_path is the path that Globus will initialize to and is very likely to be / regardless of the actual storage path.
Default
Null, do not enable the Globus button
Example
Use a single endpoint for the whole filesystem.
globus_endpoints:
  - path: "/"
    endpoint: "716de4ac-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    endpoint_path: "/"
Example
Use multiple endpoints.
globus_endpoints:
  - path: "/home"
    endpoint: "716de4ac-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    endpoint_path: "/home"

  - path: "/project"
    endpoint: "9f1fe759-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    endpoint_path: "/project"
Example
When pathnames differ between the filesystem and endpoint.
globus_endpoints:
  - path: "/project"
    endpoint: "9f1fe759-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    endpoint_path: "/"
Example
Reference the home directory of the current user.
globus_endpoints:
  - path: "<%=  Etc.getpwnam(Etc.getlogin).dir %>"
    endpoint: "9f1fe759-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    endpoint_path: "/"
google_analytics_tag_id (String, nil)
Configure Google Analytics by supplying a tag id.
Default
Google Analytics is disabled.
google_analytics_tag_id: nil
Example
Google Analytics is enabled and will upload data to the tag id abc123.
google_analytics_tag_id: 'abc123'
motd_render_html (Boolean, false)
Render HTML in the Message of the Day (MOTD). This configuration was added because some MOTD formats like RSS can generate HTML that is potentially unsafe.
Default
The Message of the day will not render HTML.
motd_render_html: false
Example
The Message of the day will render HTML.
motd_render_html: true
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/files/submit-yml-erb.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
Basic Batch Connect Options
Batch Connect VNC Options
Batch Connect VNC Container Options
Batch Connect Script Options
Simple Example
Setting Batch Connect Options Globally
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » submit.yml.erb
Edit on GitHub
submit.yml.erb
This is the file that is submitted to a batch connect job. It is comprised of a script and a batch_connect attribute. The batch_connect attribute can either be a basic template if your app is already an http server or a vnc template if you need VNC capabilities.
These are reference pages, you can see Job Submission (submit.yml.erb) for a broader overview.
Basic Batch Connect Options
Batch Connect VNC Options
Batch Connect VNC Container Options
Starter def file
Batch Connect Script Options
Simple Example
# a simple script.yml.erb file

script:
  native:
    - "-n"
    - "1"
batch_connect:
  template: "basic"
  header: "#!/bin/bash"
Setting Batch Connect Options Globally
All of these configuration items can also be applied globally to the entire cluster in the cluster definition files under /etc/ood/config/clusters.d/. If set globally, the option is applied to all applications in that cluster.
Here’s an example of how to set the header configuration for both vnc and basic templates.
v2:
  batch_connect:
    basic:
      header: "#!/bin/bash"
    vnc:
      header: "#!/bin/bash"
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/commands/ood-portal-generator.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
Options
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » ood-portal-generator
Edit on GitHub
ood-portal-generator
The ood-portal-generator tool takes a user-defined YAML configuration file and generates an Apache configuration file from the provided template file. This Apache configuration file can then be used in an Apache HTTP server to host an Open OnDemand portal.
The command that generates and updates the Apache configuration file is given as:
/opt/ood/ood-portal-generator/sbin/update_ood_portal [OPTIONS]
At any point you can display a quick reference of the capabilities offered by bin/generate with:
$ /opt/ood/ood-portal-generator/sbin/update_ood_portal -h
Usage: update_ood_portal [options]
   -r, --rpm                        Execution performed during RPM install
   -f, --force                      Force replacement of configs even if checksums differ
      --detailed-exitcodes          Exit with 3 when changes are made and 4 when changes skipped
   -c, --config CONFIG              YAML config file used to render template
   -t, --template TEMPLATE          ERB template that is rendered
   -v, --version                    Print current version
   -h, --help                       Show this help message

Default:
update_ood_portal -c /etc/ood/config/ood_portal.yml -t /opt/ood/ood-portal-generator/templates/ood-portal.conf.erb
Options
-r, --rpm
Execution performed during RPM install
Default
not used
Example
Run the script as if it were during the RPM installation
/opt/ood/ood-portal-generator/sbin/update_ood_portal -r
-f, --force
Force the update to occur even if the checksums don’t match
Default
not used
Example
Force the update to occur even if the checksums don’t match
/opt/ood/ood-portal-generator/sbin/update_ood_portal -f
--detailed-exitcodes
Exit with different codes
Default
exits 0 if the update is successful, 1 if not
Example
Exit with 3 when changes are made and 4 when changes skipped
/opt/ood/ood-portal-generator/sbin/update_ood_portal --detailed-exitcodes
-c <config>, --config <config>
the ood-portal-generator YAML configuration file
Default
/etc/ood/config/ood_portal.yml
Example
Use a local configuration file
/opt/ood/ood-portal-generator/sbin/update_ood_portal -c my_conf.yml
Warning
The systemd file for Apache will run the update_ood_portal script with defaults and will not use a different file, rendering this option obsolete unless you also modify systemd config (/etc/systemd/system/httpd24-httpd.service.d/ood-portal.conf in RHEL 7, /etc/systemd/system/httpd.service.d/ood-portal.conf in RHEL 8).
-t <template>, --template <template>
the ERB template to use as the input
Default
/opt/ood/ood-portal-generator/templates/ood-portal.conf.erb
Example
Use a different ERB template (not recommended)
/opt/ood/ood-portal-generator/sbin/update_ood_portal -t /opt/myfiles/different-ood-portal.conf.erb
Warning
The systemd file for Apache will run the update_ood_portal script with defaults and will not use a different file, rendering this option obsolete unless you also modify systemd config (/etc/systemd/system/httpd24-httpd.service.d/ood-portal.conf in RHEL 7, /etc/systemd/system/httpd.service.d/ood-portal.conf in RHEL 8).
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/commands/nginx-stage/usage.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
nginx_stage pun
nginx_stage app
nginx_stage app_reset
nginx_stage app_list
nginx_stage app_clean
nginx_stage nginx
nginx_stage nginx_show
nginx_stage nginx_list
nginx_stage nginx_clean
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » Usage
Edit on GitHub
Usage
The nginx_stage is meant to be run as a privileged process so that it can fork and kill processes owned by other users, as well as read and write to root owned files and directories. It is therefore recommended to run it under a sudo environment.
Note
All options to nginx_stage can be specified as URL-encoded strings to avoid having to escape special characters in the shell.
At any point you can display a quick reference of the capabilities offered by nginx_stage with:
nginx_stage [COMMAND] --help
Commands
nginx_stage pun
Required Options
General Options
Examples
nginx_stage app
Required Options
General Options
Examples
nginx_stage app_reset
General Options
Examples
nginx_stage app_list
Examples
nginx_stage app_clean
Examples
nginx_stage nginx
Required Options
General Options
Examples
nginx_stage nginx_show
Required Options
Examples
nginx_stage nginx_list
Examples
nginx_stage nginx_clean
General Options
Examples
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/reference/pun-environment.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Configuration Reference » PUN environment
Edit on GitHub
PUN environment
OnDemand’s configuration is stored in the environment, which can be modified using a hierarchy of config files. Configuration files are rooted in /etc/ood. Assets that should be publicly available (such as a favicon or logo image) are placed under /var/www/ood/public.
These are three files that directly affect the environment or functionality of the Per-User NGINX (PUN) processes:
/etc/ood/config/nginx_stage.yml
YAML file to override default configuration for the PUN. You can set environment variables via key-value pairs in the mapping pun_custom_env. You can specify a list of environment variables set in /etc/ood/profile to pass through to the PUN by defining the sequence pun_custom_env_declarations.
An example of both of these uses may be found in nginx_stage_example.yml. Variables set here are set for all OnDemand applications.
/etc/ood/config/apps/$APP/env
replace $APP above with the name of the app directory deployed to /var/www/ood/apps/sys
Used to provide application specific config
env files do not override values set by prior methods.
/etc/ood/config/apps/$APP/initializers/ood.rb
replace $APP above with the name of the app directory deployed to /var/www/ood/apps/sys
Modify Rails application behavior using Ruby code. Since this is application code environment variables can be set, removed.
This method is specific to Ruby on Rails applications: Activejobs, Dashboard, and Job Composer. You can add multiple initializer files in this directory and they will be loaded in alphabetical order
This file affects the starting of the PUN, and is the appropriate place to change the software collections loaded:
/etc/ood/profile
Sourced as root prior to starting the PUN
If exists, this file is sourced instead of the default at /opt/ood/nginx_stage/etc/profile by /opt/ood/nginx_stage/sbin/nginx_stage script when running as root, prior to launching the PUN.
You should source /opt/ood/nginx_stage/etc/profile in your custom /etc/ood/profile if you add one to load the correct software collections.
Environment variables set here are not guarenteed to remain set in the PUNs unless those environment variables are added to the YAML sequence pun_custom_env_declarations in /etc/ood/config/nginx_stage.yml. Here is a list of environment variables guarenteed to be preserved when NGINX starts:
PATH
LD_LIBRARY_PATH
X_SCLS
MANPATH
PCP_DIR
PERL5LIB
PKG_CONFIG_PATH
PYTHONPATH
XDG_DATA_DIRS
SCLS RUBYLIB
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes
Edit on GitHub
Release Notes
v3.1 Release Notes
Administrative changes
New Features
Details of administrative changes
Details of new features
v3.0 Release Notes
Administrative changes
New Features
Thanks!
Security Fixes
Details of administrative changes
Details of new features
v2.0 Release Notes
Upgrading to v2.0.29
Upgrading from v1.8
Details
v1.8 Release Notes
Special thanks
Upgrading from v1.7
Upgrading from v1.6
Details
v1.7 Release Notes
Special thanks
Upgrading from v1.6
Upgrading from v1.5
Details
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v3.1-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
Administrative changes
New Features
Details of administrative changes
Details of new features
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v3.1 Release Notes
Edit on GitHub
v3.1 Release Notes
Administrative changes
Breaking Changes
Deprecations
Dependency updates
Upgrade directions
New Features
Globus integration
Path Selector widget
Google Analytics 4 support
Dynamic Checkboxes
Disabling uploads and downloads
Custom Javascript files
Updated Apache options
Improved shell connections
aarch64/arm64 and ppc64le packages
Amazon Linux 2023 packages
Debian 12 packages
Details of administrative changes
Breaking Changes
User Settings File Change
We had to change the location of the user settings file off of the DATAROOT which is cluster specific and problematic for sites that have separate HOME directories for each cluster.
The new default location is under the XDG_CONFIG_HOME. This change was made to accomidate sites that have separate HOME directories for each cluster.
Sites who have never used this configuration do not need to do anything.
Sites that have reconfigured the user settings file need to provide the full path for this file. It’s recommended that you do not use a path in the DATAROOT as that is cluster specific.
Deprecations
RedHat/CentOS 7 packages deprecated
OnDemand 3.0 was the last OnDemand release to support RedHat/CentOS 7.
3.1 does not support RedHat/CentOS 7.
Dependency updates
This release updates the following dependencies:
Ruby 3.1 (RHEL 8 & 9 only)
Warning
The change in Ruby version means any Ruby based apps that are not provided by the OnDemand RPM must be rebuilt or supply their own bin/ruby to use the older version of ruby.
NodeJS 18 (All OSes except RHEL 7)
Warning
The change in Node version means any Node based apps that are not provided by the OnDemand RPM must be rebuilt.
Passenger 6.0.17
NGINX 1.22.1
ondemand-dex 2.36.0
mod_auth_openidc 2.4.14.1 (RHEL 7 & 8 only)
Upgrade directions
Warning
As always please update the development or test instances of OnDemand installed at your center first to test and verify before you modify the production instance.
Warning
The OnDemand upgrade has only been tested going from 3.0.x to 3.1.x.
Update OnDemand release RPM
RedHat/CentOS 7RedHat/Rocky Linux/AlmaLinux 8RedHat/Rocky Linux/AlmaLinux 9Ubuntu 20.04Ubuntu 22.04
sudo yum install -y https://yum.osc.edu/ondemand/3.1/ondemand-release-web-3.1-1.el7.noarch.rpm
Enable dependencies
RHEL/Rocky/AlmaLinux 8 & 9 only
sudo dnf module reset nodejs
sudo dnf module enable nodejs:18
sudo dnf module reset ruby
sudo dnf module enable ruby:3.1
Update OnDemand
yum/dnfapt
sudo yum clean all
sudo yum update ondemand
(Optional) If using Dex based authentiction, update the ondemand-dex package.
yum/dnfapt
sudo yum update ondemand-dex
Update Apache configuration and restart Apache.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
RedHat/CentOS 7RedHat/Rocky Linux/AlmaLinux 8 & 9Ubuntu 20.04 & 22.04
sudo systemctl try-restart httpd24-httpd.service
(Optional) If ondemand-dex was installed, restart the ondemand-dex service.
sudo systemctl try-restart ondemand-dex.service
(Optional) If ondemand-selinux was installed, see SELinux after Updates
Force all PUNs to restart
sudo /opt/ood/nginx_stage/sbin/nginx_stage nginx_clean -f
Details of new features
Globus integration
The files application will now provide a link to Globus endpoints when users navigate to a directory that is within that endpoint.
Administrators need to configure OnDemand to map directories to Globus endpoints. Refer to the configuration entry for enabling globus endpoints.
Path Selector widget
Open OnDemand now ships it’s own path_selector form widet. This replaces the library at https://github.com/osc/bc_js_filepicker for centers that have or do use this library.
You can go here to find details on the path selector.
Google Analytics 4 support
Google Analytics has updated since version 3.0 and 3.1 has support now for this update.
Refer to the google analytics configuration for how to configure this.
Dynamic Checkboxes
check_box form widgets can now be used with dynamic data-set and data-hide directives.
Refer to Dynamic Form Widgets for more details.
Disabling uploads and downloads
Sites can now disable uploads and downloads through the file browser. See the configuration for disabling downloads and disabling uploads for how to configure this.
Custom Javascript files
Sites can now add custom javascript files that will get loaded on every page of the dashboard application. Refer to the custom_javascript_files configuration property for more information.
Support added for completed.{md,html}.erb
Sites can now add a completed.{md,html}.erb to interactive applications to display information on the session’s card when the job has completed.
See completed.{md,html}.erb for more information.
Updated Apache options
We’ve updated ood_portal.yml for two common apache configurations sites may wish to enable.
The first is to disable apache logging in favor of supplying a global log configuration in a seperate file.
The second is to alllow for custom directives. You can now supply custom location directives and custom virtual host directives.
Improved shell connections
The shell app has been updated so that shell sessions can last longer. The app is better at keeping the connection alive, meaning users will maintain shell sessions for longer.
aarch64/arm64 and ppc64le packages
Added aarch64/arm64 and ppc64le packages for some operating systems. See Supported Operating Systems and Architectures for a full list of which operating systems support aarch64 and ppc64le.
Amazon Linux 2023 packages
Added Amazon Linux 2023 packages. See Install Software for installation instructions.
Debian 12 packages
Added Debian 12 packages. See Install Software for installation instructions.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v3.0-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
Administrative changes
New Features
Thanks!
Security Fixes
Details of administrative changes
Details of new features
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v3.0 Release Notes
Edit on GitHub
v3.0 Release Notes
Warning
3.0.2 has security fixes that no prior release has. Any version beyond this will also include these fixes.
There are also some breaking changes in 3.0. See the upgrade directions below for details.
Administrative changes
Breaking Changes
Deprecations
Dependency updates
SELinux changes
Dex behind Apache reverse proxy by default
Documentation changes
Upgrade directions
New Features
EL9 and Ubuntu 22.04 packages
Significant changes to navbar configurations
Support for Profiles
Support for custom pages
Automatic Form Options
Support for remote files
Quick Launch Apps
Deleting old interactive app directories
Disabling interactive app versions
Recently Used apps widget
Running Sessions widget
Displaying form options
Submitting help tickets
Thanks!
We’d like to thank a bunch of folks’ for contributing to this release. As we only know the github username, that’s what’s being referenced here.
We’d like to thank Harvard for many contributions around layouts and navitation. Notably, adaybujeda and whorka to name a few.
We’d like to thank CSC Finland for contributing remote file browsing. Specifically robinkar and CSC-swesters.
We’d also like to give a big thanks to these folks’ for their first time contributing to Open OnDemand.
Micket made their first contribution in #1426
aebruno made their first contribution in #1766
mayank-agarwal-96 made their first contribution in #1776
whorka made their first contribution in #1854
SaumyaBhushan made their first contribution in #1992
davidmonro made their first contribution in #2091
mnakao made their first contribution in #2194
georgiastuart made their first contribution in #2323
covert8 made their first contribution in #2327
If we’ve missed listing anyone here, please let us know!
Security Fixes
Versions prior to 3.0 are vulnerable to these security related issues:
OOD_ALLOWLIST_PATH can be circumvented in several scenarios.
Users may inject malicous Ruby code into certian user owned ERB files that the system reads.
These have been fixed in version 3.0.2 and up. Thank you to the the team at CSC - IT Center for Science, Finland for disclosing these.
Details of administrative changes
Breaking Changes
Support for Ubuntu 18.04 has been dropped.
Support for Ubuntu 18.04 has been dropped because the platform has upgraded to Ruby on Rails 6.1. This version is not compatible with Ruby 2.5 which is what Ubuntu 18.04 has.
context.json file locations have changed
This is an internal item to Open OnDemand and not likely to really affect you at all.
In versions 2.0 and below, batch connect apps wrote a context.json file to a directory like ~/ondemand/data/sys/dashboard/batch_connect/sys/<APPNAME>/context.json. OnDemand uses these files to cache the choices a user makes for the next time they use that app.
Version 3.0 now writes files like ~/ondemand/data/sys/dashboard/batch_connect/cache/<APPNAME>.json
Deprecations
Autoloading during initialization is deprecated.
This comes from the Ruby on Rails framework that Open OnDemand utilizes. It affects initializers you may have written, for example to Add Shortcuts to Files Menu.
To resolve this, wrap your code in a Rails.application.config.after_initialize block.
For example, if you have:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

  OodFilesApp.candidate_favorite_paths.tap do |paths|
    # add User project space directory
    paths << FavoritePath.new("/fs/project/#{User.new.name}")
  end
You will need to modify that file like so:
# /etc/ood/config/apps/dashboard/initializers/ood.rb

  Rails.application.config.after_initialize do
    OodFilesApp.candidate_favorite_paths.tap do |paths|
      # add User project space directory
      paths << FavoritePath.new("/fs/project/#{User.new.name}")
    end
  end
NavConfig is deprecated
The initializers used to modify the navigation bar and the class NavConfig is deprecated. The 2.x series will continue to support this, but sites should use the nav_categories property instead.
See Limit auto generated menu bars and the nav_categories configuration property for more details.
whitelist & blacklist configs are deprecated
These configurations that have whitelist in the name have been deprecated and replaced with allowlist or blocklist.
The configurations maintenance_ip_whitelist for configuring maintenance ips has been replaced by maintenance_ip_allowlist.
The WHITELIST_PATH environment variable for configuring inaccessible paths in the file browser has been replaced by OOD_ALLOWLIST_PATH.
ACL configurations in cluster.d files now use allowlist and blocklist instead of whitelist and blacklist, though sites should just use Linux FACLs to control these files instead of these configurations.
Dependency updates
This release updates the following dependencies:
Ruby 3.0
Warning
The change in Ruby version means any Ruby based apps that are not provided by the OnDemand RPM must be rebuilt or supply their own bin/ruby to use the older version of ruby.
Note
Ruby 2.7 is still supported and used by Ubuntu 20.04.
NodeJS 14
Warning
The change in Node version means any Node based apps that are not provided by the OnDemand RPM must be rebuilt.
Passenger 6.0.14
NGINX 1.20.2
ondemand-dex 2.32.0
OnDemand package now depends on Python 3 instead of Python 2
SELinux changes
The ondemand_use_shell_app SELinux boolean was removed and replaced with ondemand_use_ssh that is enabled by default.
The ondemand_use_kubernetes SELinux boolean was added and is disabled by default.
See the OnDemand SELinux documentation for details
Dex behind Apache reverse proxy by default
Warning
Dex behind the Apache reverse proxy is a behavior change from OnDemand 2.0 where the reverse proxy configuration was optional. This is to improve security as well as allow Apache to provide access logs. If you have opened ports for Dex they can be closed as all traffic to Dex will flow through Apache.
By default Dex now sits behind the Apache reverse proxy. If you wish to go back to Dex being directly accessed set the following in /etc/ood/config/ood_portal.yml:
dex_uri: false
Documentation changes
As you may have noticed, we have restructured the documentation in an attempt to group sections more logically. Please reach out if you have further suggestions on improving our documentation in either its content or its organization.
Upgrade directions
Danger
Ensure websockify version is >= 0.10.0 on the compute nodes in order for desktops to launch correctly after upgrade.
Warning
Update the development or test instances of OnDemand installed at your center first before you modify the production instance.
Warning
The OnDemand upgrade has only been tested going from 2.0.x to 3.0.x.
Update OnDemand release RPM
sudo yum install -y https://yum.osc.edu/ondemand/3.0/ondemand-release-web-3.0-1.noarch.rpm
Enable dependency repos
RHEL/Rocky 8 only
sudo dnf module reset nodejs
sudo dnf module enable nodejs:14
sudo dnf module reset ruby
sudo dnf module enable ruby:3.0
Update OnDemand
sudo yum clean all
sudo yum update ondemand
(Optional) If using Dex based authentication, update the ondemand-dex package.
sudo yum update ondemand-dex
Update Apache configuration and restart Apache.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
RHEL/Rocky 8 only
sudo systemctl try-restart httpd
RHEL/CentOS 7 only
sudo systemctl try-restart httpd24-httpd.service
(Optional) If ondemand-dex was installed, restart the ondemand-dex service.
sudo systemctl try-restart ondemand-dex.service
(Optional) If ondemand-selinux was installed, see SELinux after Updates
Force all PUNs to restart
sudo /opt/ood/nginx_stage/sbin/nginx_stage nginx_clean -f
(Optional) Remove old dependencies from prior versions of OOD if they are not used by other applications.
Warning
See Dependency updates warning before uninstalling old Ruby versions.
RHEL/CentOS 7 only
sudo yum remove rh-nodejs12\* rh-ruby27\*
Details of new features
EL9 and Ubuntu 22.04 packages
See Install Software for instructions on how to install OnDemand using the new EL9 and Ubuntu 22.04 packages. 3.0 also has support for EL8, EL7 and Ubuntu 20.04.
Significant changes to navbar configurations
Significant changes have been made to allow for very granular modification of the navigation bar. At a high level sites can now modify any aspect of the navigation bar.
See Changing the Navigation bar and the subsequent sections for more details.
Support for Profiles
3.0 adds support for profiles. Profiles are basically distinct sets of configurations. For example you may have one profile that only shows applications for the biology category and nothing else. You may have another profile that shows all applications. Users can then toggle between the two different profiles to have two different views into the same Open OnDemand installation.
See Configuration Profiles for more details.
Support for custom pages
2.0 allowed sites to modify the layout of the dashboard’s landing page.
3.0 extends this by allowing sites to create brand new pages in which sites can modify the layout in the same manner you modify the layout of the landing page.
See Custom Pages for more information.
Automatic Form Options
3.0 ships with some form.yml options that populate forms automatically. This includes auto_primary_group, auto_groups, auto_accounts and auto_modules.
See the section on Automatic Predefined Attributes for all available options.
Support for remote files
3.0 ships with the ability to browse, edit and download remote files from rclone. Refer to Accessing Remote File Systems for how to turn this feature on.
Quick Launch Apps
Quick Launch Apps launch with one click and hard coded settings. This allows for sites with common resource requests to hard code those requests into the app such that the user is never presented with the form.
These launch with 1 click from the user and do not allow for choices. I.e., the user is never presented with a form to fill out, the app simply launches when clicked.
See the documentation for Quick Launch Apps for more information.
Deleting old interactive app directories
3.0 provides a mechanism to automatically delete all the directories that interactive applications create in ~/ondemand/data/sys/dashboard/batch_connect/... after some time period. The system provides two options for this: One to enable the feature altogether and the other is to specify how old a directory must be to be removed.
See the configuration options for removing old directories for more details.
Disabling interactive app versions
Sites can now disable showing interactive application versions through the hide_app_version ondemand.d property.
Recently Used Apps widget
In 2.0 we provided a way to change the dashboard layout. Now, in 3.0 there are more widgets to choose from, namely the recently_used_apps widget.
This widget will show the last 4 recently used applications. What’s more is, they’re Quick Launch Apps so users only need to click on them to submit the job with the same parameters they used before.
Running Sessions widget
Along with recently_used_apps widget above, we’re also providing the sessions widget which will show the same cards that are shown in the My Interactive Sessions page.
This means users who have running interactive applications can now connect to them through the landing page without having to navigate anywhere else.
Displaying Form options
Sites can now display form choices in the resulting connection card.
See Displaying form items in the session card for more information.
Submitting Help tickets
Sites can enable submitting help tickets from interactive cards.
See Support Tickets for more information on how this behaves and how to enable it.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v2.0-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
Upgrading to v2.0.29
Upgrading from v1.8
Details
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v2.0 Release Notes
Edit on GitHub
v2.0 Release Notes
Warning
There are some breaking changes in 2.0. See the upgrade directions below for details.
Highlights in 2.0:
Pinned Apps: Enhanced app launch interface using large app icons on the dashboard
Custom dashboard widgets and layout
New File Manager app
Tighter integration between the Dashboard, Active Jobs, and Files apps
Adding metadata to app manifests
Shell app now has themes
Configurations in an ondemand.d directory
Changes in All Apps page layout
ERB formats for Message of the day
Control whether an app link opens in a new window using manifest attribute
Memcached Ruby gem available for use in apps
Dependency updates
Upgrading to v2.0.29
Major Changes
Require NodeJS 14
NodeJS 14 is now required as NodeJS 12 is currently End-Of-Life.
Upgrade directions
RHEL/CentOS 7RHEL/Rocky Linux 8Ubuntu
sudo yum update ondemand
Upgrading from v1.8
Breaking Changes
No longer providing ood_auth_map.regex
2.0 no longer provides /opt/ood/ood_auth_map/bin/ood_auth_map.regex, the 1.8- default user_map_cmd in ood_portal.yml.
Most sites should be able to use user_map_match instead. You can still use user_map_cmd, only you’ll have to write your own in a language of your choice.
Warning
lua patterns may not be sufficient because they are not regular expressions. For example they do not support boolean OR | operators. If you need such functionality you may find python, perl, ruby (SCL or system installed) or even bash commands that suite your needs.
See the documentation on user_map_match for more information on it.
SCL Ruby no longer available to apache
Related to the ood_auth_map.regex change above, apache no longer relies on the SCL version of Ruby. This means that Ruby 2.7 is unavailable to apache and consequently any user_map_cmd you employ.
Should you need Ruby 2.7 in any commands or scripts that apache calls, the best mitigation is to employ a wrapper script that can load rh-ruby27.
App sharing landing page
If your site has enabled app sharing through OOD_APP_SHARING the dashboard’s landing page will no longer show these app icons by default.
Your site will need to use the pinned apps feature to have the same look as 1.8.20-. Here is the relevant configuration you’ll need to provide to have a comparable landing page layout.
# /etc/ood/config/ondemand.d/ondemand.yml
pinned_apps:
  - 'usr/*'

pinned_apps_group_by: 'category'
See the documentation on pinning apps to the dashboard for more details.
Ruby and bundler updates
Open OnDemand 2.0 now uses Ruby 2.7, up from 2.5. If you have Passenger apps that have been built against 2.5, these will need to be rebuilt against 2.7.
This release also updates bundler to 2.1.4, up from 1.17.3. These versions are incompatible with each other, so passenger apps will also need to update their bundler dependencies.
ActiveJobs configuration changes
Because ActiveJobs is now integrated with the Dashboard app, configuration files are no longer being read from /etc/ood/config/apps/activejobs.
If you have initializers here in this directory, they need to move to /etc/ood/config/apps/dashboard/initializers. Similarly views, if any, need to move to /etc/ood/config/apps/dashboard/views.
If you used the class Filter to add or modify the filter menus in an initializer, this now needs to be ActiveJobs::Filter.
Files app configuration changes
Because Files app is now integrated with the Dashboard app, configurations in /etc/ood/config/apps/files need to move to /etc/ood/config/apps/dashboard for them to take effect.
The use of the environment variable OOD_SHELL to hide the Terminal button has been deprecated and can now be set with the files_enable_shell_button parameter in the /etc/ood/config/ondemand.d/*.yml file.
Changes to the interactive cards
The interactive sessions cards have changed with the bootstrap 4 upgrade. If your site uses complex logic in your view.html.erb you may have to change that. Here are the two changes that may affect your site.
The panel css classes no longer exist. These have been replaced by card. Here are examples in both plain javascript and jquery of what you may have and how it would need to change.
// there is no closes panel to this element anymore. This won't work, because
// there are no elements with a 'panel' css class.
document.getElementById("someElementId").closest(".panel").id;

// search for the closest element with a card class instead
document.getElementById("someElementId").closest(".card").id;

// the same thing in jquery
$("#someElementId").closest(".card")[0].id
The id of the card divs has changed to prepend id_ to them to fix some issues in Bootstrap-4. So if you use <%= session_id > to query for elements you will either need to prepend id_ to that or change the query to look for the data-id attribute of a div.
Note
<%= session_id > doesn’t work directly. You would need to pass it back through the conn_params for it to be usable in this view.
// searching for cards like this will no longer work because the id of the cards has changed.
document.getElementById("<= session_id >");
$("#<= session_id >"); // same thing in jquery


// you will now have to prepend the string 'id_' to them
document.getElementById("id_<= session_id >");
$("#id_<= session_id >"); // same thing in jquery

// the original session id is still stored in the attribute data-id, so this
// works in jquery
$("div[data-id='<%= session_id >']")
Upgrade directions
Warning
As always please update the development or test instances of OnDemand installed at your center first to test and verify before you modify the production instance.
Warning
The OnDemand upgrade has only been tested going from 1.8.x to 2.0.x.
Update OnDemand release RPM
sudo yum install -y https://yum.osc.edu/ondemand/2.0/ondemand-release-web-2.0-1.noarch.rpm
Enable dependency repos
CentOS/RHEL 8 only
sudo dnf module reset ruby
sudo dnf module enable ruby:2.7
sudo dnf module reset nodejs
sudo dnf module enable nodejs:12
RedHat 8 only
sudo subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms
CentOS 8 only
sudo dnf config-manager --set-enabled powertools
CentOS/RHEL 7 only
sudo yum install epel-release
Update OnDemand
sudo yum clean all
sudo yum update ondemand
(Optional) If using Dex based authentication, update the ondemand-dex package.
sudo yum update ondemand-dex
Update Apache configuration and restart Apache.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
CentOS/RHEL 8 only
sudo systemctl try-restart httpd
CentOS/RHEL 7 only
sudo systemctl try-restart httpd24-httpd.service
(Optional) If ondemand-dex was installed, restart the ondemand-dex service.
sudo systemctl try-restart ondemand-dex.service
(Optional) If ondemand-selinux was installed, see SELinux after Updates
Force all PUNs to restart
sudo /opt/ood/nginx_stage/sbin/nginx_stage nginx_clean -f
(Optional) Remove old dependencies from prior versions of OOD if they are not used by other applications.
Warning
See Dependency updates warning before uninstalling old Ruby versions.
CentOS/RHEL 7 only
sudo yum remove rh-ruby25\* rh-nodejs10\*
Details
Pinned Apps: Enhanced app launch interface using large app icons on the dashboard
As the number of apps increases and the sophistication of the typical user decreases - now including even undergraduate students using OnDemand in the classroom - it has become desirable to be able to present only a small subset of the apps that are relevant for a particular user.
2.0 now allows sites to pin a grid of application icons to the dashboard for easy access and to a subset of apps that you want to feature. The grid layout of application icons is meant to give users a desktop look and feel to the dashboard.
There are several strategies available to choose which apps to pin. For example, metadata in the app manifests could specify a field_of_science attribute, and then the pinned apps could be configured to display all apps with the field_of_science being “Biology”. The configuration for pinned apps can be made dynamic using ERB so it can be changed based on which user or group is accessing the dashboard. Pinned apps can also further be grouped by a particular attribute.
See the documentation on pinning apps to the dashboard for details.
Custom dashboard widgets and layout
See the documentation on customizing dashboard layouts for details.
Adding metadata to app manifests
App manifest files now allow for metadata fields for grouping and display in the all apps table. See documentation on manifest files for more details.
Shell app now has themes
The shell app now allows for users to choose a color theme other than the default and ships with thirteen extra themes.
Configurations in an ondemand.d directory
We’ve added an ondemand.d directory to start moving configurations there. Some new features for 2.0 rely on configurations read from files in this directory.
See the documentation for the ondemand.d configurations for all the available configurations.
Tighter integration between the Dashboard, Active Jobs, and Files apps
In OnDemand 1.8, the Dashboard, Active Jobs, Files, and File Editor apps were all served by separate Passenger application processes. These are all now served by a single Passenger application process per user.
This change has the following effects:
The URL has changed, but redirects from the old URLs should still work for backwards compatibility.
The navbar and branding across the dashboard is visible in Active Jobs and File Editor
the Active Jobs and Files apps both load without opening a new window
the Active Jobs and Files apps load much faster than before
Warning
Configuration for Active Jobs and Files apps have changed slightly and need to be updated for 2.0. See Breaking Changes above for details.
New File Manager app
The Files app in 1.8 was a fork of https://github.com/coderaiser/cloudcmd that was difficult to maintain. The new Files app is rewritten in Ruby and integrated into the Dashboard app. The look and feel has been updated to use Bootstrap 4 and the OnDemand navbar displays above the interface.
New features:
Modified at column now shows date and time
Columns are sortable by size, date, name, type, etc.
Owner column displays the actual username instead of just the UID
Uploads now managed with Uppy.js which provides a preview window prior to uploading files
Copy path button provides easy way to copy the current directory path to clipboard
Copy, Move, and Delete events now log details of the action requested in the per user NGINX logs
Copy, Move workflow includes a new visual display of the files selected to copy or move
Filter box to filter the list of files by inserted text
Changes:
The left hand navigation tree is replaced with a list of the file location shortcuts
Instead of a “..” row to navigate up, there is an “up” button to the left of the path
Buttons that apply to only one file or directory were moved to a button dropdown to the right of each filename
“Change directory” button replaced “Go to” button
Open in Terminal now displays split dropdown button to ssh to any available login host without any extra configuration required. Previously this was done by setting an SSH_HOSTS env var
See the files app configuration changes for any changes you’ll need to update to the configurations of this new app.
Changes in All Apps page layout
The ‘All Apps’ page is now a filterable table instead of cards. Note that new columns will be dynamically added by adding metadata to app manifests.
ERB formats for Message of the day
The message of the day text and markdown formats now support ERB rendering for a more dynamic message being rendered. See the documentation on Message of the Day for more information.
Control whether an app link opens in a new window using manifest attribute
In 1.8, all links to apps that are separate Passenger processes open in a new window or tab. The rationale for this was that these apps do not share the navigational context with the Dashboard app - in particular the navbar is not present.
By adding to the manifest.yml new_window: false the app is indicating it provides enough navigational context for the user to not get lost and the Dashboard will not open in new window.
This feature is used by the Files and Active Jobs apps in 2.0.
Memcached Ruby gem available for use in apps
The “dalli” Ruby gem for interfacing with memcached can now be used in batch connect apps though it needs to be explicitly required using a custom initializer or in the form or submit erb files.
Dependency updates
This release updates the following dependencies:
Ruby 2.7
NodeJS 12
Passenger 6.0.7
NGINX 1.18.0
Warning
The change in Ruby version means any Ruby based apps that are not provided by the OnDemand RPM must be rebuilt.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.8-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
Special thanks
Upgrading from v1.7
Upgrading from v1.6
Details
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.8 Release Notes
Edit on GitHub
v1.8 Release Notes
Highlights in 1.8:
Beta XDMoD integration in the dashboard
Default authentication is now handled by Dex
Support mod_auth_openidc configuration via ood-portal-generator
Beta CCQ Scheduler support
Retain completed jobs panel for debugging
Batch Connect apps now support multiple clusters
Batch Connect apps now support disabling caching on fields
Extended view support for GridEngine clusters
Torque and Slurm schedulers now support QoS fields
Shell hosts are now protected behind allowlists
Chinese localization
Ability to add additional info to batch connect app
Support for SVG dashboard logos
Support for new Native VNC views
Better max file upload support
Drop IE 11 support
Added Sinatra Ruby Gems into ondemand-gems for other apps to use
Streamlined copy and paste in noVNC for Chrome
Special thanks
Special thanks to https://github.com/374365283 and https://github.com/flybirdkh of Shanghai Jiao Tong University (https://hpc.sjtu.edu.cn/) for Chinese localization!
Thanks to Ben Plessinger and the whole University of Buffalo Center for Computational Research team for help in XDMoD integration.
Upgrading from v1.7
Before upgrading to v1.8, please consider the following:
Warning
Shell hosts are now protected behind allowlists. After upgrading, you may need to set a default SSH host and add the compute nodes to the allowlists, as well as any other hosts you want to enable access to through the Shell app that are not already specified in the cluster config. See the entry in the release notes for more information.
If upgrading from OnDemand 1.5.x or older you must upgrade to 1.6.x before upgrading to 1.7. See directions for upgrading from 1.4 to 1.5 (v1.5 Release Notes) and from 1.5 to 1.6 (v1.6 Release Notes).
As always please update the development or test instances of OnDemand installed at your center first to test and verify before you modify the production instance.
Update OnDemand release RPM
sudo yum install -y https://yum.osc.edu/ondemand/1.8/ondemand-release-web-1.8-1.noarch.rpm
Update OnDemand
sudo yum clean all
sudo yum update ondemand
(Optional) If previously using Apache’s Basic Auth, for example with LDAP, it is recommended to switch to Dex Authentication by installing the ondemand-dex package.
sudo yum install ondemand-dex
Warning
The configuration for Dex will need to be made to /etc/ood/config/ood_portal.yml with your needed LDAP configuration and updates to both Dex and Apache configurations. See Configuring OnDemand Dex for LDAP for details on configuration of LDAP.
Update Apache configuration and restart Apache.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl try-restart httpd24-httpd.service httpd24-htcacheclean.service
(Optional) If ondemand-dex was installed, you must enable and start the ondemand-dex service.
sudo systemctl enable ondemand-dex.service
sudo systemctl start ondemand-dex.service
Upgrading from v1.6
Due to changes with ood-portal-generator it is necessary to run update_ood_portal with --force flag if upgrading from v1.6 of OnDemand to v1.8.
Details
Beta XDMoD integration in the dashboard
If your site also uses XDMoD with the Job Performance module (formerlly called SUPReMM) for job performance analysis, you can configure OnDemandOpen OnDemand to display the Job Efficiency reports from XDMoD on the OnDemand dashboard.
See the documentation on enabling XDMoD integration for more details.
Default authentication is now handled by Dex
The default authentication mechanism for OnDemand is now using the OIDC provider Dex. The Dex authentication will replace Apache’s Basic Auth. Sites wishing to continue using LDAP authentication or other forms of Basic Auth are recommended to configure Dex. See Dex Authentication for details on OnDemand Dex.
You no longer need to do DISABLE_SAFARI_BASIC_AUTH_WARNING=1 and you can safely remove this from the configuration as this ENV var will be ignored.
Support mod_auth_openidc configuration via ood-portal-generator
The Open OnDemand Portal ood_portal.yml file now supports defining mod_auth_openidc configurations directly.
Beta CCQ Scheduler support
We now have beta Cloudy Cluster support for their ccq scheduler. You can find documentation on how to configure the cluster here.
Retain completed jobs panel for debugging
When an interactive job completes, its panel will now remain in the view. This is to allow users and administrators to debug failed jobs by keeping the session id links in view.
Batch Connect apps now support multiple clusters
Batch connect applications now support multiple clusters in their configuration instead of just one.
Where previous configuration look like this, with only a single cluster.
cluster: "my_cluster"
Configurations will now accept an array like the example below. This will create a dropdown select menu item at the top of the form where users can choose between the two options.
cluster:
  - "my_cluster"
  - "my_other_cluster"
See the documentation on all the ways to configure which cluster to submit to.
Batch Connect apps now support disabling caching on fields
When a user submits the web form for an interactive app (batch connect) the form values the user set are stored in a cache file that is used to pre-populate the web form in the future. In some cases, setting the default value of the form field to a previously used value is undesirable. You can now disable this caching feature for every app, on a per app basis, or on a per field basis.
See the documentation on attribute cache enabling for more details.
Extended view support for GridEngine clusters
In the Active Jobs app, similar to Torque and Slurm jobs, SGE jobs will now have a details view available where the user can see various details about their job such as walltime, Total CPUs, etc. The view is made visible by clicking on the arrow on the far left of the table row corresponding to the job.
The data seen in extended view is extracted from the command qstat -j -r -xml.
Torque and Slurm schedulers now support QoS fields
Torque and Slurm schedulers now support the quality of service (QoS) fields.
qos is now an acceptable script attribute like so:
script:
  qos: 'best'
In Torque this translates to -l qos=best and in Slurm it is --qos best.
Shell hosts are now protected behind allowlists
Shell hosts are now protected behind allowlists. This means administrators now need to explicitly add hosts to an allowlist for users to be able to access them through the shell app.
Any login host of a cluster config will be allowed, assuming that cluster is not configured as “hidden” in the metadata section of the cluster config. However, administrators will need to add a configuration for compute nodes and any additional hosts they wish to allow access to.
Administrators should also configure the default ssh host if they’ve not already done so because ‘localhost’ is no longer the out of the box default.
See the documentation for setting the default ssh host and the documentation for setting the allowlist for more details.
Chinese localization
The Chinese localization zh-CN is now available in the dashboard and job composer applications for sites who wish to use it.
To enable it, simply set the OOD_LOCALE environment variable globally in /etc/ood/config/nginx_stage.yml
pun_custom_env:
   OOD_LOCALE: "zh-CN"
Ability to add additional info to batch connect app
You can now add an info.html.erb file to an interactive app (batch connect) directory and it will render and display in the job panel. This is useful for providing documentation links for an app.q See the documentation on info.html.erb for more details.
Support for SVG dashboard logos
Logos can now be SVG images and controlled through the OOD_DASHBOARD_LOGO_HEIGHT configuration to resize them. See documentation on branding for form information.
Support for new Native VNC views
Sites can now define instructions for connecting to VNC interactive jobs using a native VNC client instead of using NoVNC through the browser.
More details on this feature can be found here.
Better max file upload support
While FILE_UPLOAD_MAX configuration has existed for some time, 1.8 adds the corresponding nginx configuration so that sites can set the upload max to settings larger than 10 GiB.
See the section in the customization page for more details.
Drop IE 11 support
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
IE 11 support was officially dropped. See Browser Requirements.
Added Sinatra Ruby Gems into ondemand-gems for other apps to use
Related Ruby gems for the micro-webframework “Sinatra” were added to the Dashboard Gemfile to ensure they are included in the ondemand-gems RPM. Simple applications like the Passenger status app featured in the Passenger app development tutorial can now be run without needing to install gem dependencies into the application directory. The following gems were added for this purpose:
gem "sinatra", require: false
gem "sinatra-contrib", require: false
gem "erubi", require: false
Streamlined copy and paste in noVNC for Chrome
Copy and pasting now works out of the box in Chrome. An issue with copy and pasting large clipboard buffers into noVNC applications on Chrome was fixed in version 1.8.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.7-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
Special thanks
Upgrading from v1.6
Upgrading from v1.5
Details
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.7 Release Notes
Edit on GitHub
v1.7 Release Notes
Highlights in 1.7:
Support running OnDemand with SELinux
Update project dependencies
Drop EL6 and add EL8 support
Added the Linux Host Adapter
Show account balance warnings
Job Composer and Active Jobs match Dashboard Branding
Titles for Files menu entries
Documentation for Keycloak as identity broker with CILogon and Keycloak with Duo 2FA
Add Grafana support for ActiveJobs app
Improvements to ood-portal-generator
Add an ssh wrapper to the shell app
Regenerate ood-portal.conf with every apache restart
Support sanitizing job names
nginx_clean support for a specific user
Dashboard now alerts on malformed cluster configs
Job composer now shows suggested scripts
Add ability to disable SSH to compute node link in batch connect session card
Reduced installation size by 30 percent
New shared OnDemand gem sets
Special thanks
Special thanks to these contributors (alpha by first name):
Bart Verheyde @baverhey
Guilherme Maluf Balzana @guimaluf
Jason Buechler @jasonbuechler
Shawn Rice @zooley
If you contributed to the 1.7 OnDemand release and you are not on the core team and your name is not listed here please let us know and we will add you.
Upgrading from v1.6
Warning
In v1.7 support for CentOS/RedHat 6 has been dropped
Before upgrading to v1.7, please consider the following:
If upgrading from OnDemand 1.3.x or older you must upgrade to 1.6.x before upgrading to 1.7. See directions for upgrading from 1.4 to 1.5 (v1.5 Release Notes) and from 1.5 to 1.6 (v1.6 Release Notes).
As always please update the development or test instances of OnDemand installed at your center first to test and verify before you modify the production instance.
All running PUNs must be restarted after the upgrade due to upgrading to new versions of Passenger and Ruby. It’s recommended to schedule an short outage of your OnDemand instance to perform this upgrade.
Update OnDemand release RPM
sudo yum install -y https://yum.osc.edu/ondemand/1.7/ondemand-release-web-1.7-1.noarch.rpm
Update OnDemand
sudo yum clean all
sudo yum update ondemand
Update Apache configuration and restart Apache.
sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal --force
sudo systemctl try-restart httpd24-httpd.service httpd24-htcacheclean.service
Warning
Due to changes with ood-portal-generator it is necessary to run update_ood_portal with --force flag after upgrading to OnDemand 1.7. The RPM upgrade will generate /opt/rh/httpd24/root/etc/httpd/conf.d/ood-portal.conf.new. If there are custom manual changes made to /opt/rh/httpd24/root/etc/httpd/conf.d/ood-portal.conf it will be necessary to merge those changes in after running update_ood_portal --force.
Force all PUNs to restart
sudo /opt/ood/nginx_stage/sbin/nginx_stage nginx_clean -f
Optionally remove old dependencies from prior versions of OOD if they are not used by other applications.
sudo yum remove rh-ruby24\* rh-nodejs6\* rh-git29\*
Upgrading from v1.5
Follow the directions for upgrading to v1.6 first (v1.6 Release Notes). After the upgrade is complete and working, follow the directions above.
Details
Support running OnDemand with SELinux
Beta support for running OnDemand with SELinux has been added. Support is enabled by installing the ondemand-selinux package. For details see SELinux
Warning
If the ondemand-selinux package was installed from the OnDemand 1.6 release there are several changes that must be addressed manually. Several SELinux booleans were enabled by the ondemand-selinux package and are no longer needed by OnDemand. The following SELinux booleans can be disabled if not used outside OnDemand:
sudo setsebool -P httpd_execmem=off
sudo setsebool -P httpd_unified=off
sudo setsebool -P httpd_enable_homedirs=off
sudo setsebool -P httpd_read_user_content=off
Update project dependencies
Table 11 Project Dependencies
Dependency
Old Version
New Version
Passenger
5.3.7
6.0.4
NGINX
1.14.0
1.17.3
Ruby
2.4
2.5
NodeJS
6
10
Rails
4.2
5.2
noVNC
1.0.0
1.1.0
Drop EL6 and add EL8 support
OnDemand has dropped support for CentOS/RedHat 6 and added support for CentOS/RedHat 8.
Added the Linux Host Adapter
Support for running jobs directly on Linux hosts has been added. This means interactive jobs can now run on a login node instead of through a batch scheduler.
See the documentation for the LinuxHost. for more details.
Show account balance warnings
The dashboard can now show account balance warnings if the users’ account balance is some threshold.
See these docs for more details on how to enable this feature.
Job Composer and Active Jobs match Dashboard Branding
The Job Composer and Active Jobs apps’ top navigation bar now share the same branding scheme configured for the dashboard.
There’s no additional configuration required for this other than what’s documented here.
Special thanks to @zooley (Shawn Rice) for implementing this feature!
Maintenance mode
OOD can be put into ‘maintenance mode’ where it serves a static page to either all users or a subset (staff on a VPN for example). This static page informs users that maintenance is underway while administrators perform disruptive tasks.
See these docs on how to configure and enable this feature.
Titles for Files menu entries
The shortcuts in the files dropdown menu can now show an optional title along with the directory path. The original documentation on this feature has been updated to reflect the new options.
Documentation for Keycloak as identity broker with CILogon and Keycloak with Duo 2FA
Documentation for Keycloak as identity broker with CILogon has been added in the documentation entitled ‘Configure Keycloak with CILogon’.
Documentation for Keycloak with Duo two factor authentication has been updated in the documentation entitled ‘Two Factor Auth using Duo with Keycloak’.
Add Grafana support for ActiveJobs app
OnDemand’s ActiveJobs app can display graphs for jobs that are pulled from Grafana. Details on how to configure Grafana support are in these docs.
Improvements to ood-portal-generator
The ood-portal-generator app has been rewritten in Ruby and extensive testing added. Checksums generated for ood-portal.conf now exclude comments.
Add an ssh wrapper to the shell app
An ssh wrapper script can now be used instead of just the ssh command in the shell app. See how to configure this here.
Special thanks to @baverhey (Bart Verheyde) for implementing this feature!
Regenerate ood-portal.conf with every apache restart
Systemd will now regenerate the ood-portal.conf before every apache restart. This means administrators can now edit the ood_portal.yml configuration and then restart httpd directly without having to do the additional step of running the ood-portal-generator.
Apache httpd will read the new configuration, because a new ood-portal.conf will have been written just before restarting.
However you will have to follow the upgrade instructions (above), and then this will be available. Specifically updating the ood portal through sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal --force.
This feature relies on checksums generated by ood-portal-generator. If the checksums differ (i.e., ood-portal.conf has been edited by hand, outside of the ood-portal-generator program) this will fail and you’ll have to force an update through update_ood_portal --force.
Support sanitizing job names
Administrators can now set the OOD_JOB_NAME_ILLEGAL_CHARS environment variable to prevent characters from being used in job names. For example if you do not want to use / in job names (as is the case with some Grid Engine versions) you would set OOD_JOB_NAME_ILLEGAL_CHARS: '/' in the pun_custom_env attribute of nginx_stage.yml.
nginx_clean support for a specific user
The nginx_stage nginx_clean command now supports a -u or --user option so it may kill a specific users’ PUN. For example nginx_stage nginx_clean -u johndoe would only kill johndoe’s PUN and disregard all the others.
Dashboard now alerts on malformed cluster configs
Prior to 1.7 the dashboard would not start if there was a cluster cluster definition file (the files in /etc/ood/config/clusters.d/) that had invalid yaml.
The dashboard now handles this gracefully and shows an error message to the user stating that this file is unusable and should indicate the line of the file that is problematic.
Job composer now shows suggested scripts
When changing the job script in the job composer the user is now presented with a dropdown of ‘Suggested Files’ first along with ‘Other valid files’.
Files in folder will be suggested if they match any of these criteria:
Have one of these extensions: “.sh”, “.job”, “.slurm”, “.batch”, “.qsub”, “.sbatch”, “.srun”, “.bsub”
The file starts with a shebang line (#!)
Has a resource manager’s directive (#PBS, #SBATCH, #BSUB or #$) in the first 1000 characters.
Other valid files only have to meet a size requirement of less than OOD_MAX_SCRIPT_SIZE_KB which defaults to 65 (meaning 65 kb).
Add ability to disable SSH to compute node link in batch connect session card
Administrators can now disable the link that appears in the batch connects’ card to ssh into the compute node that the job is running on. This is helpful for sites that don’t allow regular users to shell into compute nodes.
To do so, simply set OOD_BC_SSH_TO_COMPUTE_NODE=0 (or ‘false’ or ‘off’) in /etc/ood/config/apps/dashboard/env.
Reduced installation size by 30 percent
We reduced the size of the main OnDemand RPM by nearly 40%.
The 1.6 ondemand-1.6.22-1.el7.x86_64.rpm was 162M and in 1.7 this has been reduced by 63M to a total of 99M, split between two RPMs: ondemand-gems-1.7.10-1.7.10-2.el7.x86_64.rpm with 68M, and ondemand-1.7.10-2.el7.x86_64.rpm with 31M. This is in part due to switching to a monorepo at https://github.com/osc/ondemand and installing all the gems into a central shared location, installed using the new ondemand-gems RPM.
The resulting sizes of the two main install directories, /opt/ood and /var/www/ood/apps/sys, were in total reduced by 181M:
$ cat /opt/ood/VERSION
v1.6.22
$ sudo du -h -s  -x /var/www/ood/apps/sys /opt/ood
592M /var/www/ood/apps/sys
17M  /opt/ood
vs
$ cat /opt/ood/VERSION
v1.7.10-2
$ sudo du -h -s  -x /var/www/ood/apps/sys /opt/ood
172M /var/www/ood/apps/sys
256M /opt/ood
New shared OnDemand gem sets
The new ondemand-gems RPMs allow other Passenger apps to be developed using the same gems that the core OnDemand apps use. If you do scl enable ondemand and then gem list you can see all the gems available.
Because the ondemand-gems RPMs will include the version in the RPM name, it is possible to install multiple versions of these RPMs on the same system. For example, “ondemand-gems-1.7.10” is the name and “1.7.10-2.el7.x86_64.rpm” is the version of ondemand-gems-1.7.10-1.7.10-2.el7.x86_64.rpm. That way you can upgrade to newer versions of OnDemand but still have the ability to provide apps access to older gems by installing the older gem sets.
Having multiple versions of ondemand-gems RPMs ensure that any custom apps relying on gems provided by OnDemand will not break as OnDemand is upgraded as previous installs of ondemand-gems will remain installed when OnDemand is upgraded.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.6-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.6 Release Notes
Edit on GitHub
v1.6 Release Notes
Highlights in 1.6:
OnDemand passed a security audit
Added job array support for LSF and PBSPro adapters
Improved Slurm and Grid Engine adapters
Added localization options to the Dashboard and Job Composer
Added rendering of HTML or Markdown in Job Composer template manifests
Added support for fetching quota from a URL
Added VNC quality and compression controls
Open Shell to compute node that a VNC job is running on
Changed ‘Open in Terminal’ button to offer multiple options when OOD_SSH_HOSTS is set
Enable BatchConnect applications to raise errors after form submission
Added version strings to Dashboard
Changed ngnix_stage to always remove stale PID files
Add ability to disable RewriteEngine in Apache config
Many bug fixes
Upgrading from v1.5
Warning
As always please update the development or test instances of OnDemand installed at your center first before you modify the production instance.
Update OnDemand release RPM
sudo yum install -y https://yum.osc.edu/ondemand/1.6/ondemand-release-web-1.6-4.noarch.rpm
Update OnDemand
sudo yum clean all
sudo yum update ondemand
Infrastructure Changes
Changed ngnix_stage to always remove stale PID files
Add ability to disable RewriteEngine in Apache config
Application Version Changes
Table 12 Application Versions
App
Version
Dashboard App
1.31.0 → 1.35.0 (diff)
Shell App
1.4.2 → 1.4.6 (diff)
Files App
1.5.1 → 1.5.3 (diff)
File Editor App
1.4.1 → 1.4.3 (diff)
Active Jobs App
1.7.0 → 1.9.2 (diff)
Job Composer App
2.11.0 → 2.15.0 (diff)
Desktops App
0.2.0 → 0.2.1 (diff)
Table 12 lists the app version changes between OnDemand v1.5.3 and OnDemand 1.6.7
Details
OnDemand passed a security audit
At the end of 2018 TrustedCI completed a security audit of OnDemand and quoting the major findings of the audit: “No major issues were found in a comprehensive evaluation of the architecture and critical resources in Open OnDemand, and analysis of potential code weaknesses in critical components.”
Thanks to Elisa Heymann, Joel Atkins and Barton P. Miller for performing the audit! The full report is available as a PDF at openondemand.org.
Added job array support for LSF and PBSPro adapters
Job Composer and Active Jobs now support job arrays for all adapters that OnDemand supports including LSF and PBSPro.
Improved Slurm and Grid Engine adapters
To improve the reliability of parsing squeue output the record delimiter has been changed from newline to the ASCII/Unicode record separator.
To match the behavior of the other adapters the Grid Engine adapter will now attempt to detect whether the user has set the working directory of a job. If the user has not passed the -wd or -cwd flags in the first 1024 characters of their job script then the adapter will append -cwd to the arguments passed to qsub. Fixed error where the Grid Engine adapter would throw an error when getting information on a job that had exited the queue.
Added localization options to the Dashboard and Job Composer
Many more strings have been internationalized in the Dashboard and the Job Composer. This work does not cover all the strings in the app, but enables localization of the most important ones.
See Customize Text in OnDemand for details.
Added rendering of HTML or Markdown in Job Composer template manifests
If the environment variable RENDER_TEMPLATE_NOTES_AS_MARKDOWN is set to a truthy value then job template manifests displayed in the Job Composer that are written in Markdown will be run through the RedCarpet renderer. HTML values will always be rendered as HTML. This will allow sites to embed images or links to documentation in their templates. (ood-mjobs#291)
Added support for fetching quota from a URL
File usage quota warnings displayed on the Dashboard may now use a URL as their data source. Thanks to Dan Dietz at Purdue for the initial work on this feature.
Added VNC quality and compression controls
Controls to change the VNC compression and quality have been added to interactive session card:
This can help with users who want to sacrifice quality for a better connection speed and others who have great connection speed and want to maximize the quality.
Open Shell to compute node that a VNC job is running on
For running interactive sessions, the host name becomes a clickable link to open in the shell app:
Changed ‘Open in Terminal’ button to offer multiple options when OOD_SSH_HOSTS is set
In the Files app, if the environment variable OOD_SSH_HOSTS is set to a comma delimited value of host:title, then the Open in Terminal button will display a dropdown of hosts to ssh to, instead of ssh-ing to the default host. For example, in the image below I set OOD_SSH_HOSTS="owens.osc.edu:Owens,pitzer.osc.edu:Pitzer,ruby.osc.edu:Ruby":
Note
In a future version of OnDemand we will change this app to load the hosts from the cluster configs.
Enable BatchConnect applications to raise errors after form submission
In the submit.yml.erb of an interactive app, if you raise an exception, the submission process will be aborted and the user will be shown the error. This enables interactive apps to support basic form submission validation.
Added version strings to Dashboard
The Dashboard will now display the version of OnDemand and the Dashboard in the footer. Interactive applications will display their versions next to their title on their launch page.
Changed ngnix_stage to always remove stale PID files
nginx_stage clean will now remove PID and socket files for processes that are not longer running. Whenever a stale PID files is deleted its removal is reported on stderr. (ondemand#11)
Add ability to disable RewriteEngine in Apache config
You can now omit enabling the RewriteEngine by adding use_rewrites: false to the /etc/ood/config/ood_portal.yml config file and re-running the sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal to update the ood-portal.conf Apache config.
Many bug fixes
Setting the environmental variable OOD_SHELL to an empty string will now hide the Open in Terminal button as documented. (ood-fileexplorer#191)
Job Composer logs will no longer contain complaints about gems not being eager loaded. (ood-myjobs#285)
nginx_stage will no longer crash when one of the pun_custom_env values in /etc/ood/config/nginx_stage.yml is a number and not a string. (ondemand#26)
In Active Jobs, display nothing in “Account” column if no account set for the job, instead of displaying (null).
Fixed Time Used format for Active Jobs: In 1.5 the Time Used field in Active Jobs was the number of seconds elapsed as an integer. In 1.6 this has been changed back to HH:MM:SS.
Fixed Job Composer layout when job name is long: Job names that were exceptionally long and did not contain ‘break-able’ punctuation could break the layout of the Job Composer’s data table. The table has been updated so that job names wrap and will break mid-word if necessary.
Fixed Shell App paste issues in MS Edge and Firefox (#62, #59, and #64)
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.5-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.5 Release Notes
Edit on GitHub
v1.5 Release Notes
Highlights in 1.5:
Add ondemand SCL and use SCL nginx and passenger
Performance improvements to Active Jobs
Basic job array support for Slurm, Torque, and SGE
Easier customization of home page text
RStudio with varying versions of R
Peer to peer app sharing
Documentation update for Keycloak and Duo
Upgrading from v1.4
Warning
As always please update the development or test instances of OnDemand installed at your center first before you modify the production instance.
Update OnDemand release RPM
CentOS/RHEL 6
sudo yum install -y https://yum.osc.edu/ondemand/1.5/ondemand-release-web-1.5-1.el6.noarch.rpm
CentOS/RHEL 7
sudo yum install -y https://yum.osc.edu/ondemand/1.5/ondemand-release-web-1.5-1.el7.noarch.rpm
Update OnDemand
sudo yum clean all
sudo yum update ondemand
Warning
This step triggers the execution of update_ood_portal script from ood-portal-generator which results in /opt/rh/httpd24/root/etc/httpd/conf.d/ood-portal.conf being modified. Your previous ood-portal.conf file will be copied to a backup in the same directory, which you may need to restore if you have made custom modifications to this file.
Ensure that the resulting ood-portal.conf Apache config has SetEnv OOD_PUN_SOCKET_ROOT "/var/run/nginx" changed to SetEnv OOD_PUN_SOCKET_ROOT "/var/run/ondemand-nginx".
Warning
The nginx RPM used by ondemand in 1.4 is no longer maintained. If you use nginx outside of OnDemand it’s recommended to re-install using nginx from repositories such as EPEL after upgrading OnDemand to 1.5.
sudo yum downgrade nginx nginx-filesystem --disablerepo=ondemand-web
Optionally remove dependencies from prior versions of OOD if they are not used by other applications.
sudo yum remove nginx nginx-filesystem passenger
Clean up NGINX directories from prior versions of OOD
The ondemand RPM should have copied all the nginx configurations, tmp files and logs from their previous locations to their new locations if the defaults were not changed. Once the functionality of the OnDemand 1.5 upgrade is verified it is safe to remove these old paths.
Warning
If the host running OnDemand has other applications using NGINX then special care needs to be taken not to delete files belonging to the other applications.
sudo rm -rf /var/lib/nginx/config.rpmsave
sudo rm -rf /var/tmp/nginx/*
sudo rm -rf /var/log/nginx/*
Upgrading from v1.3
Warning
As always please update the development or test instances of OnDemand installed at your center first before you modify the production instance.
Update OnDemand release RPM
CentOS/RHEL 6
sudo yum install -y https://yum.osc.edu/ondemand/1.5/ondemand-release-web-1.5-1.el6.noarch.rpm
CentOS/RHEL 7
sudo yum install -y https://yum.osc.edu/ondemand/1.5/ondemand-release-web-1.5-1.el7.noarch.rpm
Update OnDemand
sudo yum clean all
sudo yum update ondemand
Warning
This step triggers the execution of update_ood_portal script from ood-portal-generator which results in /opt/rh/httpd24/root/etc/httpd/conf.d/ood-portal.conf being modified. Your previous ood-portal.conf file will be copied to a backup in the same directory, which you may need to restore if you have made custom modifications to this file.
Ensure that the resulting ood-portal.conf Apache config has SetEnv OOD_PUN_SOCKET_ROOT "/var/run/nginx" changed to SetEnv OOD_PUN_SOCKET_ROOT "/var/run/ondemand-nginx".
Optionally remove dependencies from prior versions of OOD
sudo yum remove nodejs010\* rh-passenger40\* rh-ruby22\* nginx16\* git19\* v8314\*
Clean up NGINX directories from prior versions of OOD
The ondemand RPM should have copied all the nginx configurations, tmp files and logs from their previous locations to their new locations if the defaults were not changed. Once the functionality of the OnDemand 1.5 upgrade is verified it is safe to remove these old paths.
Warning
If the host running OnDemand has other applications using NGINX then special care needs to be taken not to delete files belonging to the other applications.
sudo rm -rf /var/lib/nginx/config.rpmsave
sudo rm -rf /var/lib/nginx/tmp/*
sudo rm -rf /var/log/nginx/*
Rebuild any custom Node.js or Ruby apps
Since we upgraded to Ruby 2.4 from 2.2 and NodeJS 0.10 to NodeJS 6 any custom Passenger apps in Ruby or NodeJS that have their dependencies installed in vendor/bundle or node_modules will need to be reinstalled. Some code may have to be updated or dependency versions changed to work with the latest Ruby version.
For NodeJS apps:
For Ruby apps:
If you need a way to continue to still use Ruby 2.2 or a different version of NodeJS please post a question on our Discourse instance.
Verify Navbar contains all the apps you want.
The behavior changed from 1.3 to 1.5 so by default all categories of any sys app found appear as dropdown menus without the need for configuration changes.
As a result menus may appear that you do not expect, if previously you were relying on the “whitelist” functionality of the NavConfig.categories.
See Release 1.4 navbar config for details.
Verify Developer mode is configured how you want it
See Enabling App Development for an explanation of how developer mode has changed between 1.3 and 1.5 and how to configure things properly. For sites that have active developers, this will either be adding configuration to revert to 1.3’s functionality, or creating some directories and symlinks to enable specific app developers.
Infrastructure Version Changes
OnDemand’s infrastructure components have been merged into a monolithic repository. Component changelogs have been frozen and the parent repository will now track all infrastructure changes: OnDemand 1.5.2. Diff with 1.4.10
Application Version Changes
Table 13 Application Versions
App
Version
Dashboard App
1.30.2 → 1.31.0 (diff)
Shell App
Unchanged
Files App
Unchanged
File Editor App
Unchanged
Active Jobs App
1.6.9 → 1.7.0 (diff)
Job Composer App
2.10.2 → 2.11.0 (diff)
Desktops App
Unchanged
Table 13 lists the versions as well as the previous version it was updated from for each of the system web applications in this release.
Details
Add ondemand SCL and use SCL nginx and passenger
This upgrade adds a new ondemand software collection that is the only software collection needed to interact with OnDemand. This new softare collection will load all the collections needed by OnDemand. The Passenger and NGINX dependencies have been repackaged under this new ondemand SCL so those packages will no longer interfere with Passenger of NGINX packages from other repositories.
Warning
Several NGINX directories used by OnDemand have changed.
/var/lib/nginx to /var/lib/ondemand-nginx
/var/log/nginx to /var/log/ondemand-nginx
/var/tmp/nginx to /var/tmp/ondemand-nginx (1.4 to 1.5)
/var/lib/nginx/tmp to /var/tmp/ondemand-nginx (1.3 to 1.5)
Warning
nginx_stage now loads the ondemand SCL via /opt/ood/nginx_stage/etc/profile before loading /etc/ood/profile.
source scl_source enable ondemand
Performance improvements to Active Jobs
When displaying jobs from all clusters in Active Jobs, the app will now stream and display the job data for each cluster as it is retrieved, instead of waiting until all the clusters are queried. This takes advantage of the ability to read portions of an XHR response before the response has completed, which means you will only see the benefits in Chrome and Firefox.
Basic job array support for Slurm, Torque, and SGE
For Slurm, Torque, and SGE, a new text field has been added to the Job Options for the Job Composer app allowing you to specify arguments for requesting a job array when submitting a job. The apps have also been updated to gracefully handle querying jobs that are job arrays.
Note
Job array support will be added for PBSPro and LSF in the OnDemand 1.6 release.
Easier customization of home page text
Using Rails support for internationalization, we localized the html that shows the logo and tagline on the OnDemand home page, as well as the motd section title.
This enables admins to configure most of the home page html and MOTD section title by setting these strings in a locales fine under /etc/ood/config.
See Customize Text in OnDemand for details.
RStudio with varying versions of R
We added a new tutorial for setting up a Singularity based RStudio interactive app that replaces the need for proot and enables the version of RStudio and the version of R to vary.
See Add an RStudio App for details.
Peer to peer app sharing
Added documentation on peer to peer app sharing, a feature that when enabled allows privleged users to deploy OnDemand apps, both Passenger and Interactive, to their home directory (or another directory specified by the admin) so that other users (peers) can launch these apps. This is also known as “executable sharing” because it is similar to how a user can add another user’s script to the PATH and then execute it.
See App Sharing for details.
Documentation update for Keycloak and Duo
Updated OpenID Connect with KeyCloak on RHEL7 for Keycloak 4.8.3. Added documenation on setting up two factor authentication using Duo with Keycloak via SSSD (see Two Factor Auth using Duo with Keycloak).
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.4-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.4 Release Notes
Edit on GitHub
v1.4 Release Notes
Highlights in 1.4:
Upgrade to Ruby 2.4, NodeJS 6, Passenger 5
Security Enhancement - PUN autogenerates secret key base if none is set
Security Enhancement: App development mode is disabled by default
Security Enhancement: Enable whitelisting of directories in several core apps
Security Enhancement: Require SSH for all hosts in Shell app
Add ability to include Javascript in Batch Connect apps
Better environment setting
Customizable error pages for missing home dirs
Experimental SGE/UGE support
Fixed copy and paste issues in the Shell app for Firefox
Improve default discoverability of apps in the Dashboard’s navbar
Optional Quota warnings on dashboard
Slurm 18 support
Upgrading from v1.3
Enable EPEL and update OnDemand release RPM
CentOS/RHEL 6
sudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
sudo yum install -y https://yum.osc.edu/ondemand/1.4/ondemand-release-web-1.4-1.el6.noarch.rpm
CentOS/RHEL 7
sudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
sudo yum install -y https://yum.osc.edu/ondemand/1.4/ondemand-release-web-1.4-1.el7.noarch.rpm
Update OnDemand
sudo yum clean all
sudo yum update ondemand
Warning
The nginx RPM used by ondemand will upgrade the nginx RPMs provided by EPEL, if they are installed.
Rebuild any custom Node.js or Ruby apps
Since we upgraded to Ruby 2.4 from 2.2 and NodeJS 0.10 to NodeJS 6 any custom Passenger apps in Ruby or NodeJS that have their dependencies installed in vendor/bundle or node_modules will need to be reinstalled. Some code may have to be updated or dependency versions changed to work with the latest Ruby version.
For NodeJS apps:
For Ruby apps:
If you need a way to continue to still use Ruby 2.2 or a different version of NodeJS please post a question on our Discourse instance.
Verify Navbar contains all the apps you want.
The behavior changed from 1.3 to 1.4 so by default all categories of any sys app found appear as dropdown menus without the need for configuration changes.
As a result menus may appear that you do not expect, if previously you were relying on the “whitelist” functionality of the NavConfig.categories.
See Control which apps appear in the Dashboard Navbar for details.
Verify Developer mode is configured how you want it
See Enabling App Development for an explanation of how developer mode has changed between 1.3 and 1.4 and how to configure things properly. For sites that have active developers, this will either be adding configuration to revert to 1.3’s functionality, or creating some directories and symlinks to enable specific app developers.
Optionally remove dependencies from prior versions of OOD
sudo yum remove nodejs010\* rh-passenger40\* rh-ruby22\* nginx16\* git19\* v8314\*
Warning
As always please update the development or test instances of OnDemand installed at your center first before you modify the production instance. Remember, Ruby and Node have been upgraded, so existing custom apps may need to be re-built.
Infrastructure Version Changes
OnDemand’s infrastructure components have been merged into a monolithic repository. Component changelogs have been frozen and the parent repository will now track all infrastructure changes: OnDemand 1.4.9. Diff with 1.3.7
Application Version Changes
Table 14 Application Versions
App
Version
Dashboard App
1.26.2 → 1.30.2 (diff)
Shell App
1.3.1 → 1.4.2 (diff)
Files App
1.4.1 → 1.5.0 (diff)
File Editor App
1.3.3 → 1.4.0 (diff)
Active Jobs App
1.6.2 → 1.6.8 (diff)
Job Composer App
2.8.3 → 2.10.1 (diff)
Desktops App
Unchanged
Table 14 lists the versions as well as the previous version it was updated from for each of the system web applications in this release.
Details
Upgrade to Ruby 2.4, NodeJS 6, Passenger 5
This upgrade updates our dependencies to Software Collections Ruby 2.4 and NodeJS 6. Passenger is also seeing an upgrade to version 5, but until Passenger 5 is supported by SCL OSC will host the Passenger 5 and NGINX 1.14 RPMs which are built based on the Passenger RPM automation repo. A side effect of these dependency changes is that custom applications may need to be rebuilt before they will work.
Warning
The Per User NGINX temporary directory has been moved from /var/lib/nginx to /var/tmp/nginx due to an issue with more restrictive permissions with NGINX 1.14.
A consequence of this NGINX 1.14 upgrade is that NGINX directories like /var/log/nginx have become more restrictive - owned by the nginx user and set by default to 700.
Security Enhancement - PUN autogenerates secret key base if none is set
The PUN will autogenerate its own unique per-user secret key base string which is generated at first launch if it doesn’t exist. This is used by Rails apps to encrypt cookies and overrides the default one set in env.production.
Security Enhancement: App development mode is disabled by default
Development mode disabled by default: application development gives increased access to a system (e.g. allowing the user to open an interactive shell on the web node), and should only be enabled for trusted users. For details, see Enabling App Development.
Security Enhancement: Enable whitelisting of directories in several core apps
The file editor, file browser and job composer now support an optional whitelist of browseable/editable directories. Directories and files not in the whitelist will never be forbidden to users. The whitelist is controlled by the environment variable WHITELIST_PATH, which is best be defined by editing /etc/ood/config/nginx_stage.yml under the pun_custom_env map.
Security Enhancement: Require SSH for all hosts in Shell app
Prior to this release it was possible for OOD users to change the URL in the shell application and connect directly to the web node by starting a Bash shell on localhost. Given that this ability for arbitrary user access is counter intuitive to how web servers are typically managed, the exemption for localhost has been removed; users will always use SSH to connect to any host, allowing SSH access controls to work.
Add ability to include Javascript in Batch Connect apps
Batch Connect applications may now define a Javascript file to add interactive frontend functionality. Github OSC/ood-dashboard#426. The contents of this JavaScript file will be embedded in <script> tags at the bottom of the form below the Launch button.
For apps like the example Jupyter app whose form is defined in the form.yml, you can add a form.js file alongside the form.yml.
For “subapps” like bc_desktop where you have overrides defined in a custom_name.yml you can add a custom_name.js for that JavaScript file to be loaded by that app.
So for example, OSC has a Pitzer interactive desktop defined in this directory as pitzer.yml so we could add a pitzer.js file.
Better environment setting
The file /etc/ood/config/nginx_stage.yml now includes two methods to set the PUN environment. Populating the mapping pun_custom_env allows sites to define OOD specific environment variables that will be added to the PUN environment. Defining the sequence pun_custom_env_declarations confers the ability to define an arbitrary list of env vars to declare in the PUN config (so they are retained from whatever is set in /etc/ood/profile).
For example: nginx_stage_example.yml.
Customizable error pages for missing home dirs
Customizable error pages for missing home directory during the first login flow for sites using pam_mkhomedir.so. OOD Discourse: launching ondemand when home directory does not exist.
Experimental SGE/UGE support
A job adapter has been written that supports Sun Grid Engine derivatives. The adapter is known to be compatible with SGE 6.2u5 and Univa GE 8.0.1. Thanks to UCLA for donating access to Hoffman2 to aid in development of the adapter.
Fixed copy and paste issues in the Shell app for Firefox
Resolved a pair of issues (#48, #55) that caused problems with copy and paste in the Shell application.
Improve default discoverability of apps in the Dashboard’s navbar
Introduction of a whitelist mode for the Dashboard navbar which is disabled by default. This change means that by default, when deploying a new app, if properly configured it will appear in the Dashboard’s navigation menu without the need for changing configuration. OSC/ood-dashboard#295
For details please see Release 1.4 navbar config.
Optional Quota warnings on dashboard
The Dashboard can now display a configurable disk usage warning to the user if they approach a certain usage threshold. This feature is enabled by defining the environment variable OOD_QUOTA_PATH which can take a colon delimited path, and may be defined in /etc/ood/config/nginx_stage.yml under the custom_env map. The version 1 format for quota files is defined in the Dashboard README.
Slurm 18 Support
Slurm 18.x introduced a bug with the fields gres or tres in squeue output which broke prior versions of the Slurm adapter. The OOD team has both updated the OOD Slurm adapter to function normally despite the bug, and submitted a fix which Slurm will be releasing in a future version.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.3-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.3 Release Notes
Edit on GitHub
v1.3 Release Notes
Highlights in 1.3:
RPM based installation
Store configuration under /etc instead of under app directories
Config changes no longer require app rebuilds
Xfce support Interactive Desktops
Cluster config verification script
Ignore apps if they have a period in directory name
Enable multiple Dashboard announcements with embedded HTML
Open “help” links in new window
Make “Interactive Sessions” link top level item
Better debugging of Interactive Apps by logging shell commands
Job Composer: Optionally hide Account field in Job Options
Active Jobs: display list of nodes that a job is running on
Upgrading from v1.2
Warning
As always please update the development or test instances of OnDemand installed at your center first before you modify the production instance.
Note
The steps outlined below will only need to be done once when upgrading from versions <= 1.2 to 1.3. Future updates will be handled through the RPM going forward.
This RPM installation will want to overwrite any local configuration or modifications you may have made in earlier versions of OnDemand, so we will first start by making backups of OnDemand and our apps:
sudo mv /opt/ood /opt/ood.bak
sudo mv /var/www/ood/apps/sys /var/www/ood/apps/sys.bak
We have moved all configuration to be located underneath /etc/ood/config. This includes the YAML configuration file used to generate the Apache configuration file, the YAML configuration file used to generate the per-user NGINX (PUN) configuration files, and any configuration/customization files used for the individual OnDemand core apps.
So you will want to copy over the configuration files ahead of time for best results:
sudo cp $HOME/ood/src/ood-portal-generator/config.yml /etc/ood/config/ood_portal.yml
Warning
This assumes you were using the ood-portal-generator to generate the Apache configuration file under /opt/rh/httpd24/root/etc/httpd/conf.d/ood-portal.conf. If you haven’t been doing this before then now is a good time to start. Feel free to contact us if you have trouble with this.
Copy over our app configuration (if they exist).
mkdir -p /etc/ood/config/apps
[[ -e "/var/www/ood/apps/sys.bak/dashboard/.env.local" ]] \
  && sudo mkdir -p /etc/ood/config/apps/dashboard \
  && sudo cp /var/www/ood/apps/sys.bak/dashboard/.env.local /etc/ood/config/apps/dashboard/env
[[ -e "/var/www/ood/apps/sys.bak/activejobs/.env.local" ]] \
  && sudo mkdir -p /etc/ood/config/apps/activejobs \
  && sudo cp /var/www/ood/apps/sys.bak/activejobs/.env.local /etc/ood/config/apps/activejobs/env
[[ -e "/var/www/ood/apps/sys.bak/myjobs/.env.local" ]] \
  && sudo mkdir -p /etc/ood/config/apps/myjobs \
  && sudo cp /var/www/ood/apps/sys.bak/myjobs/.env.local /etc/ood/config/apps/myjobs/env
[[ -e "/var/www/ood/apps/sys.bak/file-editor/.env.local" ]] \
  && sudo mkdir -p /etc/ood/config/apps/file-editor \
  && sudo cp /var/www/ood/apps/sys.bak/file-editor/.env.local /etc/ood/config/apps/file-editor/env
[[ -e "/var/www/ood/apps/sys.bak/shell/.env.local" ]] \
  && sudo mkdir -p /etc/ood/config/apps/shell \
  && sudo cp /var/www/ood/apps/sys.bak/shell/.env /etc/ood/config/apps/shell/env
[[ -e "/var/www/ood/apps/sys.bak/files/.env.local" ]] \
  && sudo mkdir -p /etc/ood/config/apps/files \
  && sudo cp /var/www/ood/apps/sys.bak/files/.env /etc/ood/config/apps/files/env
Copy over any custom initializers you may have created (if they exist)
[[ -e "/var/www/ood/apps/sys.bak/dashboard/config/initializers/ood.rb" ]] \
  && sudo mkdir -p /etc/ood/config/apps/dashboard/initializers \
  && sudo cp /var/www/ood/apps/sys.bak/dashboard/config/initializers/ood.rb /etc/ood/config/apps/dashboard/initializers/ood.rb
[[ -e "/var/www/ood/apps/sys.bak/activejobs/config/initializers/filter.rb" ]] \
  && sudo mkdir -p /etc/ood/config/apps/activejobs/initializers \
  && sudo cp /var/www/ood/apps/sys.bak/activejobs/config/initializers/filter.rb /etc/ood/config/apps/activejobs/initializers/filter.rb
Copy over your Job Composer templates (if they exist)
[[ -e "/var/www/ood/apps/sys.bak/myjobs/templates" ]] \
  && sudo mkdir -p /etc/ood/config/apps/myjobs \
  && sudo cp -r /var/www/ood/apps/sys.bak/myjobs/templates /etc/ood/config/apps/myjobs/.
Copy over your local Interactive Desktop apps (if they exist)
[[ -e "/var/www/ood/apps/sys.bak/bc_desktop/local" ]] \
    && sudo cp -r /var/www/ood/apps/sys.bak/bc_desktop/local /etc/ood/config/apps/bc_desktop
If all went well, you should have a directory structure that looks similar to:
tree /etc/ood/config
# /etc/ood/config
# ├── apps
# │   ├── activejobs
# │   │   └── ...
# │   ├── bc_desktop
# │   │   └── ...
# │   ├── dashboard
# │   │   └── ...
# │   ├── files
# │   │   └── ...
# │   ├── myjobs
# │   │   └── ...
# │   └── shell
# │       └── ...
# ├── clusters.d
# │   ├── my_cluster.yml
# │   └── ...
# ├── nginx_stage.yml
# └── ood_portal.yml
Add Open OnDemand’s repository hosted by the Ohio Supercomputer Center:
sudo yum install https://yum.osc.edu/ondemand/1.3/ondemand-release-web-1.3-1.el7.noarch.rpm
Install OnDemand and all of its dependencies:
sudo yum install ondemand
Copy back any custom apps (e.g., Jupyter, RStudio, …) you installed previously from our backup directory:
sudo cp -r /var/www/ood/apps/sys.bak/CUSTOM_APP /var/www/ood/apps/sys/.
The installation will install all software and web apps. It will also generate a new Apache configuration file and restart Apache. So if all went well you should be able to access the OnDemand portal in your browser successfully.
Infrastructure Version Changes
Table 15 Infrastructure Component Versions
Component
Version
ood-portal-generator
0.4.0 → 0.7.1 (diff)
mod_ood_proxy
0.3.1 → 0.5.0 (diff)
ood_auth_map
0.0.3
nginx_stage
0.3.0 → 0.5.0 (diff)
Table 15 lists the versions as well as the previous version it was updated from for each component that make up the infrastructure for this release.
Application Version Changes
Table 16 Application Versions
App
Version
Dashboard App
1.18.0 → 1.26.2 (diff)
Shell App
1.2.4 → 1.3.1 (diff)
Files App
1.3.6 → 1.4.1 (diff)
File Editor App
1.3.1 → 1.3.3 (diff)
Active Jobs App
1.5.2 → 1.6.2 (diff)
Job Composer App
2.6.1 → 2.8.3 (diff)
Desktops App
0.1.2 → 0.2.0 (diff)
Table 16 lists the versions as well as the previous version it was updated from for each of the system web applications in this release.
Details
RPM based installation
This is the biggest change and constitutes the bulk of this release’s work. RPM based installation will now be the default and documented way to install and update OnDemand. The latest rpms that are in use at OSC can be accessed from https://yum.osc.edu/ondemand/latest/ and the stable releases will be available in specific release version directories, such as https://yum.osc.edu/ondemand/1.3/.
Store configuration under /etc instead of under app directories
To enable RPM based installation, two modifications have been made to all configuration for OnDemand:
All configuration can be moved to files under /etc/ood
Modifications to configuration only require Passenger app, Per User NINGX, or Apache server restart (with the exception of the ood-portal-generater config)
Since all configuration is stored under /etc/ood this directory can be easily managed by Puppet or versioned in a git repository.
Config changes no longer require app rebuilds
It is now much faster to make and test configuration changes. For most configuration changes, you can make the change and then select “Restart Web Server” from the “Help” or “Develop” dropdown to see the change.
Xfce support Interactive Desktops
We now have documentation for enabling Xfce 4+ as the desktop environment for OnDemand Interactive Desktops. Xfce is the desktop environment we now use internally at OSC. See Modify Form Attributes for documentation on how to use Xfce in OnDemand.
Cluster config verification script
A Rake task has been added to the Dashboard app that will submit and check the status of jobs for each cluster specified in the cluster config. This provides a quick way to verify that OnDemand has been properly configured for a new cluster and should speed up installation. See Test Configuration in the cluster configuration documentation for more details.
Ignore apps if they have a period in directory name
You can effectively hide apps from being displayed in the Dashboard by adding a period in the app’s directory name. This is useful if you want to make a backup of an app, e.g., ../myapp.bak/. Or just want to include a hidden directory in the app deployment directory, e.g., ../.hidden-app/.
Enable multiple Dashboard announcements with embedded HTML
Site-wide dashboard announcement support in OnDemand has been expanded. Orinally we supported a file /etc/ood/config/announcement.md but now a YAML file /etc/ood/config/announcement.yml can be used. A collection of markdown and yaml announcements in /etc/ood/config/announcements.d/ can be added. The yaml file provides extra benefits:
Pre process file using ERB so that ERB tags can provide per-request dynamic modification of the announcement
Control the color of announcement with :type which is the Bootstrap alert name (warning, info, success, or danger)
Control whether announcement appears or not by setting :msg to a string or nil
The ability to use ERB means we can set the msg to nil after a certain time period. For example:
type: warning
msg: |
  <%- if Time.now < Time.new(2018, 1, 23, 15, 0, 0) -%>
  **NOTICE:** The Ruby nodes on the Quick cluster will go down on Tuesday
  January 23, 2018 from 1 - 3 pm for scheduled maintenance. This will affect
  only **Ruby VDI** sessions scheduled to run during this time period. These
  sessions will be put on hold until after the maintenance period is complete.
  <%- end -%>
In this example, the announcement appears on the dashboard until Jan 23 at 3:00. We’ll add more documentation for this soon. If you want to take advantage of this now just ask a question on the ood-users mailing list.
Open “help” links in new window
Currently, any app that is served by a separate Passenger process, external to the Dashboard app, is opened in a new window. Thus, Shell Access, Files, Active Jobs, and Job Composer all open in new windows. Interactive App Plugins are managed by the Dashboard so they open in the same window. We fixed the external links in the Help menu to follow this convention.
Make “Interactive Sessions” link top level item
The Interactive Sessions link was moved from the first item in the Interactive Apps menu to a top level item on the navbar. Since these apps are one of the primary ways users use OnDemand this makes access to active sessions require one less click. Also, this frees us to place links to Interactive Apps anywhere in the navigation hierarchy without having to provide an associated sessions link in the same place.
Better debugging of Interactive Apps by logging shell commands
Whenever an Interactive Session is started from the Dashboard, the shell command used to submit the job is logged to the user’s NGINX config to help with debugging Interactive Apps.
Job Composer: Optionally hide Account field in Job Options
The Job Composer provides a field in the Job Options form to set the Account, which when the job is submitted uses the appropriate account flag for the resource manager (whether it is -A or -P or --account, etc.). However, some sites do not use this, and others use different mechanisms for accounting. Long term we want to support flexible configuration of this web form, but for now we have added the ability to hide this Account field from the web form. This field is hidden by adding to the Job Composer’s env file: OOD_SHOW_JOB_OPTIONS_ACCOUNT_FIELD=0
Active Jobs: display list of nodes that a job is running on
In Active Jobs, if the resource manager provides it, the list of nodes a job is running on will display in the details section of the job.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.2-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.2 Release Notes
Edit on GitHub
v1.2 Release Notes
Some highlights of this release:
Taking a step towards global configuration by moving the configuration file for nginx stage to /etc/ood/config/nginx_stage.yml (we intend on migrating all configuration to /etc/ood/config in the future).
The developer interface in the Dashboard is dynamically enabled when the developer creates the sandbox directory ~/ondemand/dev under their home directory.
To make Interactive App development debugging easier the full command used when submitting a batch job is now logged under /var/log/nginx/<user>/error.log on the corresponding OnDemand node.
The Files App now opens and displays PDF and HTML files in a new tab when a user attempts to View the selected file.
A multitude of bugfixes…
Upgrading from v1.1
Warning
If updating from a version other than v1.1 it is recommended you walkthrough the full updating instructions.
You will first need to update the PUN utility.
Confirm that you copied your custom nginx stage YAML configuration from:
/opt/ood/nginx_stage/config/nginx_stage.yml
to the new global location:
/etc/ood/config/nginx_stage.yml
Finally you will need to walkthrough updating the applications.
Infrastructure
Table 17 Infrastructure Component Versions
Component
Version
ood-portal-generator
0.4.0
mod_ood_proxy
0.3.1
ood_auth_map
0.0.3
nginx_stage
0.2.1 → 0.3.0 (diff)
Table 17 lists the versions as well as the previous version it was updated from for each component that make up the infrastructure for this release.
Applications
Table 18 Application Versions
App
Version
Dashboard App
1.17.0 → 1.18.0 (diff)
Shell App
1.2.3 → 1.2.4 (diff)
Files App
1.3.5 → 1.3.6 (diff)
File Editor App
1.3.1
Active Jobs App
1.5.1 → 1.5.2 (diff)
Job Composer App
2.6.0 → 2.6.1 (diff)
Desktops App
0.1.1 → 0.1.2 (diff)
Table 18 lists the versions as well as the previous version it was updated from for each of the system web applications in this release.
All of the above apps are installed and maintained by version 1.2.0 of the ood-apps-installer utility.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.1-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.1 Release Notes
Edit on GitHub
v1.1 Release Notes
Highlights in 1.1:
App development support with a new developer interface to help with creating, launching, and modifying custom apps
Documentation for adding Jupyter to OnDemand
Documentation for getting started with App Development
Documentation for authenticating OnDemand using Keycloak
Renamed “My Jobs” to “Job Composer” remove confusion
Upgrading to 1.1
See updating the apps as there are no infrastructure changes in this release.
Components
The two tables below show the versions of each infrastructure component or app that make up this release.
Infrastructure
Table 19 Infrastructure Component Versions
Component
Version
ood-portal-generator
0.4.0
mod_ood_proxy
0.3.1
ood_auth_map
0.0.3
nginx_stage
0.2.1
Table 19 lists the versions of each component that make up the infrastructure for this release.
Applications
Table 20 Application Versions
App
Version
Dashboard App
1.17.0
Shell App
1.2.3
Files App
1.3.5
File Editor App
1.3.1
Active Jobs App
1.5.1
Job Composer App
2.6.0
Desktops App
0.1.1
Table 20 lists the versions of each app for this release.
All of the above apps are installed and maintained by version 1.1.0 of the ood-apps-installer utility.
Infrastructure Changes
No changes from OOD 1.0.0 to 1.1.0.
App Changes
Dashboard App (from v1.15.2 to v1.17.0)
Please refer to the Changelog for details.
Notable changes:
App development support with a new Develop menu in the Dashboard app with a developer interface to help with creating, launching, and modifying custom apps
Improved Interactive app interface to support debugging when developing interactive apps
Improved responsiveness of Dashboard app for smaller screens
Active Jobs App (from v1.5.0 to v1.5.1)
Please refer to the Changelog for details.
Notable changes:
Fixed LSF bug that occurred when checking the status for a completed job that had completely left the queue 1
Job Composer (formerly My Jobs) App (from v2.5.0 to v2.6.0)
Please refer to the Changelog for details.
Notable changes:
Fixed LSF bug that occurred when checking the status for a completed job that had completely left the queue 1
Renamed app from “My Jobs” to “Job Composer”. This change only affects the name in the app views and the dashboard. The app is still deployed at /var/www/ood/apps/sys/myjobs and data is still stored in $HOME/ondemand/data/myjobs
Footnotes
1(1,2)
We currently don’t have access to an LSF 9.1 system to properly test our LSF adapter. We only have access to LSF 8.3.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/release-notes/v1.0-release-notes.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Release Notes » v1.0 Release Notes
Edit on GitHub
v1.0 Release Notes
Highlights in 1.0:
Launch interactive HPC Desktop sessions with new dashboard “batch connect” plugin
PBSPro support
LSF 9.1 partial support 1
Upgrading to 1.0
See updating.
Components
The two tables below show the versions of each infrastructure component or app that make up this release.
Infrastructure
Table 21 Infrastructure Component Versions
Component
Version
ood-portal-generator
0.4.0
mod_ood_proxy
0.3.1
ood_auth_map
0.0.3
nginx_stage
0.2.1
Table 21 lists the versions of each component that make up the infrastructure for this release.
Applications
Table 22 Application Versions
App
Version
Dashboard App
1.15.2
Shell App
1.2.3
Files App
1.3.5
File Editor App
1.3.1
Active Jobs App
1.5.0
My Jobs App
2.5.0
Desktops App
0.1.1
Table 22 lists the versions of each app for this release.
All of the above apps are installed and maintained by version 1.0.0 of the ood-apps-installer utility.
Infrastructure Changes
ood-portal-generator (from v0.3.1 to v0.4.0)
Please refer to the Changelog for details.
mod_ood_proxy (from v0.2.0 to v0.3.1)
Please refer to the Changelog for details.
App Changes
Dashboard App (from v1.12.0 to v1.15.2)
Please refer to the Changelog for details.
Notable changes:
Add interactive app support to OOD with new plugin architecture. “Batch connect” plugins start a server on a batch job and enable the user to connect to it through the dashboard. Examples of plugins this feature is able to support include Desktop via VNC, Paraview GUI app via VNC, and directly connecting to Jupyter or RStudio servers.
Shell App (from v1.2.2 to v1.2.3)
Please refer to the Changelog for details.
Files App (from v1.3.3 to v1.3.5)
Please refer to the Changelog for details.
Active Jobs App (from v1.4.4 to v1.5.0)
Please refer to the Changelog for details.
Notable changes:
Add PBSPro support
Add partial LSF 9.1 support 1
Show detail pane with more information for LSF
My Jobs App (from v2.4.1 to v2.5.0)
Please refer to the Changelog for details.
Notable changes:
Add PBSPro support
Add partial LSF 9.1 support 1
Desktops App (added v0.1.1)
Desktops is a “batch connect” plugin for the dashboard that enables launching an interactive HPC Desktop session by VNC.
See Enable Interactive Desktop for installation directions.
Please refer to the Changelog for details.
Footnotes
1(1,2,3)
We currently don’t have access to an LSF 9.1 system to properly test our LSF adapter. We only have access to LSF 8.3.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#version-numbering
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#major-versions
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#minor-versions
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#patch-versions
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#nightly-versions
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#dependency-updates
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#tagging
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#version-timing
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/version-policy.html#backporting-and-support
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
Docs » Versioning Policy
Edit on GitHub
Versioning Policy
This policy can be seen in the Open OnDemand Versioning Policy document on GitHub.
Version Numbering
Open OnDemand code releases utilize a XXX.YYY.ZZZ numbering scheme (e.g. 2.0.29), where:
XXX is the major version number
YYY is the minor version number
ZZZ is the patch version number
Major Versions
Major versions have large sets of new features and functionalities. They can include breaking changes that prevent seamless upgrading from previous versions. They can also include removal of functionality or configuration that has been deprecated in previous versions.
Minor Versions
Minor versions will contain new functionality that’s backward compatible. They may also contain bug fixes that are not in the prior releases’ patch versions.
Minor versions will also introduce deprecations to functionality or configurations that maybe be removed in the next major version.
Patch Versions
Patch versions will only contain security fixes and bug fixes.
Nightly Versions
Nightly packages (.rpm and .deb) are built every night from of the current commit in the main branch and released to the nightly repository. They have varying degrees of stability, mostly related to the release cycle. The closer in time they are to a release the more stable they’re generally considered.
Dependency Updates
Dependency updates may come anywhere in the release cycle. For example even in a patch release. Dependencies (like ruby or nodejs) updates are largely driven by the operating systems we support.
If a dependency has reached its end of life for support from an operating system, we may update that dependency even in a patch release.
Minor, major and patch versions may all include dependency updates should a dependency reach the end of life within a given release cycle.
Tagging
We create two types of tags. The first are regular tags like v3.0.0 which is a real production version. The other are release candidates like v3.0.0-rc8. Release candidates are created for testing purposes by OSC, though they’re freely available to anyone to also test. Release candidates are considered stable, but could contain bugs.
Version Timing
Patch versions are released as needed. Major and minor versions are released as time permits the team to develop features.
All versions are typically tested first in production for at least a week at OSC and other early adopter sites prior to being marked as an official release.
Backporting and Support
The Open OnDemand team will only provide general support / backporting for a major/minor version for a period of 3 months after the next major/minor version is released (i.e. version 2.0 will only be supported for 3 months after the release of 3.0). This includes providing concurrent patch versions for relevant security / bug fixes where possible (i.e. the developers would release a 2.0.1 version alongside a 3.0.1 version if released within 3 months of the 3.0 release). The Open OnDemand community is welcome to generate pull requests for additional backport code changes outside of that time frame.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/glossary.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Glossary
Edit on GitHub
Glossary
Cluster
Physical machines with a resource scheduler that users can submit jobs to.
Compute-node
The machine where a submitted job runs. Part of a cluster.
Login-node
A server on the compute cluster that can be anything from the OOD dashboard itself, to a shell, to the file-browser app, etc. Runs on the cluster but is not a compute-node.
Web-node
A term used for when a site or institution has enough funds/personel to run the OOD login on a dedicated server and not on a login-node.
PUN
The Per User Nginx. An Nginx instance running as the user.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#file-names-with-xml-or-html-break-display
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#problems-uploading-files
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#downloading-forbidden-directories-fails-silently
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#viewing-large-files-causes-problems
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#incorrect-link-in-tree-root
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#nomethoderror-when-using-a-custom-translation-file
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#dashboard-may-be-slow-due-to-logic-in-erb-templates
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#batch-connect-sessions-do-not-contain-much-debugging-info
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#novnc-does-not-work-with-safari-and-apache-basic-auth
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#multiline-select-does-not-work-in-ms-edge
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#high-output-programs-may-freeze-the-shell
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#paste-does-not-work-in-older-versions-of-safari
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/issues/overview.html#rstudio-and-upgrading-singularity-3-to-minor-version-5
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Docs » OnDemand’s Known Issues
Edit on GitHub
OnDemand’s Known Issues
Note
We take community requests and troubleshoot as well on our Discourse at https://discourse.osc.edu/.
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
File names with XML or HTML break display
Files whose names that contain XML or HTML special characters (<, >, &) break the File Explorer’s display. While this does not introduce corrupt the file system it does render the application unusable.
OSC/ood-fileexplorer#198
Work arounds: to be able to manipulate files that break the Files app users can use a graphical SFTP client like Cyberduck or FileZilla or the command line.
Problems uploading files
The File Explorer uses HTTP PUT and the NGINX temporary directory to upload files. For most usage this arrangement is adequate, but large files (which may exceed the capacity of the temp dir), shakey network connections (which may cause a transfer to stop partway through) can result in an unsatisfactory experience.
If the NGINX temporary directory is on a small partition it is possible to overload it when attempting an upload. In the case that an upload is too large to fit in the upload temp directory the application may send the partially uploaded file to the destination without reporting an error.
OSC/ood-fileexplorer#187
Work arounds: to be able to upload larger files that fail with the Files app users can use a graphical SFTP client like Cyberduck, Globus Connect Personal, or the command line. Admins should check to ensure that the partition containing the upload temp dir (/var/run/ondemand-nginx) is adequate.
Downloading forbidden directories fails silently
When a user attempts to download a directory for which they do not have adequate file system permissions the download action will fail without notifying the user of the error.
OSC/ood-fileexplorer#185
Workarounds: No work arounds are available.
Viewing large files causes problems
When attempting to view large files (multi-megabyte) the File Explorer has been observed to cause right click to stop working in FireFox.
OSC/ood-fileexplorer#196
Work arounds: if graphical desktops are installed, then use the recommended file viewer / editor for the desired file type. If the correct viewer is not known to the user, but is installed on the system it may be discoverable using the command line program xdg-open [file-name].
Incorrect link in tree root
In the File Explorer attempting to open the tree menu’s root link in a new tab causes an error.
OSC/ood-fileexplorer#173
Workarounds: No work arounds are available at this time.
NoMethodError when using a custom translation file
When attempting to use a custom translation file if the directory pointed to by the environment variable OOD_LOCALES_ROOT does not exist then attempting to load the application will cause an unhandled NoMethodError to be throw in the application controller.
OSC/ood-dashboard#465
Workarounds: Admins are encouraged to first test all changes to their OnDemand instances in a test environment before applying changes to production services.
Dashboard may be slow due to logic in ERB templates
The Dashboard may be slow as a result of how the menu is built if custom Batch Connect applications have complicated logic in their form.yml.erb.
An example where this may occur is if the ERB templates contain commands that query the cluster’s status.
OSC/ood-dashboard#417
Workarounds: Reducing the amount of logic inside ERBs is the near-term solution. In the longer term the OnDemand team will be re-evaluating how the Dashboard menu is constructed so that this will no longer be an issue.
Batch Connect sessions do not contain much debugging info
When troubleshooting a failed Batch Connect job it may be difficult to diagnose certain errors because the adapter error interface is generic and does not contain a stack trace of what has gone wrong.
OSC/ood-dashboard#397
Workarounds: no work around is available to the user; admins may find examples of what went wrong in the NGINX logs for the troubled user.
When a Batch Connect session fails inside of the script.sh.erb section of its execution the session information is removed from the view and no error message is shown to the user.
OSC/ood-dashboard#171
Workarounds: Users or support staff may find logs for failed Batch Connect sessions located in the output directory $HOME/ondemand/data/(sys|dev|usr)/dashboard/batch_connect/(sys|dev|usr)/$APP_NAME/output/$UUID/output.log.
noVNC does not work with Safari and Apache Basic auth
OnDemand’s Cluster and Interactive Apps do not work with Safari when OnDemand is protected using Basic authentication. This is due to a bug in Safari with using websockets through servers protected using “Basic” auth.
Workarounds: OnDemand can be installed with another authentication mechanism such as Shibboleth or OpenID Connect. If “Basic” auth is required, Mac users can connect with other browsers like Chrome or Firefox.
Multiline select does not work in MS Edge
Multi-line select does not work in Microsoft Edge (pre-Chromium).
OSC/ood-shell#57
Workarounds: Using another web browser such as FireFox or Chrome.
High output programs may freeze the shell
The Shell may freeze when attempting to display a large amount of content. This error was initially reported by a user running Python Spark from the Shell app, and has been duplicated by simply running cat against hundreds-of-megabyte files.
OSC/ood-shell#28
Workarounds: When attempting to view the contents of a file using the commands less, head or tail instead of cat will prevent this error. When running a program that may rapidly produce megabytes of output using a native SSH terminal may be preferable, either from the user’s personal machine, or from within a graphical session on the cluster. Alternatively redirecting application output to a file or files (stdout/stderr) and then using less or tail to view those files can also solve this problem.
Paste does not work in older versions of Safari
Pasting from the system clipboard is not supported in Safari 8 or 9.
OSC/ood-shell#16
Workarounds: At the time of writing the current version of Safari is version 12. Users experiencing this error are highly recommended to upgrade their web browser.
RStudio and Upgrading Singularity 3 to minor version 5
OnDemand RStudio implementations using Singularity may break when upgrading to Singularity version 3.5 or above. There is an undocumented breaking change where LD_LIBRARY_PATH is no longer exported to the container by default. Instead the container will default to having LD_LIBRARY_PATH=/.singularity.d/libs.
Workarounds: Explicitly exporting the variable by using SINGULARITYENV_LD_LIBRARY_PATH="$LD_LIBRARY_PATH" singularity appears sufficient to fix the issue.
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/requirements.html
3.1
GETTING STARTED
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Requirements
Edit on GitHub
Requirements
Supported Operating Systems
At this time OnDemand only supports the following operating systems and architectures:
Table 1 Operating System and Architecture Support
x86_64
aarch64/arm64
RedHat/CentOS 7
✅
✅
RedHat/Rocky Linux/AlmaLinux 8
✅
✅
RedHat/Rocky Linux/AlmaLinux 9
✅
✅
Ubuntu 20.04
✅
✅
Ubuntu 22.04
✅
✅
Debian 12
✅
✅
Amazon Linux 2023
✅
✅
Software Requirements
On the Web node serving OnDemand itself:
Software Collections repositories
lsof
sudo
OnDemand repository:
ondemand-3.1-1.el7.x86_64.rpm
And on the Compute node(s):
Note
The following are required for using OnDemand with interactive applications such as desktop environments, Jupyter Notebooks and RStudio. If you do not intend to install interactive applications then these are not necessary.
nmap-ncat
TurboVNC 2.1+
websockify 0.8.0+
Hardware Requirements
At OSC we have not quantified the minimum hardware requirements for OnDemand. The VMs that run OnDemand have 16 cores and 64GB RAM. According to our Ganglia metrics that is over powered for our normal utilization. We average 150MB memory per PUN and the average CPU percentage per Per User NGINX (PUN) is 4%. Our OnDemand instance serves over 600 unique users each month and at any given time usually has 60-100 PUN processes running.
The Passenger apps that make up the core of OnDemand (that NGINX is configured with), are each killed after a short period (5 minutes) of inactivity from the user, and when users are using NoVNC or connecting to Jupyter Notebook or RStudio on a compute node, Apache is proxying these users, bypassing the PUN completely. So it can happen that 60 PUNs are running but twice the number of users are actually being served.
Another sizing factor that has impacted us in the past is the size of the /tmp partition. We have had incidents where /tmp is exhausted and so have increased the size from 20GB to 50GB.
Browser Requirements
Warning
No IE 11 support. If you are a site that requires IE 11 support and are willing to contribute developer time to the project to support this, please reach out to us.
To have the best experience using OnDemand, use the latest versions of Google Chrome, Mozilla Firefox or Microsoft Edge. Use any modern browser that supports ECMAScript 2016.
Google Chrome has the widest range of support since the shell application uses hterm.js which is supported officially by Google. Chrome currently is the only web browser that natively supports the copy and paste functionality in noVNC. Other browsers can do copy and pasting manually through the noVNC tool drawer.
Sites have reported problems with Safari when using the shell application or noVNC. Safari is also known to cause problems with WebSockets and Basic Auth.
Next
Previous
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/latest/index.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-3.0/index.html
3.0
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-2.0/index.html
2.0
GENERAL
Architecture
Configuration Reference
INSTALL
Requirements
Installation
Authentication
Add Cluster Configuration Files
Resource Manager Configuration
Customization Overview
Customization
Analytics
Monitoring
EXTEND
Setup Interactive Apps
Enable Interactive Desktop
Install Other Interactive Apps
Code Snippets
DEPLOY
App Authorization
App Sharing
DEVELOP INTERACTIVE APPS
App Development
Tutorials: Interactive Apps
DEVELOP PASSENGER APPS
Tutorials: Passenger Apps
RELEASE NOTES
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
KNOWN ISSUES
OnDemand’s Known Issues
LEGACY DOCS
Applications
User Documentation
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
General
Architecture
Overview
System context
Container context
Request Flow
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
Install
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software From Package
2. Modify System Security
3. Start Services
4. Add SSL Support
5. Add LDAP Support
Authentication
Overview
OpenID Connect
OpenID Connect with Dex
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
NSF ACCESS
Add PAM Authentication
Add Cluster Configuration Files
Cluster Config Schema v2
Resource Manager Configuration
Configure Torque
Configure Slurm
Configure LSF
Configure PBS Professional
Configure Grid Engine
Configure LinuxHost Adapter (beta)
Configure Cloudy Cluster (beta)
Configure Kuberenetes
A Working Example of a bin_overrides Script
Test Configuration
Customization Overview
Customization
Announcements
Message of the Day (MOTD)
Branding
Add URLs to Help Menu
Add Shortcuts to Files Menu
Set Upload Limits
Block or Allow Directory Access
Set Default SSH Host
Set SSH Allowlist
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Custom Error Page for Missing Home Directory on Launch
Control Which Apps Appear in the Dashboard Navbar
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration (BETA)
Analytics
1. Adding Google Analytics
Monitoring
Prometheus Monitoring
Extend
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
Code Snippets
Deploy
App Authorization
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
Develop Interactive Apps
App Development
Enabling App Development
Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Develop Passenger Apps
Tutorials: Passenger Apps
Creating a Status App
Release Notes
v2.0 Release Notes
Upgrading to v2.0.29
Upgrading from v1.8
Details
v1.8 Release Notes
Special thanks
Upgrading from v1.7
Upgrading from v1.6
Details
v1.7 Release Notes
Special thanks
Upgrading from v1.6
Upgrading from v1.5
Details
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Known Issues
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Legacy Docs
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
User Documentation
Next
© Copyright 2017-2023, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-1.8/index.html
1.8
GENERAL
Architecture
Configuration Reference
INSTALL
Requirements
Installation
Authentication
Add Cluster Configuration Files
Resource Manager Configuration
Customization Overview
Customization
Analytics
EXTEND
Setup Interactive Apps
Enable Interactive Desktop
Install Other Interactive Apps
Code Snippets
DEPLOY
App Authorization
App Sharing
DEVELOP INTERACTIVE APPS
App Development
Tutorials: Interactive Apps
DEVELOP PASSENGER APPS
Tutorials: Passenger Apps
RELEASE NOTES
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
KNOWN ISSUES
OnDemand’s Known Issues
LEGACY DOCS
Applications
User Documentation
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
General
Architecture
Overview
System context
Container context
Request Flow
Configuration Reference
ood_portal.yml
nginx_stage.yml
ood-portal-generator
nginx-stage
Install
Requirements
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software From RPM
2. Install From Source
3. Modify System Security
4. Start Services
5. Add SSL Support
6. Add LDAP Support
Authentication
Overview
OpenID Connect
OpenID Connect with Dex
Shibboleth
CAS
OpenID Connect with KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
SAML Authentication with Active Directory Federated Services (ADFS) and mod_auth_mellon
Add PAM Authentication
Add Cluster Configuration Files
Cluster Config Schema v2
Resource Manager Configuration
Configure Torque
Configure Slurm
Configure LSF
Configure PBS Professional
Configure Grid Engine
Configure LinuxHost Adapter (beta)
Configure Cloudy Cluster (beta)
A Working Example of a bin_overrides Script
Test Configuration
Customization Overview
Customization
Announcements
Message of the Day (MOTD)
Branding
Add URLs to Help Menu
Add Shortcuts to Files Menu
Set Upload Limits
Whitelist Directories
Set Default SSH Host
Set SSH Allowlist
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Custom Error Page for Missing Home Directory on Launch
Control Which Apps Appear in the Dashboard Navbar
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration (BETA)
Analytics
1. Adding Google Analytics
Extend
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
Code Snippets
Deploy
App Authorization
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
Develop Interactive Apps
App Development
Enabling App Development
Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Develop Passenger Apps
Tutorials: Passenger Apps
Creating a Status App
Release Notes
v1.8 Release Notes
Special thanks
Upgrading from v1.7
Upgrading from v1.6
Details
v1.7 Release Notes
Special thanks
Upgrading from v1.6
Upgrading from v1.5
Details
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Known Issues
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Legacy Docs
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
User Documentation
Next
© Copyright 2017-2021, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-1.7/index.html
1.7
GENERAL
Architecture
INSTALL
Requirements
Installation
Authentication
Add Cluster Configuration Files
Resource Manager Configuration
Customization Overview
Customization
Analytics
EXTEND
Setup Interactive Apps
Enable Interactive Desktop
Install Other Interactive Apps
DEPLOY
App Authorization
App Sharing
DEVELOP INTERACTIVE APPS
App Development
Tutorials: Interactive Apps
DEVELOP PASSENGER APPS
Tutorials: Passenger Apps
RELEASE NOTES
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
KNOWN ISSUES
OnDemand’s Known Issues
LEGACY DOCS
Infrastructure
Applications
User Documentation
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar particpation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
General
Architecture
Overview
System context
Container context
Request Flow
Install
Requirements
Software Requirements
Hardware Requirements
Installation
1. Install Software From RPM
2. Install From Source
3. Modify System Security
4. Start Apache
5. Add SSL Support
6. Add LDAP Support
Authentication
Overview
Add Shibboleth Authentication
Add CAS Authentication
OpenID Connect via KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
Add Cluster Configuration Files
Cluster Config Schema v2
Resource Manager Configuration
Configure Torque
Configure Slurm
Configure LSF
Configure PBS Professional
Configure Grid Engine
Configure LinuxHost Adapter (beta)
A Working Example of a bin_overrides Script
Test Configuration
Customization Overview
Customization
Announcements
Message of the Day (MOTD)
Branding
Add URLs to Help Menu
Add Shortcuts to Files Menu
Whitelist Directories
Set Default SSH Host
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Custom Error Page for Missing Home Directory on Launch
Control Which Apps Appear in the Dashboard Navbar
Customize Text in OnDemand
Disable Safari Warning on Dashboard
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Analytics
1. Adding Google Analytics
Extend
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
Deploy
App Authorization
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
Develop Interactive Apps
App Development
Enabling App Development
Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Develop Passenger Apps
Tutorials: Passenger Apps
Creating a Status App
Release Notes
v1.7 Release Notes
Special thanks
Upgrading from v1.6
Upgrading from v1.5
Details
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Known Issues
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Legacy Docs
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
User Documentation
Next
© Copyright 2017-2019, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-1.6/index.html
1.6
GENERAL
Architecture
INSTALL
Requirements
Installation
Authentication
Add Cluster Configuration Files
Resource Manager Configuration
Customization Overview
Customization
Analytics
EXTEND
Setup Interactive Apps
Enable Interactive Desktop
Install Other Interactive Apps
App Development
App Authorization
App Sharing
Tutorials: Interactive Apps
Tutorials: Passenger Apps
RELEASE NOTES
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
KNOWN ISSUES
OnDemand’s Known Issues
LEGACY DOCS
Infrastructure
Applications
User Documentation
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar particpation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
General
Architecture
Overview
System context
Container context
Request Flow
Install
Requirements
Software Requirements
Hardware Requirements
Installation
1. Install Software From RPM
2. Install From Source
3. Modify System Security
4. Start Apache
5. Add SSL Support
6. Add LDAP Support
Authentication
Overview
Add Shibboleth Authentication
Add CAS Authentication
OpenID Connect via KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
Add Cluster Configuration Files
Cluster Config Schema v2
Resource Manager Configuration
Configure Torque
Configure Slurm
Configure LSF
Configure PBS Professional
Configure Grid Engine
A Working Example of a bin_overrides Script
Test Configuration
Customization Overview
Customization
Announcements
Message of the Day (MOTD)
Branding
Add URLs to Help Menu
Add Shortcuts to Files Menu
Whitelist Directories
Set Default SSH Host
Custom Job Composer Templates
Custom Error Page for Missing Home Directory on Launch
Control Which Apps Appear in the Dashboard Navbar
Customize Text in OnDemand
Disable Safari Warning on Dashboard
Disk Quota Warnings on Dashboard
Analytics
1. Adding Google Analytics
Extend
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
App Development
Enabling App Development
Interactive Apps
App Authorization
App Sharing
Overview
System Installed Apps
Code Sharing
Peer to Peer Executable Sharing
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Release Notes
v1.6 Release Notes
Upgrading from v1.5
Infrastructure Changes
Application Version Changes
Details
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Known Issues
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Legacy Docs
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
User Documentation
Next
© Copyright 2017-2019, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-1.5/index.html
1.5
INSTALL
Installation
Authentication
Add Cluster Configuration Files
Resource Manager Configuration
Customization Overview
Customization
EXTEND
Setup Interactive Apps
Enable Interactive Desktop
Install Other Interactive Apps
App Development
App Sharing
Tutorials: Interactive Apps
Tutorials: Passenger Apps
RELEASE NOTES
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
LEGACY DOCS
Infrastructure
Applications
User Documentation
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar particpation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Install
Installation
1. Install Software
2. Modify System Security
3. Start Apache
4. Add SSL Support
5. Add LDAP Support
Authentication
Overview
OpenID Connect via KeyCloak on RHEL7
Two Factor Auth using Duo with Keycloak
Add Cluster Configuration Files
Cluster Config Schema v2
Resource Manager Configuration
Configure Torque
Configure Slurm
Configure LSF
Configure PBS Professional
Configure Grid Engine
A Working Example of a bin_overrides Script
Test Configuration
Customization Overview
Customization
Announcements
Message of the Day (MOTD)
Branding
Add URLs to Help Menu
Add Shortcuts to Files Menu
Whitelist Directories
Set Default SSH Host
Custom Job Composer Templates
Custom Error Page for Missing Home Directory on Launch
Control Which Apps Appear in the Dashboard Navbar
Customize Tagline and Other Text on Dashboard
Disable Safari Warning on Dashboard
Disk Quota Warnings on Dashboard
Extend
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
App Development
Enabling App Development
Interactive Apps
App Sharing
Overview
Demo
Enabling App Sharing Dashboard
Controlling Who Can Share and Access Apps
Known Issues
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add Custom Queues/Partitions
Tutorials: Passenger Apps
Creating a Status App
Release Notes
v1.5 Release Notes
Upgrading from v1.4
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Legacy Docs
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
User Documentation
Next
© Copyright 2017-2018, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-1.4/index.html
1.4
INSTALL
Installation
Authentication
Add Cluster Configuration Files
Resource Manager Configuration
Customization Overview
Customization
EXTEND
Setup Interactive Apps
Enable Interactive Desktop
Install Other Interactive Apps
App Development
Tutorials: Interactive Apps
Tutorials: Passenger Apps
RELEASE NOTES
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
LEGACY DOCS
Infrastructure
Applications
User Documentation
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
See the website for more information about the Open OnDemand project.
Install
Installation
1. Install Software
2. Modify System Security
3. Start Apache
4. Add SSL Support
5. Add LDAP Support
Authentication
Overview
OpenID Connect via KeyCloak on RHEL7
Add Cluster Configuration Files
Cluster Config Schema v2
Resource Manager Configuration
Configure Torque
Configure Slurm
Configure LSF
Configure PBS Professional
Configure Grid Engine
A Working Example Of A bin_overrides Script
Test Configuration
Customization Overview
Customization
Announcements
Message of the Day (MOTD)
Branding
Add URLs to Help menu
Add shortcuts to Files menu
Whitelist directories
Set default ssh host
Custom Job Composer Templates
Custom Error Page for Missing Home Directory on Launch
Control which apps appear in the Dashboard Navbar
Disable Safari Warning on Dashboard
Disk Quota Warnings on Dashboard
Extend
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
App Development
Enabling App Development
Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add Custom Queues/Partitions
Tutorials: Passenger Apps
Creating a status app
Release Notes
v1.4 Release Notes
Upgrading from v1.3
Infrastructure Version Changes
Application Version Changes
Details
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Legacy Docs
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
User Documentation
Next
© Copyright 2017-2018, Ohio Supercomputer Center
Documentation Versions
v:

## https://osc.github.io/ood-documentation/release-1.3/index.html
1.3
CONTENTS
What is Open OnDemand
GETTING STARTED
Installation
Enable Interactive Desktop
Install Other Interactive Apps
Authentication
COMPONENTS
Infrastructure
Applications
RESOURCES
User Documentation
App Development
RELEASE NOTES
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Website | Mailing list | GitHub
Contents
What is Open OnDemand
Getting Started
Installation
1. Install Software
2. Modify System Security
3. Add Cluster Configuration Files
4. Start Apache
5. Add SSL Support
6. Add LDAP Support
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
Install Other Interactive Apps
Authentication
Overview
OpenID Connect via KeyCloak on RHEL7
Components
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
Resources
User Documentation
App Development
Enabling App Development
Interactive Apps (Plugins)
Tutorials: Passenger Apps
Tutorials: Interactive Apps
Release Notes
v1.3 Release Notes
Upgrading from v1.2
Infrastructure Version Changes
Application Version Changes
Details
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Next
© Copyright 2017-2018, Ohio Supercomputer Center.

## https://osc.github.io/ood-documentation/release-1.2/index.html
1.2
CONTENTS
What is Open OnDemand
GETTING STARTED
Installation
Install Desktops
Install Other Interactive Apps
Authentication
Updating
COMPONENTS
Infrastructure
Applications
RESOURCES
User Documentation
App Development
RELEASE NOTES
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Website | Mailing list | GitHub
Contents
What is Open OnDemand
Getting Started
Installation
1. Software Requirements
2. Modify System Security
3. Generate Apache Config
4. Install Proxy Module for Apache
5. Install the PUN Utility
6. Install User Mapping Script
7. Add Cluster Configuration Files
8. Start Apache
9. Install Applications
10. Add SSL Support
11. Add LDAP Support
Install Desktops
1. Software Requirements
2. Install Desktop App
3. Customize Desktop App
Install Other Interactive Apps
Authentication
Overview
OpenID Connect via KeyCloak on RHEL7
Updating
1. Update Infrastructure
2. Update Applications
3. Update Desktops
Components
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
Resources
User Documentation
App Development
Enabling App Development
Interactive Apps (Plugins)
Tutorials: Passenger Apps
Tutorials: Interactive Apps
Release Notes
v1.2 Release Notes
Upgrading from v1.1
Infrastructure
Applications
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Next
© Copyright 2017, Ohio Supercomputer Center.

## https://osc.github.io/ood-documentation/release-1.1/index.html
Open OnDemand
1.1
CONTENTS
What is Open OnDemand
GETTING STARTED
Installation
Install Desktops
Install Other Interactive Apps
Authentication
Updating
COMPONENTS
Infrastructure
Applications
RESOURCES
User Documentation
App Development
RELEASE NOTES
v1.1 Release Notes
v1.0 Release Notes
Docs » Welcome to Open OnDemand’s documentation!
Edit on GitHub
Welcome to Open OnDemand’s documentation!
Contents
What is Open OnDemand
Getting Started
Installation
1. Software Requirements
2. Modify System Security
3. Generate Apache Config
4. Install Proxy Module for Apache
5. Install the PUN Utility
6. Install User Mapping Script
7. Add Cluster Configuration Files
8. Start Apache
9. Install Applications
10. Add SSL Support
11. Add LDAP Support
Install Desktops
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
4. Install Desktop App
5. Customize Desktop App
Install Other Interactive Apps
Authentication
Tutorial: OpenID Connect via KeyCloak on RHEL7
Updating
1. Update Infrastructure
2. Update Applications
3. Update Desktops
Components
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
Job Composer App
Interactive Apps (Plugins)
Resources
User Documentation
App Development
Enabling App Development
Interactive Apps (Plugins)
Tutorial: Creating a status app
Tutorial: Add Jupyter
Release Notes
v1.1 Release Notes
Upgrading to 1.1
Components
Infrastructure Changes
App Changes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Next
© Copyright 2017, Ohio Supercomputer Center.
Built with Sphinx using a theme provided by Read the Docs.

## https://osc.github.io/ood-documentation/release-1.0/index.html
Open OnDemand
1.0
CONTENTS
What is Open OnDemand
GETTING STARTED
Installation
Install Desktops
Updating
COMPONENTS
Infrastructure
Applications
RESOURCES
User Documentation
RELEASE NOTES
v1.0 Release Notes
Docs » Welcome to Open OnDemand’s documentation!
View page source
Welcome to Open OnDemand’s documentation!
Contents
What is Open OnDemand
Getting Started
Installation
1. Software Requirements
2. Modify System Security
3. Generate Apache Config
4. Install Proxy Module for Apache
5. Install the PUN Utility
6. Install User Mapping Script
7. Add Cluster Configuration Files
8. Start Apache
9. Install Applications
10. Add SSL Support
11. Add LDAP Support
Install Desktops
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
4. Install Desktop App
5. Customize Desktop App
Updating
1. Update Apache Config
2. Update Proxy Module for Apache
3. Update the PUN Utility
4. Update Mapping Script
5. Update Applications
6. Update Desktops
Components
Infrastructure
ood-portal-generator
mod_ood_proxy
ood_auth_map
nginx_stage
Applications
Dashboard App
Shell App
Files App
File Editor App
Active Jobs App
My Jobs App
Resources
User Documentation
Release Notes
v1.0 Release Notes
Upgrading to 1.0
Components
Infrastructure Changes
App Changes
Next
© Copyright 2017, Ohio Supercomputer Center.
Built with Sphinx using a theme provided by Read the Docs.

## https://osc.github.io/ood-documentation/develop/index.html
3.1
GETTING STARTED
Requirements
Installation
Cluster Configuration
Setup Interactive Apps
HOW-TOS
Customizations
Debugging and Monitoring
Enable Interactive Desktop
App Development
TUTORIALS
Install Other Interactive Apps
Tutorials: Interactive Apps
Tutorials: Passenger Apps
Developing The OOD Dashboard
REFERENCE
Architecture
Configuration Reference
Release Notes
Versioning Policy
Glossary
OnDemand’s Known Issues
Docs » Open OnDemand
Edit on GitHub
Open OnDemand
Our website contains general information about the Open OnDemand project.
Community contributions
Throughout this documentation we will start highlighting community contributions to the project, including linking to external useful projects or extensions such as PSC’s Jupyter Notebook extension for manipulating the environment post launch.
Note
If you have an app or extension that may be useful to others in the OnDemand community please share on our Discourse instance and we can then also add it to this documentation site.
Special Thanks
These are institutions who were early adopters or provided HPC resources for development and testing of the resource manager adapters currently available. The success of this project would not be possible without their generous support (in alphabetical order):
Bowdoin College for help with the SGE adapter.
George Louthan, formerly of Tandy Supercomputer Center, for early adoption and help with LSF adapter.
Oregon State University for help with the SGE adapter.
Pittsburgh Supercomputer Center for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Texas A&M High Performance Research Computing for early adoption and help with the LSF adapter, platform feedback.
Tufts Technology Services HPC Research Computing for early adoption and help with Slurm adapter development, platform feedback, and webinar participation.
UCLA Institute for Digital Research and Education for help with the SGE adapter.
University of Arizona HPC for early adoption and help with the PBSPro adapter, platform feedback, and webinar participation.
University at Buffalo Center for Computational Research for early adoption, platform feedback, and collaboration on the next major version of Open OnDemand, 2.0.
University of Utah for early adoption and help with the Slurm adapter, platform feedback, and webinar participation.
Getting Started
Requirements
Supported Operating Systems
Software Requirements
Hardware Requirements
Browser Requirements
Installation
1. Install Software
2. Authentication
3. Secure Apache httpd
4. Add SELinux
Building From Source
Cluster Configuration
Cluster Config Schema v2
Torque
Slurm
LSF
PBS Professional
Grid Engine
LinuxHost
Cloudy Cluster
Kubernetes
Systemd
A Working Example of a bin_overrides Script
Test Configuration
Advanced Resource Manager Configrations
Setup Interactive Apps
1. Software Requirements
2. Modify Cluster Configuration
3. Enable Reverse Proxy
How-Tos
Customizations
Announcements
Message of the Day (MOTD)
Branding
Overriding Pages
Add URLs to Help Menu
Add Shortcuts to Files Menu
Configuration Profiles
Changing the Navigation bar
Interactive Apps Menu
Set Upload Limits
Set Download Limits
Block or Allow Directory Access
Disabling Users
Set Default SSH Host
Set SSH Allowlist
Set OOD SSH Port
Shell App SSH Command Wrapper
Fix Unauthorized WebSocket Connection in Shell App
Custom Job Composer Templates
Job Composer Script Size Limit
Hiding Job Arrays
Custom Error Page for Missing Home Directory on Launch
Pinning Applications to the Dashboard
Custom layouts in the dashboard
Customize Text in OnDemand
Disk Quota Warnings on Dashboard
Balance Warnings on Dashboard
Maintenance Mode
Grafana support
Disable Host Link in Batch Connect Session Card
Set Illegal Job Name Characters
Customize Dex Theme
XDMoD Integration
Accessing Remote File Systems
Cancel Interactive Sessions
Custom Pages
Support Tickets
Debugging and Monitoring
Apache httpd tips
Debugging Interactive Apps
Logging
Prometheus Monitoring
Adding Google Analytics
Enable Interactive Desktop
1. Software Requirements
2. Add a Cluster
3. Modify Form Attributes
4. Custom Job Submission
App Development
Enabling App Development
Interactive Apps
App Sharing
Tutorials
Install Other Interactive Apps
Tutorials: Interactive Apps
Add a Jupyter App
Add an RStudio App
Add a MATLAB App
Add a Jupyter App on a Kubernetes Cluster
Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute
Add Custom Queues/Partitions
Troubleshooting Interactive Apps
Tutorials: Passenger Apps
Creating a Status App
Developing The OOD Dashboard
Developing the Dashboard App
Developing the Shell App
Reference
Architecture
Overview
System context
Container context
Request Flow
Other Request Flow Diagrams
Configuration Reference
ood_portal.yml
nginx_stage.yml
ondemand.d/*.yml files
submit.yml.erb
ood-portal-generator
nginx-stage
PUN environment
Release Notes
v3.1 Release Notes
v3.0 Release Notes
v2.0 Release Notes
v1.8 Release Notes
v1.7 Release Notes
v1.6 Release Notes
v1.5 Release Notes
v1.4 Release Notes
v1.3 Release Notes
v1.2 Release Notes
v1.1 Release Notes
v1.0 Release Notes
Versioning Policy
Version Numbering
Major Versions
Minor Versions
Patch Versions
Nightly Versions
Dependency Updates
Tagging
Version Timing
Backporting and Support
Glossary
OnDemand’s Known Issues
File names with XML or HTML break display
Problems uploading files
Downloading forbidden directories fails silently
Viewing large files causes problems
Incorrect link in tree root
NoMethodError when using a custom translation file
Dashboard may be slow due to logic in ERB templates
Batch Connect sessions do not contain much debugging info
noVNC does not work with Safari and Apache Basic auth
Multiline select does not work in MS Edge
High output programs may freeze the shell
Paste does not work in older versions of Safari
RStudio and Upgrading Singularity 3 to minor version 5
Next
© Copyright 2017-2024, Ohio Supercomputer Center
Documentation Versions
v:

## http://openondemand.org/
Open OnDemand
Connecting Computing Power With Powerful Minds
Open OnDemand empowers students, researchers, and industry professionals 
with remote web access to supercomputers. 
Compute from anywhere
Run Open OnDemand
Perform high-power calculations, simulations, modeling, and more on the web.
See how
on Run Open OnDemand
Administer remote access
Install Open OnDemand
Make supercomputing accessible with our easy-to-use web portal. 
Learn more
on Install Open OnDemand
Branding
Careers
Licensing
Maintained by OSC
Please cite us Hudak et al., (2018). Open OnDemand: A web-based client portal for HPC centers. Journal of Open Source Software, 3(25), 622, https://doi.org/10.21105/joss.00622 or via our permanent code repos Jeff Ohrstrom, Travis Ravert, Gerald Byrket, Trey Dockendorf, & Alan Chalker. Open OnDemand Source Code. Zenodo. https://doi.org/10.5281/zenodo.6323791
This material is based upon work supported by the National Science Foundation under grant numbers 1534949, 1835725, 2138286, and 2303692 and supported by a team from the Massachusetts Green High Performance Computing Center, Ohio Supercomputer Center, U. of Buffalo CCR, U. of Colorado Boulder, and Virginia Tech.
If you have a disability and experience difficulty accessing this content, please contact the OH-TECH Digital Accessibility Team at accessibility@oh-tech.org.  For information regarding the accessibility and alignment with WCAG standards of the Open OnDemand software itself, please visit openondemand.org/accessibility
© 2024 Open OnDemand. All right reserved.
Privacy Policy

## https://github.com/OSC/Open-OnDemand
Skip to content
Navigation Menu
Sign in
Dismiss alert
This repository has been archived by the owner on Apr 11, 2023. It is now read-only.
OSC
/
Open-OnDemand
Public archive
Notifications
Fork 18
Star 91
Code
Pull requests
Actions
Projects
Wiki
Security
Insights
Additional navigation options
OSC/Open-OnDemand
 master
Go to file
Code
Folders and files
Name Last commit message Last commit date
Latest commit
Gerald Byrket
Update LICENSE.txt
3 years ago
58cd29f
 · 3 years ago
Dec 30, 2021
History
LICENSE.txt
Update LICENSE.txt
3 years agoDec 30, 2021
LICENSE_DOCS.txt
Create LICENSE_DOCS.txt
7 years agoNov 8, 2017
README.md
Update README.md
3 years agoFeb 17, 2021
Repository files navigation
README
MIT license
CC-BY-4.0 license
Open OnDemand - this has been moved to https://github.com/OSC/ondemand
Supercomputing. Seamlessly. Open, Interactive HPC Via the Web
Website: http://openondemand.org/
Website repo: https://github.com/OSC/openondemand.org
Documentation: https://osc.github.io/ood-documentation/latest/
Main code repo: https://github.com/OSC/ondemand
Core library repo: https://github.com/OSC/ood_core
About
Supercomputing. Seamlessly. Open, Interactive HPC Via the Web
openondemand.org
Resources
Readme
License
MIT, CC-BY-4.0 licenses found
Activity
Custom properties
Stars
91 stars
Watchers
23 watching
Forks
18 forks
Report repository
Releases
No releases published
Packages
No packages published
Contributors
8
Footer
© 2024 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Docs
Contact
Manage cookies
Do not share my personal information

## http://www.readthedocs.org/
Product
Pricing
Resources
Log in
Sign up
Documentation simplified
Build, host, and share documentation, all with a single platform.
Sign up now
Easy previews and deploys
Preview changes on every commit to your pull requests. Release documentation to your users on each merge.
Ideal developer experience
Write documentation without changing your workflow or your tools using a docs as code approach.
Work privately or publicly
Easily share within your team or with the whole world. Manage permissions yourself or automatically with GitHub.
Features
Supports any doc tool
Integrated support for Sphinx, MkDocs, Jupyter Book. Flexible enough to work with any documentation tool.
Integrated search
Easily search all your docs via our dashboard, and offer your users a more powerful search with our search API.
Pull request previews
Preview each pull request before releasing any changes, allowing for fast collaboration across your organization.
Versioned docs
Match your product release cycle with multiple versions of your docs. Automatically build versions from any branch or tag.
Private repository support
Paid plan feature
Clone private repositories using a connected GitHub, GitLab, or Bitbucket account, or clone from any Git provider with an SSH key.
Single-Sign On
Paid plan feature
Control who has access to your documentation with integrated authentication. Enable SSO with GitHub or GitLab to easily manage permissions in one place.
Discover all our features
TRY IT OUT
Upgrade your documentation with Read the Docs
.readthedocs.yaml
version: 2
build:
  os: ubuntu-22.04
  tools:
    python: "3.10"
    # You can also specify other tool versions:
    # nodejs: "16"

# Build documentation in the docs/ directory with Sphinx
sphinx:
   configuration: docs/conf.py

# Dependencies required to build your docs
python:
   install:
   - requirements: docs/requirements.txt
Create an account
Sign up with GitHub or your email.
Import your project
Select your existing Git repositories with a 1-click interface.
Add YAML config
Copy this example, it probably does what you want 😉
Your docs build on every commit
Like magic.
Join thousands of happy users
Flask
Web Framework
Flask is a Python web framework built with a small core and easy-to-extend philosophy.
Jupyter
Data Science Environment
Jupyter Notebook is a web-based interactive computational environment for creating notebook documents.
Godot Engine
Game Engine
Godot Engine is a free and open source community-driven 2D and 3D game engine.
Get your docs online in 5 minutes.
Create an account
STAY UPDATED
Blog
Newsletter
Status
LEARN MORE
Documentation
Getting started guide
Configure your project
Comparison to GitHub Pages
Comparison to GitBook
Comparison to Cloudflare Pages
PRODUCT
Features
Pricing
Privacy Policy
Terms of Service
COMPANY
About us
Support
Advertise with Us
Contribute
Copyright 2022, Read the Docs, Inc & contributors

